var LZString=function(){function a(e,f){if(!c[e]){c[e]={};for(var g=0;g<e.length;g++)c[e][e.charAt(g)]=g}return c[e][f]}var b=String.fromCharCode,c={},d={compressToBase64:function(e){if(null==e)return"";e=d._compress(e,6,function(f){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:d._decompress(e.length,
32,function(f){return a("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.charAt(f))})},compressToUTF16:function(e){return null==e?"":d._compress(e,15,function(f){return b(f+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:d._decompress(e.length,16384,function(f){return e.charCodeAt(f)-32})},compressToUint8Array:function(e){e=d.compress(e);for(var f=new Uint8Array(2*e.length),g=0,k=e.length;k>g;g++){var h=e.charCodeAt(g);f[2*g]=h>>>8;f[2*g+1]=h%256}return f},
decompressFromUint8Array:function(e){if(null===e||void 0===e)return d.decompress(e);for(var f=Array(e.length/2),g=0,k=f.length;k>g;g++)f[g]=256*e[2*g]+e[2*g+1];var h=[];return f.forEach(function(q){h.push(b(q))}),d.decompress(h.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":d._compress(e,6,function(f){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(f)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,
"+"),d._decompress(e.length,32,function(f){return a("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",e.charAt(f))}))},compress:function(e){return d._compress(e,16,function(f){return b(f)})},_compress:function(e,f,g){if(null==e)return"";var k,h,q={},B={},E="",G="",D="",y=2,t=3,C=2,w=[],n=0,u=0;for(h=0;h<e.length;h+=1)if(E=e.charAt(h),Object.prototype.hasOwnProperty.call(q,E)||(q[E]=t++,B[E]=!0),G=D+E,Object.prototype.hasOwnProperty.call(q,G))D=G;else{if(Object.prototype.hasOwnProperty.call(B,
D)){if(256>D.charCodeAt(0)){for(k=0;C>k;k++)n<<=1,u==f-1?(u=0,w.push(g(n)),n=0):u++;var x=D.charCodeAt(0);for(k=0;8>k;k++)n=n<<1|1&x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x>>=1}else{x=1;for(k=0;C>k;k++)n=n<<1|x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x=0;x=D.charCodeAt(0);for(k=0;16>k;k++)n=n<<1|1&x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x>>=1}y--;0==y&&(y=Math.pow(2,C),C++);delete B[D]}else for(x=q[D],k=0;C>k;k++)n=n<<1|1&x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x>>=1;y--;0==y&&(y=Math.pow(2,C),C++);q[G]=t++;D=String(E)}if(""!==
D){if(Object.prototype.hasOwnProperty.call(B,D)){if(256>D.charCodeAt(0)){for(k=0;C>k;k++)n<<=1,u==f-1?(u=0,w.push(g(n)),n=0):u++;x=D.charCodeAt(0);for(k=0;8>k;k++)n=n<<1|1&x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x>>=1}else{x=1;for(k=0;C>k;k++)n=n<<1|x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x=0;x=D.charCodeAt(0);for(k=0;16>k;k++)n=n<<1|1&x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x>>=1}y--;0==y&&(y=Math.pow(2,C),C++);delete B[D]}else for(x=q[D],k=0;C>k;k++)n=n<<1|1&x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x>>=1;y--;0==
y&&C++}x=2;for(k=0;C>k;k++)n=n<<1|1&x,u==f-1?(u=0,w.push(g(n)),n=0):u++,x>>=1;for(;;){if(n<<=1,u==f-1){w.push(g(n));break}u++}return w.join("")},decompress:function(e){return null==e?"":""==e?null:d._decompress(e.length,32768,function(f){return e.charCodeAt(f)})},_decompress:function(e,f,g){var k,h,q=[],B=4,E=4,G=3,D=[],y=g(0),t=f,C=1;for(k=0;3>k;k+=1)q[k]=k;var w=0;var n=Math.pow(2,2);for(h=1;h!=n;){var u=y&t;t>>=1;0==t&&(t=f,y=g(C++));w|=(0<u?1:0)*h;h<<=1}switch(w){case 0:w=0;n=Math.pow(2,8);for(h=
1;h!=n;)u=y&t,t>>=1,0==t&&(t=f,y=g(C++)),w|=(0<u?1:0)*h,h<<=1;var x=b(w);break;case 1:w=0;n=Math.pow(2,16);for(h=1;h!=n;)u=y&t,t>>=1,0==t&&(t=f,y=g(C++)),w|=(0<u?1:0)*h,h<<=1;x=b(w);break;case 2:return""}k=q[3]=x;for(D.push(x);;){if(C>e)return"";w=0;n=Math.pow(2,G);for(h=1;h!=n;)u=y&t,t>>=1,0==t&&(t=f,y=g(C++)),w|=(0<u?1:0)*h,h<<=1;switch(x=w){case 0:w=0;n=Math.pow(2,8);for(h=1;h!=n;)u=y&t,t>>=1,0==t&&(t=f,y=g(C++)),w|=(0<u?1:0)*h,h<<=1;q[E++]=b(w);x=E-1;B--;break;case 1:w=0;n=Math.pow(2,16);for(h=
1;h!=n;)u=y&t,t>>=1,0==t&&(t=f,y=g(C++)),w|=(0<u?1:0)*h,h<<=1;q[E++]=b(w);x=E-1;B--;break;case 2:return D.join("")}if(0==B&&(B=Math.pow(2,G),G++),q[x])x=q[x];else{if(x!==E)return null;x=k+k.charAt(0)}D.push(x);q[E++]=k+x.charAt(0);B--;k=x;0==B&&(B=Math.pow(2,G),G++)}}};return d}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);
var UTF={U16to8:function(a){for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);b+=String.fromCharCode(~~(d/256));b+=String.fromCharCode(d%256)}return b},U8to16:function(a){for(var b="",c=0;c<a.length;c+=2){var d=256*a.charCodeAt(c);d+=a.charCodeAt(c+1);b+=String.fromCharCode(d)}return b}},$jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};
(function(){function a(m,v){var p=0,z=!1,r=window.setInterval(function(){m()&&(window.clearInterval(r),v(z));50<p++&&(window.clearInterval(r),z=!0,v(z))},10)}function b(m){m=m.toLowerCase();return 0===m.indexOf("msie")&&0===m.indexOf("trident")?!1:(m=/(?:msie|rv:)\s?([\d\.]+)/.exec(m))&&10<=parseInt(m[1],10)?!0:!1}function c(m){m=(m||h.userAgent).toLowerCase();return(m=m.match(/android\s([0-9\.]*)/))?m[1]:!1}function d(m,v){function p(F){if(F){console.log("candicate "+F);var L=x.exec(F);L&&(L=L[1],
F=F.match(u),void 0===r[L]&&m(L,F,!0),r[L]=!0)}else m()}function z(){H.localDescription.sdp.split("\n").forEach(function(F){F&&0===F.indexOf("a=candidate:")&&p(F)})}if("undefined"!==typeof document&&"function"===typeof document.getElementById){var r={},A=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!A){A=document.getElementById("iframe");if(!A)return;A=A.contentWindow;A=A.RTCPeerConnection||A.mozRTCPeerConnection||A.webkitRTCPeerConnection}if(A){var Q=null;
"Chrome"===l.browser&&58>l.browser.version&&(Q={optional:[{RtpDataChannels:!0}]});var H=new A({iceServers:[]},Q);v&&(H.addStream?H.addStream(v):H.addTrack&&v.getTracks()[0]&&H.addTrack(v.getTracks()[0],v));H.onicecandidate=function(F){F.candidate&&F.candidate.candidate?p(F.candidate.candidate):p()};if(!v)try{H.createDataChannel("",{reliable:!1})}catch(F){}l.isPromisesSupported?H.createOffer().then(function(F){H.setLocalDescription(F).then(z)}):H.createOffer(function(F){H.setLocalDescription(F,z,function(){})},
function(){})}}}function e(m){if(U)if(!h.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(h.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!h.enumerateDevices&&h.enumerateDevices&&(h.enumerateDevices=h.enumerateDevices.bind(h)),h.enumerateDevices){N=[];I=[];J=[];K=[];O=P=R=S=T=!1;var v={};h.enumerateDevices(function(p){N=[];I=[];J=[];K=[];p.forEach(function(z){var r={},A;for(A in z)try{"function"!==typeof z[A]&&(r[A]=z[A])}catch(Q){}v[r.deviceId+
r.label+r.kind]||("audio"===r.kind&&(r.kind="audioinput"),"video"===r.kind&&(r.kind="videoinput"),r.deviceId||(r.deviceId=r.id),r.id||(r.id=r.deviceId),r.label?("videoinput"!==r.kind||O||(O=!0),"audioinput"!==r.kind||P||(P=!0)):(r.isCustomLabel=!0,r.label="videoinput"===r.kind?"Camera "+(K.length+1):"audioinput"===r.kind?"Microphone "+(I.length+1):"audiooutput"===r.kind?"Speaker "+(J.length+1):"Please invoke getUserMedia once.","undefined"!==typeof l&&l.browser.isChrome&&46<=l.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||
"")&&"undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(r.label="HTTPs is required to get label of this "+r.kind+" device.")),"audioinput"===r.kind&&(T=!0,-1===I.indexOf(r)&&I.push(r)),"audiooutput"===r.kind&&(S=!0,-1===J.indexOf(r)&&J.push(r)),"videoinput"===r.kind&&(R=!0,-1===K.indexOf(r)&&K.push(r)),N.push(r),v[r.deviceId+r.label+r.kind]=r)});"undefined"!==typeof l&&(l.MediaDevices=N,l.hasMicrophone=T,l.hasSpeakers=
S,l.hasWebcam=R,l.isWebsiteHasWebcamPermissions=O,l.isWebsiteHasMicrophonePermissions=P,l.audioInputDevices=I,l.audioOutputDevices=J,l.videoInputDevices=K);m&&m()})}else m&&m();else m&&m()}var f="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",g="object"===typeof process&&"object"===typeof process.versions&&process.versions.node&&!process.browser;if(g){var k=process.versions.node.toString().replace("v","");f="Nodejs/"+k+" (NodeOS) AppleWebKit/"+k+" (KHTML, like Gecko) Nodejs/"+
k+" Nodejs/"+k}(function(m){"undefined"===typeof window&&("undefined"===typeof window&&"undefined"!==typeof global?(global.navigator={userAgent:f,getUserMedia:function(){}},m.window=global):"undefined"===typeof window&&console.log("window undefined"),"undefined"===typeof location&&(m.location={protocol:"file:",href:"",hash:""}),"undefined"===typeof screen&&(m.screen={width:0,height:0}))})("undefined"!==typeof global?global:window);var h=window.navigator;"undefined"!==typeof h?("undefined"!==typeof h.webkitGetUserMedia&&
(h.getUserMedia=h.webkitGetUserMedia),"undefined"!==typeof h.mozGetUserMedia&&(h.getUserMedia=h.mozGetUserMedia)):h={getUserMedia:function(){},userAgent:f};k=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(h.userAgent||"");var q=-1!==h.userAgent.indexOf("Edge")&&(!!h.msSaveOrOpenBlob||!!h.msSaveBlob),B=!!window.opera||0<=h.userAgent.indexOf(" OPR/"),E=-1<h.userAgent.toLowerCase().indexOf("firefox")&&"netscape"in window&&/ rv:/.test(h.userAgent),G=/^((?!chrome|android).)*safari/i.test(h.userAgent),
D=!!window.chrome&&!B,y={Android:function(){return h.userAgent.match(/Android/i)},BlackBerry:function(){return h.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return h.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return h.userAgent.match(/Opera Mini/i)},Windows:function(){return h.userAgent.match(/IEMobile/i)},any:function(){return y.Android()||y.BlackBerry()||y.iOS()||y.Opera()||y.Windows()},getOsName:function(){var m="Unknown OS";y.Android()&&(m="Android");y.BlackBerry()&&(m="BlackBerry");
y.iOS()&&(m="iOS");y.Opera()&&(m="Opera Mini");y.Windows()&&(m="Windows");return m}},t="Unknown OS",C="Unknown OS Version";(g=function(){for(var m=h.appVersion,v=h.userAgent,p="-",z=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",
r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",
r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],r=0,A;A=z[r];r++)if(A.r.test(v)){p=A.s;break}z="-";/Windows/.test(p)&&(/Windows (.*)/.test(p)&&(z=/Windows (.*)/.exec(p)[1]),p="Windows");switch(p){case "Mac OS X":/Mac OS X (10[\._\d]+)/.test(v)&&(z=/Mac OS X (10[\._\d]+)/.exec(v)[1]);break;case "Android":/Android ([\._\d]+)/.test(v)&&
(z=/Android ([\._\d]+)/.exec(v)[1]);break;case "iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(v)&&(z=/OS (\d+)_(\d+)_?(\d+)?/.exec(m))&&3<z.length&&(z=z[1]+"."+z[2]+"."+(z[3]|0))}return{osName:p,osVersion:z}}())&&g.osName&&"-"!=g.osName?(t=g.osName,C=g.osVersion):y.any()&&(t=y.getOsName(),"Android"==t&&(C=c()));g="object"===typeof process&&"object"===typeof process.versions&&process.versions.node;"Unknown OS"===t&&g&&(t="Nodejs",C=process.versions.node.toString().replace("v",""));var w=!1,n=!1;["captureStream",
"mozCaptureStream","webkitCaptureStream"].forEach(function(m){"undefined"!==typeof document&&"function"===typeof document.createElement&&(!w&&m in document.createElement("canvas")&&(w=!0),!n&&m in document.createElement("video")&&(n=!0))});var u=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,x=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,ba=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,N=[],I=[],J=[],K=[];h.mediaDevices&&h.mediaDevices.enumerateDevices&&(h.enumerateDevices=function(m){var v=h.mediaDevices.enumerateDevices();
v&&v.then?h.mediaDevices.enumerateDevices().then(m).catch(function(){m([])}):m([])});var U=!1;"undefined"!==typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?U=!0:h.mediaDevices&&h.mediaDevices.enumerateDevices&&(U=!0);var T=!1,S=!1,R=!1,P=!1,O=!1,l=window.DetectRTC||{};l.browser=function(){var m=h.userAgent,v=h.appName,p=""+parseFloat(h.appVersion);parseInt(h.appVersion,10);var z,r;if(B){v="Opera";try{p=h.userAgent.split("OPR/")[1].split(" ")[0],p.split(".")}catch(Q){p="0.0.0.0"}}else if(D){var A=
m.indexOf("Chrome");v="Chrome";p=m.substring(A+7)}else G?-1!==m.indexOf("CriOS")?(A=m.indexOf("CriOS"),v="Chrome",p=m.substring(A+6)):-1!==m.indexOf("FxiOS")?(A=m.indexOf("FxiOS"),v="Firefox",p=m.substring(A+6)):(A=m.indexOf("Safari"),v="Safari",p=m.substring(A+7),-1!==(A=m.indexOf("Version"))&&(p=m.substring(A+8)),-1!==h.userAgent.indexOf("Version/")&&(p=h.userAgent.split("Version/")[1].split(" ")[0])):E?(A=m.indexOf("Firefox"),v="Firefox",p=m.substring(A+8)):(z=m.lastIndexOf(" ")+1)<(A=m.lastIndexOf("/"))&&
(v=m.substring(z,A),p=m.substring(A+1),v.toLowerCase()===v.toUpperCase()&&(v=h.appName));q&&(v="Edge",p=h.userAgent.split("Edge/")[1]);-1!==(r=p.search(/[; \)]/))&&(p=p.substring(0,r));m=parseInt(""+p,10);isNaN(m)&&(p=""+parseFloat(h.appVersion),m=parseInt(h.appVersion,10));return{fullVersion:p,version:m,name:v,isPrivateBrowsing:!1}}();(function(m){try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){p=!1},function(z){p=!0});else if(window.indexedDB&&
/Firefox/.test(window.navigator.userAgent)){try{var v=window.indexedDB.open("test");v.onerror=function(){return!0}}catch(z){var p=!0}"undefined"===typeof p&&a(function(){return"done"===v.readyState?!0:!1},function(z){z||(p=v.result?!1:!0)})}else if(b(window.navigator.userAgent)){p=!1;try{window.indexedDB||(p=!0)}catch(z){p=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(z){p=!0}"undefined"===typeof p&&(p=!1,window.localStorage.removeItem("test"))}}catch(z){p=
!1}a(function(){return"undefined"!==typeof p?!0:!1},function(z){m(p)})})(function(m){l.browser.isPrivateBrowsing=!!m});l.browser["is"+l.browser.name]=!0;l.osName=t;l.osVersion=C;var W=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(m){W||m in window&&(W=!0)});l.isWebRTCSupported=W;l.isORTCSupported="undefined"!==typeof RTCIceGatherer;t=!1;l.browser.isChrome&&35<=l.browser.version?t=!0:l.browser.isFirefox&&34<=l.browser.version?t=!0:l.browser.isEdge&&
17<=l.browser.version?t=!0:"Android"===l.osName&&l.browser.isChrome&&(t=!0);if(h.getDisplayMedia||h.mediaDevices&&h.mediaDevices.getDisplayMedia)t=!0;/^(https:|chrome-extension:)$/g.test(location.protocol||"")||("undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(l.browser.isChrome||l.browser.isEdge||l.browser.isOpera)?t=!1:l.browser.isFirefox&&(t=!1));l.isScreenCapturingSupported=t;var Z=!1,aa=!1;["AudioContext",
"webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(m){!Z&&m in window&&(Z=!0,window[m]&&"createMediaStreamSource"in window[m].prototype&&(aa=!0))});l.isAudioContextSupported=Z;l.isCreateMediaStreamSourceSupported=aa;t=!1;l.browser.isChrome&&31<l.browser.version&&(t=!0);l.isRtpDataChannelsSupported=t;t=!1;l.browser.isFirefox&&28<l.browser.version?t=!0:l.browser.isChrome&&25<l.browser.version?t=!0:l.browser.isOpera&&11<=l.browser.version&&(t=!0);l.isSctpDataChannelsSupported=
t;l.isMobileDevice=k;k=!1;h.getUserMedia?k=!0:h.mediaDevices&&h.mediaDevices.getUserMedia&&(k=!0);l.browser.isChrome&&46<=l.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(k="Requires HTTPs");"Nodejs"===l.osName&&(k=!1);l.isGetUserMediaSupported=k;k="";screen.width&&(k+=""+(screen.width?screen.width:"")+" x "+(screen.height?screen.height:
""));l.displayResolution=k;l.displayAspectRatio=function(m,v){function p(r,A){return 0==A?r:p(A,r%A)}var z=p(m,v);return m/z/(v/z)}(screen.width,screen.height).toFixed(2);l.isCanvasSupportsStreamCapturing=w;l.isVideoSupportsStreamCapturing=n;"Chrome"==l.browser.name&&53<=l.browser.version&&(l.isCanvasSupportsStreamCapturing||(l.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),l.isVideoSupportsStreamCapturing||(l.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"));
l.DetectLocalIPAddress=function(m,v){if(l.isWebRTCSupported){var p=!0,z=!0;d(function(r){r?r.match(u)?(p=!1,m("Local: "+r,p,z)):(r.match(ba)&&(z=!1),m("Public: "+r,p,z)):m()},v)}};l.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING;l.isWebSocketsBlocked=!l.isWebSocketsSupported;"Nodejs"===l.osName&&(l.isWebSocketsSupported=!0,l.isWebSocketsBlocked=!1);l.checkWebSocketsSupport=function(m){m=m||function(){};try{var v,p=new WebSocket("wss://echo.websocket.org:443/");p.onopen=function(){l.isWebSocketsBlocked=
!1;v=(new Date).getTime();p.send("ping")};p.onmessage=function(){l.WebsocketLatency=(new Date).getTime()-v+"ms";m();p.close();p=null};p.onerror=function(){l.isWebSocketsBlocked=!0;m()}}catch(z){l.isWebSocketsBlocked=!0,m()}};l.load=function(m){e(m||function(){})};"function"===typeof e&&console.log("check device support !");l.MediaDevices="undefined"!==typeof N?N:[];l.hasMicrophone=T;l.hasSpeakers=S;l.hasWebcam=R;l.isWebsiteHasWebcamPermissions=O;l.isWebsiteHasMicrophonePermissions=P;l.audioInputDevices=
I;l.audioOutputDevices=J;l.videoInputDevices=K;k=!1;"undefined"!==typeof document&&"function"===typeof document.createElement&&"setSinkId"in document.createElement("video")&&(k=!0);l.isSetSinkIdSupported=k;k=!1;l.browser.isFirefox&&"undefined"!==typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(k=!0):l.browser.isChrome&&"undefined"!==typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(k=!0);l.isRTPSenderReplaceTracksSupported=k;k=!1;l.browser.isFirefox&&
38<l.browser.version&&(k=!0);l.isRemoteStreamProcessingSupported=k;k=!1;"undefined"!==typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(k=!0);l.isApplyConstraintsSupported=k;k=!1;l.browser.isFirefox&&43<=l.browser.version&&(k=!0);l.isMultiMonitorScreenCapturingSupported=k;l.isPromisesSupported=!!("Promise"in window);l.version="1.4.1";"undefined"===typeof l&&(window.DetectRTC={});k=window.MediaStream;"undefined"===typeof k&&"undefined"!==typeof webkitMediaStream&&(k=webkitMediaStream);
l.MediaStream="undefined"!==typeof k&&"function"===typeof k?Object.keys(k.prototype):!1;l.MediaStreamTrack="undefined"!==typeof MediaStreamTrack?Object.keys(MediaStreamTrack.prototype):!1;k=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;l.RTCPeerConnection="undefined"!==typeof k?Object.keys(k.prototype):!1;window.DetectRTC=l;"undefined"!==typeof module&&(module.exports=l);"function"===typeof define&&define.amd&&define("DetectRTC",[],function(){return l})})();
var cc=cc||{};
cc.defineGetterSetter=function(a,b,c,d,e,f){if(a.__defineGetter__)c&&a.__defineGetter__(b,c),d&&a.__defineSetter__(b,d);else if(Object.defineProperty){var g={enumerable:!1,configurable:!0};c&&(g.get=c);d&&(g.set=d);Object.defineProperty(a,b,g)}else throw Error("browser does not support getters");if(!e&&!f){g=null!=c;for(var k=void 0!=d,h=Object.getOwnPropertyNames(a),q=0;q<h.length;q++){var B=h[q];if((a.__lookupGetter__?!a.__lookupGetter__(B):!Object.getOwnPropertyDescriptor(a,B))&&"function"===typeof a[B]){var E=
a[B];if(g&&E===c&&(e=B,!k||f))break;if(k&&E===d&&(f=B,!g||e))break}}}a=a.constructor;e&&(a.__getters__||(a.__getters__={}),a.__getters__[e]=b);f&&(a.__setters__||(a.__setters__={}),a.__setters__[f]=b)};cc.clone=function(a){var b=a.constructor?new a.constructor:{},c;for(c in a){var d=a[c];b[c]="object"!==typeof d||!d||d instanceof cc.Node||d instanceof HTMLElement?d:cc.clone(d)}return b};cc.inject=function(a,b){for(var c in a)b[c]=a[c]};
var ClassManager=function(){var a=0|998*Math.random(),b=0|998*Math.random();this.getNewID=function(){return a++};this.getNewInstanceId=function(){return b++}},classManager=new ClassManager;
(function(){var a=/\b_super\b/;cc.Class=function(){};cc.Class.extend=function(b){cc.isEmpty(b._html)||cc.import(b._html);cc.isEmpty(b._css)||cc.import(b._css);var c=this.prototype,d=Object.create(c),e={writable:!0,enumerable:!1,configurable:!0};var f=function(C,w,n,u,x){this.__instanceId=classManager.getNewInstanceId();if(this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(C);break;case 2:this.ctor(C,w);break;case 3:this.ctor(C,w,n);break;case 4:this.ctor(C,w,n,u);break;case 5:this.ctor(C,
w,n,u,x);break;default:this.ctor.apply(this,arguments)}};e.value=classManager.getNewID();Object.defineProperty(d,"__pid",e);f.prototype=d;e.value=f;Object.defineProperty(d,"constructor",e);this.__getters__&&(f.__getters__=cc.clone(this.__getters__));this.__setters__&&(f.__setters__=cc.clone(this.__setters__));for(var g=0,k=arguments.length;g<k;++g){var h=arguments[g],q;for(q in h){var B="function"===typeof h[q],E="function"===typeof c[q],G=a.test(h[q]);B&&E&&G?(e.value=function(C,w){return function(){var n=
this._super;this._super=c[C];var u=w.apply(this,arguments);this._super=n;return u}}(q,h[q]),Object.defineProperty(d,q,e)):B?(e.value=h[q],Object.defineProperty(d,q,e)):d[q]=h[q];if(B){if(this.__getters__&&this.__getters__[q]){B=this.__getters__[q];for(var D in this.__setters__)if(this.__setters__[D]===B){var y=D;break}cc.defineGetterSetter(d,B,h[q],h[y]?h[y]:d[y],q,y)}if(this.__setters__&&this.__setters__[q]){B=this.__setters__[q];for(D in this.__getters__)if(this.__getters__[D]===B){var t=D;break}cc.defineGetterSetter(d,
B,h[t]?h[t]:d[t],h[q],t,q)}}}}f.extend=cc.Class.extend;f.implement=function(C){for(var w in C)d[w]=C[w]};return f}})();cc.each=function(a,b,c){if(a)if(a instanceof Array)for(var d=0,e=a.length;d<e&&!1!==b.call(c,a[d],d);d++);else for(d in a)if(!1===b.call(c,a[d],d))break};cc.extend=function(a){var b=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];cc.each(b,function(c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])});return a};
cc.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a};cc.isFunction=function(a){return"function"===typeof a};cc.isNumber=function(a){return"number"===typeof a||"[object Number]"===Object.prototype.toString.call(a)};cc.isString=function(a){return"string"===typeof a||"[object String]"===Object.prototype.toString.call(a)};cc.isArray=function(a){return Array.isArray(a)||"object"===typeof a&&"[object Array]"===Object.prototype.toString.call(a)};
cc.isUndefined=function(a){return"undefined"===typeof a};cc.isObject=function(a){return"object"===typeof a&&"[object Object]"===Object.prototype.toString.call(a)};cc.objToArray=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};cc.localLog={maxLog:20,isLocalStorage:localStorage?!0:!1,push:function(a){},send:function(a,b){}};cc.log=function(a){var b=(new Date).toISOString();a=b.substr(b.length-13,13)+"--"+a;console.log(a)};
cc.isEmpty=function(a){return void 0==a||null==a||""==a.toString()?!0:!1};String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)};cc.Class.prototype.addCEventListener=function(a,b,c){null==this.arrEventCb&&(this.arrEventCb=[]);for(var d=!1,e=0;e<this.arrEventCb.length;e++)if(this.arrEventCb[e].ev==a&&this.arrEventCb[e].cb==b&&this.arrEventCb[e].caller==c){d=!0;break}d||this.arrEventCb.push({ev:a,cb:b,caller:c})};
cc.Class.prototype.removeCEventListener=function(a,b,c){null==this.arrEventCb&&(this.arrEventCb=[]);for(var d=0;d<this.arrEventCb.length;d++)if(this.arrEventCb[d].ev==a&&this.arrEventCb[d].cb==b&&c==this.arrEventCb[d].caller){this.arrEventCb.splice(d,1);break}};cc.Class.prototype.CEventCallback=function(a){if(null!=this.arrEventCb)for(var b=this.arrEventCb.concat(),c=0;c<b.length;c++)b[c].ev==a&&b[c].cb.apply(b[c].caller,arguments)};
cc.Class.prototype.dispath=function(a){if(null!=this.arrEventCb)for(var b=this.arrEventCb.concat(),c=0;c<b.length;c++)b[c].ev==a&&b[c].cb.apply(b[c].caller,arguments)};cc.Class.prototype.removeAllCEventListener=function(a){if(null==a)null!=this.arrEventCb&&(this.arrEventCb=[]);else if(null!=this.arrEventCb&&void 0!=this.arrEventCb){do{var b=!1;for(var c=0;c<this.arrEventCb.length;c++)if(this.arrEventCb[c].ev==a){this.arrEventCb.splice(c,1);b=!0;break}}while(b)}};
cc.os=function(){var a=navigator.userAgent.toLowerCase(),b=/iphone|ipod|ipad/.test(a);return/android/.test(a)?"android":b?"ios":"pc"};cc.isMobile=function(){return"android"==cc.os||"ios"==cc.os?!0:!1};cc.isWebview=function(){return"zaloWebview"==cc.browserName||"fbWebview"==cc.browserName||"webview"==cc.browserName?!0:!1};
cc.browserName=function(){var a=navigator.userAgent.toLowerCase();if(0<=a.indexOf("zalo"))return"zaloWebview";if(0<=a.indexOf("FBAV"))return"fbWebview";if(0<=a.indexOf("webview"))return"webview";if(0<=a.indexOf("coccoc"))return"coccoc";var b=!!window.opr&&!!opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),c="undefined"!==typeof InstallTrigger,d=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!==typeof safari&&window.safari.pushNotification).toString();
0<=a.indexOf("safari")&&(d=!0);a=!!window.StyleMedia;var e=-1!=navigator.userAgent.indexOf("Chrome"),f=e&&-1!=navigator.userAgent.indexOf("Edg");return b?"opera":d?"safari":c?"firefox":a?"edge":e?"chrome":f?"edgeChrome":"other"};cc.touchable=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};cc.webrtcSupport=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof RTCPeerConnection?!0:!1};
cc.mediaRecorderSupport=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.MediaRecorder?!0:!1};cc.workerSupport=function(){return"undefined"!==typeof Worker?!0:!1};
cc.fullscreenSupport=function(){var a=document.body;return"undefined"!==typeof a.requestFullscreen||"undefined"!==typeof a.mozRequestFullScreen||"undefined"!==typeof a.webkitRequestFullscreen||"undefined"!==typeof a.msRequestFullscreen||"undefined"!==typeof document.exitFullscreen||"undefined"!==typeof document.mozCancelFullScreen||"undefined"!==typeof document.webkitExitFullscreen};cc.removeAllChildNodes=function(a){if(a)for(;a.firstChild;)a.removeChild(a.firstChild)};
cc.removeDomAttr=function(a,b){if(cc.isArray(b)&&a&&a instanceof HTMLElement)for(var c=0;c<b.length;c++)a.removeAttribute(b[c])};cc.getAttrToNumber=function(a,b){return Number(a.getAttribute(b))};cc.createGrid=function(a,b){if(0>=a||0>=b)return null;for(var c=document.createElement("div"),d=100/a,e=100/b,f=0;f<a*b;f++){var g=document.createElement("div");g.style.width=e+"%";g.style.height=d+"%";g.style.position="relative";g.style.float="left";g.setAttribute("grid",f);c.appendChild(g)}return c};
cc.dragDom=null;cc.winSize=function(){return{width:window.innerWidth,height:window.innerHeight}};cc.getParameterByName=function(a,b=window.location.href){a=a.replace(/[\[\]]/g,"\\$&");return(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null};cc.appVer=.1;
cc.loadCss=function(a){for(var b=0;b<a.length;b++){var c=document.getElementsByTagName("HEAD")[0],d=document.createElement("link");d.rel="stylesheet";d.type="text/css";d.href=a[b]+"?ver="+cc.appVer;c.appendChild(d)}};cc.insertCss=function(a){var b=document.createElement("style");b.type="text/css";b.innerHTML=a;document.getElementsByTagName("head")[0].appendChild(b)};
cc.getText=function(a,b){if(a)try{const c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&(200==this.status?b&&b(!0,this.responseText):b(!1,this.status))};c.open("GET",a+"?ver="+cc.appVer);c.send()}catch(c){b(!1,c.toString())}};
cc.getJson=function(a,b){if(a)try{const c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){if(b)try{b(!0,JSON.parse(this.responseText))}catch(d){b(!1,"error parse json result "+this.responseText)}}else b(!1,this.status)};c.open("GET",a+"?ver="+cc.appVer);c.send()}catch(c){b(!1,c.toString())}};
cc.loadJs=function(a,b,c){cc.isString(a)&&(a=[a]);if(!cc.isNumber(c)||0>c)c=0;if(a&&cc.isArray(a))if(a.length<=c)b&&b.call(null,!0);else{var d=a[c],e=document.createElement("script");e.onload=()=>{c<a.length&&(c++,cc.loadJs(a,b,c))};e.onerror=()=>{b&&b.call(null,!1)};e.src=d+"?ver="+cc.appVer;e.async=!0;document.body.appendChild(e)}};
cc.loadHtml=function(a,b,c){if(!cc.isNumber(c)||0>c)c=0;a&&cc.isArray(a)&&(a.length<=c?b&&b.call(null,!0):cc.getText(a[c],(d,e)=>{d&&(cc.htmlImport[a[c]]=e);c++;cc.loadHtml(a,b,c)}))};cc.jsfw=[];cc.coreready=null;cc.callbackready=null;cc.onready=function(a){null==cc.coreready?cc.callbackready=a:a.call(null,cc.coreready)};cc.loadJs(cc.jsfw,a=>{cc.coreready=a;cc.callbackready&&cc.callbackready.call(null,cc.coreready)});cc.htmlImport={};cc.cssImport={};
cc.getHtml=function(a){return cc.htmlImport[a]?cc.htmlImport[a]:""};cc.import=function(a){0<a.indexOf(".css")&&(cc.cssImport[a]||(cc.cssImport[a]=a));0<a.indexOf(".html")&&(cc.htmlImport[a]||(cc.htmlImport[a]=a))};cc.initApp=function(a,b){cc.loadJs(a,c=>{cc.loadCss(cc.objToArray(cc.cssImport));cc.loadHtml(cc.objToArray(cc.htmlImport),()=>{b&&b()})})};
cc.randomUUID=function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"==b?c:c&3|8).toString(16)})};cc.md5=function(a){return M(V(Y(X(a),8*a.length))).toLowerCase()};function M(a){for(var b,c="",d=0;d<a.length;d++)b=a.charCodeAt(d),c+="0123456789ABCDEF".charAt(b>>>4&15)+"0123456789ABCDEF".charAt(15&b);return c}
function X(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b}function V(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b}
function Y(a,b){a[b>>5]|=128<<b%32;a[14+(b+64>>>9<<4)]=b;b=1732584193;for(var c=-271733879,d=-1732584194,e=271733878,f=0;f<a.length;f+=16){var g=b,k=c,h=d,q=e;c=md5_ii(c=md5_ii(c=md5_ii(c=md5_ii(c=md5_hh(c=md5_hh(c=md5_hh(c=md5_hh(c=md5_gg(c=md5_gg(c=md5_gg(c=md5_gg(c=md5_ff(c=md5_ff(c=md5_ff(c=md5_ff(c,d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+0],7,-680876936),c,d,a[f+1],12,-389564586),b,c,a[f+2],17,606105819),e,b,a[f+3],22,-1044525330),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+4],7,-176418897),
c,d,a[f+5],12,1200080426),b,c,a[f+6],17,-1473231341),e,b,a[f+7],22,-45705983),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+8],7,1770035416),c,d,a[f+9],12,-1958414417),b,c,a[f+10],17,-42063),e,b,a[f+11],22,-1990404162),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+12],7,1804603682),c,d,a[f+13],12,-40341101),b,c,a[f+14],17,-1502002290),e,b,a[f+15],22,1236535329),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+1],5,-165796510),c,d,a[f+6],9,-1069501632),b,c,a[f+11],14,643717713),e,b,a[f+0],20,-373897302),d=md5_gg(d,
e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+5],5,-701558691),c,d,a[f+10],9,38016083),b,c,a[f+15],14,-660478335),e,b,a[f+4],20,-405537848),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+9],5,568446438),c,d,a[f+14],9,-1019803690),b,c,a[f+3],14,-187363961),e,b,a[f+8],20,1163531501),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+13],5,-1444681467),c,d,a[f+2],9,-51403784),b,c,a[f+7],14,1735328473),e,b,a[f+12],20,-1926607734),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+5],4,-378558),c,d,a[f+8],11,-2022574463),b,c,a[f+11],16,
1839030562),e,b,a[f+14],23,-35309556),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+1],4,-1530992060),c,d,a[f+4],11,1272893353),b,c,a[f+7],16,-155497632),e,b,a[f+10],23,-1094730640),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+13],4,681279174),c,d,a[f+0],11,-358537222),b,c,a[f+3],16,-722521979),e,b,a[f+6],23,76029189),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+9],4,-640364487),c,d,a[f+12],11,-421815835),b,c,a[f+15],16,530742520),e,b,a[f+2],23,-995338651),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+0],6,
-198630844),c,d,a[f+7],10,1126891415),b,c,a[f+14],15,-1416354905),e,b,a[f+5],21,-57434055),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+12],6,1700485571),c,d,a[f+3],10,-1894986606),b,c,a[f+10],15,-1051523),e,b,a[f+1],21,-2054922799),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+8],6,1873313359),c,d,a[f+15],10,-30611744),b,c,a[f+6],15,-1560198380),e,b,a[f+13],21,1309151649),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+4],6,-145523070),c,d,a[f+11],10,-1120210379),b,c,a[f+2],15,718787259),e,b,a[f+9],21,-343485551);
b=safe_add(b,g);c=safe_add(c,k);d=safe_add(d,h);e=safe_add(e,q)}return[b,c,d,e]}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,g){return md5_cmn(b&c|~b&d,a,b,e,f,g)}function md5_gg(a,b,c,d,e,f,g){return md5_cmn(b&d|c&~d,a,b,e,f,g)}function md5_hh(a,b,c,d,e,f,g){return md5_cmn(b^c^d,a,b,e,f,g)}function md5_ii(a,b,c,d,e,f,g){return md5_cmn(c^(b|~d),a,b,e,f,g)}
function safe_add(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function bit_rol(a,b){return a<<b|a>>>32-b}cc.keywordNotStyle=["element","_childStyle","state"];
cc.Node=cc.Class.extend({_name:"",_lcid:0,_countChild:0,_render:null,_children:null,_parent:null,_style:null,_nodeType:"Node",ctor:function(a){this._initRender(a);a&&this.css(a)},_initRender:function(a){null==a&&(a={});cc.isEmpty(a.element)&&(a.element=cc.getHtml(this._html));if(!cc.isEmpty(a.element)){if(cc.isString(a.element))try{var b=document.createElement("div");b.innerHTML=a.element.trim();var c=b.firstChild;if(c&&1==c.nodeType){this._render=c;this._render.setAttribute("_nt",this.getType());
return}}catch(d){cc.log("error create element from  html :"+a.element+":"+this._idLocal+":"+this.getType())}if(a.element instanceof HTMLElement){this._render=a.element;this._render.setAttribute("_nt",this.getType());return}}this._render=document.createElement("div");this._render.setAttribute("_nt",this.getType())},appendTo:function(a){a instanceof HTMLElement&&a.appendChild(this._render)},addChild:function(a){a._nodeType&&this._render&&a._render instanceof HTMLElement&&(this._render.appendChild(a._render),
this._children=this._children||{},a._lcid=this._countChild++,this._children[a._lcid]=a,a._parent=this)},removeChild:function(a,b){a._parent&&a._parent._render&&a._parent._render.removeChild(a._render);delete this._children[a._idNode];b&&a.release&&a.release()},removeAllChild:function(){for(var a in this._children)this.removeChild(this._children[a])},children:function(){var a=[],b;for(b in this._children)a.push(this._children);return a},getParent:function(){return this._parent},getRender:function(){return this._render},
getChildrenByName:function(a){if(cc.isEmpty(a))return null;for(var b in this._children)if(this._children[b].name==a)return this._children[b]},getChildByLcId:function(a){return!cc.isNumber(a)||0>Number(a)?null:this._children[a]?this._children[a]:null},toObject:function(){},fromObject:function(a){this._countChild=a.countChild?a.countChild:this._countChild},getType:function(){return this._nodeType},_release:function(){this.removeAllChild();this._render=null;this.removeAllCEventListener()},cssChild:function(a){if(this._render)for(var b in a){var c=
this._render.getChildrenByName(b);if(c)for(var d=0;d<c.length;d++)this.cssDom(c[d],a[b])}},css:function(a,b){if(!this._render||!this._render.style)return!1;this._style=this._style||{};var c=!0;if(cc.isString(a)){if(!b)return this._render.style[a];0>cc.keywordNotStyle.indexOf(a)&&(a=this._replaceCssProperties(a),this._render.style[a]=b,this._render.style[a]==b?this._style[a]=b:c=!1)}else{a=this._replaceCssProperties(a);for(var d in a)0>cc.keywordNotStyle.indexOf(d)?(this._render.style[d]=a[d],this._render.style[d]==
a[d]?this._style[d]=a[d]:c=!1):"_childStyle"==d&&this.cssChild(a[d])}""!=this._render.style.display&&"none"!=this._render.style.display&&(this._render.style.cdisplay=this._render.style.display);if(this._style.scaleX||this._style.scaleY||this._style.rotation)a="",this._style.rotation&&(a+="rotate("+this._style.rotation+"deg) "),this._style.scaleX&&(a+="scaleX("+this._style.scaleX+") "),this._style.scaleY&&(a+="scaleY("+this._style.scaleY+") "),this._render.style.transform=a;return c},cssDom:function(a,
b,c){if(cc.isString(b))b=this._replaceCssProperties(b),a.style[b]=c;else{b=this._replaceCssProperties(b);for(var d in b)a.style[d]=b[d]}},_replaceCssProperties:function(a){cc.isObject(a)&&(void 0!=a.x&&(a.left=a.x),void 0!=a.y&&(a.top=a.y),void 0!=a.rotate&&(a.rotation=a.rotate),delete a.x,delete a.y);if(cc.isString(a)){if("x"==a)return"left";if("y"==a)return"top";if("rotate"==a)return"ratation"}return a},_renderStyle:function(){return this._render&&this._render.style?this._render.style:null},setWidth:function(a){return this._renderStyle()?
cc.isString(a)?this.css("width",a):!cc.isNumber(a)||0>Number(a)?!1:this.css("width",a+"px"):!1},getWidth:function(){return this._renderStyle()?parseInt(this._render.style.width):0},setHeight:function(a){return this._renderStyle()?cc.isString(a)?this.css("height",a):!cc.isNumber(a)||0>Number(a)?!1:this.css("height",a+"px"):!1},getHeight:function(){return this._renderStyle()?parseInt(this._render.style.height):0},setX:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("left",a+"px"):!1},
getX:function(){return this._renderStyle()?parseInt(this._render.style.left):0},setY:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("top",a+"px"):!1},getY:function(){return this._renderStyle()?parseInt(this._render.style.top):0},getClientBoudingBox:function(){return this._render&&this._render.getClientBoudingBox?this._render.getClientBoudingBox():null},setVisible:function(a){this._renderStyle()&&(this._render.style.display=a?cc.isUndefined(this._render.style.cdisplay)?"":this._render.style.cdisplay:
"none")},getVisible:function(){return this._renderStyle()?"none"==this._render.style.display?!0:!1:!1},setColor:function(a){return this._renderStyle()?this.css("color",a):!1},getColor:function(){return this._renderStyle()?this._render.style.color.toString():""},setOpacity:function(a){return this._renderStyle()?this.css("opacity",a):!1},getOpacity:function(){return this._renderStyle()&&cc.isNumber(this._render.style.opacity)?this._render.style.opacity:1},setRotate:function(a){return!this._renderStyle()||
!cc.isNumber(a)||0>Number(a)?!1:this.css("rotation",a)},getRotate:function(){return this._renderStyle()&&this._style.rotation?this._style.rotation:0},setScaleX:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("scaleX",a):!1},getScaleX:function(){return this._renderStyle()&&this._style.scaleX?this._style.scaleX:1},setScaleY:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("scaleY",a):!1},getScaleY:function(){return this._renderStyle()&&this._style.scaleY?this._style.scaleY:
1},setScale:function(a,b){this.setScaleX(a);this.setScaleY(b)},setButtonMode:function(a){if(!this._renderStyle())return!1;a?this.css("cursor","pointer"):this.css("cursor","default")},anim:function(a,b,c,d){cc.isObject(a)||cc.isArray(a)?this.animFromTo(null,a,b,c,d):cc.isString(a)&&this._render&&(a=cc.animePattern.getFromTo(a,this))&&(b&&(a.to.duration=b),this.animFromTo(a.from,a.to,b,c,d))},animFromTo:function(a,b,c,d,e){if(this._render&&b&&(cc.isArray(b)||cc.isObject(b))){d&&"true"==d.toString().trim()||
(d=!1);null==e&&(e="normal");try{this.stopAnim();this.timeline=anime.timeline({targets:this._render,loop:d,duration:Number(c),direction:e});a&&cc.isObject(a)&&(a=this._replaceCssProperties(a),this.timeline._from=a,this.css(a));if(cc.isArray(b))for(a=0;a<b.length;a++)b[a]=this._replaceCssProperties(b[a]),this.timeline.add(b[a]);else cc.isObject(b)&&(b=this._replaceCssProperties(b),this.timeline.add(b));this.timeline._animto=b}catch(f){cc.log("runAnim error "+f.message)}}},stopAnimToEnd:function(){this.timeline&&
this.timeline.pause();anime.remove(this._render);for(var a=0;a<this.timeline._animto.length;a++){var b=this.timeline._animto[a];delete b.targets;delete b.easing;delete b.duration;delete b.delay;delete b.endDelay;delete b.round;this.css(b)}delete this.timeline._from;delete this.timeline._timelines},stopAnim:function(){this.timeline&&(this.timeline.pause(),anime.remove(this._render),delete this.timeline._from,delete this.timeline._timelines)},addTouchStart:function(a){this.addDomTouchStart(this._render,
a)},removeTouchStart:function(){this.removeDomTouchStart(this._render)},addDomTouchStart:function(a,b){a.touchStartEnabled=!0;a.addEventListener("mousedown",c=>{this._onDomDown(c,b)});a.addEventListener("touchstart",c=>{this._onDomDown(c,b);c.preventDefault()})},_onDomDown:function(a,b){if(a.currentTarget.touchStartEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();cc.removeDomAttr(a,"move_time move_pageX move_pageY move_clientX move_clientY end_time".split(" "));
a.setAttribute("start_time",c.time);a.setAttribute("start_pageX",c.pageX);a.setAttribute("start_pageY",c.pageY);a.setAttribute("start_clientX",c.clientX);a.setAttribute("start_clientY",c.clientY);_windowUp();a.dragEnabled&&(cc.dragDom=a,a.setAttribute("start_left",parseInt(a.style.left)),a.setAttribute("start_top",parseInt(a.style.top)),window.addEventListener("mousemove",_windowMove),window.addEventListener("touchmove",_windowMove),window.addEventListener("mouseup",_windowUp),window.addEventListener("touchend",
_windowUp));b&&b(c)}},removeDomTouchStart:function(a){a.dragEnabled||(a.touchStartEnabled=!1)},addTouchMove:function(a){this.addDomTouchMove(this._render,a)},removeTouchMove:function(){this.removeDomTouchMove(this._render)},addDomTouchMove:function(a,b){a.touchMoveEnabled=!0;a.addEventListener("mousemove",c=>{this._onDomMove(c,b)});a.addEventListener("touchmove",c=>{this._onDomMove(c,b);c.preventDefault()})},_onDomMove:function(a,b){if(a.currentTarget.touchMoveEnabled){var c=a.touches&&0<a.touches.length?
a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();a.setAttribute("move_time",c.time);a.setAttribute("move_pageX",c.pageX);a.setAttribute("move_pageY",c.pageY);a.setAttribute("move_clientX",c.clientX);a.setAttribute("move_clientY",c.clientY);b&&b(c)}},removeDomTouchMove:function(a){a.touchMoveEnabled=!1},addTouchOut:function(a){this.addDomTouchOut(this._render,a)},removeTouchOut:function(){this.removeDomTouchOut(this._render)},addDomTouchOut:function(a,b){a.touchOutEnabled=
!0;a.addEventListener("mouseout",c=>{this._onDomOut(c,b)})},_onDomOut:function(a,b){if(a.target.touchOutEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();b&&b(c)}},removeDomTouchOut:function(a){a.touchOutEnabled=!1},addTouchEnd:function(a){this.addDomTouchEnd(this._render,a)},removeTouchEnd:function(){this.removeDomTouchEnd(this._render)},addDomTouchEnd:function(a,b){a.touchEndEnabled=!0;a.addEventListener("mouseup",
c=>{this._onDomEnd(c,b)});a.addEventListener("touchend",c=>{this._onDomEnd(c,b);c.preventDefault()})},_onDomEnd:function(a,b){if(a.currentTarget.touchEndEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();a.setAttribute("end_time",c.time);b&&b(c);this._onDomTap(a);cc.removeDomAttr(a,"move_time move_pageX move_pageY move_clientX move_clientY end_time".split(" "));cc.removeDomAttr(a,["start_time","start_pageX","start_pageY",
"start_clientX","start_clientY"])}},removeDomTouchEnd:function(a){a.touchEndEnabled=!1},addTouch:function(a){this.addTouchTap(a)},removeTouch:function(){this.removeTouchTap()},addDomTouch:function(a,b){this.addDomTouchTap(a,b)},addTouchTap:function(a){this.addDomTouchTap(this._render,a)},removeTouchTap:function(){this.removeDomTouchTap(this._render)},addDomTouchTap:function(a,b){a.touchStartEnabled||this.addDomTouchStart(a);a.touchEndEnabled||this.addDomTouchEnd(a);a.touchTapEnabled=!0;a.callbacksTap=
a.callbacksTap||[];b&&a.callbacksTap.push(b)},_onDomTap:function(a){a.getAttribute("move_pageX")||a.setAttribute("move_pageX",a.getAttribute("start_pageX"));a.getAttribute("move_pageY")||a.setAttribute("move_pageY",a.getAttribute("start_pageY"));if(150>cc.getAttrToNumber(a,"end_time")-cc.getAttrToNumber(a,"start_time")&&10>Math.abs(cc.getAttrToNumber(a,"start_pageX")-cc.getAttrToNumber(a,"move_pageX"))&&10>Math.abs(cc.getAttrToNumber(a,"start_pageY")-cc.getAttrToNumber(a,"move_pageY"))){if(a.getAttribute("tap_time")&&
200>(new Date).getTime()-cc.getAttrToNumber(a,"tap_time")){if(a.callbacksDoubleTap)for(var b=0;b<a.callbacksDoubleTap.length;b++)a.callbacksDoubleTap[b].call(null,{target:a==this._render?this._render:a})}else if(a.callbacksTap)for(b=0;b<a.callbacksTap.length;b++)a.callbacksTap[b].call(null,{target:a==this._render?this._render:a});a.setAttribute("tap_time",(new Date).getTime())}},removeDomTouchTap:function(a){a.callbacksTap&&(a.touchTapEnabled=!1,a.callbacksTap=null,delete a.callbacksTap)},addTouchDouble:function(a){this.addDomTouchDoubleTap(this._render,
a)},addTouchDoubleTap:function(a){this.addDomTouchDoubleTap(this._render,a)},removeTouchDoubleTap:function(){this.removeDomTouchDoubleTap(this._render)},addDomTouchDoubleTap:function(a,b){a.touchTapEnabled||this.addDomTouchTap(a);a.touchDoubleTapEnable=!0;a.callbacksDoubleTap=a.callbacksDoubleTap||[];b&&a.callbacksDoubleTap.push(b)},removeDomTouchDoubleTap:function(a){a.callbacksDoubleTap&&(a.touchDoubleTapEnable=!1,a.callbacksDoubleTap=null,delete a.callbacksDoubleTap)},_dragEnabled:!1,setDragEnabled:function(a){this._render&&
(this.setDragEnabledDom(this._render,a),this._dragEnabled=a)},getDragEnabled:function(){return this._dragEnabled},setDragEnabledDom:function(a,b){b&&!a.touchStartEnabled&&this.addDomTouchStart(a);a.dragEnabled=!!b},findDom:function(a){var b=null;if(!a)return null;a instanceof HTMLElement?b=a:cc.isString(a)&&(b=this._render.querySelector(a));b._ccinit||(b._ccinit=!0,b.css=(c,d)=>{if(cc.isString(c))b.style[c]=d;else if(cc.isObject(c))for(var e in c)b.style[e]=c[e]},b.getBoxGrid=c=>this.findDom(b.querySelector("[grid='"+
c+"']")),b.addTouch=c=>{this.addDomTouchTap(b,c)},b.removeTouch=()=>{this.removeDomTouchTap(b)},b.addTouchStart=c=>{this.addDomTouchStart(b,c)},b.removeTouchStart=()=>{this.removeDomTouchStart(b)},b.addTouchMove=c=>{this.addDomTouchMove(b,c)},b.removeTouchMove=()=>{this.removeDomTouchMove(b)},b.addTouchOut=c=>{this.addDomTouchOut(b,c)},b.removeTouchOut=()=>{this.removeDomTouchOut(b)},b.addTouchEnd=c=>{this.addDomTouchEnd(b,c)},b.removeTouchEnd=()=>{this.removeDomTouchEnd(b)},b.addTouchDouble=c=>{this.addDomTouchDoubleTap(b,
c)},b.removeTouchDouble=()=>{this.removeDomTouchDoubleTap(b)});return b},findAllDom:function(a){}});cc.Node.fromObject=function(a){return cc.Node().fromObject(a)};var _p=cc.Node.prototype;cc.defineGetterSetter(_p,"parent",_p.getParent,_p.getParent);cc.defineGetterSetter(_p,"render",_p.getRender,_p.getRender);cc.defineGetterSetter(_p,"width",_p.getWidth,_p.setWidth);cc.defineGetterSetter(_p,"height",_p.getHeight,_p.setHeight);cc.defineGetterSetter(_p,"x",_p.getX,_p.setX);
cc.defineGetterSetter(_p,"left",_p.getX,_p.setX);cc.defineGetterSetter(_p,"y",_p.getY,_p.setY);cc.defineGetterSetter(_p,"top",_p.getY,_p.setY);cc.defineGetterSetter(_p,"visible",_p.getVisible,_p.setVisible);cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);cc.defineGetterSetter(_p,"scale",_p.getScale,_p.getScale);cc.defineGetterSetter(_p,"scaleX",_p.getScaleX,_p.setScaleX);cc.defineGetterSetter(_p,"scaleY",_p.getScaleY,_p.setScaleY);
cc.defineGetterSetter(_p,"rotate",_p.getRotate,_p.setRotate);cc.defineGetterSetter(_p,"buttonMode",_p.setButtonMode,_p.setButtonMode);cc.defineGetterSetter(_p,"anchorX",_p.getAnchorX,_p.setAnchorX);cc.defineGetterSetter(_p,"anchorY",_p.getAnchorY,_p.setAnchorY);cc.defineGetterSetter(_p,"touchEnabled",_p.getTouchEnabled,_p.setTouchEnabled);cc.defineGetterSetter(_p,"dragEnabled",_p.getDragEnabled,_p.setDragEnabled);
function _windowMove(a){var b=a.touches&&0<a.touches.length?a.touches[0]:a;a=cc.dragDom;var c=b.pageX-cc.getAttrToNumber(a,"start_pageX");b=b.pageY-cc.getAttrToNumber(a,"start_pageY");a==this._render?(this.x=c+cc.getAttrToNumber(a,"start_left"),this.y=b+cc.getAttrToNumber(a,"start_top")):(a.style.left=c+cc.getAttrToNumber(a,"start_left")+"px",a.style.top=b+cc.getAttrToNumber(a,"start_top")+"px")}
function _windowUp(a){window.removeEventListener("mousemove",_windowMove);window.removeEventListener("touchmove",_windowMove);window.removeEventListener("mouseup",_windowUp);window.removeEventListener("touchend",_windowUp);cc.dragDom&&cc.dragDom.removeAttribute("start_left");cc.dragDom&&cc.dragDom.removeAttribute("start_top");cc.dragDom&&cc.removeDomAttr(cc.dragDom,["start_time","start_pageX","start_pageY","start_clientX","start_clientY"]);cc.dragDom=null};var aztExam=aztExam||{};
aztExam.RTCConnection||(aztExam.RTCConnection=cc.Class.extend({conn:null,candidate:null,callback:null,isUsed:!1,remoteUserId:"",localUserId:"",type:"offer",monitor:null,offerTimestamp:-1,timeIntv:3E3,timeAnswerIntv:15E3,timeIntvCount:0,blacklistTimestamp:null,lasttimestamp:-1,isWaitingUploadOffer:!1,isWaitingUploadAnswer:!1,offer:null,answer:null,offerReceive:null,isUsefirestore:!1,ctor:function(a){this.blacklistTimestamp=[];this.monitor=a;this.monitor.firebaseApp&&(this.isUsefirestore=!0);this.initUI()},
initUI:function(){this.ui=document.createElement("div");this.ui.style.transformOrigin="0% 0%";this.ui.style.overflow="hidden";this.uivideo=document.createElement("div");this.uivideo.style.width="100%";this.uivideo.style.height="100%";this.uivideo.style.display="flex";this.uivideo.style.flexDirection="row";this.uivideo.style.alignItems="center";this.uivideo.style.justifyContent="center";this.ui.appendChild(this.uivideo);this.txtConnecting=document.createElement("div");this.txtConnecting.style.backgroundColor=
"#333333";this.txtConnecting.style.width="250px";this.txtConnecting.style.padding="20px";this.txtConnecting.style.borderRadius="8px";this.txtConnecting.style.color="#EEEEEE";this.txtConnecting.style.fontSize="16px";this.txtConnecting.innerHTML=aztExam.lang.lbConnectingMedia;this.txtConnecting.style.position="absolute";this.txtConnecting.style.bottom="20px";this.txtConnecting.style.textAlign="center";this.txtConnecting.style.lineHeight="30px";this.perConnecting=document.createElement("div");this.perConnecting.style.backgroundColor=
"#1A84E3";this.perConnecting.style.height="5px";this.perConnecting.style.borderRadius="5px";this.perConnecting.style.width="0%";this.perConnecting.per=0;this.perConnecting.style.position="absolute";this.perConnecting.style.bottom="5px";this.txtConnecting.appendChild(this.perConnecting);this.ui.appendChild(this.txtConnecting)},showLoading:function(){this.txtConnecting.style.display="block";clearInterval(this.itvPerConnection);this.perConnecting.per=0},hideLoading:function(){this.txtConnecting.style.display=
"none";clearInterval(this.itvPerConnection)},resizeUI:function(a,b){this.ui.style.width=a+"px";this.ui.style.height=b+"px";this.txtConnecting.style.left=(a-260)/2+"px"},startIntv:async function(){cc.log("start intv");this.isStarted=!0;this.showLoading();if("offer"==this.type){var a=(new Date).getTime();this.offer=await this.createOffer();this.offer.timestamp=a;this.offer.conn=a;this.offer.userid=this.localUserId;this.isWaitingUploadOffer=!0}else clearInterval(this.ofIntv),this.ofIntv=setInterval(()=>
{this.getOfferIntv()},this.timeIntv),this.getOfferIntv()},getAnswerIntv:function(){var a=new XMLHttpRequest;a.onreadystatechange=()=>{if(4==a.readyState&&200==a.status)try{var b=JSON.parse(a.responseText);b.timestamp==this.offerTimestamp&&(clearInterval(this.anIntv),this.receiveAnswer(b))}catch(c){cc.log("get answer error")}};a.open("GET",this.monitor._urlDownload+this.monitor.options.roomid+"/"+this.localUserId+"/public/answer.txt?t="+(new Date).getTime());a.send()},getOfferIntv:async function(){var a=
new XMLHttpRequest;a.onreadystatechange=()=>{if(4==a.readyState&&200==a.status)try{var b=JSON.parse(a.responseText);this.receiveOffer(b)}catch(c){cc.log("get offer error")}};a.open("GET",this.monitor._urlDownload+this.monitor.options.roomid+"/"+this.remoteUserId+"/public/offer.txt?t="+(new Date).getTime());a.send()},start:function(a,b,c){cc.log("start");this.isUsed||!a||!b&&"offer"!=c||(this.reset(),this.localUserId=a,this.remoteUserId=b,this.type=c,this.timeUsed=(new Date).getTime(),this.isUsed=
!0,this.initConn(),this.startIntv())},stop:function(){"offer"!=this.type&&this.isUsefirestore&&this.answer&&this.monitor.firestoreWriteDocument("answer_"+this.remoteUserId,"lastest",{state:1,timestamp:this.answer.timestamp});this.reset()},initConn:function(){cc.log("init connection ");this.conn=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});this.conn.addEventListener("icecandidate",a=>this.onIceCandidate(a));this.conn.addEventListener("iceconnectionstatechange",a=>this.onIceStateChange(a));
this.monitor.stream&&this.addStream(this.monitor.stream);this.conn.ontrack=a=>{this.gotRemoteStream(a)}},createOffer:async function(){if(this.conn){try{const a=await this.conn.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});this.conn.setLocalDescription(a);return{candidate:this.candidate,offer:a}}catch(a){console.log("create offer error "+a)}return null}},receiveOffer:async function(a){if(null!=this.conn)try{if(!(0<=this.blacklistTimestamp.indexOf(a.timestamp))){this.blacklistTimestamp.push(a.timestamp);
clearInterval(this.ofIntv);this.offerReceive=a;this.conn.setRemoteDescription(this.offerReceive.offer);var b=await this.conn.createAnswer();this.conn.setLocalDescription(b);this.answer={candidate:this.candidate,answer:b,timestamp:a.timestamp};this.isWaitingUploadAnswer=!0}}catch(c){cc.log("receiveOffer error "+c)}},receiveAnswer:function(a){if(null!=this.conn){"offer"==this.type&&(this.answer=a);this.conn.setRemoteDescription(a.answer);for(var b=0;b<a.candidate.length;b++)this.conn.addIceCandidate(a.candidate[b])}},
addStream:function(a){},gotRemoteStream:function(a){cc.log("gotRemoteStream "+a.streams.length);if(0<a.streams.length){cc.removeAllChildNodes(this.uivideo);for(var b=0;b<a.streams.length;b++){var c=document.createElement("video");this.uivideo.appendChild(c);c.playsInline=!0;c.muted=!0;c.srcObject=a.streams[b];c.vW=parseInt(this.ui.style.width);c.vH=parseInt(this.ui.style.height);c.onplay=()=>{};c.onresize=()=>{80<c.videoWidth&&60<c.videoHeight&&(this.hideLoading(),console.log("video size "+c.videoWidth+
":"+c.videoHeight),c.videoWidth/c.videoHeight<c.vW/c.vH?(c.style.width="",c.style.height="100%"):(c.style.width="100%",c.style.height=""))};c.play()}}},updateBandwidthRestriction:function(a,b){return a=-1===a.indexOf("b=AS:")?a.replace(/c=IN (.*)\r\n/,"c=IN $1\r\nb=AS:"+b+"\r\n"):a.replace(RegExp("b=AS:.*\r\n"),"b=AS:"+b+"\r\n")},onIceCandidate:function(a){try{a&&a.candidate?(cc.log("onIceCandicate "+JSON.stringify(a.candidate)),this.candidate.push(a.candidate),clearInterval(this.iceIntv),this.iceIntv=
setInterval(()=>{clearInterval(this.iceIntv);this.onIceCandidateFinish()},3E3)):(cc.log("on ice null finish get candicate first time"),this.onIceCandidateFinish())}catch(b){cc.log("onIceCandidate exception "+b.message)}},onIceCandidateFinish:function(){this.isWaitingUploadOffer&&(this.isWaitingUploadOffer=!1,this.offer.candidate=this.candidate,this.monitor.uploadPublicContent(this.monitor._urlOffer,"offer.txt",JSON.stringify(this.offer),(b,c)=>{200==b&&(this.offerTimestamp=this.offer.timestamp,cc.log("upload offer ok"))}));
if(this.isWaitingUploadAnswer){this.isWaitingUploadAnswer=!1;this.answer.candidate=this.candidate;this.monitor.getPublicUpload(this.monitor.options.roomid,this.remoteUserId,"answer.txt",1,0,b=>{""!=b&&this.monitor.uploadPublicContent(b,"answer.txt",JSON.stringify(this.answer),(c,d)=>{200==c&&this.isUsefirestore&&this.monitor.firestoreWriteDocument("answer_"+this.remoteUserId,"lastest",{state:0,timestamp:this.answer.timestamp})})});for(var a=0;a<this.offerReceive.candidate.length;a++)this.conn.addIceCandidate(this.offerReceive.candidate[a])}},
onIceStateChange:function(a){a=this.conn.iceConnectionState.toString();cc.log("onIceStateChange state "+a);if("failed"==a||"disconnected"==a||"closed"==a)this.isUsed=!1,this.start(this.localUserId,this.remoteUserId,this.type)},reset:function(){null!=this.conn&&(this.conn.close(),this.conn=null);this.isStarted=this.isUsed=!1;this.type=this.localUserId=this.remoteUserId="";this.offerTimestamp=-1;this.isWaitingUploadOffer=this.isWaitingUploadAnswer=!1;this.answer=this.offerReceive=this.offer=null;this.candidate=
[];this.timeUsed=-1;clearInterval(this.anIntv);clearInterval(this.ofIntv);cc.removeAllChildNodes(this.uivideo)}}));aztExam=aztExam||{};aztExam.icon={};
aztExam.svg={iconCheck:'<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 24px; height: 24px;"><g class="style-scope iron-icon"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" class="style-scope iron-icon"></path></g></svg>',iconWarning:'<?xml version="1.0" ?><svg  viewBox="0 0 64 64" style="pointer-events: none; display: block; width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#efcc00;}.cls-2{fill:#353535;}</style></defs><title/><path class="cls-1" d="M30.16,11.51,6.84,51.9a2.13,2.13,0,0,0,1.84,3.19H55.32a2.13,2.13,0,0,0,1.84-3.19L33.84,11.51A2.13,2.13,0,0,0,30.16,11.51Z"/><path class="cls-2" d="M29,46a3,3,0,1,1,3,3A2.88,2.88,0,0,1,29,46Zm1.09-4.66-.76-15h5.26l-.73,15Z"/></svg>',iconCameraOff:'<?xml version="1.0" ?><svg id="Icons" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}</style><g><path d="M22.5,20.9l5,3C27.6,24,27.8,24,28,24c0.2,0,0.3,0,0.5-0.1c0.3-0.2,0.5-0.5,0.5-0.9V9c0-0.4-0.2-0.7-0.5-0.9   c-0.3-0.2-0.7-0.2-1,0l-5,3C22.2,11.3,22,11.6,22,12v8C22,20.4,22.2,20.7,22.5,20.9z"/><path d="M29.7,28.3L20,18.6V11c0-1.7-1.3-3-3-3H9.4L3.7,2.3c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l26,26c0.2,0.2,0.5,0.3,0.7,0.3   s0.5-0.1,0.7-0.3C30.1,29.3,30.1,28.7,29.7,28.3z"/><path d="M3,11v10c0,1.7,1.3,3,3,3h11c0.8,0,1.5-0.3,2-0.8L4.3,8.5C3.5,9.1,3,10,3,11z"/></g></svg>',
iconCamera:'<?xml version="1.0" ?><svg id="Icons" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}</style><g><path d="M17,8H6c-1.7,0-3,1.3-3,3v10c0,1.7,1.3,3,3,3h11c1.7,0,3-1.3,3-3V11C20,9.3,18.7,8,17,8z"/><path d="M28.5,8.1c-0.3-0.2-0.7-0.2-1,0l-5,3C22.2,11.3,22,11.6,22,12v8c0,0.4,0.2,0.7,0.5,0.9l5,3C27.6,24,27.8,24,28,24   c0.2,0,0.3,0,0.5-0.1c0.3-0.2,0.5-0.5,0.5-0.9V9C29,8.6,28.8,8.3,28.5,8.1z"/></g></svg>',
iconMicOff:'<?xml version="1.0" ?><svg  viewBox="0 0 48 48"  xmlns="http://www.w3.org/2000/svg"><path d="M0 0h48v48H0zm0 0h48v48H0z" fill="none"/><path d="M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z"/></svg>',
iconMic:'<?xml version="1.0" ?><svg  viewBox="0 0 48 48"  xmlns="http://www.w3.org/2000/svg"><path d="M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z"/><path d="M0 0h48v48H0z" fill="none"/></svg>',iconRefresh:'<?xml version="1.0" ?><svg style="enable-background:new 0 0 30 30;" version="1.1" viewBox="0 0 30 30" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M22.143,23.365  C20.221,25.008,17.726,26,15,26C8.925,26,4,21.075,4,15" style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-miterlimit:10;"/><path d="M7.857,6.635  C9.779,4.992,12.274,4,15,4c6.075,0,11,4.925,11,11" style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-miterlimit:10;"/><polygon points="26,20 22,14 30,14 "/><polygon points="4,10 8,16 0,16 "/></svg>',
iconClose:'<?xml version="1.0" ?><svg  style="enable-background:new 0 0 612 792;" version="1.1" viewBox="0 0 612 792" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{clip-path:url(#SVGID_2_);fill:none;stroke:#E44061;stroke-width:45;}.st1{fill:#E44061;}</style><g><g><defs><rect height="512" width="512" x="50" y="140"/></defs><clipPath id="SVGID_2_"><use style="overflow:visible;" xlink:href="#SVGID_1_"/></clipPath><path class="st0" d="M306,629.5c128.8,0,233.5-104.7,233.5-233.5S434.8,162.5,306,162.5S72.5,267.2,72.5,396    S177.2,629.5,306,629.5L306,629.5z"/></g><polygon class="st1" points="348.7,396 448,296.7 405.3,254 306,353.3 206.7,254 164,296.7 263.3,396 164,495.3 206.7,538    306,438.7 405.3,538 448,495.3 348.7,396  "/></g></svg>',
iconGroup:'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><rect fill="none" height="24" width="24"/><g><path d="M12,12.75c1.63,0,3.07,0.39,4.24,0.9c1.08,0.48,1.76,1.56,1.76,2.73L18,18H6l0-1.61c0-1.18,0.68-2.26,1.76-2.73 C8.93,13.14,10.37,12.75,12,12.75z M4,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C2,12.1,2.9,13,4,13z M5.13,14.1 C4.76,14.04,4.39,14,4,14c-0.99,0-1.93,0.21-2.78,0.58C0.48,14.9,0,15.62,0,16.43V18l4.5,0v-1.61C4.5,15.56,4.73,14.78,5.13,14.1z M20,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C18,12.1,18.9,13,20,13z M24,16.43c0-0.81-0.48-1.53-1.22-1.85 C21.93,14.21,20.99,14,20,14c-0.39,0-0.76,0.04-1.13,0.1c0.4,0.68,0.63,1.46,0.63,2.29V18l4.5,0V16.43z M12,6c1.66,0,3,1.34,3,3 c0,1.66-1.34,3-3,3s-3-1.34-3-3C9,7.34,10.34,6,12,6z"/></g></svg>',
iconLeft:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M14 7l-5 5 5 5V7z"/><path d="M24 0v24H0V0h24z" fill="none"/></svg>',iconFullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M0 0h24v24H0z" fill="none"/><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>',iconExitFullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M0 0h24v24H0z" fill="none"/><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>'};
aztExam.lang={btDone:"XONG",btViewFull:"XEM TO\u00c0N B\u1ed8 L\u1edaP",btViewHistory:"XEM TH\u00d4NG TIN",btCopyLink:"COPY LINK",btBackToList:"DANH S\u00c1CH L\u1edaP",lbDeviceInfo:"TH\u00d4NG TIN THI\u1ebeT B\u1eca",lbOs:"H\u1ec7 \u0111i\u1ec1u h\u00e0nh",msgOsNotSupport:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ean c\u00e1c h\u1ec7 \u0111i\u1ec1u h\u00e0nh : iOS(iphone,ipad) , Android , Window , MAC_OS",msgTeacherOsNotSupport:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ean c\u00e1c h\u1ec7 \u0111i\u1ec1u h\u00e0nh : Window , MAC_OS",
lbBrowser:"Tr\u00ecnh duy\u1ec7t",msgBrowserNotSupportPc:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 phi\u00ean b\u1ea3n m\u1edbi nh\u1ea5tt tr\u00ecnh duy\u1ec7t Chrome,C\u1ed1c c\u1ed1c ,Microsoft Edge ,Firefox tr\u00ean m\u00e1y t\u00ednh",msgBrowserNotSupportAndroid:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ecnh duy\u1ec7t Chrome tr\u00ean h\u1ec7 \u0111i\u1ec1u h\u00e0nh Android .<br/> Copy link v\u00e0 m\u1edf b\u1eb1ng Chrome !",msgBrowserNotSupportIOs:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ecnh duy\u1ec7t Safari  tr\u00ean h\u1ec7 \u0111i\u1ec1u h\u00e0nh iOs .<br/> Copy link v\u00e0 m\u1edf b\u1eb1ng Safari !",
lbCamera:"Camera ",msgCameraNotFound:"Thi\u1ebft b\u1ecb kh\u00f4ng c\u00f3 camera.",msgCameraNotPermission:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Camera.<br/><br/><span style='font-style:italic'> Ch\u1ecdn bi\u1ec3u t\u01b0\u1ee3ng kho\u00e1 tr\u00ean \u0111\u1ea7u thanh \u0111\u1ecba ch\u1ec9 , c\u1ea5p quy\u1ec1n truy c\u1eadp camera , t\u1ea3i l\u1ea1i trang website</span>",msgCameraNotPermissionIos:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Camera .<br/><br/><span style='font-style:italic'>T\u1ea3i l\u1ea1i trang website , ch\u1ecdn cho ph\u00e9p truy c\u1eadp camera .</span>",
lbMic:"Microphone ",msgMicNotFound:"Thi\u1ebft b\u1ecb kh\u00f4ng c\u00f3 microphone",msgMicNotPermission:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Microphone.<br/><br/><span style='font-style:italic'> Ch\u1ecdn bi\u1ec3u t\u01b0\u1ee3ng kho\u00e1 tr\u00ean \u0111\u1ea7u thanh \u0111\u1ecba ch\u1ec9 , c\u1ea5p quy\u1ec1n truy c\u1eadp microphone , t\u1ea3i l\u1ea1i trang website</span>",msgMicNotPermissionIos:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Microphone.<br/><br/><span style='font-style:italic'>T\u1ea3i l\u1ea1i trang website , ch\u1ecdn cho ph\u00e9p truy c\u1eadp microphone .</span>",
lbTitleHistory:"TH\u00d4NG TIN C\u00c1 NH\u00c2N ",lbConnectingMedia:"\u0110ang k\u1ebft n\u1ed1i ... !"};aztExam=aztExam||{};
aztExam.monitor=cc.Node.extend({_hasExtentCamera:!1,_imageCaptureWidth:142,_imageCaptureHeight:80,deviceInfo:null,stream:null,streamType:-1,_isGettingMediaUser:!1,_hasVideoReviewPlaying:!1,ctor:function(){this.init()},init:function(){this.deviceInfo={hasCollectInfo:!1,isSupportMonitor:!0};this.options={};this.options.roomid="";this.options.resultid="";this.options.time=-1;this.options.userlist=[];this.options.duration=9E5;this.options.user={token:"",userid:"",username:""};this.options.config={currentUpdateSize:3,
storeUpdateSize:4,domainApi:"",firebaseApp:null}},showDeviceUI:function(a){if(a){try{this.deviUI&&(document.body.removeChild(this.deviUI),this.deviUI=null)}catch(h){cc.log("error remove deviUI")}var b=window.innerWidth/500;0==b&&(b=1);1<=b&&(b=1);var c=window.innerHeight/b;this.deviUI=this.findDom(document.createElement("div"));this.deviUI.css("position","absolute");this.deviUI.css("transform-origin","0% 0%");this.deviUI.css("transform","scale("+b+","+b+")");this.deviUI.css("width","500px");this.deviUI.css("height",
Math.floor(c)+"px");this.deviUI.css("left",Math.floor((window.innerWidth-500*b)/2)+"px");this.deviUI.css("top",Math.floor((window.innerHeight-c*b)/2)+"px");this.deviUI.css("background-color","white");this.deviUI.css("font-family","sans-serif");this.deviUI.css("font-size","18px");this.deviUI.css("box-shadow","0 2px 2px 0 rgb(0 0 0 / 14%), 0 3px 1px -2px rgb(0 0 0 / 12%), 0 1px 5px 0 rgb(0 0 0 / 20%)");this.deviUI.css("z-index",999999999);document.body.appendChild(this.deviUI);this.deviUI.css("display",
"block");b=this.findDom(document.createElement("div"));b.css("width","100%");b.css("height","60px");b.css("border-bottom","1px solid #CCCCCC");this.deviUI.appendChild(b);this.btDone=this.createButton(100,40,aztExam.lang.btDone,"#1A84E3",16);this.btDone.css("float","left");this.btDone.css("margin-left","10px");this.btDone.css("margin-top","10px");b.appendChild(this.btDone);var d=this.findDom(document.createElement("span"));d.css("color","gray");d.css("display","flex");d.css("width","60%");d.css("height",
"100%");d.css("float","left");d.css("padding-left","20px");d.css("align-items","center");d.innerHTML=aztExam.lang.lbDeviceInfo;b.appendChild(d);this.btDone.addTouch(h=>{this.deviUI.css("display","none")});b=this.findDom(document.createElement("div"));b.css("width","100%");b.css("height",c-60+"px");b.css("overflow-x","hidden");b.css("text-align","center");b.css("overflow-y","scroll");this.deviUI.appendChild(b);c=this.findDom(document.createElement("div"));c.css("width","100%");c.css("height","60px");
c.css("margin-top","10px");c.css("background",a.osSupport?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.innerHTML=aztExam.lang.lbOs+" "+a.osName+"  "+a.osVersion;b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","90%");c.css("height","auto");c.css("text-align","center");c.css("margin-top","10px");c.css("margin-left","5%");c.innerHTML="student"==this.role()?aztExam.lang.msgOsNotSupport:aztExam.lang.msgTeacherOsNotSupport;
c.css("display",a.osSupport?"none":"block");b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.browserSupport?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.innerHTML=aztExam.lang.lbBrowser+" "+a.browser.name+" "+a.browser.version;b.appendChild(c);c=this.findDom(document.createElement("div"));
c.css("width","90%");c.css("height","auto");c.css("text-align","center");c.css("margin-top","10px");c.css("padding-left","5%");c.css("line-height","28px");c.innerHTML=aztExam.lang.msgBrowserNotSupportPc;a.isAndroid?c.innerHTML=aztExam.lang.msgBrowserNotSupportAndroid:a.isIOs&&(c.innerHTML=aztExam.lang.msgBrowserNotSupportIOs);c.css("display",a.browserSupport?"none":"block");b.appendChild(c);if(a.browserSupport){c=this.findDom(document.createElement("div"));c.css("width","100%");c.css("height","60px");
c.css("margin-top","10px");c.css("background",a.hasWebcam&&a.isWebsiteHasWebcamPermissions?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.innerHTML=aztExam.lang.lbCamera+" ("+a.videoInputDevices.length+")";b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","90%");c.css("height","auto");c.css("text-align","center");c.css("margin-top","10px");c.css("padding-left",
"5%");c.css("display",a.hasWebcam&&a.isWebsiteHasWebcamPermissions?"none":"block");a.hasWebcam?a.isWebsiteHasWebcamPermissions||(c.innerHTML=a.isIOs?aztExam.lang.msgCameraNotPermissionIos:aztExam.lang.msgCameraNotPermission):c.innerHTML=aztExam.lang.msgCameraNotFound;b.appendChild(c);if(a.isWebsiteHasWebcamPermissions){c=document.createElement("video");c.width=80;c.height=60;c.style.marginLeft="auto";c.style.marginTop="5px";c.classList.add("azt_monitor_webcam_review");c.muted=!0;c.playsInline=!0;
this.stream&&(c.srcObject=this.stream,c.play());b.appendChild(c);var e=document.createElement("div");e.style.width="100%";e.style.height="auto";b.appendChild(e);c=a.videoInputDevices;for(d=0;d<c.length;d++){var f=this.createListCheck("azt_cam_item",d,c[d].label,d==this.deviceInfo.videoInputIndex?!0:!1,c[d]);f.addTouch(h=>{h=parseInt(h.target.getAttribute("azt_cam_item_index"));h!=this.deviceInfo.videoInputIndex&&this.getMediaUser(h,this.deviceInfo.audioInputIndex)});e.appendChild(f)}}c=this.findDom(document.createElement("div"));
c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.hasMicrophone&&a.isWebsiteHasMicrophonePermissions?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.innerHTML=aztExam.lang.lbMic+" ("+a.audioInputDevices.length+")";b.appendChild(c);e=this.findDom(document.createElement("div"));e.css("width","90%");e.css("height","auto");e.css("text-align","center");
e.css("margin-top","10px");e.css("padding-left","5%");e.css("padding-left","5%");e.css("display",a.hasMicrophone&&a.isWebsiteHasMicrophonePermissions?"none":"block");a.hasMicrophone?a.isWebsiteHasMicrophonePermissions||(e.innerHTML=a.isIOs?aztExam.lang.msgMicNotPermissionIos:aztExam.lang.msgMicNotPermission):e.innerHTML=aztExam.lang.msgMicNotFound;if(a.isWebsiteHasMicrophonePermissions)for(c=a.audioInputDevices,d=0;d<c.length;d++)f=this.createListCheck("azt_mic_item",d,c[d].label,d==this.deviceInfo.audioInputIndex?
!0:!1,c[d]),f.addTouch(h=>{h=parseInt(h.target.getAttribute("azt_mic_item_index"));h!=this.deviceInfo.audioInputIndex&&this.getMediaUser(this.deviceInfo.videoInputIndex,h)}),b.appendChild(f);b.appendChild(e)}else if(a.isIOs||a.isAndroid){var g=document.createElement("div");a=window.location.toString().indexOf(this.options.roomid);a=0>a?window.location.length:a;g.innerHTML=window.location.toString().substr(0,a+this.options.roomid.length+1);g.style.width="100%";g.style.height="30px";g.style.marginTop=
"20px";g.style.marginBottom="10px";b.appendChild(g);var k=this.createButton(160,60,aztExam.lang.btCopyLink,"#1A84E3",20);k.css("margin-left","170px");k.css("margin-top","10px");k.css("display","flex");k.addTouch(h=>{h=document.createRange();const q=window.getSelection();q.removeAllRanges();h.selectNodeContents(g);q.addRange(h);try{document.queryCommandSupported("copy")?(document.execCommand("copy"),k.innerHTML="\u0110\u00c3 COPY LINK"):cc.log("exec Command not found !")}catch(B){console.log(B)}q.removeAllRanges()});
b.appendChild(k)}}},parseOption:function(a){a&&a.roomid&&cc.isString(a.roomid)&&(this.options.roomid=a.roomid);a&&a.resultid&&(this.options.resultid=Number(a.resultid));a&&a.examid&&(this.options.examid=Number(a.examid));a&&a.user&&(a.user.studentid&&(this.options.user.studentid=a.user.studentid),a.user.userid&&(this.options.user.userid=a.user.userid),a.user.token&&(this.options.user.token=a.user.token),this.options.user.username=cc.isEmpty(a.user.studentname)?a.user.username:a.user.studentname);
a&&a.userlist&&cc.isArray(a.userlist)&&(this.options.userlistStart=JSON.parse(JSON.stringify(a.userlist)));a&&a.time&&cc.isNumber(a.time)&&(this.options.time=a.time);a&&a.duration&&(this.options.duration=Number(a.duration));this.options.duration=9E5>this.options.duration?9E5:this.options.duration;a&&a.config&&(a.config.domainApi&&(this.options.config.domainApi=a.config.domainApi),a.config.urlGetPublicForLive&&(this.options.config.urlGetPublicForLive=a.config.urlGetPublicForLive),a.config.urlGetListFileForLive&&
(this.options.config.urlGetListFileForLive=a.config.urlGetListFileForLive),a.config.urlGetTokenForLive&&(this.options.config.urlGetTokenForLive=a.config.urlGetTokenForLive),a.config.urlExamResultGetLastExamResultOfStudentId&&(this.options.config.urlExamResultGetLastExamResultOfStudentId=a.config.urlExamResultGetLastExamResultOfStudentId),a.config.numMainView&&(this.options.config.numMainView=a.config.numMainView),a.config.firestore&&(this.options.config.firestore=a.config.firestore));a&&a.element&&
(this.options.element=a.element);a&&a.firebaseApp&&(this.options.firebaseApp=a.firebaseApp);this.options.config.urlGetPublicForLive=this.options.config.domainApi+this.options.config.urlGetPublicForLive;this.options.config.urlGetListFileForLive=this.options.config.domainApi+this.options.config.urlGetListFileForLive;this.options.config.urlGetTokenForLive=this.options.config.domainApi+this.options.config.urlGetTokenForLive;this.options.config.urlExamResultGetLastExamResultOfStudentId=this.options.config.domainApi+
this.options.config.urlExamResultGetLastExamResultOfStudentId;this.options.urlDownload=a.urlDownload;this.options.urlCurr=a.urlCurr;this.options.urlOffer=a.urlOffer},collectDeviceInfo:function(a){cc.log("call collectDeviceInfo");this.deviceInfo.hasCollectInfo?setTimeout(()=>{a&&a()},100):DetectRTC.load(()=>{cc.log("start collection info");this.deviceInfo.osName=DetectRTC.osName;this.deviceInfo.osVersion=DetectRTC.osVersion;this.deviceInfo.browser=DetectRTC.browser;this.deviceInfo.osSupport=this.checkOsSupport(this.deviceInfo);
this.deviceInfo.browserSupport=this.checkBrowserSuppor(this.deviceInfo);this.deviceInfo.hasWebcam=DetectRTC.hasWebcam;this.deviceInfo.hasMicrophone=DetectRTC.hasMicrophone;this.deviceInfo.isWebsiteHasWebcamPermissions=DetectRTC.isWebsiteHasWebcamPermissions;this.deviceInfo.isWebsiteHasMicrophonePermissions=DetectRTC.isWebsiteHasMicrophonePermissions;this.deviceInfo.isWebRTCSupported=DetectRTC.isWebRTCSupported;this.deviceInfo.videoInputDevices=DetectRTC.videoInputDevices;this.deviceInfo.audioInputDevices=
DetectRTC.audioInputDevices;this.deviceInfo.osSupport||(this.deviceInfo.isSupportMonitor=!1);this.deviceInfo.browserSupport||(this.deviceInfo.isSupportMonitor=!1);this.deviceInfo.hasCollectInfo=!0;cc.log("collect deviceInfo done");setTimeout(()=>{a&&a()},100)})},checkOsSupport:function(a){var b=a.osName.toLowerCase();return 0<=b.indexOf("window")||0<=b.indexOf("mac")?a.isPc=!0:0<=b.indexOf("android")?a.isAndroid=!0:0<=b.indexOf("ios")||b.indexOf("ipad")?a.isIOs=!0:!1},checkBrowserSuppor:function(a){var b=
a.osName.toLowerCase();a=a.browser.name.toLowerCase();if(0<=b.indexOf("window")||0<=b.indexOf("mac"))if(0<=a.indexOf("chrome")||0<=a.indexOf("edge")||0<=a.indexOf("firefox")||0<=a.indexOf("coccoc"))return!0;return 0<=b.indexOf("android")&&0<=a.indexOf("chrome")||(0<=b.indexOf("ios")||0<=b.indexOf("ipad"))&&0<=a.indexOf("safari")?!0:!1},isMobile:function(){return this.deviceInfo&&this.deviceInfo.osName?0>this.deviceInfo.osName.toLowerCase().indexOf("window")&&0>this.deviceInfo.osName.toLowerCase().indexOf("mac")?
!0:!1:!1},getMediaUser:function(a,b,c){if(!(0>a&&0>b||this._isGettingMediaUser||a>=this.deviceInfo.videoInputDevices.length||b>=this.deviceInfo.audioInputDevices.length)){var d=!1,e=!1;cc.log("get media user "+a+":"+b);if(0<=a){cc.log("video index");d=this.deviceInfo.videoInputDevices[a].deviceId;var f=640,g=480;this.isMobile()||(f=1280,g=720);d=c?{deviceId:d?{exact:d}:void 0}:{deviceId:d?{exact:d}:void 0,width:{max:f,min:f},height:{max:g,min:g},frameRate:{max:12,ideal:6}};cc.log("video contrainst")}0<=
b&&(e=this.deviceInfo.audioInputDevices[b].deviceId,e={deviceId:e?{exact:e}:void 0});cc.log("video constraints "+JSON.stringify(d));this._isGettingMediaUser=!0;this.stopAllPreview();navigator.mediaDevices.getUserMedia({audio:e,video:d}).then(k=>{this.gotStream(k,a,b)}).then().catch(k=>{this.handleError(k,a,b,c)})}},gotStream:function(a,b,c){cc.log("on getStream");this.deviceInfo.videoInputIndex=b;this.deviceInfo.audioInputIndex=c;this.stream=a;0<=b&&(this.videoWidth=this.stream.getVideoTracks()[0].getSettings().width,
this.videoHeight=this.stream.getVideoTracks()[0].getSettings().height,this.videoHeight=0==this.videoHeight?480:this.videoHeight,this.videoWidth=0==this.videoWidth?640:this.videoWidth);0<=b&&0<=c?this._streamType=0:0<=b?this._streamType=1:0<=c&&(this._streamType=2);(0<=b&&!this.deviceInfo.isWebsiteHasWebcamPermissions||0<=c&&!this.deviceInfo.isWebsiteHasMicrophonePermissions)&&DetectRTC.load(()=>{this.deviceInfo.videoInputDevices=DetectRTC.videoInputDevices;this.deviceInfo.audioInputDevices=DetectRTC.audioInputDevices});
this.startAllPreview();this._isGettingMediaUser=!1},handleError:function(a,b,c,d){cc.log("handle error getStream "+b+":"+c+":"+d);this._isGettingMediaUser=!1;d?(cc.log("error permission "),this.showDeviceUI(this.deviceInfo)):this.getMediaUser(b,c,!0)},destroyStream:function(){this.stream&&(this.stream.getTracks().forEach(a=>{a.stop()}),this.stream=null)},stopAllPreview:function(){this.destroyStream()},startAllPreview:function(){for(var a=document.getElementsByClassName("azt_monitor_webcam_review"),
b=0;b<a.length;b++)cc.log("startPreview"),a[b].srcObject=this.stream,a[b].play()},getPublicUpload:function(a,b,c,d,e,f,g,k,h){var q=new XMLHttpRequest;a=encodeURI(a+"?examHashId="+(c+"&resultid="+d+"&isPublic="+g+"&userId="+e+"&file_name="+f+"&file_size=100000&minetype=text/plain&randomFileName="+k));q.open("GET",a);q.setRequestHeader("Authorization","Bearer "+b);q.onreadystatechange=function(){if(4==q.readyState)if(200==q.status)try{var B=JSON.parse(q.responseText).data.upload_url,E=JSON.parse(q.responseText).data.url;
cc.log("getPublicUpload "+B+":"+E);h(B,E)}catch(G){h("")}else h("")};q.send()},uploadPublicContent:function(a,b,c,d){c=new Blob([c],{type:"text/plain"});b=new File([c],b);c=new XMLHttpRequest;c.open("PUT",a);c.setRequestHeader("Content-Type","text/plain");c.setRequestHeader("x-amz-acl","public-read");c.onreadystatechange=function(){4==this.readyState&&d&&d(this.status,this.responseText)};c.send(b)},uploadContent:function(a,b,c,d,e){this.getPublicUpload(this.options.config.urlGetPublicForLive,this.options.user.token,
this.options.roomid,this.options.resultid,this.options.user.userid,a,c,d,f=>{f?this.uploadPublicContent(f,a,b,(g,k)=>{e&&e(g,k)}):e&&e(404,"")})},getTokenForLive:function(a,b){var c=new XMLHttpRequest;a=encodeURI(this.options.config.urlGetTokenForLive+"?examHashId="+a);c.open("GET",a);c.setRequestHeader("Authorization","Bearer "+this.options.user.token);c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status)try{var d=JSON.parse(c.responseText).data;b(d)}catch(e){b("")}else b("")};c.send()},
getListFile:function(a,b,c,d){var e=new XMLHttpRequest;a="examHashId="+encodeURIComponent(a)+"&userId="+b+"&resultId="+c;a=encodeURI(this.options.config.urlGetListFileForLive+"?"+a);cc.log("getListFile "+a);e.open("GET",a);e.setRequestHeader("Authorization","Bearer "+this.options.user.token);e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status)try{var f=JSON.parse(e.responseText).objs;cc.log("arrPath "+JSON.stringify(f));d&&d(f)}catch(g){}else cc.log("response not "+e.status),d&&d("")};
e.send()},getContentFile:function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=()=>{if(4==c.readyState&&200==c.status)try{b&&b(c.responseText)}catch(d){b&&b("")}};c.open("GET",a);c.send()},getExamResultGetLastExamResultOfStudentId:function(a,b,c,d,e){var f=new XMLHttpRequest;b=encodeURI(this.options.config.urlExamResultGetLastExamResultOfStudentId+"?examId="+(b+"&userId="+c+"&studentId="+d+"&getMixQuestion=0"));f.open("GET",b);f.setRequestHeader("Authorization","Bearer "+a);f.onreadystatechange=
function(){if(4==f.readyState)if(200==f.status)try{var g=JSON.parse(f.responseText),k={lastResultId:-1,resultIds:[]};if(g.data){if(g.data.examResultObjs)for(var h=0;h<g.data.examResultObjs.length;h++)k.resultIds.push(g.data.examResultObjs[h].id);g.data.lastExamResultObj&&g.data.lastExamResultObj.examResultObj&&(k.lastResultId=g.data.lastExamResultObj.examResultObj.id)}cc.log("getExamResult "+JSON.stringify(k));e&&e(k)}catch(q){e&&e(null)}else e&&e(null)};f.send()},examLiveTeachers_student_subscribe:function(a,
b){this.options.firebaseApp&&this.options.firebaseApp.examLiveTeachers_student_subscribe(a).subscribe(c=>{cc.log("receive student subcribe examId "+JSON.stringify(c));b&&b(c)})},examLiveTeachers_student_unbsubscribe:function(a){this.options.firebaseApp&&(cc.log("student unsubcrible "+a),this.options.firebaseApp.examLiveTeachers_student_unbsubscribe(a))},examLiveTeachers_teacher_saveChange:function(a,b,c){this.options.firebaseApp&&this.options.firebaseApp.examLiveTeachers_teacher_saveChange(a,b).subscribe(d=>
{cc.log("teacher write examId "+JSON.stringify(d));c&&c(d)})},examSessions_subscribeUserMap:function(a){},examLiveStudents_student_subscribe:function(a){},examLiveStudents_student_unbsubscribe:function(a){},examLiveStudents_teacher_saveChange:function(a,b,c){},createButton:function(a,b,c,d,e){var f=this.findDom(document.createElement("div"));f.css("border-radius","5px");f.css("width",a+"px");f.css("height",b+"px");f.css("background-color",d);f.css("display","flex");f.css("align-items","center");f.css("justify-content",
"center");f.css("color","white");f.css("cursor","pointer");f.css("font-size",e+"px");f.css("user-select","none");f.css("transform-origin","50% 50%");f.innerHTML=c;f.addTouchStart(g=>{cc.log("touch start");g.target.css("opacity",.5)});f.addTouchEnd(g=>{cc.log("touch end");g.target.css("opacity",1)});return f},createListCheck:function(a,b,c,d,e){var f=this.findDom(document.createElement("div"));f.css("width","90%");f.css("margin-left","5%");f.css("height","50px");f.css("display","flex");f.css("align-items",
"center");f.css("justify-content","space-between");f.css("flex-direction","row");f.css("border-bottom","1px solid #AAAAAA");f.css("white-space","nowrap");f.css("cursor","pointer");f.classList.add(a);f.setAttribute(a+"_index",b);f.innerHTML=c;f.info=e;a=document.createElement("div");a.classList.add("check_icon");a.innerHTML=aztExam.svg.iconCheck;a.style.display=d?"block":"none";f.appendChild(a);return f},getLocalStorage:function(a){try{if(localStorage)return localStorage.getItem(a)}catch(b){}cc.log("not support localStorage");
return""},setLocalStorage:function(a,b){try{if(localStorage)return localStorage.setItem(a,b),!0}catch(c){}cc.log("not support localStorage");return!1},getParameterByName:function(a,b=window.location.href){a=a.replace(/[\[\]]/g,"\\$&");return(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},hasWebcamStream:function(){return 0==this._streamType||1==this._streamType?!0:!1},hasMicrophoneStream:function(){return 0==this._streamType||2==this._streamType?
!0:!1},version:function(){return"50.2"}});function SoundMeter(a){try{this.context=a;this.clip=this.slow=this.instant=0;this.script=a.createScriptProcessor(2048,1,1);const b=this;this.script.onaudioprocess=function(c){c=c.inputBuffer.getChannelData(0);let d,e=0,f=0;for(d=0;d<c.length;++d)e+=c[d]*c[d],.99<Math.abs(c[d])&&(f+=1);b.instant=Math.sqrt(e/c.length);b.slow=.95*b.slow+.05*b.instant;b.clip=f/c.length}}catch(b){}}
SoundMeter.prototype.connectToSource=function(a,b){console.log("SoundMeter connecting");try{a&&(this.mic=this.context.createMediaStreamSource(a),this.mic.connect(this.script),this.script.connect(this.context.destination),"undefined"!==typeof b&&b(null))}catch(c){console.error(c),"undefined"!==typeof b&&b(c)}};SoundMeter.prototype.stop=function(){console.log("SoundMeter stopping");try{this.mic&&this.mic.disconnect(),this.script&&this.script.disconnect()}catch(a){}};aztExam=aztExam||{};
aztExam.monitorStudent=aztExam.monitor.extend({_hasVideoReviewPlaying:!1,_hasExtentCamera:!1,_firstUpload:!0,_queueUpload:null,_uploadIntv:9E3,_needUpdateRealtime:!1,_state:0,w:void 0,_optionsPreparing:null,_lastCurrContent:"",_queueStoreContent:null,ctor:function(){cc.log("init ver= "+this.version());this._super();this.initUI()},init:function(){this._super();this._optionsPreparing=null;this._state=0},initUI:function(){this.preview=this.findDom(document.createElement("div"));this.preview.style.overflow="hidden";
this.preview.style.borderRadius="8px";this.preview.style.backgroundColor="gray";this.preview.style.position="fixed";this.preview.style.zIndex="9999999";this.preview.style.transformOrigin="100% 100%";this.preview.style.width=this._imageCaptureWidth+"px";this.preview.style.height=this._imageCaptureHeight+"px";this.preview.style.display="block";this.preview.addTouch(a=>{});this.volumeMeter=document.createElement("canvas");this.volumeMeter.width=6;this.volumeMeter.height=this._imageCaptureHeight;this.volumeMeter.style.position=
"absolute";this.volumeMeter.style.border="none";this.ctxVolumeMeter=this.volumeMeter.getContext("2d");this.volumeMeter.style.right="0px";this.volumeMeter.style.zIndex="9999999";this.preview.appendChild(this.volumeMeter);this.videoReview=document.createElement("video");this.videoReview.muted=!0;this.videoReview.playsInline=!0;this.videoReview.style.position="absolute";this.videoReview.style.top="0px";this.videoReview.style.left="0px";this.videoReview.classList.add("azt_monitor_webcam_review");this.videoReview.onplay=
()=>{this._hasVideoReviewPlaying=!0;this.updatePreviewUI()};this.videoReview.onresize=()=>{this.updatePreviewUI()};this.preview.appendChild(this.videoReview);this.previewWarning=this.findDom(document.createElement("div"));this.previewWarning.style.width="100%";this.previewWarning.style.height="100%";this.previewWarning.style.backgroundColor="red";this.previewWarning.style.opacity=.2;this.previewWarning.style.position="absolute";this.previewWarning.style.top="0px";this.previewWarning.style.left="0px";
this.previewWarning.lastWarning=!1;this.previewWarning.style.numFound=-1;this.previewWarning.style.display="none";this.preview.appendChild(this.previewWarning);this.canvasPreview=document.createElement("canvas");this.canvasPreview.style.borderRadius="8px";this.ctxPreview=this.canvasPreview.getContext("2d");this.canvasDraw=document.createElement("canvas");this.canvasDraw.numDraw=0;this.canvasDraw.timestamp=[];this.canvasDraw.warning=[];this.ctxDraw=this.canvasDraw.getContext("2d");this.canvasDrawCurr=
document.createElement("canvas");this.canvasDrawCurr.numDraw=0;this.canvasDrawCurr.timestamp=[];this.canvasDrawCurr.warning={};this.canvasDrawCurr.isWarning=!1;this.ctxDrawCurr=this.canvasDrawCurr.getContext("2d");this.ctxDrawCurr.fontSize="18px Arial";this.ctxDrawCurr.fillStyle="red";this.divLog=document.createElement("div");this.divLog.style.position="fixed";this.divLog.style.width="100%";this.divLog.style.height="auto";this.divLog.style.bottom="0px"},updatePreviewUI:function(){this._hasVideoReviewPlaying&&
this._hasExtentCamera?cc.log("has extent camera"):this._hasVideoReviewPlaying?this.previewWidth/this.previewHeight>this.videoReview.videoWidth/this.videoReview.videoHeight?(this.videoReview.style.width="100%",this.videoReview.style.height="auto"):(this.videoReview.style.width="auto",this.videoReview.style.height="100%"):this._hasExtentCamera&&cc.log("has extent camera");this.isMobile()&&(this.preview.style.transform="scale(0.4)")},appendPreviewToElement:function(){clearInterval(this.appendElementItv);
this.appendPreviewToElementTry=0;this.appendElementItv=setInterval(()=>{if(0==this._state)clearInterval(this.appendElementItv),this.preview.parentNode&&this.preview.parentNode.removeChild(this.preview);else if(null==this._optionsPreparing)clearInterval(this.appendElementItv);else if(10<=this.appendPreviewToElementTry)clearInterval(this.appendElementItv),cc.log("not found element to append preview "+this._optionsPreparing.element);else{var a=document.getElementById(this._optionsPreparing.element);
cc.log("try to append preview to element "+a);a?(this.preview.parentNode&&this.preview.parentNode.removeChild(this.preview),a.appendChild(this.preview),this.stream&&this.startAllPreview(),cc.log("append preview to element ok !"),clearInterval(this.appendElementItv)):this.appendPreviewToElementTry++}},1E3)},prepairSession:function(a,b){a!=this._optionsPreparing&&(1==this._state?cc.log("monitor is running , stop it first !"):(this._state=1,this._optionsPreparing=a,cc.log("start prepairSession"),this.collectDeviceInfo(()=>
{if(this.deviceInfo.isSupportMonitor){if(!this.stream){var c=-1,d=-1;0<this.deviceInfo.videoInputDevices.length&&(c=0);0<this.deviceInfo.audioInputDevices.length&&(d=0);this.getMediaUser(c,d)}this.initFaceEyeDetection();this.appendPreviewToElement();a.getUrlPublicTry=0;this.initUrlUploadPublic(a,()=>{b&&b(!0,a)})}else b&&b(!1,a)})))},startSession:function(a){cc.log("start session");this.stopSession();this.prepairSession(a,(b,c)=>{this._optionsPreparing==c&&0!=this._state?b?(cc.log("url curr "+c.urlCurr),
cc.log("url offer "+c.urlOffer),cc.log("url download "+c.urlDownload),""!=c.urlCurr&&""!=c.urlOffer&&""!=c.urlDownload?setTimeout(()=>{this.parseOption(c);this.initFirestoreEvent();this._updateSizePreview();this._updateSizeCurrDraw(this.options.config.currentUpdateSize);this._updateSizeStoreDraw(this.options.config.storeUpdateSize);this._startMonitoring();this._state=1;this._initConn()},10):(cc.log("prepair for session fail , can't get url for options"),this.stopSession())):0!=this._state&&this.showDeviceUI(this.deviceInfo):
cc.log("prepair finish old options ! ")})},stopSession:function(){cc.log("stop session");this.destroyStream();this._stopMonitoring();clearInterval(this.appendPreviewToElement);this.preview.parentNode&&this.preview.parentNode.removeChild(this.preview);this.conn&&this.conn.reset();this._state=0;this._optionsPreparing=null},gotStream:function(a,b,c){this._super(a,b,c);0==this._state?this.stopAllPreview():(this.initSoundMeter(),this._initConn())},handleError:function(a,b,c,d){0!=this._state&&this._super(a,
b,c,d)},destroyStream:function(){this.stopSoundMeter();this._super()},initSoundMeter:function(){if(0==this._streamType||2==this._streamType)try{window.AudioContext=window.AudioContext||window.webkitAudioContext,null==this.audioContext&&(this.audioContext=new AudioContext),null!=this.soundMeter&&this.soundMeter.stop(),this.soundMeter=new SoundMeter(this.audioContext),this.soundMeter.isConnected=!1,this.soundMeter.connectToSource(this.stream,a=>{this.soundMeter.isConnected=!0;a||cc.log("intSoundMeter done")})}catch(a){}},
stopSoundMeter:function(){this.soundMeter&&(this.soundMeter.stop(),this.soundMeter=null)},initFaceEyeDetection:function(){this.w||("undefined"!==typeof Worker?("undefined"==typeof this.w&&(this.w=new Worker("/assets/js/worker.js?ver=1.6")),this.w.onmessage=a=>{a=a.data;"opencvloaded"==a.cmd&&(cc.log("opencv_loaded"),this.isMobile()?this.w.postMessage({cmd:"processiniteye"}):this.w.postMessage({cmd:"processinitface"}));"processimage"==a.cmd&&this.faceEyesDetectResult(a.obj)}):cc.log("browser not support worker"))},
faceEyesDetectResult:function(a){var b=this.isMobile()?a.foundEye.length:a.foundFace.length;if(0==b||1<b)a.currStartTime==this.canvasDrawCurr.startTime&&(cc.log("push curr warning "+a.currIndex+":"+b),this.canvasDrawCurr.isWarning=!0,this.canvasDrawCurr.warning[a.currIndex]=b),a.storeStartTime==this.canvasDraw.startTime&&(cc.log("push store warning "+a.storeIndex+":"+b),this.canvasDraw.isWarning=!0,this.canvasDraw.warning[a.storeIndex]=b)},detectFaceEye:function(a){this.w&&this.w.postMessage({cmd:"processimage",
obj:a})},initUrlUploadPublic:function(a,b){cc.log("getUrlPublic");var c=a.config.domainApi+a.config.urlGetPublicForLive;a.urlDownload="";a.urlCurr="";a.urlOffer="";this.getPublicUpload(c,a.user.token,a.roomid,0,a.user.userid,"curr.txt",1,0,(d,e)=>{d&&""!=d?(a.urlCurr=d,d=e.indexOf(a.roomid),0<=d&&(a.urlDownload=e.substr(0,d)),this.getPublicUpload(c,a.user.token,a.roomid,0,a.user.userid,"offer.txt",1,0,f=>{f&&""!=f?(a.urlOffer=f,b&&b()):(cc.log("getOffer url "+f),a.getUrlPublicTry++,0!=this._state&&
5>a.getUrlPublicTry?setTimeout(()=>{this.initUrlUploadPublic(a,b)},5E3):b&&b())})):(cc.log("getCurr url "+d),a.getUrlPublicTry++,0!=this._state&&5>a.getUrlPublicTry?setTimeout(()=>{this.initUrlUploadPublic(a,b)},5E3):b&&b())})},initFirestoreEvent:function(){this.options.firebaseApp&&(this.options.roomid!=this.lastStudentSubcribleRoomId?(this.lastStudentSubcribleRoomId&&this.examLiveTeachers_student_unbsubscribe(this.lastStudentSubcribleRoomId),this.lastStudentSubcribleRoomId=this.options.roomid,this.examLiveTeachers_student_subscribe(this.options.roomid,
a=>{this.onGetTeacherControl(a)})):cc.log("not change roomid , no need subcrible"))},onGetTeacherControl:function(a){cc.log("student get teacher control "+JSON.stringify(a));if(1==this._state){cc.log("myId "+this.options.user.userid);this.isUpdateRealtime=!1;try{if(1==a.success){var b=a.data;for(a=0;a<b.length;a++){var c=b[a].arr.split(",");for(a=0;a<c.length;a++)c[a].toString()==this.options.user.userid.toString()&&(this.isUpdateRealtime=!0)}}}catch(d){cc.log("exception receive teacher control")}this.isUpdateRealtime&&
this._lastCurrContent&&(cc.log("change to upload realtime"),this.uploadPublicContent(this.options.urlCurr,"curr.txt",this._lastCurrContent,d=>{cc.log("upload curr ok "+d)}))}},_initConn:function(){cc.log("initConn");null==this.conn&&(this.conn=new aztExam.RTCConnection(this));null!=this.stream&&1==this._state&&(cc.log("startConn"),this.conn.start(this.options.user.userid,"","offer"))},_startMonitoring:function(){cc.log("start monitoring "+this.options.user.userid+":"+this.options.user.studentid+":"+
this.options.user.username+":"+this.options.user.studentname);this._running=!0;this._countProcessDraw=0;this._queueStoreContent=[];this._update()},_stopMonitoring:function(){cc.log("stop monitoring");this._queueStoreContent=[];this._running=!1},_update:function(){var a=(new Date).getTime();this._lastTimeDraw?a>this._lastTimeDraw&&1E3<a-this._lastTimeDraw&&(this._processDraw(),this._lastTimeDraw=a):this._lastTimeDraw=a;this._running&&setTimeout(()=>{window.requestAnimationFrame(()=>{this._update()})},
1200)},_updateSizePreview:function(){this.canvasPreview.width=this._imageCaptureWidth;this.canvasPreview.height=this._imageCaptureHeight},_updateSizeCurrDraw:function(a){cc.log("updateSizeCurrDraw "+a);var b=this.options.config;b.currentUpdateSize=a;this.canvasDrawCurr.width=b.currentUpdateSize*this._imageCaptureWidth;this.canvasDrawCurr.height=b.currentUpdateSize*this._imageCaptureHeight;this.canvasDrawCurr.cols=b.currentUpdateSize;this.canvasDrawCurr.rows=b.currentUpdateSize;this.canvasDrawCurr.imageWidth=
this._imageCaptureWidth;this.canvasDrawCurr.imageHeight=this._imageCaptureHeight;this.ctxDrawCurr.clearRect(0,0,this.canvasDrawCurr.width,this.canvasDrawCurr.height);this.canvasDrawCurr.numDraw=0;this.canvasDrawCurr.timestamp=[];this.canvasDrawCurr.warning={};this.canvasDrawCurr.isWarning=!1},_updateSizeStoreDraw:function(a){cc.log("updateSizeStoreDraw "+a);var b=this.options.config;b.storeUpdateSize=a;this.canvasDraw.width=b.storeUpdateSize*this._imageCaptureWidth;this.canvasDraw.height=b.storeUpdateSize*
this._imageCaptureHeight;this.canvasDraw.cols=b.storeUpdateSize;this.canvasDraw.rows=b.storeUpdateSize;this.canvasDraw.imageWidth=this._imageCaptureWidth;this.canvasDraw.imageHeight=this._imageCaptureHeight;this.ctxDraw.clearRect(0,0,this.canvasDraw.width,this.canvasDraw.height);this.canvasDraw.numDraw=0;this.canvasDraw.timestamp=[];this.canvasDraw.warning={};this.canvasDraw.isWarning=!1},_processDraw:function(){if(this._running){this._countProcessDraw++;var a=this.options.config,b=(new Date).getTime();
this.ctxPreview.fillStyle="black";this.ctxPreview.fillRect(0,0,this.canvasPreview.width,this.canvasPreview.height);if(this._hasVideoReviewPlaying&&this._hasExtentCamera)cc.log("has extent camera");else if(this._hasVideoReviewPlaying){var c=this._imageCaptureHeight/this.videoHeight*this.videoHeight;this.ctxPreview.drawImage(this.videoReview,0,0,this.canvasPreview.width,this.canvasPreview.height);var d=(new Date(b)).toLocaleString();this.ctxPreview.fillStyle="red";this.ctxPreview.font="10px Arial";
this.ctxPreview.fillText(d,0,c-10)}else this._hasExtentCamera&&cc.log("has extent camera");d=a.currentUpdateSize;c=a.storeUpdateSize;var e=Math.floor(this.canvasDraw.numDraw/c),f=Math.floor(this.canvasDraw.numDraw%c);this.ctxDrawCurr.drawImage(this.canvasPreview,0,0,this.canvasPreview.width,this.canvasPreview.height,Math.floor(this.canvasDrawCurr.numDraw%d)*this.canvasDrawCurr.imageWidth,Math.floor(this.canvasDrawCurr.numDraw/d)*this.canvasDrawCurr.imageHeight,this.canvasDrawCurr.imageWidth,this.canvasDrawCurr.imageHeight);
0==this.canvasDrawCurr.numDraw&&(this.canvasDrawCurr.startTime=b);this.canvasDrawCurr.numDraw++;this.canvasDrawCurr.timestamp.push(b);0==this._countProcessDraw%4&&(this.ctxDraw.drawImage(this.canvasPreview,0,0,this.canvasPreview.width,this.canvasPreview.height,f*this.canvasDraw.imageWidth,e*this.canvasDraw.imageHeight,this.canvasDraw.imageWidth,this.canvasDraw.imageHeight),0==this.canvasDraw.numDraw&&(this.canvasDraw.startTime=b),this.canvasDraw.numDraw++,this.canvasDraw.timestamp.push(b),this.detectFaceEye({isMobile:this.isMobile(),
currStartTime:this.canvasDrawCurr.startTime,currIndex:this.canvasDrawCurr.numDraw,storeStartTime:this.canvasDraw.startTime,storeIndex:this.canvasDraw.numDraw,imagedata:this.ctxPreview.getImageData(0,0,this.canvasPreview.width,this.canvasPreview.height)}));if(this.canvasDrawCurr.numDraw==d*d){if(this.isUpdateRealtime){cc.log("upload curr"+this.canvasDrawCurr.numDraw+":"+a.currentUpdateSize+":"+a.storeUpdateSize);this._lastCurrContent=this._toStrCanvasDraw(this.canvasDrawCurr);b=Math.floor(5*Math.random());
cc.log("upload size "+this._lastCurrContent.length+":"+b);var g=this._lastCurrContent;setTimeout(()=>{this.uploadPublicContent(this.options.urlCurr,"curr.txt",g,k=>{cc.log("upload curr ok "+k)})},1E3*b)}this.ctxDrawCurr.clearRect(0,0,this.canvasDrawCurr.width,this.canvasDrawCurr.height);this.canvasDrawCurr.numDraw=0;this.canvasDrawCurr.timestamp=[];this.canvasDrawCurr.warning={};this.canvasDrawCurr.isWarning=!1}this.canvasDraw.numDraw==c*c&&(b=this._toStrCanvasDraw(this.canvasDraw),cc.log("push store "+
this.canvasDraw.numDraw+":"+a.currentUpdateSize+":"+a.storeUpdateSize),cc.log("push size "+b.length),this._queueStoreContent.push(b),this._uploadStoreContent(),this.ctxDraw.clearRect(0,0,this.canvasDraw.width,this.canvasDraw.height),this.canvasDraw.numDraw=0,this.canvasDraw.timestamp=[],this.canvasDraw.warning={},this.canvasDraw.isWarning=!1)}},_toStrCanvasDraw:function(a){(new Date).getTime();var b=a.toDataURL("image/jpeg",15),c=(new Date).getTime();a={v:this.version(),c:a.cols,r:a.rows,numImage:a.numDraw,
w:a.imageWidth,h:a.imageHeight,deviceInfo:{hasWebcam:this.deviceInfo.hasWebcam,hasMicrophone:this.deviceInfo.hasMicrophone,isWebsiteHasWebcamPermissions:this.deviceInfo.isWebsiteHasWebcamPermissions,isWebsiteHasMicrophonePermissions:this.deviceInfo.isWebsiteHasMicrophonePermissions},startTime:a.startTime,time:c,timeStr:(new Date).toUTCString(),timestamp:this.canvasDrawCurr.timestamp,warning:this.canvasDrawCurr.warning,isWarning:this.canvasDrawCurr.isWarning};a=JSON.stringify(a);c=a.length;for(var d=
c.toString(),e=10;e>c.toString().length;e--)d="0"+d;return b+a+d},_uploadStoreContent:function(){if(0<this._queueStoreContent.length){var a=this._queueStoreContent.shift(),b=(new Date).getTime()+".azt",c=5+Math.floor(30*Math.random());cc.log("upload store queue rand "+a.length+":"+c);setTimeout(()=>{this.uploadContent(b,a,0,1,d=>{cc.log("upload store queue ok "+d)});this._uploadStoreContent()},1E3*c)}else cc.log("upload store content empty")},role:function(){return"student"}});
aztExam.MonitorStudent=function(){var a;return{getInstance:function(b){null==a&&(a=new aztExam.monitorStudent(b));return a},releaseInst:function(){a=null},inst:function(){return this.getInstance()}}}();aztExam=aztExam||{};
aztExam.monitorTeacher=aztExam.monitor.extend({_imageCaptureWidth:200,_imageCaptureHeight:150,mainViewWidth:1280,mainViewHeight:720,historyWidth:440,userMediaWidth:840,userMediaHeight:472,arrImageIntv:null,isFirstLoad:!0,state:-1,arrUserConn:null,_mouseX:-1,_mouseY:-1,_mouseIntv:-1,_timeOnlineIntv:5E4,_maxUserUpdate:25,_indexStartUpdate:0,_indexEndUpdate:-1,_indexStartShow:0,_numShow:25,currIndexGet:-1,countLoop:0,_roomControlInfo:null,_objUserHasJoined:null,_objUserList:null,_arrUserUpdate:null,
ctor:function(){cc.log("init ver= "+this.version());this._super();this.initUI();window.addEventListener("resize",()=>{this.onresize()});cc.insertCss(".loader {border: 6px solid #f3f3f3; /* Light grey */border-top: 6px solid #3498db; /* Blue */border-radius: 50%;width: 50px;height: 50px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}");document.addEventListener("fullscreenchange",()=>{this.onFullscreenChange()},!1);document.addEventListener("webkitfullscreenchange",
()=>{this.onFullscreenChange()},!1);document.addEventListener("mozfullscreenchange",()=>{this.onFullscreenChange()},!1);this.onresize()},start:function(a){this.parseOption(a);this._objUserList={};for(a=0;a<this.options.userlistStart.length;a++){var b={};b.userid=this.options.userlistStart[a].userid;b.studentid=this.options.userlistStart[a].studentid;b.username=cc.isEmpty(this.options.userlistStart[a].studentname)?this.options.userlistStart[a].username:this.options.userlistStart[a].studentname;this.options.userlist[a]=
b;this._objUserList[this.options.userlist[a].userid]=this.options.userlist[a]}this._running=!0;this.collectDeviceInfo(()=>{this._imageCaptureWidth=360;this._imageCaptureHeight=202;this.initUrlUploadPublic(()=>{this.initShowUser();this.loop()})})},loop:function(){cc.log("running "+this._running);this._running&&this.update(0)},stopLoop:function(){this._running=!1},stop:function(){},reset:function(){this._super();this.currIndexGet=-1;this.countLoop=this._indexEndUpdate=this._indexStartUpdate=this._indexStartShow=
0;this.isFirstLoad=!0;this.setState(0);this.arrUserConn=[];this._objUserHasJoined={};this._objUserList={};this._arrUserUpdate=[];this._roomControlInfo=null},startFirestoreEvent:function(){},initUrlUploadPublic:function(a){this.showLoading();this.getTokenForLive(this.options.roomid,b=>{b&&""!=b?(this.options.user.token=b,this.getPublicUpload(this.options.config.urlGetPublicForLive,this.options.user.token,this.options.roomid,0,this.options.user.userid,"offer.txt",1,0,(c,d)=>{if(c&&""!=c){var e=d.indexOf(this.options.roomid);
0<=e?(this._urlDownload=d.substr(0,e),this.hideLoading(),setTimeout(()=>{a&&a()},100)):alert("L\u1ed7i l\u1ea5y d\u1eef li\u1ec7u upload ! "+c+":"+this.options.roomid)}else setTimeout(()=>{this.initUrlUploadPublic(a)},8E3)})):setTimeout(()=>{this.initUrlUploadPublic(a)},8E3)})},onFullscreenChange:function(){this.btFullscreen.innerHTML=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?aztExam.svg.iconExitFullscreen:aztExam.svg.iconFullscreen},toggleFullScreen:function(){var a=
this.app;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},initUI:function(){this.app=document.createElement("div");this.app.style.width="100%";this.app.style.height=
"100%";this.app.style.fontFamily="sans-serif";this.app.style.fontSize="20px";this.app.style.overflow="hidden";this.app.style.backgroundColor="#222222";this.mainView=this.findDom(document.createElement("div"));this.mainView.css("width","100%");this.mainView.css("height","100%");this.mainView.css("transform-origin","0% 0%");this.mainView.css("position","absolute");this.mainView.classList.add("azt_monitor_mainview");this.mainView.css("background-color","#4c4b4b");this.mainView.css("overflow","hidden");
this.mainView.css("display","none");this.app.appendChild(this.mainView);this.userView=this.findDom(document.createElement("div"));this.userView.css("width","100%");this.userView.css("height","100%");this.userView.css("transform-origin","0% 0%");this.userView.css("position","absolute");this.userView.css("overflow","hidden");this.userView.classList.add("azt_monitor_userview");this.userView.css("background-color","#4c4b4b");this.userView.css("display","none");this.app.appendChild(this.userView);this.divLog=
document.createElement("div");this.divLog.style.position="fixed";this.divLog.style.width="100%";this.divLog.style.height="auto";this.divLog.style.bottom="0px";this.loadingDiv=document.createElement("div");this.loadingDiv.style.width="100%";this.loadingDiv.style.height="100%";this.loadingDiv.style.backgroundColor="gray";this.loadingDiv.style.opacity=.5;this.loadingDiv.style.display="none";this.loadingDiv.style.justifyContent="center";this.loadingDiv.style.alignItems="center";this.loadingDiv.style.position=
"absolute";this.loadingDiv.style.zIndex="9999999999";this.loadingDiv.innerHTML="<div class='loader'></div>";document.body.appendChild(this.loadingDiv);this.initMainView();this.initUserView();this.initUserHistory();this.setState(0)},onresize:function(){var a=window.innerHeight-52;var b=window.innerWidth-96;if(!(0>=a||0>=b)){var c=this.mainViewWidth/this.mainViewHeight<b/a?a/this.mainViewHeight:b/this.mainViewWidth;a=(a-this.mainViewHeight*c)/2;b=48+(b-this.mainViewWidth*c)/2;this.classMedia.css("transform",
"scale("+c+")");this.classMedia.css("top",a+"px");this.classMedia.css("left",b+"px");this.btBack.style.top=(window.innerHeight-100)/2+"px";this.btNext.style.left=window.innerWidth-48+"px";this.btNext.style.top=(window.innerHeight-100)/2+"px";this.userHeader.css("width",window.innerWidth-this.historyWidth+"px");this.myMedia.css("width",window.innerWidth-this.historyWidth+"px");this.app.style.height=window.innerHeight+"px";this.userMediaWidth=window.innerWidth-this.historyWidth-2;this.userMediaHeight=
window.innerHeight-60;this.userMedia.css("width",this.userMediaWidth+"px");this.userMedia.css("height",this.userMediaHeight+"px");this.userMedia.css("top","65px");this.listUser.style.height=window.innerHeight-120+"px";this.resizeUserMedia()}},initMainView:function(){this.mainHeader=this.findDom(document.createElement("div"));this.mainHeader.css("width","100%");this.mainHeader.css("height","60px");this.mainHeader.css("border-bottom","1px solid black");this.mainHeader.css("position","fixed");this.mainHeader.css("display",
"none");this.mainHeader.css("top","0px");this.mainHeader.css("background-color","#333434");this.mainView.appendChild(this.mainHeader);this.btViewHistory=this.createButton(180,36,"TH\u00d4NG TIN C\u00c1 NH\u00c2N","#1A84E3",14);this.btViewHistory.css("position","absolute");this.btViewHistory.css("top","12px");this.btViewHistory.css("right","180px");this.btViewHistory.css("cursor","pointer");this.btViewHistory.addTouch(b=>{this.removeAllUserMedia();this.showListUser();this.setState(1)});this.mainHeader.appendChild(this.btViewHistory);
this.btExit=this.createButton(80,36,"\u0110\u00d3NG","#1A84E3",14);this.btExit.css("position","absolute");this.btExit.css("top","12px");this.btExit.css("left","12px");this.btExit.css("cursor","pointer");this.btExit.addTouch(b=>{window.parent.aztExam.removeMonitorTeacher&&window.parent.aztExam.removeMonitorTeacher()});this.mainHeader.appendChild(this.btExit);this.mainBottomMenu=this.findDom(document.createElement("div"));this.mainBottomMenu.style.width="100%";this.mainBottomMenu.style.height="50px";
this.mainBottomMenu.css("border-top","1px solid black");this.mainBottomMenu.css("position","fixed");this.mainBottomMenu.css("bottom","0px");this.mainBottomMenu.css("background-color","#222222");this.mainView.appendChild(this.mainBottomMenu);this.classMedia=this.findDom(document.createElement("div"));this.classMedia.css("width",this.mainViewWidth+"px");this.classMedia.css("height",this.mainViewHeight+"px");this.classMedia.css("overflow","hidden");this.classMedia.css("transform-origin","0% 0%");this.classMedia.css("position",
"absolute");this.classMedia.classList.add("azt_monitor_mainview");this.classMedia.css("background-color","#4c4b4b");this.mainView.appendChild(this.classMedia);this.btClose=this.findDom(document.createElement("div"));this.btClose.css("width","80px");this.btClose.css("height","36px");this.btClose.css("position","absolute");this.btClose.css("right","10px");this.btClose.css("bottom","7px");this.btClose.css("color","red");this.btClose.css("background","#333434");this.btClose.css("line-height","36px");
this.btClose.css("cursor","pointer");this.btClose.css("text-align","center");this.btClose.innerHTML="\u0110\u00d3NG";this.btClose.css("font-size","14px");this.btClose.addTouch(b=>{window.parent.aztExam.removeMonitorTeacher&&window.parent.aztExam.removeMonitorTeacher()});this.mainView.appendChild(this.btClose);this.btClassInfo=this.findDom(document.createElement("div"));this.btClassInfo.css("width","190px");this.btClassInfo.css("height","36px");this.btClassInfo.css("position","absolute");this.btClassInfo.css("left",
"10px");this.btClassInfo.css("bottom","7px");this.btClassInfo.css("color","white");this.btClassInfo.css("background","#333434");this.btClassInfo.css("line-height","36px");this.btClassInfo.css("cursor","pointer");this.btClassInfo.css("font-size","12px");this.mainView.appendChild(this.btClassInfo);this.txtClassInfo=document.createElement("div");this.txtClassInfo.style.width="150px";this.txtClassInfo.style.lineHeight="36px";this.txtClassInfo.style.marginLeft="40px";this.btClassInfo.appendChild(this.txtClassInfo);
var a=document.createElement("div");a.innerHTML=aztExam.svg.iconGroup;a.style.position="absolute";a.style.top="4px";a.style.left="8px";this.btClassInfo.appendChild(a);this.btClassInfo.addTouch(b=>{this.removeAllUserMedia();this.showListUser();this.setState(1)});this.btBack=this.findDom(document.createElement("div"));this.btBack.style.width="48px";this.btBack.style.height="auto";this.btBack.style.textAlign="center";this.btBack.style.position="absolute";this.btBack.style.left="0px";this.btBack.style.color=
"gray";this.btBack.style.fontSize="14px";this.btBack.style.top=(window.innerHeight-100)/2+"px";this.btBack.style.cursor="pointer";this.btBack.style.display="none";this.mainView.appendChild(this.btBack);a=document.createElement("div");a.innerHTML=aztExam.svg.iconLeft;a.style.fill="gray";this.btBack.appendChild(a);this.infoBack=document.createElement("div");this.infoBack.style.width="100%";this.infoBack.style.marginTop="-10px";this.btBack.appendChild(this.infoBack);this.btBack.addTouch(b=>{this.backShowUser()});
this.btNext=this.findDom(document.createElement("div"));this.btNext.style.width="48px";this.btNext.style.height="auto";this.btNext.style.textAlign="center";this.btNext.style.position="absolute";this.btNext.style.left=window.innerWidth-58+"px";this.btNext.style.top=(window.innerHeight-100)/2+"px";this.btNext.style.color="gray";this.btNext.style.fontSize="14px";this.btNext.style.cursor="pointer";this.btNext.style.display="none";this.mainView.appendChild(this.btNext);a=document.createElement("div");
a.innerHTML=aztExam.svg.iconLeft;a.style.fill="gray";a.style.transform="scale(-1,1)";this.btNext.appendChild(a);this.infoNext=document.createElement("div");this.infoNext.style.width="100%";this.infoNext.style.marginTop="-10px";this.btNext.appendChild(this.infoNext);this.btNext.addTouch(b=>{this.nextShowUser()});this.btFullscreen=this.findDom(document.createElement("div"));this.btFullscreen.css("cursor","pointer");this.btFullscreen.css("position","absolute");this.btFullscreen.css("top","5px");this.btFullscreen.css("right",
"5px");this.btFullscreen.css("transform","scale(0.6,0.6)");this.btFullscreen.innerHTML=aztExam.svg.iconFullscreen;this.btFullscreen.addTouch(b=>{this.toggleFullScreen()});this.mainView.appendChild(this.btFullscreen)},initUserView:function(){this.userMedia=this.findDom(document.createElement("div"));this.userMedia.css("width",this.userMediaWidth+"px");this.userMedia.css("height",this.userMediaHeight+"px");this.userMedia.css("transform-origin","0% 0%");this.userMedia.css("background-color","#222222");
this.userMedia.css("position","absolute");this.userMedia.css("overflow","hidden");this.userView.appendChild(this.userMedia);this.history=this.findDom(document.createElement("div"));this.history.css("width",this.historyWidth+"px");this.history.css("height","100%");this.history.css("background-color","white");this.history.css("overflow-y","hidden");this.history.css("overflow-x","hidden");this.history.css("position","absolute");this.history.css("right","0px");this.history.css("display","block");this.userView.appendChild(this.history);
this.listUserView=this.findDom(document.createElement("div"));this.listUserView.css("width",this.historyWidth+"px");this.listUserView.css("height","100%");this.listUserView.css("overflow","hidden");this.listUserView.css("background-color","white");this.listUserView.css("position","absolute");this.listUserView.css("right","0px");this.listUserView.css("display","none");this.userView.appendChild(this.listUserView);this.userHeader=this.findDom(document.createElement("div"));this.userHeader.css("width",
window.innerWidth-this.historyWidth+"px");this.userHeader.css("height","60px");this.userHeader.css("position","absolute");this.userHeader.css("top","0px");this.userHeader.css("left","0px");this.userHeader.css("background-color","#333434");this.userView.appendChild(this.userHeader);this.btUserViewDone=this.createButton(220,36,"M\u00c0N H\u00ccNH THEO D\u00d5I","#1A84E3",14);this.btUserViewDone.css("position","absolute");this.btUserViewDone.css("top","12px");this.btUserViewDone.css("left","12px");this.btUserViewDone.css("cursor",
"pointer");this.btUserViewDone.addTouch(d=>{this.removeAllUserMedia();this.setState(0)});this.userHeader.appendChild(this.btUserViewDone);this.myMedia=this.findDom(document.createElement("div"));this.myMedia.css("width",window.innerWidth-this.historyWidth+"px");this.myMedia.css("height","80px");this.myMedia.css("position","absolute");this.myMedia.css("bottom","0px");this.myMedia.css("left","0px");this.myMedia.css("display","flex");this.myMedia.css("flex-direction","row");this.myMedia.css("align-items",
"center");this.myMedia.css("justify-content","end");this.myMedia.css("background-color","#333434");this.myMedia.css("display","none");this.userView.appendChild(this.myMedia);this.videoReview=this.findDom(document.createElement("video"));this.videoReview.muted=!0;this.videoReview.playsInline=!0;this.videoReview.height=80;this.videoReview.onplay=()=>{this._hasVideoReviewPlaying=!0;this.videoReview.height=80};this.btMyMedia=this.findDom(document.createElement("div"));this.btMyMedia.css("width","35px");
this.btMyMedia.css("height",80);this.btMyMedia.css("margin-left","10px");this.btMyMedia.css("margin-right","6px");this.myMedia.appendChild(this.videoReview);this.myMedia.appendChild(this.btMyMedia);this.btMyCameraOff=this.findDom(document.createElement("div"));this.btMyCameraOff.innerHTML=aztExam.svg.iconCameraOff;this.btMyCameraOff.css("width","30px");this.btMyCameraOff.css("height","30px");this.btMyCameraOff.css("fill","#cd1f1f");this.btMyCameraOff.css("color","#cd1f1f");this.btMyCameraOff.css("display",
"none");this.btMyCameraOff.css("margin-top","5px");this.btMyCameraOff.css("cursor","pointer");this.btMyMedia.appendChild(this.btMyCameraOff);this.btMyCamera=this.findDom(document.createElement("div"));this.btMyCamera.innerHTML=aztExam.svg.iconCamera;this.btMyCamera.css("width","30px");this.btMyCamera.css("height","30px");this.btMyCamera.css("fill","#dfd9d9");this.btMyCamera.css("color","#dfd9d9");this.btMyCamera.css("display","block");this.btMyCamera.css("margin-top","5px");this.btMyCamera.css("cursor",
"pointer");this.btMyMedia.appendChild(this.btMyCamera);this.btMyMicOff=this.findDom(document.createElement("div"));this.btMyMicOff.innerHTML=aztExam.svg.iconMicOff;this.btMyMicOff.css("width","25px");this.btMyMicOff.css("height","25px");this.btMyMicOff.css("fill","#cd1f1f");this.btMyMicOff.css("display","none");this.btMyMicOff.css("margin-top","10px");this.btMyMicOff.css("cursor","pointer");this.btMyMedia.appendChild(this.btMyMicOff);this.btMyMic=this.findDom(document.createElement("div"));this.btMyMic.innerHTML=
aztExam.svg.iconMic;this.btMyMic.css("width","25px");this.btMyMic.css("height","25px");this.btMyMic.css("fill","#dfd9d9");this.btMyMic.css("display","block");this.btMyMic.css("cursor","pointer");this.btMyMic.css("margin-top","10px");this.btMyMedia.appendChild(this.btMyMic);var a=document.createElement("div");a.style.width="100%";a.style.height="40px";a.style.padding="10px";a.style.borderBottom="1px solid #CCCCCC";a.style.marginBottom="20px";this.listUserView.appendChild(a);var b=this.createButton(130,
36,"TH\u00d4NG TIN","#1A84E3",14);b.style.float="left";b.style.marginTop="4px";b.addTouch(d=>{this.showUserHistory()});a.appendChild(b);var c=document.createElement("div");c.style.width="59%";c.style.height="21px";c.style.borderRadius="8px";c.style.borderColor="#CCCCCC";c.style.backgroundColor="#edeaea";c.style.color="#afaaaa";c.style.padding="10px";c.style.fontSize="17px";c.style.marginLeft="8px";c.style.float="left";c.innerHTML="T\u00ecm theo t\u00ean ";c.setAttribute("contenteditable",!0);c.setAttribute("contentsearch",
"");c.addEventListener("input",()=>{cc.log("on txt search change "+c.innerHTML);c.setAttribute("contentsearch",c.innerHTML);this.searchUserListItem(c.innerHTML)});c.addEventListener("focus",()=>{""==c.getAttribute("contentsearch")&&(c.innerHTML="",this.searchUserListItem(c.innerHTML))});c.addEventListener("blur",()=>{""==c.innerHTML&&(this.searchUserListItem(""),c.innerHTML="T\u00ecm theo t\u00ean ")});a.appendChild(c);this.txtListUserInfo=document.createElement("div");this.txtListUserInfo.style.width=
"50%";this.txtListUserInfo.style.height="20px";this.txtListUserInfo.innerHTML="";this.txtListUserInfo.style.fontFamily="sans-serif";this.txtListUserInfo.style.fontSize="16px";this.txtListUserInfo.style.paddingLeft="15px";this.listUserView.appendChild(this.txtListUserInfo);this.listUser=document.createElement("div");this.listUser.style.width="100%";this.listUser.style.overflowX="hidden";this.listUser.style.overflowY="scroll";this.listUser.style.height=window.innerHeight-80+"px";this.listUserView.appendChild(this.listUser);
a=document.createElement("div");a.style.width="100%";a.style.height="40px";a.style.padding="10px";a.style.borderBottom="1px solid #CCCCCC";a.style.marginBottom="10px";a.style.display="flex";a.style.flexDirection="row";a.style.justifyContent="start";a.style.alignItems="center";this.history.appendChild(a);b=this.createButton(130,36,"DANH S\u00c1CH","#1A84E3",14);b.style.marginTop="4px";b.addTouch(d=>{this.showListUser()});a.appendChild(b);b=document.createElement("div");b.style.fontSize="16px";b.innerHTML=
aztExam.lang.lbTitleHistory;b.style.fontWeight="bold";b.style.marginTop="4px";b.style.marginLeft="25px";a.appendChild(b)},setState(a){this.state!=a&&(this.state=a,this.mainView.css("display","none"),this.userView.css("display","none"),0==this.state&&this.mainView.css("display","block"),1==this.state&&this.userView.css("display","block"))},showLoading(){this.loadingDiv.style.display="flex";this.loadingDiv.style.justifyContent="center";this.loadingDiv.style.alignContent="center"},hideLoading(){this.loadingDiv.style.display=
"none"},update:function(a){a=(new Date).getTime();this._lastTimeIntv?a>this._lastTimeIntv&&1E3<a-this._lastTimeIntv&&(this.processImageIntv(),this._lastTimeIntv=a):this._lastTimeIntv=a;this._lastTimeGet?a>this._lastTimeGet&&450<a-this._lastTimeGet&&(this.getCurrNew(),this._lastTimeGet=a):this._lastTimeGet=a;this._lastTimeGetOffline?a>this._lastTimeGetOffline&&2E3<a-this._lastTimeGetOffline&&(this.getCurrOffline(),this._lastTimeGetOffline=a):this._lastTimeGetOffline=a;this._running&&window.requestAnimationFrame(b=>
{this.update(b)})},getCurrNew:function(){this.isFirstLoad&&(this.currIndexGet++,this.currIndexGet>=this._arrUserUpdate.length?(this.currIndexGet=-1,this.isFirstLoad=!1):(cc.log("load index "+this.currIndexGet),this.getCurrUser(this._arrUserUpdate[this.currIndexGet])));if(8>this.countLoop){for(var a=null,b=Number.MAX_VALUE,c=0;c<this._arrUserUpdate.length;c++){var d=(new Date).getTime(),e=Number(this._arrUserUpdate[c].lastimeUpdate);if(this._arrUserUpdate[c].info){var f=this._arrUserUpdate[c].info.startTime;
4E3<d-e&&e<b&&d-f<this.options.duration&&(b=e,a=this._arrUserUpdate[c])}}a?(this.countLoop++,cc.log("getUserOnline : "+a.userid),this.getCurrUser(a)):0<this.countLoop&&this.countLoop--}else 8<=this.countLoop&&17>this.countLoop?(this.countLoop++,cc.log("rest")):17<=this.countLoop&&(this.countLoop=0)},getCurrOffline:function(){var a=null,b=Number.MAX_VALUE;(new Date).getTime();for(var c=0;c<this._arrUserUpdate.length;c++){var d=(new Date).getTime();if(this._arrUserUpdate[c].lastimeUpdate){var e=Number(this._arrUserUpdate[c].lastimeUpdate);
(null==this._arrUserUpdate[c].info||d-this._arrUserUpdate[c].info.startTime>this.options.duration)&&4E3<d-e&&e<b&&(b=e,a=this._arrUserUpdate[c])}}a&&(cc.log("getUserOffline : "+a.userid),this.getCurrUser(a))},getCurr:function(){this.isFirstLoad?(this.currIndexGet++,this.currIndexGet>=this._indexEndUpdate?(this.isFirstLoad=!1,this.currIndexGet=-9):(cc.log("load index "+this.currIndexGet),this.getCurrUser(this.options.userlist[this.currIndexGet]))):-1>this.currIndexGet?this.currIndexGet++:(this.countLoop++,
9>this.countLoop?this.currIndexGet>=this._indexEndUpdate?this.currIndexGet=-1:(this.currIndexGet++,cc.log("load index "+this.currIndexGet),this.getCurrUser(this.options.userlist[this.currIndexGet])):16<=this.countLoop&&(this.countLoop=-1))},getCurrUser:function(a){if(a&&a.userid){var b=(new Date).getTime();a.lastimeUpdate=b;if(!(0>=a.userid)){var c=new XMLHttpRequest;c.user=a;c.onreadystatechange=()=>{if(4==c.readyState)if(200==c.status)this.onGetCurrUser(!0,c.responseText,c.user);else this.onGetCurrUser(!1,
null,c.user)};c.open("GET",this._urlDownload+this.options.roomid+"/"+a.userid+"/public/curr.txt?t="+(new Date).getTime());c.send()}}},onGetCurrUser:function(a,b,c){if(a){var d=parseInt(b.substr(b.length-10,10));a=b.substr(0,b.length-(10+d));b=b.substr(b.length-(10+d),d);b=JSON.parse(b);c.info=b;d=(new Date).getTime();c.info.status=d-b.startTime>this._timeOnlineIntv?"join":"online";c.imgstr=a;c.mainViewItem&&this.bindMainviewItem(c);c.userListItem&&this.bindUserListItem(c);this.bindUserHistory(c)}},
addUser:function(a){if(0<a.length){for(var b=-1,c=0;c<a.length;c++)if(a[c].userid&&a[c].username)if(null==this._objUserList[a[c].userid]){var d=JSON.parse(JSON.stringify(a[c]));this.options.userlist.push(d);-1==b&&(b=this.options.userlist.length-1);this._objUserList[a[c].userid]=d;this.getCurrUser(d)}else a[c].t&&(this._objUserList[a[c]].startTime=a[c].t),this.getCurrUser(this._objUserList[a[c]]);-1<b&&this._indexStartShow+this._numShow>b&&this.showUser()}},backShowUser:function(){if(this._indexStartShow>=
this._numShow){this._indexStartUpdate=this._indexStartShow-=this._numShow;this._indexEndUpdate=this._indexStartUpdate+this._maxUserUpdate<this.options.userlist.length?this._indexStartUpdate+this._maxUserUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;cc.log("backShowUser :"+this._indexStartShow+":"+this._indexStartUpdate+":"+this._indexEndUpdate);this._arrUserUpdate=[];for(var a=this._indexStartUpdate;a<this._indexEndUpdate;a++)this._arrUserUpdate.push(this.options.userlist[a]);
this.showUser();this.sendMessControlToStudent();this.showLoading();setTimeout(()=>{this.hideLoading()},1E3)}},nextShowUser:function(){this._indexStartUpdate=this._indexStartShow=this._indexStartShow+this._numShow<this.options.userlist.length?this._indexStartShow+this._numShow:0;this._indexEndUpdate=this._indexStartUpdate+this._maxUserUpdate<this.options.userlist.length?this._indexStartUpdate+this._maxUserUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;
this._arrUserUpdate=[];for(var a=this._indexStartUpdate;a<this._indexEndUpdate;a++)this._arrUserUpdate.push(this.options.userlist[a]);cc.log("nextShowUser :"+this._indexStartShow+":"+this._indexStartUpdate+":"+this._indexEndUpdate);this.showUser();this.sendMessControlToStudent();this.showLoading();setTimeout(()=>{this.hideLoading()},1E3)},initShowUser:function(){var a=-1,b=this.getLocalStorage("aztTeacherControl");if(!cc.isEmpty(b))try{a=JSON.parse(b).idx}catch(c){}cc.log("localStartShow "+a);this._indexStartUpdate=
this._indexStartShow=0<=a?a:0;this._indexEndUpdate=this.options.userlist.length>this._maxUserUpdate+this._indexStartUpdate?this._maxUserUpdate+this._indexStartUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;cc.log("list user : "+JSON.stringify(this.options.userlist));cc.log("initShowUser "+this._indexStartShow+":"+this._indexStartUpdate+":"+this._indexEndUpdate);this._arrUserUpdate=[];for(b=this._indexStartUpdate;b<this._indexEndUpdate;b++)this._arrUserUpdate.push(this.options.userlist[b]);
0>a&&this.sendMessControlToStudent();this.showUser()},sendMessControlToStudent:function(){for(var a=[],b=0;b<this._arrUserUpdate.length;b++)a.push(this._arrUserUpdate[b].userid);var c={idx:this._indexStartShow,cmd:"neba",arr:a.toString()};this.examLiveTeachers_teacher_saveChange(this.options.roomid,c,d=>{cc.log("write control response :"+JSON.stringify(d));this.setLocalStorage("aztTeacherControl",JSON.stringify(c))})},showUser:function(){this.bindClassMedia();this.initListUser();this.txtClassInfo.innerHTML=
"Danh s\u00e1ch h\u1ecdc sinh ( "+this.options.userlist.length+" )";var a=Math.floor(this.options.userlist.length/this._numShow);a=a==this.options.userlist.length/this._numShow?a:a+1;var b=Math.floor(this._indexStartShow/this._numShow)+1;this.infoNext.innerHTML=b+" / "+a;this.infoBack.innerHTML=b+" / "+a;this.btBack.style.display="block";this.btNext.style.display="block"},refreshUserJoin:function(){for(var a=0,b=(new Date).getTime(),c=0;c<this.options.userlist.length;c++)this.options.userlist[c].info&&
b-this.options.userlist[c].info.startTime<this.options.duration&&a++},bindClassMedia:function(){var a=this._arrUserUpdate;if(0!=a.length){cc.log("bindClassMedia "+a.length);for(var b=Math.sqrt(this._numShow),c=0,d=Math.floor(this.mainViewWidth/b)-1,e=Math.floor(this.mainViewHeight/Math.sqrt(this._numShow))-1,f=0;f<this.options.userlist.length;f++)this.options.userlist[f].mainViewItem=null;cc.removeAllChildNodes(this.classMedia);for(f=0;f<this._arrUserUpdate.length;f++){var g=this.createMainviewItem(a[f],
d,e);g.style.position="absolute";g.style.overflow="hidden";g.style.left=c%b*d+"px";g.style.top=Math.floor(c/b)*e+"px";g.style.cursor="pointer";g.addEventListener("mouseup",k=>{this.addUserMedia(k.currentTarget.user);this.showUserHistory();this.setState(1);k.stopPropagation()});this.classMedia.appendChild(g);c++}}},processImageIntv:function(){if(0==this.state)for(var a=document.getElementsByClassName("aztExam_image_intv"),b=0;b<a.length;b++){var c=a[b];if(c.hasLoaded){var d=c.image,e=c.info.w,f=c.info.h,
g=c.currIdx,k=c.info.numImage,h=c.info.c,q=c.info.r;0<=c.currIdx&&0<k&&(col=Math.floor(g%h),row=Math.floor(g/q),d.style.marginTop=-(row*f)+"px",d.style.marginLeft=-(col*e)+"px",null!=c.info.warning[g.toString()]?(d=parseInt(c.info.warning[g.toString()]),1<d&&(c.warning.style.backgroundColor="yellow",c.warning.style.display="block"),0==d&&(c.warning.style.backgroundColor="red",c.warning.style.display="block")):c.warning.style.display="none",g=g<k-1?g+1:-4,c.currIdx=g)}}},createMainviewItem:function(a,
b,c){var d=document.createElement("div");d.style.border="1px solid black";d.style.backgroundColor="#2e2d2d";d.style.width=b+"px";d.style.height=c+"px";d.user=a;var e=this.findDom(document.createElement("div"));e.css("font-size","14px");e.css("color","white");e.css("width",b+"px");e.css("height","28px");e.css("display","flex");e.css("align-items","center");e.css("position","absolute");e.css("bottom","0px");e.css("background-color","#4c4949");var f=document.createElement("span");f.style.width=b-70+
"px";f.style.paddingLeft="10px";f.style.whiteSpace="nowrap";f.style.overflow="hidden";f.style.color="gray";f.innerHTML=a.username;e.appendChild(f);d.spanName=f;f=this.findDom(document.createElement("div"));f.innerHTML=aztExam.svg.iconRefresh;f.css("position","absolute");f.css("width","15px");f.css("height","15px");f.css("bottom","8px");f.css("right","30px");f.css("display","block");f.css("cursor","pointer");f.setAttribute("icRefresh",!0);f.addEventListener("mouseup",g=>{this.getCurrUser(g.currentTarget.it.user);
g.stopPropagation()});f.it=d;d.icRefresh=f;f=this.findDom(document.createElement("div"));f.css("border-radius","50%");f.css("background-color","gray");f.css("width","6px");f.css("height","6px");f.css("position","absolute");f.css("bottom","11px");f.css("right","11px");e.appendChild(f);d.icStatus=f;f=this.findDom(document.createElement("div"));f.innerHTML=aztExam.svg.iconWarning;f.css("position","absolute");f.css("bottom","8px");f.css("right","60px");f.css("display","none");d.icWarning=f;f=document.createElement("span");
f.style.position="absolute";f.style.width="60px";f.style.right="22px";f.style.bottom="8px";f.style.textAlign="right";f.style.color="gray";e.appendChild(f);d.txtTimeUpdate=f;c=22<=c-50?c-50:22;f=this.createCircleAva(a.username,c,"#222222","gray");d.appendChild(f);f.style.position="absolute";f.style.top="12px";f.style.left=(b-c)/2+"px";a.imageIntv||(a.imageIntv=this.createImageIntv());d.imageIntv=a.imageIntv;d.imageIntv.style.display="none";d.appendChild(d.imageIntv);d.appendChild(e);a.mainViewItem=
d;this.bindMainviewItem(a);return d},bindMainviewItem:function(a){if(a&&a.mainViewItem&&a.info&&a.imgstr){var b=a.mainViewItem,c=a.info,d=a.imgstr;a=this.isOnline(c);b.icStatus.style.backgroundColor=a?"#0af50a":"yellow";b.spanName.style.color=a?"white":"gray";b.icWarning.style.display=c.isWarning&&a?"block":"none";var e=(new Date).getTime();e=Math.floor((e-c.time)/1E3);e=3600<e?Math.floor(e/3600)+"h":60<e?Math.floor(e/60)+"m":e+"s";b.txtTimeUpdate.innerHTML=e+" ago";b.imageIntv.style.display="block";
e=b.imageIntv;if(e.imageTime!=c.time){e=b.imageIntv;var f=e.image;f.src=d;f.style.marginTop="0px";f.style.marginLeft="0px";e.currIdx=0;e.info=c;e.hasLoaded=!0;e.imageTime=c.time;d=c.w;var g=c.h;e.style.width=d+"px";e.style.height=g+"px";f=parseInt(b.style.width);g=(parseInt(b.style.height)-28)/g;e.style.transform="scale("+g+")";e.style.top="0px";e.style.left=(f-d*g)/2+"px"}b.lastimeUpdate=(new Date).getTime();b.hasLoaded=!0;b.status="updated";b.info=c;b.user.isOnline=a;b.user.info=c}},createImageIntv:function(a){a=
this.findDom(document.createElement("div"));a.style.overflow="hidden";a.style.width=this._imageCaptureWidth+"px";a.style.height=this._imageCaptureHeight+"px";a.classList.add("aztExam_image_intv");a.style.transformOrigin="0% 0%";a.style.position="absolute";a.style.backgroundColor="#2e2d2d";var b=new Image;b.style.position="absolute";a.appendChild(b);var c=document.createElement("div");c.style.position="absolute";c.style.width="100%";c.style.height="100%";c.style.backgroundColor="red";c.style.opacity=
"0.3";c.style.display="none";a.warning=c;a.appendChild(c);a.currIdx=-1;a.image=b;a.imageTime=-1;a.info=null;return a},initConn:function(){this.arrConn=[];for(var a=0;4>a;a++)this.arrConn[a]=new aztExam.RTCConnection(this),this.arrConn[a].initConn(this.options.user.userid,"user_"+a,"find_offer"),this.app.appendChild(this.arrConn[a].ui)},addUserMedia:function(a){if(cc.isArray(a)&&0<a.length){for(var b=0;b<a.length>0;b++)this.initUserConn(a[b]);this.history.user=a[0];this.bindUserHistory(a[0]);this.bindUserMedia(this.arrUserConn);
this.getListFile(this.options.roomid,a[0].userid)}else this.initUserConn(a),this.history.user=a,this.bindUserHistory(a),this.bindUserMedia(this.arrUserConn),this.getListFile(this.options.roomid,a.userid)},initUserConn:function(a){for(var b=-1,c=-1,d=0;d<this.arrUserConn.length;d++)this.arrUserConn[d].user==a&&(b=d),!this.arrUserConn[d].isUsed&&0>c&&(c=d);if(!(0<=b)){b=null;if(0>c)if(4>this.arrUserConn.length)b=new aztExam.RTCConnection(this),this.arrUserConn.push(b);else{c=Number.MAX_VALUE;var e=
null;for(d=0;d<this.arrUserConn.length;d++)0<=this.arrUserConn[d].timeUsed&&this.arrUserConn[d].timeUsed<c&&(c=this.arrUserConn[d].timeUsed,e=this.arrUserConn[d]);e&&(b=e,b.stop())}else b=this.arrUserConn[c];b.user=a;b.start(this.options.user.userid,a.userid)}},removeUserMedia:function(a){for(var b=-1,c=0;c<this.arrUserConn.length;c++)if(this.arrUserConn[c].user==a){b=c;break}0<=b&&(this.arrUserConn[c].stop(),this.arrUserConn[c].user=null);this.bindUserMedia(this.arrUserConn)},removeAllUserMedia:function(a){for(a=
0;a<this.arrUserConn.length;a++)this.arrUserConn[a].stop(),this.arrUserConn[a].user=null;this.bindUserMedia(this.arrUserConn)},resizeUserMedia:function(){var a=this.userMedia.childNodes;if(0<a.length){var b=Math.floor(Math.sqrt(a.length));b=b==Math.sqrt(a.length)?b:b+1;var c=this.userMediaHeight/b,d=Math.floor(a.length/b);d=d==a.length/b?d:d+1;b=Math.floor((this.userMediaWidth-2)/d);2==a.length&&(b=this.userMediaWidth/2,c=this.userMediaHeight,d=2);for(var e=0;e<a.length;e++){var f=a[e];f.style.width=
b+"px";f.style.height=c+"px";f.style.top=Math.floor(e/d)*c+"px";f.style.left=Math.floor(e%d)*b+"px";f.conn.resizeUI(b,c-50);f.ava.style.top=(c-50-parseInt(f.ava.style.height))/2+"px";f.ava.style.left=(b-parseInt(f.ava.style.width))/2+"px"}}},bindUserMedia:function(a){cc.removeAllChildNodes(this.userMedia);a=[];for(var b=0;b<this.arrUserConn.length;b++)this.arrUserConn[b].isUsed&&a.push(this.arrUserConn[b]);if(0<a.length){b=Math.floor(Math.sqrt(a.length));b=b==Math.sqrt(a.length)?b:b+1;var c=this.userMediaHeight/
b,d=Math.floor(a.length/b);d=d==a.length/b?d:d+1;var e=Math.floor((this.userMediaWidth-2)/d);2==a.length&&(e=this.userMediaWidth/2,c=this.userMediaHeight,d=2);for(b=0;b<a.length;b++){var f=this.createUserMediaItem(a[b],e,c);f.style.position="absolute";f.style.width=e+"px";f.style.height=c+"px";f.style.top=Math.floor(b/d)*c+"px";f.style.left=Math.floor(b%d)*e+"px";f.conn=a[b];this.userMedia.appendChild(f)}}},createUserMediaItem:function(a,b,c){var d=document.createElement("div");d.style.border="1px solid black";
d.style.backgroundColor="#2e2d2d";d.style.width=b+"px";d.style.height=c+"px";d.addEventListener("mouseup",k=>{this.history.user=k.currentTarget.conn.user;this.bindUserHistory(k.currentTarget.conn.user);this.showUserHistory();k.stopPropagation()});d.conn=a;var e=this.findDom(document.createElement("div"));e.css("font-size","16px");e.css("color","white");e.css("width","100%");e.css("height","50px");e.css("display","flex");e.css("align-items","center");e.css("position","absolute");e.css("bottom","0px");
e.css("background-color","#222222");var f=document.createElement("span");f.style.width=b-70+"px";f.style.paddingLeft="10px";f.style.whiteSpace="nowrap";f.style.overflow="hidden";f.style.color="gray";f.innerHTML=a.user.username;e.appendChild(f);d.spanName=f;f=this.findDom(document.createElement("div"));f.innerHTML=aztExam.svg.iconClose;f.css("position","absolute");f.css("width","30px");f.css("height","30px");f.css("bottom","18px");f.css("right","10px");f.css("display","block");f.css("cursor","pointer");
f.conn=a;f.addEventListener("mouseup",k=>{this.removeUserMedia(k.currentTarget.conn.user);k.stopPropagation()});e.appendChild(f);f=22<=c-50?c-50:22;f=200<f?200:f;var g=this.createCircleAva(a.user.username,f,"#222222","gray");d.ava=g;d.appendChild(g);g.style.position="absolute";g.style.top=(c-50-f)/2+"px";g.style.left=(b-f)/2+"px";a.ui.style.position="absolute";a.resizeUI(b,c-50);d.appendChild(a.ui);d.appendChild(e);return d},showListUser:function(){this.listUserView.style.display="block";this.history.style.display=
"none";this.searchUserListItem("")},showUserHistory:function(){this.listUserView.style.display="none";this.history.style.display="block"},initListUser:function(){for(var a=0;a<this.options.userlist.length;a++)this.options.userlist[a].listUserItem=null;cc.removeAllChildNodes(this.listUser);for(a=0;a<this._arrUserUpdate.length;a++){var b=this.createUserListItem(this._arrUserUpdate[a]);this._arrUserUpdate[a].listUserItem=b;this.listUser.appendChild(b)}},createUserListItem:function(a){if(a){var b=this.findDom(document.createElement("div"));
b.style.width=this.historyWidth+"px";b.style.height="60px";b.style.display="flex";b.style.flexDirection="row";b.style.alignItems="center";b.style.paddingLeft="10px";b.style.cursor="pointer";a.userListItem=b;b.addTouch(f=>{this.addUserMedia(f.target.user)});b.addTouchMove(f=>{f.target.style.backgroundColor="#EEEEEE"});b.addTouchOut(f=>{f.target.style.backgroundColor="white"});var c="#F47373 #697689 #37D67A #2CCCE4 #555555 #dce775 #ff8a65 #ba68c8".split(" ");c=this.createCircleAva(a.username,50,c[Math.floor(Math.random()*
(c.length-1))],"white");b.ava=c;c.style.pointerEvents="none";c.style.opacity=.5;b.appendChild(c);c=document.createElement("div");c.style.width=this.historyWidth-50+"px";c.style.height="100%";c.style.display="flex";c.style.justifyContent="center";c.style.paddingLeft="10px";c.style.flexDirection="column";c.style.pointerEvents="none";b.appendChild(c);var d=document.createElement("div");d.style.color="gray";d.style.fontSize="18px";d.style.fontFamily="sans-serif";d.style.display="flex";d.style.flexDirection=
"row";b.txtname=d;c.appendChild(d);var e=document.createElement("div");e.style.width="260px";e.innerHTML=a.username;d.appendChild(e);e=this.findDom(document.createElement("div"));e.style.width="20px";e.style.height="20px";e.style.fill="#979494";e.style.display="none";e.innerHTML=aztExam.svg.iconCamera;b.icCam=e;d.appendChild(e);e=this.findDom(document.createElement("div"));e.style.width="20px";e.style.height="20px";e.style.marginLeft="10px";e.style.fill="#979494";e.style.display="none";e.innerHTML=
aztExam.svg.iconMic;b.icMic=e;d.appendChild(e);e=this.findDom(document.createElement("div"));e.style.width="20px";e.style.height="20px";e.style.marginLeft="10px";e.style.display="none";e.innerHTML=aztExam.svg.iconWarning;b.icWarning=e;d.appendChild(e);d=document.createElement("div");d.style.width="1005";d.style.display="flex";d.style.flexDirection="row";d.style.alignItems="center";d.style.justifyContent="start";c.appendChild(d);c=this.findDom(document.createElement("div"));c.css("border-radius","50%");
c.css("background-color","gray");c.css("width","10px");c.css("height","10px");c.css("margin-right","4px");c.style.marginTop="5px";b.icStatus=c;d.appendChild(c);c=document.createElement("div");c.style.color="gray";c.style.fontSize="14px";c.style.fontFamily="sans-serif";c.style.marginTop="5px";c.innerHTML="Offline";b.txtinfo=c;d.appendChild(c);b.user=a;this.bindUserListItem(a);return b}},createCircleAva:function(a,b,c,d){null==a&&(a="");a=a.trim();var e=this.findDom(document.createElement("div"));e.css("border-radius",
"50%");e.css("background-color",c);e.css("width",b+"px");e.css("height",b+"px");e.css("display","flex");e.css("align-items","center");e.css("justify-content","center");e.css("color",d);e.css("font-size",(b-10)/2+"px");a=a.split(" ");e.innerHTML=a[a.length-1].substr(0,2).toUpperCase();return e},bindUserListItem:function(a){if(a&&a.userListItem&&a.info){var b=a.userListItem;a=a.info;var c=(new Date).getTime(),d=Math.abs(c-a.time);c=(new Date(a.time)).toLocaleString();c=d<this._timeOnlineIntv?"Online":
"Offline . "+c;d=this.isOnline(a);b.txtinfo.innerHTML=c;d?(b.ava.style.opacity=1,b.txtname.style.color="black",b.icStatus.style.backgroundColor="#0af50a",b.txtinfo.style.opacity=1,b.txtname.style.opacity=1,b.icStatus.style.opacity=1,b.icCam.style.display="block",b.icMic.style.display="block",b.icCam.innerHTML=a.deviceInfo.isWebsiteHasWebcamPermissions?aztExam.svg.iconCamera:aztExam.svg.iconCameraOff,b.icMic.innerHTML=a.deviceInfo.isWebsiteHasMicrophonePermissions?aztExam.svg.iconMic:aztExam.svg.iconMicOff,
b.icWarning.style.display=a.isWarning?"block":"none"):(b.txtname.style.color="gray",b.icStatus.style.backgroundColor="gray",b.icCam.style.display="none",b.icMic.style.display="none",b.icWarning.style.display="none");this.txtListUserInfo.style.display="none"}},searchUserListItem:function(a){for(var b=this.listUser.childNodes,c=0;c<b.length;c++)""==a.trim()?b[c].style.display="flex":0<=b[c].user.username.toLowerCase().indexOf(a.trim().toLowerCase())?b[c].style.display="flex":b[c].style.display="none"},
initUserHistory:function(){this.userInfo=document.createElement("div");this.userInfo.style.width="100%";this.userInfo.style.height="auto";this.userInfo.style.marginTop="15px";this.userInfo.style.marginLeft="15px";this.userInfo.style.marginBottom="35px";this.userInfo.style.fontSize="16px";this.userInfo.style.lineHeight="25px";this.history.appendChild(this.userInfo);this.userHistory=document.createElement("div");this.userHistory.style.width="100%";this.userHistory.style.height=window.innerHeight-330+
"px";this.userHistory.style.overflowY="scroll";this.userHistory.style.overflowX="hidden";this.userHistory.style.paddingTop="10px";this.history.appendChild(this.userHistory)},bindUserHistory:function(a){if(this.history.user==a)if(a&&a.info){var b="<b>T\u00ean : </b>"+a.username+"<br/>";b+="<b>H\u1ec7 \u0111i\u1ec1u h\u00e0nh : </b>"+a.info.deviceInfo.osName+"_"+a.info.deviceInfo.osVersion+"<br/>";b+="<b>Tr\u00ecnh duy\u1ec7t :  </b>"+a.info.deviceInfo.browser.name+"_"+a.info.deviceInfo.browser.version+
"<br/>";b+="<b>Tr\u1ea1ng th\u00e1i : </b>"+(this.isOnline(a.info)?"Online":"Offline")+"<br/>";b+="<b>Webcam : </b>"+(a.info.deviceInfo.hasWebcam?"C\u00f3":"Kh\u00f4ng")+"<br/>";b+="<b>C\u00f3 c\u1ea5p quy\u1ec1n webcam : </b>"+(a.info.deviceInfo.isWebsiteHasWebcamPermissions?"C\u00f3":"Kh\u00f4ng")+"<br/>";b+="<b>Microphone : </b>"+(a.info.deviceInfo.hasMicrophone?"C\u00f3":"Kh\u00f4ng")+"<br/>";b+="<b>C\u00f3 c\u1ea5p quy\u1ec1n microphone : </b>"+(a.info.deviceInfo.isWebsiteHasMicrophonePermissions?
"C\u00f3":"Kh\u00f4ng")+"<br/>";b+="<b>C\u1eadp nh\u1eadt : </b>"+(new Date(a.info.time)).toLocaleString()+"<br/>";this.userInfo.innerHTML=b}else this.userInfo.innerHTML="\u0110ang l\u1ea5y d\u1eef li\u1ec7u ...."},createUserHistoryItem:function(a){a=this.findDom(document.createElement("div"));a.style.width="100%";a.style.height="100px";a.style.marginLeft="20px";a.style.position="relative";a.style.cursor="pointer";a.style.borderLeft="2px solid green";a.addTouch(c=>{});a.addTouchMove(c=>{c.target.style.backgroundColor=
"#EEEEEE"});a.addTouchOut(c=>{c.target.style.backgroundColor="white"});var b=document.createElement("div");b.style.borderRadius="50%";b.style.width="10px";b.style.height="10px";b.style.backgroundColor="green";b.style.border="1px solid #888888";b.style.position="absolute";b.style.bottom="0px";b.style.left="-7px";b.style.pointerEvents="none";a.appendChild(b);b=document.createElement("div");b.innerHTML="2021-11-11 09:11:11 AM";b.style.fontSize="14px";b.style.position="absolute";b.style.bottom="0px";
b.style.left="15px";b.style.pointerEvents="none";a.appendChild(b);b=this.findDom(document.createElement("div"));b.style.width="100px";b.style.height="60px";b.style.display="flex";b.style.flexDirection="column";b.style.justifyContent="center";b.style.alignItems="center";b.style.position="absolute";b.style.left="35px";b.style.top="25px";b.style.fontSize="12px";b.innerHTML=aztExam.svg.iconWarning+"6 C\u1ea3nh b\u00e1o";b.style.pointerEvents="none";a.appendChild(b);return a},isOnline:function(a){return a&&
a.time&&(new Date).getTime()-a.time<this._timeOnlineIntv?!0:!1},role:function(){return"teacher"}});aztExam.MonitorTeacher=function(){var a;return{getInstance:function(b){null==a&&(a=new aztExam.monitorTeacher(b));return a},releaseInst:function(){a=null},inst:function(){return this.getInstance()}}}();
