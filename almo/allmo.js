var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var h=e[f];if(!(h in d))return;d=d[h]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};
(function(){function a(l,q){var n=0,r=!1,p=window.setInterval(function(){l()&&(window.clearInterval(p),q(r));50<n++&&(window.clearInterval(p),r=!0,q(r))},10)}function b(l){l=l.toLowerCase();return 0===l.indexOf("msie")&&0===l.indexOf("trident")?!1:(l=/(?:msie|rv:)\s?([\d\.]+)/.exec(l))&&10<=parseInt(l[1],10)?!0:!1}function c(l){l=(l||k.userAgent).toLowerCase();return(l=l.match(/android\s([0-9\.]*)/))?l[1]:!1}function d(l,q){function n(x){if(x){console.log("candicate "+x);var I=S.exec(x);I&&(I=I[1],
x=x.match(D),void 0===p[I]&&l(I,x,!0),p[I]=!0)}else l()}function r(){B.localDescription.sdp.split("\n").forEach(function(x){x&&0===x.indexOf("a=candidate:")&&n(x)})}if("undefined"!==typeof document&&"function"===typeof document.getElementById){var p={},t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!t){t=document.getElementById("iframe");if(!t)return;t=t.contentWindow;t=t.RTCPeerConnection||t.mozRTCPeerConnection||t.webkitRTCPeerConnection}if(t){var O=null;
"Chrome"===g.browser&&58>g.browser.version&&(O={optional:[{RtpDataChannels:!0}]});var B=new t({iceServers:[]},O);q&&(B.addStream?B.addStream(q):B.addTrack&&q.getTracks()[0]&&B.addTrack(q.getTracks()[0],q));B.onicecandidate=function(x){x.candidate&&x.candidate.candidate?n(x.candidate.candidate):n()};if(!q)try{B.createDataChannel("",{reliable:!1})}catch(x){}g.isPromisesSupported?B.createOffer().then(function(x){B.setLocalDescription(x).then(r)}):B.createOffer(function(x){B.setLocalDescription(x,r,function(){})},
function(){})}}}function e(l){if(T)if(!k.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(k.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!k.enumerateDevices&&k.enumerateDevices&&(k.enumerateDevices=k.enumerateDevices.bind(k)),k.enumerateDevices){J=[];E=[];F=[];G=[];L=N=P=Q=R=!1;var q={};k.enumerateDevices(function(n){J=[];E=[];F=[];G=[];n.forEach(function(r){var p={},t;for(t in r)try{"function"!==typeof r[t]&&(p[t]=r[t])}catch(O){}q[p.deviceId+
p.label+p.kind]||("audio"===p.kind&&(p.kind="audioinput"),"video"===p.kind&&(p.kind="videoinput"),p.deviceId||(p.deviceId=p.id),p.id||(p.id=p.deviceId),p.label?("videoinput"!==p.kind||L||(L=!0),"audioinput"!==p.kind||N||(N=!0)):(p.isCustomLabel=!0,p.label="videoinput"===p.kind?"Camera "+(G.length+1):"audioinput"===p.kind?"Microphone "+(E.length+1):"audiooutput"===p.kind?"Speaker "+(F.length+1):"Please invoke getUserMedia once.","undefined"!==typeof g&&g.browser.isChrome&&46<=g.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||
"")&&"undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(p.label="HTTPs is required to get label of this "+p.kind+" device.")),"audioinput"===p.kind&&(R=!0,-1===E.indexOf(p)&&E.push(p)),"audiooutput"===p.kind&&(Q=!0,-1===F.indexOf(p)&&F.push(p)),"videoinput"===p.kind&&(P=!0,-1===G.indexOf(p)&&G.push(p)),J.push(p),q[p.deviceId+p.label+p.kind]=p)});"undefined"!==typeof g&&(g.MediaDevices=J,g.hasMicrophone=R,g.hasSpeakers=
Q,g.hasWebcam=P,g.isWebsiteHasWebcamPermissions=L,g.isWebsiteHasMicrophonePermissions=N,g.audioInputDevices=E,g.audioOutputDevices=F,g.videoInputDevices=G);l&&l()})}else l&&l();else l&&l()}var f="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",h="object"===typeof process&&"object"===typeof process.versions&&process.versions.node&&!process.browser;if(h){var m=process.versions.node.toString().replace("v","");f="Nodejs/"+m+" (NodeOS) AppleWebKit/"+m+" (KHTML, like Gecko) Nodejs/"+
m+" Nodejs/"+m}(function(l){"undefined"===typeof window&&("undefined"===typeof window&&"undefined"!==typeof global?(global.navigator={userAgent:f,getUserMedia:function(){}},l.window=global):"undefined"===typeof window&&console.log("window undefined"),"undefined"===typeof location&&(l.location={protocol:"file:",href:"",hash:""}),"undefined"===typeof screen&&(l.screen={width:0,height:0}))})("undefined"!==typeof global?global:window);var k=window.navigator;"undefined"!==typeof k?("undefined"!==typeof k.webkitGetUserMedia&&
(k.getUserMedia=k.webkitGetUserMedia),"undefined"!==typeof k.mozGetUserMedia&&(k.getUserMedia=k.mozGetUserMedia)):k={getUserMedia:function(){},userAgent:f};m=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(k.userAgent||"");var u=-1!==k.userAgent.indexOf("Edge")&&(!!k.msSaveOrOpenBlob||!!k.msSaveBlob),w=!!window.opera||0<=k.userAgent.indexOf(" OPR/"),K=-1<k.userAgent.toLowerCase().indexOf("firefox")&&"netscape"in window&&/ rv:/.test(k.userAgent),U=/^((?!chrome|android).)*safari/i.test(k.userAgent),
H=!!window.chrome&&!w,y={Android:function(){return k.userAgent.match(/Android/i)},BlackBerry:function(){return k.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return k.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return k.userAgent.match(/Opera Mini/i)},Windows:function(){return k.userAgent.match(/IEMobile/i)},any:function(){return y.Android()||y.BlackBerry()||y.iOS()||y.Opera()||y.Windows()},getOsName:function(){var l="Unknown OS";y.Android()&&(l="Android");y.BlackBerry()&&(l="BlackBerry");
y.iOS()&&(l="iOS");y.Opera()&&(l="Opera Mini");y.Windows()&&(l="Windows");return l}},v="Unknown OS",z="Unknown OS Version";(h=function(){for(var l=k.appVersion,q=k.userAgent,n="-",r=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",
r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",
r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],p=0,t;t=r[p];p++)if(t.r.test(q)){n=t.s;break}r="-";/Windows/.test(n)&&(/Windows (.*)/.test(n)&&(r=/Windows (.*)/.exec(n)[1]),n="Windows");switch(n){case "Mac OS X":/Mac OS X (10[\._\d]+)/.test(q)&&(r=/Mac OS X (10[\._\d]+)/.exec(q)[1]);break;case "Android":/Android ([\._\d]+)/.test(q)&&
(r=/Android ([\._\d]+)/.exec(q)[1]);break;case "iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(q)&&(r=/OS (\d+)_(\d+)_?(\d+)?/.exec(l))&&3<r.length&&(r=r[1]+"."+r[2]+"."+(r[3]|0))}return{osName:n,osVersion:r}}())&&h.osName&&"-"!=h.osName?(v=h.osName,z=h.osVersion):y.any()&&(v=y.getOsName(),"Android"==v&&(z=c()));h="object"===typeof process&&"object"===typeof process.versions&&process.versions.node;"Unknown OS"===v&&h&&(v="Nodejs",z=process.versions.node.toString().replace("v",""));var A=!1,C=!1;["captureStream",
"mozCaptureStream","webkitCaptureStream"].forEach(function(l){"undefined"!==typeof document&&"function"===typeof document.createElement&&(!A&&l in document.createElement("canvas")&&(A=!0),!C&&l in document.createElement("video")&&(C=!0))});var D=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,S=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,ba=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,J=[],E=[],F=[],G=[];k.mediaDevices&&k.mediaDevices.enumerateDevices&&(k.enumerateDevices=function(l){var q=k.mediaDevices.enumerateDevices();
q&&q.then?k.mediaDevices.enumerateDevices().then(l).catch(function(){l([])}):l([])});var T=!1;"undefined"!==typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?T=!0:k.mediaDevices&&k.mediaDevices.enumerateDevices&&(T=!0);var R=!1,Q=!1,P=!1,N=!1,L=!1,g=window.DetectRTC||{};g.browser=function(){var l=k.userAgent,q=k.appName,n=""+parseFloat(k.appVersion);parseInt(k.appVersion,10);var r,p;if(w){q="Opera";try{n=k.userAgent.split("OPR/")[1].split(" ")[0],n.split(".")}catch(O){n="0.0.0.0"}}else if(H){var t=
l.indexOf("Chrome");q="Chrome";n=l.substring(t+7)}else U?-1!==l.indexOf("CriOS")?(t=l.indexOf("CriOS"),q="Chrome",n=l.substring(t+6)):-1!==l.indexOf("FxiOS")?(t=l.indexOf("FxiOS"),q="Firefox",n=l.substring(t+6)):(t=l.indexOf("Safari"),q="Safari",n=l.substring(t+7),-1!==(t=l.indexOf("Version"))&&(n=l.substring(t+8)),-1!==k.userAgent.indexOf("Version/")&&(n=k.userAgent.split("Version/")[1].split(" ")[0])):K?(t=l.indexOf("Firefox"),q="Firefox",n=l.substring(t+8)):(r=l.lastIndexOf(" ")+1)<(t=l.lastIndexOf("/"))&&
(q=l.substring(r,t),n=l.substring(t+1),q.toLowerCase()===q.toUpperCase()&&(q=k.appName));u&&(q="Edge",n=k.userAgent.split("Edge/")[1]);-1!==(p=n.search(/[; \)]/))&&(n=n.substring(0,p));l=parseInt(""+n,10);isNaN(l)&&(n=""+parseFloat(k.appVersion),l=parseInt(k.appVersion,10));return{fullVersion:n,version:l,name:q,isPrivateBrowsing:!1}}();(function(l){try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){n=!1},function(r){n=!0});else if(window.indexedDB&&
/Firefox/.test(window.navigator.userAgent)){try{var q=window.indexedDB.open("test");q.onerror=function(){return!0}}catch(r){var n=!0}"undefined"===typeof n&&a(function(){return"done"===q.readyState?!0:!1},function(r){r||(n=q.result?!1:!0)})}else if(b(window.navigator.userAgent)){n=!1;try{window.indexedDB||(n=!0)}catch(r){n=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(r){n=!0}"undefined"===typeof n&&(n=!1,window.localStorage.removeItem("test"))}}catch(r){n=
!1}a(function(){return"undefined"!==typeof n?!0:!1},function(r){l(n)})})(function(l){g.browser.isPrivateBrowsing=!!l});g.browser["is"+g.browser.name]=!0;g.osName=v;g.osVersion=z;var W=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(l){W||l in window&&(W=!0)});g.isWebRTCSupported=W;g.isORTCSupported="undefined"!==typeof RTCIceGatherer;v=!1;g.browser.isChrome&&35<=g.browser.version?v=!0:g.browser.isFirefox&&34<=g.browser.version?v=!0:g.browser.isEdge&&
17<=g.browser.version?v=!0:"Android"===g.osName&&g.browser.isChrome&&(v=!0);if(k.getDisplayMedia||k.mediaDevices&&k.mediaDevices.getDisplayMedia)v=!0;/^(https:|chrome-extension:)$/g.test(location.protocol||"")||("undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(g.browser.isChrome||g.browser.isEdge||g.browser.isOpera)?v=!1:g.browser.isFirefox&&(v=!1));g.isScreenCapturingSupported=v;var Z=!1,aa=!1;["AudioContext",
"webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(l){!Z&&l in window&&(Z=!0,window[l]&&"createMediaStreamSource"in window[l].prototype&&(aa=!0))});g.isAudioContextSupported=Z;g.isCreateMediaStreamSourceSupported=aa;v=!1;g.browser.isChrome&&31<g.browser.version&&(v=!0);g.isRtpDataChannelsSupported=v;v=!1;g.browser.isFirefox&&28<g.browser.version?v=!0:g.browser.isChrome&&25<g.browser.version?v=!0:g.browser.isOpera&&11<=g.browser.version&&(v=!0);g.isSctpDataChannelsSupported=
v;g.isMobileDevice=m;m=!1;k.getUserMedia?m=!0:k.mediaDevices&&k.mediaDevices.getUserMedia&&(m=!0);g.browser.isChrome&&46<=g.browser.version&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!==typeof document&&"string"===typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(m="Requires HTTPs");"Nodejs"===g.osName&&(m=!1);g.isGetUserMediaSupported=m;m="";screen.width&&(m+=""+(screen.width?screen.width:"")+" x "+(screen.height?screen.height:
""));g.displayResolution=m;g.displayAspectRatio=function(l,q){function n(p,t){return 0==t?p:n(t,p%t)}var r=n(l,q);return l/r/(q/r)}(screen.width,screen.height).toFixed(2);g.isCanvasSupportsStreamCapturing=A;g.isVideoSupportsStreamCapturing=C;"Chrome"==g.browser.name&&53<=g.browser.version&&(g.isCanvasSupportsStreamCapturing||(g.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),g.isVideoSupportsStreamCapturing||(g.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"));
g.DetectLocalIPAddress=function(l,q){if(g.isWebRTCSupported){var n=!0,r=!0;d(function(p){p?p.match(D)?(n=!1,l("Local: "+p,n,r)):(p.match(ba)&&(r=!1),l("Public: "+p,n,r)):l()},q)}};g.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING;g.isWebSocketsBlocked=!g.isWebSocketsSupported;"Nodejs"===g.osName&&(g.isWebSocketsSupported=!0,g.isWebSocketsBlocked=!1);g.checkWebSocketsSupport=function(l){l=l||function(){};try{var q,n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){g.isWebSocketsBlocked=
!1;q=(new Date).getTime();n.send("ping")};n.onmessage=function(){g.WebsocketLatency=(new Date).getTime()-q+"ms";l();n.close();n=null};n.onerror=function(){g.isWebSocketsBlocked=!0;l()}}catch(r){g.isWebSocketsBlocked=!0,l()}};g.load=function(l){e(l||function(){})};"function"===typeof e&&console.log("check device support !");g.MediaDevices="undefined"!==typeof J?J:[];g.hasMicrophone=R;g.hasSpeakers=Q;g.hasWebcam=P;g.isWebsiteHasWebcamPermissions=L;g.isWebsiteHasMicrophonePermissions=N;g.audioInputDevices=
E;g.audioOutputDevices=F;g.videoInputDevices=G;m=!1;"undefined"!==typeof document&&"function"===typeof document.createElement&&"setSinkId"in document.createElement("video")&&(m=!0);g.isSetSinkIdSupported=m;m=!1;g.browser.isFirefox&&"undefined"!==typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(m=!0):g.browser.isChrome&&"undefined"!==typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(m=!0);g.isRTPSenderReplaceTracksSupported=m;m=!1;g.browser.isFirefox&&
38<g.browser.version&&(m=!0);g.isRemoteStreamProcessingSupported=m;m=!1;"undefined"!==typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(m=!0);g.isApplyConstraintsSupported=m;m=!1;g.browser.isFirefox&&43<=g.browser.version&&(m=!0);g.isMultiMonitorScreenCapturingSupported=m;g.isPromisesSupported=!!("Promise"in window);g.version="1.4.1";"undefined"===typeof g&&(window.DetectRTC={});m=window.MediaStream;"undefined"===typeof m&&"undefined"!==typeof webkitMediaStream&&(m=webkitMediaStream);
g.MediaStream="undefined"!==typeof m&&"function"===typeof m?Object.keys(m.prototype):!1;g.MediaStreamTrack="undefined"!==typeof MediaStreamTrack?Object.keys(MediaStreamTrack.prototype):!1;m=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;g.RTCPeerConnection="undefined"!==typeof m?Object.keys(m.prototype):!1;window.DetectRTC=g;"undefined"!==typeof module&&(module.exports=g);"function"===typeof define&&define.amd&&define("DetectRTC",[],function(){return g})})();
var cc=cc||{};
cc.defineGetterSetter=function(a,b,c,d,e,f){if(a.__defineGetter__)c&&a.__defineGetter__(b,c),d&&a.__defineSetter__(b,d);else if(Object.defineProperty){var h={enumerable:!1,configurable:!0};c&&(h.get=c);d&&(h.set=d);Object.defineProperty(a,b,h)}else throw Error("browser does not support getters");if(!e&&!f){h=null!=c;for(var m=void 0!=d,k=Object.getOwnPropertyNames(a),u=0;u<k.length;u++){var w=k[u];if((a.__lookupGetter__?!a.__lookupGetter__(w):!Object.getOwnPropertyDescriptor(a,w))&&"function"===typeof a[w]){var K=
a[w];if(h&&K===c&&(e=w,!m||f))break;if(m&&K===d&&(f=w,!h||e))break}}}a=a.constructor;e&&(a.__getters__||(a.__getters__={}),a.__getters__[e]=b);f&&(a.__setters__||(a.__setters__={}),a.__setters__[f]=b)};cc.clone=function(a){var b=a.constructor?new a.constructor:{},c;for(c in a){var d=a[c];b[c]="object"!==typeof d||!d||d instanceof cc.Node||d instanceof HTMLElement?d:cc.clone(d)}return b};cc.inject=function(a,b){for(var c in a)b[c]=a[c]};
var ClassManager=function(){var a=0|998*Math.random(),b=0|998*Math.random();this.getNewID=function(){return a++};this.getNewInstanceId=function(){return b++}},classManager=new ClassManager;
(function(){var a=/\b_super\b/;cc.Class=function(){};cc.Class.extend=function(b){cc.isEmpty(b._html)||cc.import(b._html);cc.isEmpty(b._css)||cc.import(b._css);var c=this.prototype,d=Object.create(c),e={writable:!0,enumerable:!1,configurable:!0};var f=function(z,A,C,D,S){this.__instanceId=classManager.getNewInstanceId();if(this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(z);break;case 2:this.ctor(z,A);break;case 3:this.ctor(z,A,C);break;case 4:this.ctor(z,A,C,D);break;case 5:this.ctor(z,
A,C,D,S);break;default:this.ctor.apply(this,arguments)}};e.value=classManager.getNewID();Object.defineProperty(d,"__pid",e);f.prototype=d;e.value=f;Object.defineProperty(d,"constructor",e);this.__getters__&&(f.__getters__=cc.clone(this.__getters__));this.__setters__&&(f.__setters__=cc.clone(this.__setters__));for(var h=0,m=arguments.length;h<m;++h){var k=arguments[h],u;for(u in k){var w="function"===typeof k[u],K="function"===typeof c[u],U=a.test(k[u]);w&&K&&U?(e.value=function(z,A){return function(){var C=
this._super;this._super=c[z];var D=A.apply(this,arguments);this._super=C;return D}}(u,k[u]),Object.defineProperty(d,u,e)):w?(e.value=k[u],Object.defineProperty(d,u,e)):d[u]=k[u];if(w){if(this.__getters__&&this.__getters__[u]){w=this.__getters__[u];for(var H in this.__setters__)if(this.__setters__[H]===w){var y=H;break}cc.defineGetterSetter(d,w,k[u],k[y]?k[y]:d[y],u,y)}if(this.__setters__&&this.__setters__[u]){w=this.__setters__[u];for(H in this.__getters__)if(this.__getters__[H]===w){var v=H;break}cc.defineGetterSetter(d,
w,k[v]?k[v]:d[v],k[u],v,u)}}}}f.extend=cc.Class.extend;f.implement=function(z){for(var A in z)d[A]=z[A]};return f}})();cc.each=function(a,b,c){if(a)if(a instanceof Array)for(var d=0,e=a.length;d<e&&!1!==b.call(c,a[d],d);d++);else for(d in a)if(!1===b.call(c,a[d],d))break};cc.extend=function(a){var b=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];cc.each(b,function(c){for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])});return a};
cc.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a};cc.isFunction=function(a){return"function"===typeof a};cc.isNumber=function(a){return"number"===typeof a||"[object Number]"===Object.prototype.toString.call(a)};cc.isString=function(a){return"string"===typeof a||"[object String]"===Object.prototype.toString.call(a)};cc.isArray=function(a){return Array.isArray(a)||"object"===typeof a&&"[object Array]"===Object.prototype.toString.call(a)};
cc.isUndefined=function(a){return"undefined"===typeof a};cc.isObject=function(a){return"object"===typeof a&&"[object Object]"===Object.prototype.toString.call(a)};cc.objToArray=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};cc.localLog={maxLog:20,isLocalStorage:localStorage?!0:!1,push:function(a){},send:function(a,b){}};cc.log=function(a){var b=(new Date).toISOString();a=b.substr(b.length-13,13)+"--"+a;console.log(a)};
cc.isEmpty=function(a){return void 0==a||null==a||""==a.toString()?!0:!1};String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)};cc.Class.prototype.addCEventListener=function(a,b,c){null==this.arrEventCb&&(this.arrEventCb=[]);for(var d=!1,e=0;e<this.arrEventCb.length;e++)if(this.arrEventCb[e].ev==a&&this.arrEventCb[e].cb==b&&this.arrEventCb[e].caller==c){d=!0;break}d||this.arrEventCb.push({ev:a,cb:b,caller:c})};
cc.Class.prototype.removeCEventListener=function(a,b,c){null==this.arrEventCb&&(this.arrEventCb=[]);for(var d=0;d<this.arrEventCb.length;d++)if(this.arrEventCb[d].ev==a&&this.arrEventCb[d].cb==b&&c==this.arrEventCb[d].caller){this.arrEventCb.splice(d,1);break}};cc.Class.prototype.CEventCallback=function(a){if(null!=this.arrEventCb)for(var b=this.arrEventCb.concat(),c=0;c<b.length;c++)b[c].ev==a&&b[c].cb.apply(b[c].caller,arguments)};
cc.Class.prototype.dispath=function(a){if(null!=this.arrEventCb)for(var b=this.arrEventCb.concat(),c=0;c<b.length;c++)b[c].ev==a&&b[c].cb.apply(b[c].caller,arguments)};cc.Class.prototype.removeAllCEventListener=function(a){if(null==a)null!=this.arrEventCb&&(this.arrEventCb=[]);else if(null!=this.arrEventCb&&void 0!=this.arrEventCb){do{var b=!1;for(var c=0;c<this.arrEventCb.length;c++)if(this.arrEventCb[c].ev==a){this.arrEventCb.splice(c,1);b=!0;break}}while(b)}};
cc.os=function(){var a=navigator.userAgent.toLowerCase(),b=/iphone|ipod|ipad/.test(a);return/android/.test(a)?"android":b?"ios":"pc"};cc.isMobile=function(){return"android"==cc.os||"ios"==cc.os?!0:!1};cc.isWebview=function(){return"zaloWebview"==cc.browserName||"fbWebview"==cc.browserName||"webview"==cc.browserName?!0:!1};
cc.browserName=function(){var a=navigator.userAgent.toLowerCase();if(0<=a.indexOf("zalo"))return"zaloWebview";if(0<=a.indexOf("FBAV"))return"fbWebview";if(0<=a.indexOf("webview"))return"webview";if(0<=a.indexOf("coccoc"))return"coccoc";var b=!!window.opr&&!!opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),c="undefined"!==typeof InstallTrigger,d=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!==typeof safari&&window.safari.pushNotification).toString();
0<=a.indexOf("safari")&&(d=!0);a=!!window.StyleMedia;var e=-1!=navigator.userAgent.indexOf("Chrome"),f=e&&-1!=navigator.userAgent.indexOf("Edg");return b?"opera":d?"safari":c?"firefox":a?"edge":e?"chrome":f?"edgeChrome":"other"};cc.touchable=function(){return"ontouchstart"in window||navigator.msMaxTouchPoints};cc.webrtcSupport=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof RTCPeerConnection?!0:!1};
cc.mediaRecorderSupport=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&window.MediaRecorder?!0:!1};cc.workerSupport=function(){return"undefined"!==typeof Worker?!0:!1};
cc.fullscreenSupport=function(){var a=document.body;return"undefined"!==typeof a.requestFullscreen||"undefined"!==typeof a.mozRequestFullScreen||"undefined"!==typeof a.webkitRequestFullscreen||"undefined"!==typeof a.msRequestFullscreen||"undefined"!==typeof document.exitFullscreen||"undefined"!==typeof document.mozCancelFullScreen||"undefined"!==typeof document.webkitExitFullscreen};cc.removeAllChildNodes=function(a){if(a)for(;a.firstChild;)a.removeChild(a.firstChild)};
cc.removeDomAttr=function(a,b){if(cc.isArray(b)&&a&&a instanceof HTMLElement)for(var c=0;c<b.length;c++)a.removeAttribute(b[c])};cc.getAttrToNumber=function(a,b){return Number(a.getAttribute(b))};cc.createGrid=function(a,b){if(0>=a||0>=b)return null;for(var c=document.createElement("div"),d=100/a,e=100/b,f=0;f<a*b;f++){var h=document.createElement("div");h.style.width=e+"%";h.style.height=d+"%";h.style.position="relative";h.style.float="left";h.setAttribute("grid",f);c.appendChild(h)}return c};
cc.dragDom=null;cc.winSize=function(){return{width:window.innerWidth,height:window.innerHeight}};cc.getParameterByName=function(a,b=window.location.href){a=a.replace(/[\[\]]/g,"\\$&");return(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null};cc.appVer=.1;
cc.loadCss=function(a){for(var b=0;b<a.length;b++){var c=document.getElementsByTagName("HEAD")[0],d=document.createElement("link");d.rel="stylesheet";d.type="text/css";d.href=a[b]+"?ver="+cc.appVer;c.appendChild(d)}};cc.insertCss=function(a){var b=document.createElement("style");b.type="text/css";b.innerHTML=a;document.getElementsByTagName("head")[0].appendChild(b)};
cc.getText=function(a,b){if(a)try{const c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&(200==this.status?b&&b(!0,this.responseText):b(!1,this.status))};c.open("GET",a+"?ver="+cc.appVer);c.send()}catch(c){b(!1,c.toString())}};
cc.getJson=function(a,b){if(a)try{const c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){if(b)try{b(!0,JSON.parse(this.responseText))}catch(d){b(!1,"error parse json result "+this.responseText)}}else b(!1,this.status)};c.open("GET",a+"?ver="+cc.appVer);c.send()}catch(c){b(!1,c.toString())}};
cc.loadJs=function(a,b,c){cc.isString(a)&&(a=[a]);if(!cc.isNumber(c)||0>c)c=0;if(a&&cc.isArray(a))if(a.length<=c)b&&b.call(null,!0);else{var d=a[c],e=document.createElement("script");e.onload=()=>{c<a.length&&(c++,cc.loadJs(a,b,c))};e.onerror=()=>{b&&b.call(null,!1)};e.src=d+"?ver="+cc.appVer;e.async=!0;document.body.appendChild(e)}};
cc.loadHtml=function(a,b,c){if(!cc.isNumber(c)||0>c)c=0;a&&cc.isArray(a)&&(a.length<=c?b&&b.call(null,!0):cc.getText(a[c],(d,e)=>{d&&(cc.htmlImport[a[c]]=e);c++;cc.loadHtml(a,b,c)}))};cc.jsfw=[];cc.coreready=null;cc.callbackready=null;cc.onready=function(a){null==cc.coreready?cc.callbackready=a:a.call(null,cc.coreready)};cc.loadJs(cc.jsfw,a=>{cc.coreready=a;cc.callbackready&&cc.callbackready.call(null,cc.coreready)});cc.htmlImport={};cc.cssImport={};
cc.getHtml=function(a){return cc.htmlImport[a]?cc.htmlImport[a]:""};cc.import=function(a){0<a.indexOf(".css")&&(cc.cssImport[a]||(cc.cssImport[a]=a));0<a.indexOf(".html")&&(cc.htmlImport[a]||(cc.htmlImport[a]=a))};cc.initApp=function(a,b){cc.loadJs(a,c=>{cc.loadCss(cc.objToArray(cc.cssImport));cc.loadHtml(cc.objToArray(cc.htmlImport),()=>{b&&b()})})};
cc.randomUUID=function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"==b?c:c&3|8).toString(16)})};cc.md5=function(a){return M(V(Y(X(a),8*a.length))).toLowerCase()};function M(a){for(var b,c="",d=0;d<a.length;d++)b=a.charCodeAt(d),c+="0123456789ABCDEF".charAt(b>>>4&15)+"0123456789ABCDEF".charAt(15&b);return c}
function X(a){for(var b=Array(a.length>>2),c=0;c<b.length;c++)b[c]=0;for(c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b}function V(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b}
function Y(a,b){a[b>>5]|=128<<b%32;a[14+(b+64>>>9<<4)]=b;b=1732584193;for(var c=-271733879,d=-1732584194,e=271733878,f=0;f<a.length;f+=16){var h=b,m=c,k=d,u=e;c=md5_ii(c=md5_ii(c=md5_ii(c=md5_ii(c=md5_hh(c=md5_hh(c=md5_hh(c=md5_hh(c=md5_gg(c=md5_gg(c=md5_gg(c=md5_gg(c=md5_ff(c=md5_ff(c=md5_ff(c=md5_ff(c,d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+0],7,-680876936),c,d,a[f+1],12,-389564586),b,c,a[f+2],17,606105819),e,b,a[f+3],22,-1044525330),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+4],7,-176418897),
c,d,a[f+5],12,1200080426),b,c,a[f+6],17,-1473231341),e,b,a[f+7],22,-45705983),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+8],7,1770035416),c,d,a[f+9],12,-1958414417),b,c,a[f+10],17,-42063),e,b,a[f+11],22,-1990404162),d=md5_ff(d,e=md5_ff(e,b=md5_ff(b,c,d,e,a[f+12],7,1804603682),c,d,a[f+13],12,-40341101),b,c,a[f+14],17,-1502002290),e,b,a[f+15],22,1236535329),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+1],5,-165796510),c,d,a[f+6],9,-1069501632),b,c,a[f+11],14,643717713),e,b,a[f+0],20,-373897302),d=md5_gg(d,
e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+5],5,-701558691),c,d,a[f+10],9,38016083),b,c,a[f+15],14,-660478335),e,b,a[f+4],20,-405537848),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+9],5,568446438),c,d,a[f+14],9,-1019803690),b,c,a[f+3],14,-187363961),e,b,a[f+8],20,1163531501),d=md5_gg(d,e=md5_gg(e,b=md5_gg(b,c,d,e,a[f+13],5,-1444681467),c,d,a[f+2],9,-51403784),b,c,a[f+7],14,1735328473),e,b,a[f+12],20,-1926607734),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+5],4,-378558),c,d,a[f+8],11,-2022574463),b,c,a[f+11],16,
1839030562),e,b,a[f+14],23,-35309556),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+1],4,-1530992060),c,d,a[f+4],11,1272893353),b,c,a[f+7],16,-155497632),e,b,a[f+10],23,-1094730640),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+13],4,681279174),c,d,a[f+0],11,-358537222),b,c,a[f+3],16,-722521979),e,b,a[f+6],23,76029189),d=md5_hh(d,e=md5_hh(e,b=md5_hh(b,c,d,e,a[f+9],4,-640364487),c,d,a[f+12],11,-421815835),b,c,a[f+15],16,530742520),e,b,a[f+2],23,-995338651),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+0],6,
-198630844),c,d,a[f+7],10,1126891415),b,c,a[f+14],15,-1416354905),e,b,a[f+5],21,-57434055),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+12],6,1700485571),c,d,a[f+3],10,-1894986606),b,c,a[f+10],15,-1051523),e,b,a[f+1],21,-2054922799),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+8],6,1873313359),c,d,a[f+15],10,-30611744),b,c,a[f+6],15,-1560198380),e,b,a[f+13],21,1309151649),d=md5_ii(d,e=md5_ii(e,b=md5_ii(b,c,d,e,a[f+4],6,-145523070),c,d,a[f+11],10,-1120210379),b,c,a[f+2],15,718787259),e,b,a[f+9],21,-343485551);
b=safe_add(b,h);c=safe_add(c,m);d=safe_add(d,k);e=safe_add(e,u)}return[b,c,d,e]}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,h){return md5_cmn(b&c|~b&d,a,b,e,f,h)}function md5_gg(a,b,c,d,e,f,h){return md5_cmn(b&d|c&~d,a,b,e,f,h)}function md5_hh(a,b,c,d,e,f,h){return md5_cmn(b^c^d,a,b,e,f,h)}function md5_ii(a,b,c,d,e,f,h){return md5_cmn(c^(b|~d),a,b,e,f,h)}
function safe_add(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function bit_rol(a,b){return a<<b|a>>>32-b}cc.keywordNotStyle=["element","_childStyle","state"];
cc.Node=cc.Class.extend({_name:"",_lcid:0,_countChild:0,_render:null,_children:null,_parent:null,_style:null,_nodeType:"Node",ctor:function(a){this._initRender(a);a&&this.css(a)},_initRender:function(a){null==a&&(a={});cc.isEmpty(a.element)&&(a.element=cc.getHtml(this._html));if(!cc.isEmpty(a.element)){if(cc.isString(a.element))try{var b=document.createElement("div");b.innerHTML=a.element.trim();var c=b.firstChild;if(c&&1==c.nodeType){this._render=c;this._render.setAttribute("_nt",this.getType());
return}}catch(d){cc.log("error create element from  html :"+a.element+":"+this._idLocal+":"+this.getType())}if(a.element instanceof HTMLElement){this._render=a.element;this._render.setAttribute("_nt",this.getType());return}}this._render=document.createElement("div");this._render.setAttribute("_nt",this.getType())},appendTo:function(a){a instanceof HTMLElement&&a.appendChild(this._render)},addChild:function(a){a._nodeType&&this._render&&a._render instanceof HTMLElement&&(this._render.appendChild(a._render),
this._children=this._children||{},a._lcid=this._countChild++,this._children[a._lcid]=a,a._parent=this)},removeChild:function(a,b){a._parent&&a._parent._render&&a._parent._render.removeChild(a._render);delete this._children[a._idNode];b&&a.release&&a.release()},removeAllChild:function(){for(var a in this._children)this.removeChild(this._children[a])},children:function(){var a=[],b;for(b in this._children)a.push(this._children);return a},getParent:function(){return this._parent},getRender:function(){return this._render},
getChildrenByName:function(a){if(cc.isEmpty(a))return null;for(var b in this._children)if(this._children[b].name==a)return this._children[b]},getChildByLcId:function(a){return!cc.isNumber(a)||0>Number(a)?null:this._children[a]?this._children[a]:null},toObject:function(){},fromObject:function(a){this._countChild=a.countChild?a.countChild:this._countChild},getType:function(){return this._nodeType},_release:function(){this.removeAllChild();this._render=null;this.removeAllCEventListener()},cssChild:function(a){if(this._render)for(var b in a){var c=
this._render.getChildrenByName(b);if(c)for(var d=0;d<c.length;d++)this.cssDom(c[d],a[b])}},css:function(a,b){if(!this._render||!this._render.style)return!1;this._style=this._style||{};var c=!0;if(cc.isString(a)){if(!b)return this._render.style[a];0>cc.keywordNotStyle.indexOf(a)&&(a=this._replaceCssProperties(a),this._render.style[a]=b,this._render.style[a]==b?this._style[a]=b:c=!1)}else{a=this._replaceCssProperties(a);for(var d in a)0>cc.keywordNotStyle.indexOf(d)?(this._render.style[d]=a[d],this._render.style[d]==
a[d]?this._style[d]=a[d]:c=!1):"_childStyle"==d&&this.cssChild(a[d])}""!=this._render.style.display&&"none"!=this._render.style.display&&(this._render.style.cdisplay=this._render.style.display);if(this._style.scaleX||this._style.scaleY||this._style.rotation)a="",this._style.rotation&&(a+="rotate("+this._style.rotation+"deg) "),this._style.scaleX&&(a+="scaleX("+this._style.scaleX+") "),this._style.scaleY&&(a+="scaleY("+this._style.scaleY+") "),this._render.style.transform=a;return c},cssDom:function(a,
b,c){if(cc.isString(b))b=this._replaceCssProperties(b),a.style[b]=c;else{b=this._replaceCssProperties(b);for(var d in b)a.style[d]=b[d]}},_replaceCssProperties:function(a){cc.isObject(a)&&(void 0!=a.x&&(a.left=a.x),void 0!=a.y&&(a.top=a.y),void 0!=a.rotate&&(a.rotation=a.rotate),delete a.x,delete a.y);if(cc.isString(a)){if("x"==a)return"left";if("y"==a)return"top";if("rotate"==a)return"ratation"}return a},_renderStyle:function(){return this._render&&this._render.style?this._render.style:null},setWidth:function(a){return this._renderStyle()?
cc.isString(a)?this.css("width",a):!cc.isNumber(a)||0>Number(a)?!1:this.css("width",a+"px"):!1},getWidth:function(){return this._renderStyle()?parseInt(this._render.style.width):0},setHeight:function(a){return this._renderStyle()?cc.isString(a)?this.css("height",a):!cc.isNumber(a)||0>Number(a)?!1:this.css("height",a+"px"):!1},getHeight:function(){return this._renderStyle()?parseInt(this._render.style.height):0},setX:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("left",a+"px"):!1},
getX:function(){return this._renderStyle()?parseInt(this._render.style.left):0},setY:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("top",a+"px"):!1},getY:function(){return this._renderStyle()?parseInt(this._render.style.top):0},getClientBoudingBox:function(){return this._render&&this._render.getClientBoudingBox?this._render.getClientBoudingBox():null},setVisible:function(a){this._renderStyle()&&(this._render.style.display=a?cc.isUndefined(this._render.style.cdisplay)?"":this._render.style.cdisplay:
"none")},getVisible:function(){return this._renderStyle()?"none"==this._render.style.display?!0:!1:!1},setColor:function(a){return this._renderStyle()?this.css("color",a):!1},getColor:function(){return this._renderStyle()?this._render.style.color.toString():""},setOpacity:function(a){return this._renderStyle()?this.css("opacity",a):!1},getOpacity:function(){return this._renderStyle()&&cc.isNumber(this._render.style.opacity)?this._render.style.opacity:1},setRotate:function(a){return!this._renderStyle()||
!cc.isNumber(a)||0>Number(a)?!1:this.css("rotation",a)},getRotate:function(){return this._renderStyle()&&this._style.rotation?this._style.rotation:0},setScaleX:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("scaleX",a):!1},getScaleX:function(){return this._renderStyle()&&this._style.scaleX?this._style.scaleX:1},setScaleY:function(a){return this._renderStyle()&&cc.isNumber(a)?this.css("scaleY",a):!1},getScaleY:function(){return this._renderStyle()&&this._style.scaleY?this._style.scaleY:
1},setScale:function(a,b){this.setScaleX(a);this.setScaleY(b)},setButtonMode:function(a){if(!this._renderStyle())return!1;a?this.css("cursor","pointer"):this.css("cursor","default")},anim:function(a,b,c,d){cc.isObject(a)||cc.isArray(a)?this.animFromTo(null,a,b,c,d):cc.isString(a)&&this._render&&(a=cc.animePattern.getFromTo(a,this))&&(b&&(a.to.duration=b),this.animFromTo(a.from,a.to,b,c,d))},animFromTo:function(a,b,c,d,e){if(this._render&&b&&(cc.isArray(b)||cc.isObject(b))){d&&"true"==d.toString().trim()||
(d=!1);null==e&&(e="normal");try{this.stopAnim();this.timeline=anime.timeline({targets:this._render,loop:d,duration:Number(c),direction:e});a&&cc.isObject(a)&&(a=this._replaceCssProperties(a),this.timeline._from=a,this.css(a));if(cc.isArray(b))for(a=0;a<b.length;a++)b[a]=this._replaceCssProperties(b[a]),this.timeline.add(b[a]);else cc.isObject(b)&&(b=this._replaceCssProperties(b),this.timeline.add(b));this.timeline._animto=b}catch(f){cc.log("runAnim error "+f.message)}}},stopAnimToEnd:function(){this.timeline&&
this.timeline.pause();anime.remove(this._render);for(var a=0;a<this.timeline._animto.length;a++){var b=this.timeline._animto[a];delete b.targets;delete b.easing;delete b.duration;delete b.delay;delete b.endDelay;delete b.round;this.css(b)}delete this.timeline._from;delete this.timeline._timelines},stopAnim:function(){this.timeline&&(this.timeline.pause(),anime.remove(this._render),delete this.timeline._from,delete this.timeline._timelines)},addTouchStart:function(a){this.addDomTouchStart(this._render,
a)},removeTouchStart:function(){this.removeDomTouchStart(this._render)},addDomTouchStart:function(a,b){a.touchStartEnabled=!0;a.addEventListener("mousedown",c=>{this._onDomDown(c,b)});a.addEventListener("touchstart",c=>{this._onDomDown(c,b);c.preventDefault()})},_onDomDown:function(a,b){if(a.currentTarget.touchStartEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();cc.removeDomAttr(a,"move_time move_pageX move_pageY move_clientX move_clientY end_time".split(" "));
a.setAttribute("start_time",c.time);a.setAttribute("start_pageX",c.pageX);a.setAttribute("start_pageY",c.pageY);a.setAttribute("start_clientX",c.clientX);a.setAttribute("start_clientY",c.clientY);_windowUp();a.dragEnabled&&(cc.dragDom=a,a.setAttribute("start_left",parseInt(a.style.left)),a.setAttribute("start_top",parseInt(a.style.top)),window.addEventListener("mousemove",_windowMove),window.addEventListener("touchmove",_windowMove),window.addEventListener("mouseup",_windowUp),window.addEventListener("touchend",
_windowUp));b&&b(c)}},removeDomTouchStart:function(a){a.dragEnabled||(a.touchStartEnabled=!1)},addTouchMove:function(a){this.addDomTouchMove(this._render,a)},removeTouchMove:function(){this.removeDomTouchMove(this._render)},addDomTouchMove:function(a,b){a.touchMoveEnabled=!0;a.addEventListener("mousemove",c=>{this._onDomMove(c,b)});a.addEventListener("touchmove",c=>{this._onDomMove(c,b);c.preventDefault()})},_onDomMove:function(a,b){if(a.currentTarget.touchMoveEnabled){var c=a.touches&&0<a.touches.length?
a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();a.setAttribute("move_time",c.time);a.setAttribute("move_pageX",c.pageX);a.setAttribute("move_pageY",c.pageY);a.setAttribute("move_clientX",c.clientX);a.setAttribute("move_clientY",c.clientY);b&&b(c)}},removeDomTouchMove:function(a){a.touchMoveEnabled=!1},addTouchOut:function(a){this.addDomTouchOut(this._render,a)},removeTouchOut:function(){this.removeDomTouchOut(this._render)},addDomTouchOut:function(a,b){a.touchOutEnabled=
!0;a.addEventListener("mouseout",c=>{this._onDomOut(c,b)})},_onDomOut:function(a,b){if(a.target.touchOutEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();b&&b(c)}},removeDomTouchOut:function(a){a.touchOutEnabled=!1},addTouchEnd:function(a){this.addDomTouchEnd(this._render,a)},removeTouchEnd:function(){this.removeDomTouchEnd(this._render)},addDomTouchEnd:function(a,b){a.touchEndEnabled=!0;a.addEventListener("mouseup",
c=>{this._onDomEnd(c,b)});a.addEventListener("touchend",c=>{this._onDomEnd(c,b);c.preventDefault()})},_onDomEnd:function(a,b){if(a.currentTarget.touchEndEnabled){var c=a.touches&&0<a.touches.length?a.touches[0]:a;a=a.currentTarget;c.target=a==this._render?this:a;c.time=(new Date).getTime();a.setAttribute("end_time",c.time);b&&b(c);this._onDomTap(a);cc.removeDomAttr(a,"move_time move_pageX move_pageY move_clientX move_clientY end_time".split(" "));cc.removeDomAttr(a,["start_time","start_pageX","start_pageY",
"start_clientX","start_clientY"])}},removeDomTouchEnd:function(a){a.touchEndEnabled=!1},addTouch:function(a){this.addTouchTap(a)},removeTouch:function(){this.removeTouchTap()},addDomTouch:function(a,b){this.addDomTouchTap(a,b)},addTouchTap:function(a){this.addDomTouchTap(this._render,a)},removeTouchTap:function(){this.removeDomTouchTap(this._render)},addDomTouchTap:function(a,b){a.touchStartEnabled||this.addDomTouchStart(a);a.touchEndEnabled||this.addDomTouchEnd(a);a.touchTapEnabled=!0;a.callbacksTap=
a.callbacksTap||[];b&&a.callbacksTap.push(b)},_onDomTap:function(a){a.getAttribute("move_pageX")||a.setAttribute("move_pageX",a.getAttribute("start_pageX"));a.getAttribute("move_pageY")||a.setAttribute("move_pageY",a.getAttribute("start_pageY"));if(150>cc.getAttrToNumber(a,"end_time")-cc.getAttrToNumber(a,"start_time")&&10>Math.abs(cc.getAttrToNumber(a,"start_pageX")-cc.getAttrToNumber(a,"move_pageX"))&&10>Math.abs(cc.getAttrToNumber(a,"start_pageY")-cc.getAttrToNumber(a,"move_pageY"))){if(a.getAttribute("tap_time")&&
200>(new Date).getTime()-cc.getAttrToNumber(a,"tap_time")){if(a.callbacksDoubleTap)for(var b=0;b<a.callbacksDoubleTap.length;b++)a.callbacksDoubleTap[b].call(null,{target:a==this._render?this._render:a})}else if(a.callbacksTap)for(b=0;b<a.callbacksTap.length;b++)a.callbacksTap[b].call(null,{target:a==this._render?this._render:a});a.setAttribute("tap_time",(new Date).getTime())}},removeDomTouchTap:function(a){a.callbacksTap&&(a.touchTapEnabled=!1,a.callbacksTap=null,delete a.callbacksTap)},addTouchDouble:function(a){this.addDomTouchDoubleTap(this._render,
a)},addTouchDoubleTap:function(a){this.addDomTouchDoubleTap(this._render,a)},removeTouchDoubleTap:function(){this.removeDomTouchDoubleTap(this._render)},addDomTouchDoubleTap:function(a,b){a.touchTapEnabled||this.addDomTouchTap(a);a.touchDoubleTapEnable=!0;a.callbacksDoubleTap=a.callbacksDoubleTap||[];b&&a.callbacksDoubleTap.push(b)},removeDomTouchDoubleTap:function(a){a.callbacksDoubleTap&&(a.touchDoubleTapEnable=!1,a.callbacksDoubleTap=null,delete a.callbacksDoubleTap)},_dragEnabled:!1,setDragEnabled:function(a){this._render&&
(this.setDragEnabledDom(this._render,a),this._dragEnabled=a)},getDragEnabled:function(){return this._dragEnabled},setDragEnabledDom:function(a,b){b&&!a.touchStartEnabled&&this.addDomTouchStart(a);a.dragEnabled=!!b},findDom:function(a){var b=null;if(!a)return null;a instanceof HTMLElement?b=a:cc.isString(a)&&(b=this._render.querySelector(a));b._ccinit||(b._ccinit=!0,b.css=(c,d)=>{if(cc.isString(c))b.style[c]=d;else if(cc.isObject(c))for(var e in c)b.style[e]=c[e]},b.getBoxGrid=c=>this.findDom(b.querySelector("[grid='"+
c+"']")),b.addTouch=c=>{this.addDomTouchTap(b,c)},b.removeTouch=()=>{this.removeDomTouchTap(b)},b.addTouchStart=c=>{this.addDomTouchStart(b,c)},b.removeTouchStart=()=>{this.removeDomTouchStart(b)},b.addTouchMove=c=>{this.addDomTouchMove(b,c)},b.removeTouchMove=()=>{this.removeDomTouchMove(b)},b.addTouchOut=c=>{this.addDomTouchOut(b,c)},b.removeTouchOut=()=>{this.removeDomTouchOut(b)},b.addTouchEnd=c=>{this.addDomTouchEnd(b,c)},b.removeTouchEnd=()=>{this.removeDomTouchEnd(b)},b.addTouchDouble=c=>{this.addDomTouchDoubleTap(b,
c)},b.removeTouchDouble=()=>{this.removeDomTouchDoubleTap(b)});return b},findAllDom:function(a){}});cc.Node.fromObject=function(a){return cc.Node().fromObject(a)};var _p=cc.Node.prototype;cc.defineGetterSetter(_p,"parent",_p.getParent,_p.getParent);cc.defineGetterSetter(_p,"render",_p.getRender,_p.getRender);cc.defineGetterSetter(_p,"width",_p.getWidth,_p.setWidth);cc.defineGetterSetter(_p,"height",_p.getHeight,_p.setHeight);cc.defineGetterSetter(_p,"x",_p.getX,_p.setX);
cc.defineGetterSetter(_p,"left",_p.getX,_p.setX);cc.defineGetterSetter(_p,"y",_p.getY,_p.setY);cc.defineGetterSetter(_p,"top",_p.getY,_p.setY);cc.defineGetterSetter(_p,"visible",_p.getVisible,_p.setVisible);cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);cc.defineGetterSetter(_p,"scale",_p.getScale,_p.getScale);cc.defineGetterSetter(_p,"scaleX",_p.getScaleX,_p.setScaleX);cc.defineGetterSetter(_p,"scaleY",_p.getScaleY,_p.setScaleY);
cc.defineGetterSetter(_p,"rotate",_p.getRotate,_p.setRotate);cc.defineGetterSetter(_p,"buttonMode",_p.setButtonMode,_p.setButtonMode);cc.defineGetterSetter(_p,"anchorX",_p.getAnchorX,_p.setAnchorX);cc.defineGetterSetter(_p,"anchorY",_p.getAnchorY,_p.setAnchorY);cc.defineGetterSetter(_p,"touchEnabled",_p.getTouchEnabled,_p.setTouchEnabled);cc.defineGetterSetter(_p,"dragEnabled",_p.getDragEnabled,_p.setDragEnabled);
function _windowMove(a){var b=a.touches&&0<a.touches.length?a.touches[0]:a;a=cc.dragDom;var c=b.pageX-cc.getAttrToNumber(a,"start_pageX");b=b.pageY-cc.getAttrToNumber(a,"start_pageY");a==this._render?(this.x=c+cc.getAttrToNumber(a,"start_left"),this.y=b+cc.getAttrToNumber(a,"start_top")):(a.style.left=c+cc.getAttrToNumber(a,"start_left")+"px",a.style.top=b+cc.getAttrToNumber(a,"start_top")+"px")}
function _windowUp(a){window.removeEventListener("mousemove",_windowMove);window.removeEventListener("touchmove",_windowMove);window.removeEventListener("mouseup",_windowUp);window.removeEventListener("touchend",_windowUp);cc.dragDom&&cc.dragDom.removeAttribute("start_left");cc.dragDom&&cc.dragDom.removeAttribute("start_top");cc.dragDom&&cc.removeDomAttr(cc.dragDom,["start_time","start_pageX","start_pageY","start_clientX","start_clientY"]);cc.dragDom=null};var aztExam=aztExam||{};
aztExam.RTCConnection||(aztExam.RTCConnection=cc.Class.extend({conn:null,candidate:null,callback:null,isUsed:!1,remoteUserId:"",localUserId:"",type:"offer",monitor:null,offerTimestamp:-1,timeIntv:3E3,timeAnswerIntv:15E3,timeIntvCount:0,blacklistTimestamp:null,lasttimestamp:-1,isWaitingUploadOffer:!1,isWaitingUploadAnswer:!1,offer:null,answer:null,offerReceive:null,isUsefirestore:!1,ctor:function(a){this.blacklistTimestamp=[];this.monitor=a;this.monitor.firebaseApp&&(this.isUsefirestore=!0);this.initUI()},
initUI:function(){this.ui=document.createElement("div");this.ui.style.transformOrigin="0% 0%";this.ui.style.overflow="hidden";this.uivideo=document.createElement("div");this.uivideo.style.width="100%";this.uivideo.style.height="100%";this.uivideo.style.display="flex";this.uivideo.style.flexDirection="row";this.uivideo.style.alignItems="center";this.uivideo.style.justifyContent="center";this.ui.appendChild(this.uivideo);this.txtConnecting=document.createElement("div");this.txtConnecting.style.backgroundColor=
"#333333";this.txtConnecting.style.width="250px";this.txtConnecting.style.padding="20px";this.txtConnecting.style.borderRadius="8px";this.txtConnecting.style.color="#EEEEEE";this.txtConnecting.style.fontSize="16px";this.txtConnecting.innerHTML=aztExam.lang.lbConnectingMedia;this.txtConnecting.style.position="absolute";this.txtConnecting.style.bottom="20px";this.txtConnecting.style.textAlign="center";this.txtConnecting.style.lineHeight="30px";this.perConnecting=document.createElement("div");this.perConnecting.style.backgroundColor=
"#1A84E3";this.perConnecting.style.height="5px";this.perConnecting.style.borderRadius="5px";this.perConnecting.style.width="0%";this.perConnecting.per=0;this.perConnecting.style.position="absolute";this.perConnecting.style.bottom="5px";this.txtConnecting.appendChild(this.perConnecting);this.ui.appendChild(this.txtConnecting)},showLoading:function(){this.txtConnecting.style.display="block";clearInterval(this.itvPerConnection);this.perConnecting.per=0;this.itvPerConnection=setInterval(()=>{this.perConnecting.per+=
.5;90<=this.perConnecting.per&&(this.perConnecting.per=0);this.perConnecting.style.width=this.perConnecting.per+"%"},100)},hideLoading:function(){this.txtConnecting.style.display="none";clearInterval(this.itvPerConnection)},resizeUI:function(a,b){this.ui.style.width=a+"px";this.ui.style.height=b+"px";this.txtConnecting.style.left=(a-260)/2+"px"},startIntv:async function(){cc.log("start intv");this.isStarted=!0;this.showLoading();if("offer"==this.type){var a=(new Date).getTime();this.offer=await this.createOffer();
this.offer.timestamp=a;this.offer.conn=a;this.offer.userid=this.localUserId;this.isWaitingUploadOffer=!0}else clearInterval(this.ofIntv),this.ofIntv=setInterval(()=>{this.getOfferIntv()},this.timeIntv),this.getOfferIntv()},getAnswerIntv:function(){var a=new XMLHttpRequest;a.onreadystatechange=()=>{if(4==a.readyState&&200==a.status)try{var b=JSON.parse(a.responseText);b.timestamp==this.offerTimestamp&&(clearInterval(this.anIntv),this.receiveAnswer(b))}catch(c){cc.log("get answer error")}};a.open("GET",
this.monitor._urlDownload+this.monitor.options.roomid+"/"+this.localUserId+"/public/answer.txt?t="+(new Date).getTime());a.send()},getOfferIntv:async function(){var a=new XMLHttpRequest;a.onreadystatechange=()=>{if(4==a.readyState&&200==a.status)try{var b=JSON.parse(a.responseText);this.receiveOffer(b)}catch(c){cc.log("get offer error")}};a.open("GET",this.monitor._urlDownload+this.monitor.options.roomid+"/"+this.remoteUserId+"/public/offer.txt?t="+(new Date).getTime());a.send()},start:function(a,
b,c){cc.log("start");this.isUsed||!a||!b&&"offer"!=c||(this.reset(),this.localUserId=a,this.remoteUserId=b,this.type=c,this.timeUsed=(new Date).getTime(),this.isUsed=!0,this.initConn(),this.startIntv())},stop:function(){"offer"!=this.type&&this.isUsefirestore&&this.answer&&this.monitor.firestoreWriteDocument("answer_"+this.remoteUserId,"lastest",{state:1,timestamp:this.answer.timestamp});this.reset()},initConn:function(){cc.log("init connection ");this.conn=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});
this.conn.addEventListener("icecandidate",a=>this.onIceCandidate(a));this.conn.addEventListener("iceconnectionstatechange",a=>this.onIceStateChange(a));this.monitor.stream&&this.addStream(this.monitor.stream);this.conn.ontrack=a=>{this.gotRemoteStream(a)}},createOffer:async function(){if(this.conn){try{const a=await this.conn.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1});this.conn.setLocalDescription(a);return{candidate:this.candidate,offer:a}}catch(a){console.log("create offer error "+
a)}return null}},receiveOffer:async function(a){if(null!=this.conn)try{if(!(0<=this.blacklistTimestamp.indexOf(a.timestamp))){this.blacklistTimestamp.push(a.timestamp);clearInterval(this.ofIntv);this.offerReceive=a;this.conn.setRemoteDescription(this.offerReceive.offer);var b=await this.conn.createAnswer();this.conn.setLocalDescription(b);this.answer={candidate:this.candidate,answer:b,timestamp:a.timestamp};this.isWaitingUploadAnswer=!0}}catch(c){cc.log("receiveOffer error "+c)}},receiveAnswer:function(a){if(null!=
this.conn){"offer"==this.type&&(this.answer=a);this.conn.setRemoteDescription(a.answer);for(var b=0;b<a.candidate.length;b++)this.conn.addIceCandidate(a.candidate[b])}},addStream:function(a){},gotRemoteStream:function(a){cc.log("gotRemoteStream "+a.streams.length);if(0<a.streams.length){cc.removeAllChildNodes(this.uivideo);for(var b=0;b<a.streams.length;b++){var c=document.createElement("video");this.uivideo.appendChild(c);c.playsInline=!0;c.muted=!0;c.srcObject=a.streams[b];c.vW=parseInt(this.ui.style.width);
c.vH=parseInt(this.ui.style.height);c.onplay=()=>{};c.onresize=()=>{80<c.videoWidth&&60<c.videoHeight&&(this.hideLoading(),console.log("video size "+c.videoWidth+":"+c.videoHeight),c.videoWidth/c.videoHeight<c.vW/c.vH?(c.style.width="",c.style.height="100%"):(c.style.width="100%",c.style.height=""))};c.play()}}},updateBandwidthRestriction:function(a,b){return a=-1===a.indexOf("b=AS:")?a.replace(/c=IN (.*)\r\n/,"c=IN $1\r\nb=AS:"+b+"\r\n"):a.replace(RegExp("b=AS:.*\r\n"),"b=AS:"+b+"\r\n")},onIceCandidate:function(a){try{a&&
a.candidate?(cc.log("onIceCandicate "+JSON.stringify(a.candidate)),this.candidate.push(a.candidate),clearInterval(this.iceIntv),this.iceIntv=setInterval(()=>{clearInterval(this.iceIntv);this.onIceCandidateFinish()},3E3)):(cc.log("on ice null finish get candicate first time"),this.onIceCandidateFinish())}catch(b){cc.log("onIceCandidate exception "+b.message)}},onIceCandidateFinish:function(){this.isWaitingUploadOffer&&(this.isWaitingUploadOffer=!1,this.offer.candidate=this.candidate,this.monitor.uploadPublicContent(this.monitor._urlOffer,
"offer.txt",JSON.stringify(this.offer),(b,c)=>{200==b&&(this.offerTimestamp=this.offer.timestamp,cc.log("upload offer ok"))}));if(this.isWaitingUploadAnswer){this.isWaitingUploadAnswer=!1;this.answer.candidate=this.candidate;this.monitor.getPublicUpload(this.monitor.options.roomid,this.remoteUserId,"answer.txt",1,0,b=>{""!=b&&this.monitor.uploadPublicContent(b,"answer.txt",JSON.stringify(this.answer),(c,d)=>{200==c&&this.isUsefirestore&&this.monitor.firestoreWriteDocument("answer_"+this.remoteUserId,
"lastest",{state:0,timestamp:this.answer.timestamp})})});for(var a=0;a<this.offerReceive.candidate.length;a++)this.conn.addIceCandidate(this.offerReceive.candidate[a])}},onIceStateChange:function(a){a=this.conn.iceConnectionState.toString();cc.log("onIceStateChange state "+a);if("failed"==a||"disconnected"==a||"closed"==a)this.isUsed=!1,this.start(this.localUserId,this.remoteUserId,this.type)},reset:function(){null!=this.conn&&(this.conn.close(),this.conn=null);this.isStarted=this.isUsed=!1;this.type=
this.localUserId=this.remoteUserId="";this.offerTimestamp=-1;this.isWaitingUploadOffer=this.isWaitingUploadAnswer=!1;this.answer=this.offerReceive=this.offer=null;this.candidate=[];this.timeUsed=-1;clearInterval(this.anIntv);clearInterval(this.ofIntv);cc.removeAllChildNodes(this.uivideo)}}));aztExam=aztExam||{};aztExam.icon={};
aztExam.svg={iconCheck:'<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 24px; height: 24px;"><g class="style-scope iron-icon"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" class="style-scope iron-icon"></path></g></svg>',iconWarning:'<?xml version="1.0" ?><svg  viewBox="0 0 64 64" style="pointer-events: none; display: block; width: 14px; height: 14px;" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#efcc00;}.cls-2{fill:#353535;}</style></defs><title/><path class="cls-1" d="M30.16,11.51,6.84,51.9a2.13,2.13,0,0,0,1.84,3.19H55.32a2.13,2.13,0,0,0,1.84-3.19L33.84,11.51A2.13,2.13,0,0,0,30.16,11.51Z"/><path class="cls-2" d="M29,46a3,3,0,1,1,3,3A2.88,2.88,0,0,1,29,46Zm1.09-4.66-.76-15h5.26l-.73,15Z"/></svg>',iconCameraOff:'<?xml version="1.0" ?><svg id="Icons" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}</style><g><path d="M22.5,20.9l5,3C27.6,24,27.8,24,28,24c0.2,0,0.3,0,0.5-0.1c0.3-0.2,0.5-0.5,0.5-0.9V9c0-0.4-0.2-0.7-0.5-0.9   c-0.3-0.2-0.7-0.2-1,0l-5,3C22.2,11.3,22,11.6,22,12v8C22,20.4,22.2,20.7,22.5,20.9z"/><path d="M29.7,28.3L20,18.6V11c0-1.7-1.3-3-3-3H9.4L3.7,2.3c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l26,26c0.2,0.2,0.5,0.3,0.7,0.3   s0.5-0.1,0.7-0.3C30.1,29.3,30.1,28.7,29.7,28.3z"/><path d="M3,11v10c0,1.7,1.3,3,3,3h11c0.8,0,1.5-0.3,2-0.8L4.3,8.5C3.5,9.1,3,10,3,11z"/></g></svg>',
iconCamera:'<?xml version="1.0" ?><svg id="Icons" style="enable-background:new 0 0 32 32;" version="1.1" viewBox="0 0 32 32" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}</style><g><path d="M17,8H6c-1.7,0-3,1.3-3,3v10c0,1.7,1.3,3,3,3h11c1.7,0,3-1.3,3-3V11C20,9.3,18.7,8,17,8z"/><path d="M28.5,8.1c-0.3-0.2-0.7-0.2-1,0l-5,3C22.2,11.3,22,11.6,22,12v8c0,0.4,0.2,0.7,0.5,0.9l5,3C27.6,24,27.8,24,28,24   c0.2,0,0.3,0,0.5-0.1c0.3-0.2,0.5-0.5,0.5-0.9V9C29,8.6,28.8,8.3,28.5,8.1z"/></g></svg>',
iconMicOff:'<?xml version="1.0" ?><svg  viewBox="0 0 48 48"  xmlns="http://www.w3.org/2000/svg"><path d="M0 0h48v48H0zm0 0h48v48H0z" fill="none"/><path d="M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z"/></svg>',
iconMic:'<?xml version="1.0" ?><svg  viewBox="0 0 48 48"  xmlns="http://www.w3.org/2000/svg"><path d="M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z"/><path d="M0 0h48v48H0z" fill="none"/></svg>',iconRefresh:'<?xml version="1.0" ?><svg style="enable-background:new 0 0 30 30;" version="1.1" viewBox="0 0 30 30" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M22.143,23.365  C20.221,25.008,17.726,26,15,26C8.925,26,4,21.075,4,15" style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-miterlimit:10;"/><path d="M7.857,6.635  C9.779,4.992,12.274,4,15,4c6.075,0,11,4.925,11,11" style="fill:none;stroke:#000000;stroke-width:2;stroke-linecap:round;stroke-miterlimit:10;"/><polygon points="26,20 22,14 30,14 "/><polygon points="4,10 8,16 0,16 "/></svg>',
iconClose:'<?xml version="1.0" ?><svg  style="enable-background:new 0 0 612 792;" version="1.1" viewBox="0 0 612 792" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css">.st0{clip-path:url(#SVGID_2_);fill:none;stroke:#E44061;stroke-width:45;}.st1{fill:#E44061;}</style><g><g><defs><rect height="512" width="512" x="50" y="140"/></defs><clipPath id="SVGID_2_"><use style="overflow:visible;" xlink:href="#SVGID_1_"/></clipPath><path class="st0" d="M306,629.5c128.8,0,233.5-104.7,233.5-233.5S434.8,162.5,306,162.5S72.5,267.2,72.5,396    S177.2,629.5,306,629.5L306,629.5z"/></g><polygon class="st1" points="348.7,396 448,296.7 405.3,254 306,353.3 206.7,254 164,296.7 263.3,396 164,495.3 206.7,538    306,438.7 405.3,538 448,495.3 348.7,396  "/></g></svg>',
iconGroup:'<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><rect fill="none" height="24" width="24"/><g><path d="M12,12.75c1.63,0,3.07,0.39,4.24,0.9c1.08,0.48,1.76,1.56,1.76,2.73L18,18H6l0-1.61c0-1.18,0.68-2.26,1.76-2.73 C8.93,13.14,10.37,12.75,12,12.75z M4,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C2,12.1,2.9,13,4,13z M5.13,14.1 C4.76,14.04,4.39,14,4,14c-0.99,0-1.93,0.21-2.78,0.58C0.48,14.9,0,15.62,0,16.43V18l4.5,0v-1.61C4.5,15.56,4.73,14.78,5.13,14.1z M20,13c1.1,0,2-0.9,2-2c0-1.1-0.9-2-2-2s-2,0.9-2,2C18,12.1,18.9,13,20,13z M24,16.43c0-0.81-0.48-1.53-1.22-1.85 C21.93,14.21,20.99,14,20,14c-0.39,0-0.76,0.04-1.13,0.1c0.4,0.68,0.63,1.46,0.63,2.29V18l4.5,0V16.43z M12,6c1.66,0,3,1.34,3,3 c0,1.66-1.34,3-3,3s-3-1.34-3-3C9,7.34,10.34,6,12,6z"/></g></svg>',
iconLeft:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M14 7l-5 5 5 5V7z"/><path d="M24 0v24H0V0h24z" fill="none"/></svg>',iconFullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M0 0h24v24H0z" fill="none"/><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>',iconExitFullscreen:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 0 24 24" width="48px" fill="gray"><path d="M0 0h24v24H0z" fill="none"/><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>'};
aztExam.lang={btDone:"XONG",btViewFull:"XEM TO\u00c0N B\u1ed8 L\u1edaP",btViewHistory:"XEM TH\u00d4NG TIN",btCopyLink:"COPY LINK",btBackToList:"DANH S\u00c1CH L\u1edaP",lbDeviceInfo:"TH\u00d4NG TIN THI\u1ebeT B\u1eca",lbOs:"H\u1ec7 \u0111i\u1ec1u h\u00e0nh",msgOsNotSupport:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ean c\u00e1c h\u1ec7 \u0111i\u1ec1u h\u00e0nh : iOS(iphone,ipad) , Android , Window , MAC_OS",msgTeacherOsNotSupport:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ean c\u00e1c h\u1ec7 \u0111i\u1ec1u h\u00e0nh : Window , MAC_OS",
lbBrowser:"Tr\u00ecnh duy\u1ec7t",msgBrowserNotSupportPc:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 phi\u00ean b\u1ea3n m\u1edbi nh\u1ea5tt tr\u00ecnh duy\u1ec7t Chrome,C\u1ed1c c\u1ed1c ,Microsoft Edge ,Firefox tr\u00ean m\u00e1y t\u00ednh",msgBrowserNotSupportAndroid:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ecnh duy\u1ec7t Chrome tr\u00ean h\u1ec7 \u0111i\u1ec1u h\u00e0nh Android .<br/> Copy link v\u00e0 m\u1edf b\u1eb1ng Chrome !",msgBrowserNotSupportIOs:"Ch\u1ee9c n\u0103ng gi\u00e1m s\u00e1t h\u1ed7 tr\u1ee3 tr\u00ecnh duy\u1ec7t Safari  tr\u00ean h\u1ec7 \u0111i\u1ec1u h\u00e0nh iOs .<br/> Copy link v\u00e0 m\u1edf b\u1eb1ng Safari !",
lbCamera:"Camera ",msgCameraNotFound:"Thi\u1ebft b\u1ecb kh\u00f4ng c\u00f3 camera.",msgCameraNotPermission:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Camera.<br/><br/><span style='font-style:italic'> Ch\u1ecdn bi\u1ec3u t\u01b0\u1ee3ng kho\u00e1 tr\u00ean \u0111\u1ea7u thanh \u0111\u1ecba ch\u1ec9 , c\u1ea5p quy\u1ec1n truy c\u1eadp camera , t\u1ea3i l\u1ea1i trang website</span>",msgCameraNotPermissionIos:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Camera .<br/><br/><span style='font-style:italic'>T\u1ea3i l\u1ea1i trang website , ch\u1ecdn cho ph\u00e9p truy c\u1eadp camera .</span>",
lbMic:"Microphone ",msgMicNotFound:"Thi\u1ebft b\u1ecb kh\u00f4ng c\u00f3 microphone",msgMicNotPermission:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Microphone.<br/><br/><span style='font-style:italic'> Ch\u1ecdn bi\u1ec3u t\u01b0\u1ee3ng kho\u00e1 tr\u00ean \u0111\u1ea7u thanh \u0111\u1ecba ch\u1ec9 , c\u1ea5p quy\u1ec1n truy c\u1eadp microphone , t\u1ea3i l\u1ea1i trang website</span>",msgMicNotPermissionIos:"Ch\u1ee9c n\u0103ng kh\u00f4ng \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp Microphone.<br/><br/><span style='font-style:italic'>T\u1ea3i l\u1ea1i trang website , ch\u1ecdn cho ph\u00e9p truy c\u1eadp microphone .</span>",
lbTitleHistory:"TH\u00d4NG TIN C\u00c1 NH\u00c2N ",lbConnectingMedia:"\u0110ang k\u1ebft n\u1ed1i ... !"};aztExam=aztExam||{};
aztExam.monitor=cc.Node.extend({options:null,deviceInfo:null,_isStarted:!1,_numGetMediaUser:0,_isGettingMediaUser:!1,_imageCaptureWidth:0,_imageCaptureHeight:0,_streamType:-1,_urlCurr:"",_urlAnswer:"",_urlOffer:"",_urlDownload:"",_isInitFirstTime:!1,_joinRoom:!1,_keyDbUserListInfo:"",_keyDbRoomControlInfo:"",ctor:function(){this.initUI();this.reset()},start:function(a){this._isStarted||(this._isStarted=!0,this.reset(),a&&cc.isNumber(a.imageCaptureWidth)&&(this._imageCaptureWidth=a.imageCaptureWidth),
a&&cc.isNumber(a.imageCaptureHeight)&&(this._imageCaptureHeight=a.imageCaptureHeight),a&&a.roomid&&cc.isString(a.roomid)&&(this.options.roomid=a.roomid),a&&a.time&&cc.isNumber(a.time)&&(this.options.time=a.time),a&&a.duration&&(this.options.duration=Number(a.duration)),a&&a.userlist&&cc.isArray(a.userlist)&&(this.options.userlistStart=JSON.parse(JSON.stringify(a.userlist))),a&&a.user&&(a.user.studentid&&(this.options.user.studentid=a.user.studentid),a.user.userid&&(this.options.user.userid=a.user.userid),
a.user.token&&(this.options.user.token=a.user.token),a.user.role&&cc.isNumber(a.user.role)&&(this.options.user.role=a.user.role),this.options.user.username=cc.isEmpty(a.user.studentname)?a.user.username:a.user.studentname),a&&a.config&&(a.config.urlUpload&&(this.options.config.urlUpload=a.config.urlUpload),a.config.urlDownload&&(this.options.config.urlDownload=a.config.urlDownload),a.config.domainApi&&(this.options.config.domainApi=a.config.domainApi),a.config.numMainView&&(this.options.config.numMainView=
a.config.numMainView),a.config.firestore&&(this.options.config.firestore=a.config.firestore),a.config.useFirestore&&(this.options.config.useFirestore=a.config.useFirestore)),a&&a.element&&(this.options.element=a.element),a&&a.isStarted&&(this._running=a.isStarted?!0:!1),a&&a.firebaseApp&&(this.options.firebaseApp=a.firebaseApp),cc.log("get started "+this._running+":"+a.isStarted),this._keyDbUserListInfo="azt_mo_"+this.options.roomid+"_user",this._keyDbRoomControlInfo="azt_mo"+this.options.roomid+
"_control",this.options.duration=9E5>this.options.duration?9E5:this.options.duration,this.options.config.urlGetPublicForLive=this.options.config.domainApi+this.options.config.urlGetPublicForLive,this.options.config.urlGetListFileForLive=this.options.config.domainApi+this.options.config.urlGetListFileForLive,this.options.config.urlGetTokenForLive=this.options.config.domainApi+this.options.config.urlGetTokenForLive)},loop:function(){cc.log("running "+this._running);this._running&&this.update(0)},stopLoop:function(){this._running=
!1},reset:function(){this.soundMeter&&this.soundMeter.stop();this.stopLoop();this.options={};this.options.roomid="";this.options.time=-1;this.options.userlist=[];this.options.duration=9E5;this.options.user={token:"",userid:"",role:0,name:""};this.options.config={currentUpdateSize:2,storeUpdateSize:8,domainApi:"https://api.beta.azota.vn/api/",urlUpload:"/fileupload",urlDownload:"/upload/",urlRename:"/rename",urlGetPublicForLive:"s3space/get_public_upload_url_for_live",urlGetListFileForLive:"S3space/get_list_files_for_live",
urlGetTokenForLive:"s3space/get_token_for_live",firestore:null,useFirestore:!1};this.deviceInfo={};this.firestoreRemoveAllListener();this._isStarted=this._running=!1;this._numGetMediaUser=0;this._isGettingMediaUser=!1},showDeviceUI:function(a){if(a){try{this.deviUI&&(document.body.removeChild(this.deviUI),this.deviUI=null)}catch(k){cc.log("error remove deviUI")}var b=window.innerWidth/500;0==b&&(b=1);1<=b&&(b=1);var c=window.innerHeight/b;this.deviUI=this.findDom(document.createElement("div"));this.deviUI.css("position",
"absolute");this.deviUI.css("transform-origin","0% 0%");this.deviUI.css("transform","scale("+b+","+b+")");this.deviUI.css("width","500px");this.deviUI.css("height",Math.floor(c)+"px");this.deviUI.css("left",Math.floor((window.innerWidth-500*b)/2)+"px");this.deviUI.css("top",Math.floor((window.innerHeight-c*b)/2)+"px");this.deviUI.css("background-color","white");this.deviUI.css("font-family","sans-serif");this.deviUI.css("font-size","18px");this.deviUI.css("box-shadow","0 2px 2px 0 rgb(0 0 0 / 14%), 0 3px 1px -2px rgb(0 0 0 / 12%), 0 1px 5px 0 rgb(0 0 0 / 20%)");
this.deviUI.css("z-index",999999999);document.body.appendChild(this.deviUI);this.deviUI.css("display","block");b=this.findDom(document.createElement("div"));b.css("width","100%");b.css("height","60px");b.css("border-bottom","1px solid #CCCCCC");this.deviUI.appendChild(b);this.btDone=this.createButton(100,40,aztExam.lang.btDone,"#1A84E3",16);this.btDone.css("float","left");this.btDone.css("margin-left","10px");this.btDone.css("margin-top","10px");b.appendChild(this.btDone);var d=this.findDom(document.createElement("span"));
d.css("color","gray");d.css("display","flex");d.css("width","60%");d.css("height","100%");d.css("float","left");d.css("padding-left","20px");d.css("align-items","center");d.innerHTML=aztExam.lang.lbDeviceInfo;b.appendChild(d);this.btDone.addTouch(k=>{this.deviUI.css("display","none")});b=this.findDom(document.createElement("div"));b.css("width","100%");b.css("height",c-60+"px");b.css("overflow-x","hidden");b.css("text-align","center");b.css("overflow-y","scroll");this.deviUI.appendChild(b);c=this.findDom(document.createElement("div"));
c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.osSupport?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.innerHTML=aztExam.lang.lbOs+" "+a.osName+"  "+a.osVersion;b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","90%");c.css("height","auto");c.css("text-align","center");c.css("margin-top","10px");c.css("margin-left","5%");c.innerHTML="student"==
this.role()?aztExam.lang.msgOsNotSupport:aztExam.lang.msgTeacherOsNotSupport;c.css("display",a.osSupport?"none":"block");b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.browserSupport?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.innerHTML=aztExam.lang.lbBrowser+" "+a.browser.name+
" "+a.browser.version;b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","90%");c.css("height","auto");c.css("text-align","center");c.css("margin-top","10px");c.css("padding-left","5%");c.css("line-height","28px");c.innerHTML=aztExam.lang.msgBrowserNotSupportPc;a.isAndroid?c.innerHTML=aztExam.lang.msgBrowserNotSupportAndroid:a.isIOs&&(c.innerHTML=aztExam.lang.msgBrowserNotSupportIOs);c.css("display",a.browserSupport?"none":"block");b.appendChild(c);if(a.browserSupport){c=
this.findDom(document.createElement("div"));c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.hasWebcam&&a.isWebsiteHasWebcamPermissions?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.innerHTML=aztExam.lang.lbCamera+" ("+a.videoInputDevices.length+")";b.appendChild(c);c=this.findDom(document.createElement("div"));c.css("width","90%");c.css("height",
"auto");c.css("text-align","center");c.css("margin-top","10px");c.css("padding-left","5%");c.css("display",a.hasWebcam&&a.isWebsiteHasWebcamPermissions?"none":"block");a.hasWebcam?a.isWebsiteHasWebcamPermissions||(c.innerHTML=a.isIOs?aztExam.lang.msgCameraNotPermissionIos:aztExam.lang.msgCameraNotPermission):c.innerHTML=aztExam.lang.msgCameraNotFound;b.appendChild(c);if(a.isWebsiteHasWebcamPermissions){c=document.createElement("video");c.width=80;c.height=60;c.style.marginLeft="auto";c.style.marginTop=
"5px";c.muted=!0;c.playsInline=!0;c.classList.add("azt_devi_video_preview");this.stream&&(c.srcObject=this.stream,c.play());b.appendChild(c);var e=document.createElement("div");e.style.width="100%";e.style.height="auto";b.appendChild(e);c=a.videoInputDevices;for(d=0;d<c.length;d++){var f=this.createListCheck("azt_cam_item",d,c[d].label,d==this.deviceInfo.videoInputIndex?!0:!1,c[d]);f.addTouch(k=>{k=parseInt(k.target.getAttribute("azt_cam_item_index"));k!=this.deviceInfo.videoInputIndex&&this.getMediaUser(k,
this.deviceInfo.audioInputIndex)});e.appendChild(f)}}c=this.findDom(document.createElement("div"));c.css("width","100%");c.css("height","60px");c.css("margin-top","10px");c.css("background",a.hasMicrophone&&a.isWebsiteHasMicrophonePermissions?"#90ec90":"#ec9090");c.css("display","flex");c.css("align-items","center");c.css("padding-left","20px");c.css("color","#333333");c.css("white-space","nowrap");c.innerHTML=aztExam.lang.lbMic+" ("+a.audioInputDevices.length+")";b.appendChild(c);e=this.findDom(document.createElement("div"));
e.css("width","90%");e.css("height","auto");e.css("text-align","center");e.css("margin-top","10px");e.css("padding-left","5%");e.css("padding-left","5%");e.css("display",a.hasMicrophone&&a.isWebsiteHasMicrophonePermissions?"none":"block");a.hasMicrophone?a.isWebsiteHasMicrophonePermissions||(e.innerHTML=a.isIOs?aztExam.lang.msgMicNotPermissionIos:aztExam.lang.msgMicNotPermission):e.innerHTML=aztExam.lang.msgMicNotFound;if(a.isWebsiteHasMicrophonePermissions)for(c=a.audioInputDevices,d=0;d<c.length;d++)f=
this.createListCheck("azt_mic_item",d,c[d].label,d==this.deviceInfo.audioInputIndex?!0:!1,c[d]),f.addTouch(k=>{k=parseInt(k.target.getAttribute("azt_mic_item_index"));k!=this.deviceInfo.audioInputIndex&&this.getMediaUser(this.deviceInfo.videoInputIndex,k)}),b.appendChild(f);b.appendChild(e)}else if(a.isIOs||a.isAndroid){var h=document.createElement("div");a=window.location.toString().indexOf(this.options.roomid);a=0>a?window.location.length:a;h.innerHTML=window.location.toString().substr(0,a+this.options.roomid.length+
1);h.style.width="100%";h.style.height="30px";h.style.marginTop="20px";h.style.marginBottom="10px";b.appendChild(h);var m=this.createButton(160,60,aztExam.lang.btCopyLink,"#1A84E3",20);m.css("margin-left","170px");m.css("margin-top","10px");m.css("display","flex");m.addTouch(k=>{k=document.createRange();const u=window.getSelection();u.removeAllRanges();k.selectNodeContents(h);u.addRange(k);try{document.queryCommandSupported("copy")?(document.execCommand("copy"),m.innerHTML="\u0110\u00c3 COPY LINK"):
cc.log("exec Command not found !")}catch(w){console.log(w)}u.removeAllRanges()});b.appendChild(m)}}},collectInfo:function(a){DetectRTC.load(()=>{this.deviceInfo.osName=DetectRTC.osName;this.deviceInfo.osVersion=DetectRTC.osVersion;this.deviceInfo.browser=DetectRTC.browser;this.deviceInfo.osSupport=this.checkOsSupport(this.deviceInfo);this.deviceInfo.browserSupport=this.checkBrowserSuppor(this.deviceInfo);this.deviceInfo.hasWebcam=DetectRTC.hasWebcam;this.deviceInfo.hasMicrophone=DetectRTC.hasMicrophone;
this.deviceInfo.isWebsiteHasWebcamPermissions=DetectRTC.isWebsiteHasWebcamPermissions;this.deviceInfo.isWebsiteHasMicrophonePermissions=DetectRTC.isWebsiteHasMicrophonePermissions;this.deviceInfo.isWebRTCSupported=DetectRTC.isWebRTCSupported;this.deviceInfo.videoInputDevices=DetectRTC.videoInputDevices;this.deviceInfo.audioInputDevices=DetectRTC.audioInputDevices;if(0==this._numGetMediaUser){if(!this.deviceInfo.osSupport||!this.deviceInfo.browserSupport){this.showDeviceUI(this.deviceInfo);return}if("teacher"==
this.role()){a&&a();return}DetectRTC.hasWebcam||DetectRTC.hasMicrophone?this.getMediaUser(DetectRTC.hasWebcam?0:-1,DetectRTC.hasMicrophone?0:-1):this.showDeviceUI(this.deviceInfo)}else if(1==this._numGetMediaUser)0>this._streamType&&this.showDeviceUI(this.deviceInfo);else if(this.deviUI){for(var b=this.deviUI.getElementsByClassName("azt_cam_item"),c=0;c<b.length;c++){var d=b[c].getElementsByClassName("check_icon");d[0].style.display=c==this.deviceInfo.videoInputIndex?"block":"none"}b=this.deviUI.getElementsByClassName("azt_mic_item");
for(c=0;c<b.length;c++)d=b[c].getElementsByClassName("check_icon"),d[0].style.display=c==this.deviceInfo.audioInputIndex?"block":"none"}a&&a()})},checkOsSupport:function(a){var b=a.osName.toLowerCase();if(0<=b.indexOf("window")||0<=b.indexOf("mac"))return a.isPc=!0;if("student"==this.role()){if(0<=b.indexOf("android"))return a.isAndroid=!0;if(0<=b.indexOf("ios")||b.indexOf("ipad"))return a.isIOs=!0}return!1},checkBrowserSuppor:function(a){var b=a.osName.toLowerCase();a=a.browser.name.toLowerCase();
if(0<=b.indexOf("window")||0<=b.indexOf("mac"))if(0<=a.indexOf("chrome")||0<=a.indexOf("edge")||0<=a.indexOf("firefox")||0<=a.indexOf("coccoc"))return!0;return"student"==this.role()&&(0<=b.indexOf("android")&&0<=a.indexOf("chrome")||(0<=b.indexOf("ios")||0<=b.indexOf("ipad"))&&0<=a.indexOf("safari"))?!0:!1},stopAllPreview:function(){this.stream&&this.stream.getTracks().forEach(a=>{a.stop()})},updateAllPreview:function(){if(this.deviUI){var a=this.deviUI.getElementsByClassName("azt_devi_video_preview")[0];
a&&this.stream&&(a.srcObject=this.stream,a.play())}this.stream&&this.videoReview&&(this.videoReview.srcObject=this.stream,this.videoReview.play())},getMediaUser:function(a,b,c){if(!(0>a&&0>b||this._isGettingMediaUser||a>=this.deviceInfo.videoInputDevices.length||b>=this.deviceInfo.audioInputDevices.length)){var d=!1,e=!1;cc.log("get media user "+a+":"+b);if(0<=a){cc.log("video index");d=this.deviceInfo.videoInputDevices[a].deviceId;var f=640,h=480;this.isMobile()&&(f=640,h=480);d=c?{deviceId:d?{exact:d}:
void 0}:{deviceId:d?{exact:d}:void 0,width:{max:f,min:f},height:{max:h,min:h},frameRate:{max:12,ideal:6}};cc.log("video contrainst")}0<=b&&(cc.log("audio index"),c=this.deviceInfo.audioInputDevices[b].deviceId,e={deviceId:c?{exact:c}:void 0},cc.log("audio contrainst"));cc.log("media constraints "+JSON.stringify(d));this._isGettingMediaUser=!0;this.stopAllPreview();navigator.mediaDevices.getUserMedia({audio:e,video:d}).then(m=>{cc.log("ongetstream");this.gotStream(m,a,b)}).then().catch(this.handleError)}},
gotStream:function(a,b,c){cc.log("on getStream");this.deviceInfo.videoInputIndex=b;this.deviceInfo.audioInputIndex=c;this.stream=a;0<=b&&(this.videoWidth=this.stream.getVideoTracks()[0].getSettings().width,this.videoHeight=this.stream.getVideoTracks()[0].getSettings().height,this.videoHeight=0==this.videoHeight?240:this.videoHeight,this.videoWidth=0==this.videoWidth?320:this.videoWidth);0<=b&&0<=c?this._streamType=0:0<=b?this._streamType=1:0<=c&&(this._streamType=2);this.updateAllPreview();this._numGetMediaUser++;
this.collectInfo();this._isGettingMediaUser=!1},handleError:function(a){},update:function(a){},uploadContentBlob:function(a,b,c,d){if(a&&b){c||(c=this.options.user.userid);b=new Blob([b],{type:"text/plain"});var e=new File([b],a),f=new XMLHttpRequest;b=new FormData;b.append("file",e);a="roomid="+this.options.roomid+"&userid="+c+"&filename="+a;f.onreadystatechange=function(){4==this.readyState&&(cc.log("upload success"),d&&d(this.status,f.responseText))};f.open("POST",this.options.config.urlUpload+
"?"+a);f.send(b)}},renameContent:function(a,b,c,d){if(a&&b){c||(c=this.options.user.userid);var e=new XMLHttpRequest;a="roomid="+this.options.roomid+"&userid="+c+"&filenameold="+a+"&filenamenew="+b;e.onreadystatechange=function(){4==this.readyState&&d&&d(this.status,e.responseText)};e.open("POST",this.options.config.urlRename+"?"+a);e.send()}},getPublicUpload:function(a,b,c,d,e,f){var h=new XMLHttpRequest;a=encodeURI(this.options.config.urlGetPublicForLive+"?examHashId="+(a+"&isPublic="+d+"&userId="+
b+"&file_name="+c+"&file_size=100000&minetype=text/plain&randomFileName="+e));h.open("GET",a);h.setRequestHeader("Authorization","Bearer "+this.options.user.token);h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status)try{var m=JSON.parse(h.responseText).data.upload_url,k=JSON.parse(h.responseText).data.url;cc.log("getPublicUpload "+m+":"+k);f(m,k)}catch(u){f("")}else f("")};h.send()},getPublicUpload__:function(a,b,c,d,e){null==e&&(e=1);var f=new XMLHttpRequest;a=encodeURI(this.options.config.urlGetPublicForLive+
"?examHashId="+(a+"&isPublic="+e+"&userId="+b+"&file_name="+c+"&file_size=100000&minetype=text/plain"));f.open("GET",a);f.setRequestHeader("Authorization","Bearer "+this.options.user.token);f.onreadystatechange=function(){if(4==f.readyState&&200==f.status)try{var h=JSON.parse(f.responseText).data.upload_url,m=JSON.parse(f.responseText).data.url;cc.log("getPublicUpload "+h+":"+m);d(h,m)}catch(k){d("")}};f.send()},uploadPublicContent:function(a,b,c,d){c=new Blob([c],{type:"text/plain"});b=new File([c],
b);c=new XMLHttpRequest;c.open("PUT",a);c.setRequestHeader("Content-Type","text/plain");c.setRequestHeader("x-amz-acl","public-read");c.onreadystatechange=function(){4==this.readyState&&d&&d(this.status,this.responseText)};c.send(b)},uploadContent:function(a,b,c,d,e){this.getPublicUpload(this.options.roomid,this.options.user.userid,a,c,d,(f,h)=>{f?this.uploadPublicContent(f,a,b,(m,k)=>{e&&e(m,k)}):e&&e(404,"")},c)},getTokenForLive:function(a,b){var c=new XMLHttpRequest;a=encodeURI(this.options.config.urlGetTokenForLive+
"?examHashId="+a);c.open("GET",a);c.setRequestHeader("Authorization","Bearer "+this.options.user.token);c.onreadystatechange=function(){if(4==c.readyState)if(200==c.status)try{var d=JSON.parse(c.responseText).data;b(d)}catch(e){b("")}else b("")};c.send()},getListFile:function(a,b,c){var d=new XMLHttpRequest;a=encodeURI(this.options.config.urlGetListFileForLive+"?examHashId="+(a+"&userId="+b));d.open("GET",a);d.setRequestHeader("Authorization","Bearer "+this.options.user.token);d.onreadystatechange=
function(){if(4==d.readyState)if(200==d.status){cc.log("response ok "+d.status);var e=JSON.parse(d.responseText).objs;c&&c(e)}else cc.log("response not "+d.status),c&&c("")};d.send()},getContentFile:function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=()=>{if(4==c.readyState&&200==c.status)try{b&&b(c.responseText)}catch(d){b&&b("")}};c.open("GET",a);c.send()},initFirestore:function(a){this.options.firebaseApp?a(null):(cc.log("init firsestore "+this.firebaseApp),this.options.config.useFirestore&&
this.options.config.firestore?this.firebaseApp?a(this.firebaseApp):window.firebase?a(null):cc.loadJs(["https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js","https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js","https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"],()=>{const b=firebase.initializeApp(this.options.config.firestore);firebase.auth().signInAnonymously().then(()=>{cc.log("signIn anonymous");a&&a(b)}).catch(c=>{a&&a(null)})}):a(null))},firestoreAddListener:function(a,
b,c,d){!this.options.firebaseApp&&this.firebaseApp&&b&&""!=b.trim()&&(this.firestoreListenerColl||(this.firestoreListenerColl={}),this.firestoreListenerColl[a]&&this.firestoreListenerColl[a].call(),this.firestoreListenerColl[a]=c&&3==c.length?this.firebaseApp.firestore().collection(b).where(c[0],c[1],c[2]).onSnapshot(e=>{e=e.docs.map(f=>({id:f.id,...f.data()}));console.log("receive firestore : ",JSON.stringify(e));d&&d(!0,e)},e=>{d&&d(!1)}):this.firebaseApp.firestore().collection(b).onSnapshot(e=>
{e=e.docs.map(f=>({id:f.id,...f.data()}));console.log("receive firestore : ",JSON.stringify(e));d&&d(!0,e)},e=>{d&&d(!1)}))},firestoreReadDocument:async function(a){if(!this.options.firebaseApp)return(await firebase.firestore().collection(a).get()).docs.map(b=>b.data())},firestoreWriteDocument:function(a,b,c,d){this.options.firebaseApp?this.options.firebaseApp.examLiveStudents_student_saveChange(this.options.roomid,{u:this.options.user.userid,n:this.options.user.username,t:(new Date).getTime(),o:!0}):
(b=b.toString(),this.firebaseApp&&b&&""!=b.trim()&&c&&(cc.log("write firestore :"+a+":"+b+":"+JSON.stringify(c)),this.firebaseApp.firestore().collection(a).doc(b).set(c).then(()=>{console.log("Document created")}).catch(e=>{console.log("Write document error")})))},firestoreRemoveListener:function(a){this.options.firebaseApp||this.firebaseApp&&this.firestoreListenerColl&&this.firestoreListenerColl[a]&&this.firestoreListenerColl[a].call()},firestoreRemoveAllListener:function(){if(!this.options.firebaseApp&&
this.firestoreListenerDoc)for(var a in this.firestoreListenerDoc)this.firestoreListenerDoc[a].call()},examLiveTeachers_student_subscribe:function(a,b){this.options.firebaseApp&&this.options.firebaseApp.examLiveTeachers_student_subscribe(a).subscribe(c=>{cc.log("receive student subcribe examId "+JSON.stringify(c));b&&b(c)})},examLiveTeachers_student_unbsubscribe:function(a){this.options.firebaseApp&&(cc.log("student unsubcrible "+a),this.options.firebaseApp.examLiveTeachers_student_unbsubscribe(a))},
examLiveTeachers_teacher_saveChange:function(a,b,c){this.options.firebaseApp&&this.options.firebaseApp.examLiveTeachers_teacher_saveChange(a,b).subscribe(d=>{cc.log("teacher write examId "+JSON.stringify(d));c&&c(d)})},examSessions_subscribeUserMap:function(a){},examLiveStudents_student_subscribe:function(a){},examLiveStudents_student_unbsubscribe:function(a){},examLiveStudents_teacher_saveChange:function(a,b,c){},createButton:function(a,b,c,d,e){var f=this.findDom(document.createElement("div"));
f.css("border-radius","5px");f.css("width",a+"px");f.css("height",b+"px");f.css("background-color",d);f.css("display","flex");f.css("align-items","center");f.css("justify-content","center");f.css("color","white");f.css("cursor","pointer");f.css("font-size",e+"px");f.css("user-select","none");f.css("transform-origin","50% 50%");f.innerHTML=c;f.addTouchStart(h=>{cc.log("touch start");h.target.css("opacity",.5)});f.addTouchEnd(h=>{cc.log("touch end");h.target.css("opacity",1)});return f},createListCheck:function(a,
b,c,d,e){var f=this.findDom(document.createElement("div"));f.css("width","90%");f.css("margin-left","5%");f.css("height","50px");f.css("display","flex");f.css("align-items","center");f.css("justify-content","space-between");f.css("flex-direction","row");f.css("border-bottom","1px solid #AAAAAA");f.css("white-space","nowrap");f.css("cursor","pointer");f.classList.add(a);f.setAttribute(a+"_index",b);f.innerHTML=c;f.info=e;a=document.createElement("div");a.classList.add("check_icon");a.innerHTML=aztExam.svg.iconCheck;
a.style.display=d?"block":"none";f.appendChild(a);return f},getLocalStorage:function(a){try{if(localStorage)return localStorage.getItem(a)}catch(b){}cc.log("not support localStorage");return""},setLocalStorage:function(a,b){try{if(localStorage)return localStorage.setItem(a,b),!0}catch(c){}cc.log("not support localStorage");return!1},getParameterByName:function(a,b=window.location.href){a=a.replace(/[\[\]]/g,"\\$&");return(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(b))?a[2]?decodeURIComponent(a[2].replace(/\+/g,
" ")):"":null},hasWebcamStream:function(){return 0==this._streamType||1==this._streamType?!0:!1},hasMicrophoneStream:function(){return 0==this._streamType||2==this._streamType?!0:!1},isMobile:function(){return this.deviceInfo&&this.deviceInfo.osName?0>this.deviceInfo.osName.toLowerCase().indexOf("window")&&0>this.deviceInfo.osName.toLowerCase().indexOf("mac")?!0:!1:!1},role:function(){return""},version:function(){return"30.8"}});
function SoundMeter(a){try{this.context=a;this.clip=this.slow=this.instant=0;this.script=a.createScriptProcessor(2048,1,1);const b=this;this.script.onaudioprocess=function(c){c=c.inputBuffer.getChannelData(0);let d,e=0,f=0;for(d=0;d<c.length;++d)e+=c[d]*c[d],.99<Math.abs(c[d])&&(f+=1);b.instant=Math.sqrt(e/c.length);b.slow=.95*b.slow+.05*b.instant;b.clip=f/c.length}}catch(b){}}
SoundMeter.prototype.connectToSource=function(a,b){console.log("SoundMeter connecting");try{a&&(this.mic=this.context.createMediaStreamSource(a),this.mic.connect(this.script),this.script.connect(this.context.destination),"undefined"!==typeof b&&b(null))}catch(c){console.error(c),"undefined"!==typeof b&&b(c)}};SoundMeter.prototype.stop=function(){console.log("SoundMeter stopping");this.mic.disconnect();this.script.disconnect()};aztExam=aztExam||{};
aztExam.monitorStudent=aztExam.monitor.extend({_hasVideoReviewPlaying:!1,_hasExtentCamera:!1,_firstUpload:!0,_queueUpload:null,_uploadIntv:9E3,_needUpdateRealtime:!1,w:void 0,ctor:function(){cc.log("init ver= "+this.version());this._super();window.addEventListener("resize",()=>{this.onresize()})},start:function(a){cc.log("start : "+this._isStarted);this._isStarted||(this._super(a),cc.log("start student: "+this._isStarted+":"+this.options.user.username+":"+this.options.user.userid+":"+this.options.user.studentid),
this.stream?(this.loop(),this.initConn()):(this.startCollection(),this.initUrlUploadPublic(()=>{cc.log("init url finish ");cc.log("url download "+this._urlDownload);cc.log("url upload offer "+this._urlOffer);cc.log("url upload curr "+this._urlCurr)})))},onresize:function(){this._running&&this.updatePreviewUI()},startCollection:function(){this.collectInfo(()=>{cc.log("on collection complete");this.isMobile()?(this._imageCaptureHeight=120,this._imageCaptureWidth=90):(this._imageCaptureWidth=142,this._imageCaptureHeight=
80);this.previewWidth=this.options.config&&this.options.config.previewWidth?parseInt(this.options.config.previewWidth):this._imageCaptureWidth;this.previewHeight=this.options.config&&this.options.config.previewHeight?parseInt(this.options.config.previewHeight):this._imageCaptureHeight;this.preview.style.width=this.previewWidth+"px";this.preview.style.height=this.previewHeight+"px";this.volumeMeter.height=this.previewHeight;var a=this.options.config;this.canvasPreview.width=this._imageCaptureWidth;
this.canvasPreview.height=this._imageCaptureHeight;this.canvasDraw.width=a.storeUpdateSize*this._imageCaptureWidth;this.canvasDraw.height=a.storeUpdateSize*this._imageCaptureHeight;this.canvasDraw.cols=a.storeUpdateSize;this.canvasDraw.rows=a.storeUpdateSize;this.canvasDraw.imageWidth=this._imageCaptureWidth;this.canvasDraw.imageHeight=this._imageCaptureHeight;this.canvasDrawCurr.width=a.currentUpdateSize*this._imageCaptureWidth;this.canvasDrawCurr.height=a.currentUpdateSize*this._imageCaptureHeight;
this.canvasDrawCurr.cols=a.currentUpdateSize;this.canvasDrawCurr.rows=a.currentUpdateSize;this.canvasDrawCurr.imageWidth=this._imageCaptureWidth;this.canvasDrawCurr.imageHeight=this._imageCaptureHeight;this._uploadIntv=a.currentUpdateSize*a.currentUpdateSize*1E3+1E3})},reset:function(){cc.log("reset monitor ");this.options&&this.options.roomid&&this.examLiveTeachers_student_unbsubscribe(this.options.roomid);this._super();this.conn&&(this.conn.stop(),this.conn=null);this._firstUpload=!0;this._hasVideoReviewPlaying=
this._hasExtentCamera=!1;this._queueUpload=[];this.preview.style.display="none"},stop:function(){this.reset()},appendPreview:function(){clearInterval(this.intvAppendPreview);this.intvAppendPreview=setInterval(()=>{null!=document.getElementById(this.options.element)&&(document.getElementById(this.options.element).appendChild(this.preview),this.preview.style.left="0px",this.isMobile()&&(this.preview.style.transform="scale(0.4)"),this.preview.style.display="block",setTimeout(()=>{this.stream&&this.videoReview.play()},
1E3),clearInterval(this.intvAppendPreview))},500)},initUI:function(){this.preview=this.findDom(document.createElement("div"));this.preview.style.overflow="hidden";this.preview.style.borderRadius="8px";this.preview.style.backgroundColor="gray";this.preview.style.position="fixed";this.preview.style.zIndex="9999999";this.preview.style.transformOrigin="100% 100%";this.preview.style.width=this._imageCaptureWidth+"px";this.preview.style.height=this._imageCaptureHeight+"px";this.preview.style.display="none";
this.preview.addTouch(a=>{});this.volumeMeter=document.createElement("canvas");this.volumeMeter.width=6;this.volumeMeter.height=this._imageCaptureHeight;this.volumeMeter.style.position="absolute";this.volumeMeter.style.border="none";this.ctxVolumeMeter=this.volumeMeter.getContext("2d");this.volumeMeter.style.right="0px";this.volumeMeter.style.zIndex="9999999";this.preview.appendChild(this.volumeMeter);document.body.appendChild(this.preview);this.videoReview=document.createElement("video");this.videoReview.muted=
!0;this.videoReview.playsInline=!0;this.videoReview.style.position="absolute";this.videoReview.style.top="0px";this.videoReview.style.left="0px";this.videoReview.onplay=()=>{this._hasVideoReviewPlaying=!0;this.updatePreviewUI()};this.videoReview.onresize=()=>{this.updatePreviewUI()};this.preview.appendChild(this.videoReview);this.previewWarning=this.findDom(document.createElement("div"));this.previewWarning.style.width="100%";this.previewWarning.style.height="100%";this.previewWarning.style.backgroundColor=
"red";this.previewWarning.style.opacity=.2;this.previewWarning.style.position="absolute";this.previewWarning.style.top="0px";this.previewWarning.style.left="0px";this.previewWarning.lastWarning=!1;this.previewWarning.style.numFound=-1;this.previewWarning.style.display="none";this.preview.appendChild(this.previewWarning);this.canvasPreview=document.createElement("canvas");this.canvasPreview.style.borderRadius="8px";this.ctxPreview=this.canvasPreview.getContext("2d");this.canvasDraw=document.createElement("canvas");
this.canvasDraw.numDraw=0;this.canvasDraw.timestamp=[];this.canvasDraw.warning=[];this.ctxDraw=this.canvasDraw.getContext("2d");this.canvasDrawCurr=document.createElement("canvas");this.canvasDrawCurr.numDraw=0;this.canvasDrawCurr.timestamp=[];this.canvasDrawCurr.warning={};this.canvasDrawCurr.isWarning=!1;this.ctxDrawCurr=this.canvasDrawCurr.getContext("2d");this.ctxDrawCurr.fontSize="18px Arial";this.ctxDrawCurr.fillStyle="red";this.divLog=document.createElement("div");this.divLog.style.position=
"fixed";this.divLog.style.width="100%";this.divLog.style.height="auto";this.divLog.style.bottom="0px";this.currDiv=document.createElement("div")},updatePreviewUI:function(){this._hasVideoReviewPlaying&&this._hasExtentCamera?cc.log("has extent camera"):this._hasVideoReviewPlaying?this.previewWidth/this.previewHeight>this.videoReview.videoWidth/this.videoReview.videoHeight?(this.videoReview.style.width="100%",this.videoReview.style.height="auto"):(this.videoReview.style.width="auto",this.videoReview.style.height=
"100%"):this._hasExtentCamera&&cc.log("has extent camera");this.isMobile()&&(this.preview.style.transform="scale(0.4)");this.options.element?(this.intvAppendPreviewCount=0,clearInterval(this.intvAppendPreview),this.intvAppendPreview=setInterval(()=>{var a=document.getElementById(this.options.element);this.intvAppendPreviewCount++;if(a||50<=this.intvAppendPreviewCount)a&&(this._running?(this.preview.style.top="auto",this.preview.style.left="auto",this.preview.style.bottom="10px",this.preview.style.right=
"10px",this.isMobile()&&(this.preview.style.bottom="60px",this.preview.style.right="5px"),this.preview.style.transformOrigin="100% 100%"):(this.preview.style.bottom="auto",this.preview.style.right="auto",this.preview.style.top=a.getBoundingClientRect().top+"px",this.preview.style.left=a.getBoundingClientRect().left+"px",this.isMobile()&&(this.preview.style.left=a.getBoundingClientRect().width/2+"px"),this.preview.style.transformOrigin="0% 0%"),this.preview.style.display="block"),clearInterval(this.intvAppendPreview)},
100)):this.preview.style.display="block"},gotStream:function(a,b,c){this._super(a,b,c);this.hasWebcamStream();this.hasMicrophoneStream()&&setTimeout(()=>{this.initSoundMeter()},1E3);this._running&&this.initConn();this._isGettingMediaUser=!1},handleError:function(a){var b=aztExam.MonitorStudent.getInstance();b._numGetMediaUser++;cc.log("navigator.MediaDevices.getUserMedia error: ",a.message,a.name,b._numGetMediaUser);b._isGettingMediaUser=!1;1==b._numGetMediaUser?b.getMediaUser(0,0,!0):(cc.log("show collection info"),
b._numGetMediaUser--,b.collectInfo(),b.initConn())},initFaceApi:function(){},loadFaceApi:async function(){cc.log("load tinyface");this.isInitFaceApi||(await faceapi.loadTinyFaceDetectorModel("https://azota889.github.io/storage_public/almo/weights"),cc.log("end load tinyface"),this.isInitFaceApi=!0)},detectFace:async function(a,b){if(this.isInitFaceApi){cc.log("start detect face");null==this.faceApiOption&&(this.faceApiOption=new faceapi.TinyFaceDetectorOptions({inputSize:224,scoreThreshold:.5}));
var c=await faceapi.detectAllFaces(0<=a?this.videoReview:this.canvasPreview,this.faceApiOption);0<a&&(c?this.faceEyesDetectResult(c.length,a,b):this.faceEyesDetectResult(0,a,b));cc.log("end detect face ")}},initEyeDetection:function(){this.w||("undefined"!==typeof Worker?("undefined"==typeof this.w&&(this.w=new Worker("/assets/js/worker.js?ver=1.6"),setInterval(()=>{this.w&&(this.hasWebcamStream()||this._hasExtentCamera)?this.w.postMessage({cmd:"processimage",obj:{isMobile:this.isMobile(),startTime:this.canvasDrawCurr.startTime,
index:this.canvasDrawCurr.numDraw,timestamp:this.canvasDrawCurr.startTime,imagedata:this.ctxPreview.getImageData(0,0,this.canvasPreview.width,this.canvasPreview.height)}}):this.detectFace(this.canvasDrawCurr.startTime,this.canvasDrawCurr.numDraw)},8E3)),this.w.onmessage=a=>{a=a.data;"opencvloaded"==a.cmd&&cc.log("opencv_loaded");"processimage"==a.cmd&&((new Date).getTime(),this.faceEyesDetectResult(0<a.obj.foundFace.length?a.obj.foundFace.length:0<a.obj.foundEyes.length?1:0,a.obj.startTime,a.obj.index))}):
(cc.log("browser not support wasm"),this.divLog.innerHTML="browser not support wasm"))},faceEyesDetectResult:function(a,b,c){0<=this.previewWarning.numFound&&(1<a?(this.previewWarning.style.display="none",this.previewWarning.style.backgroundColor="yellow"):0==a&&0==this.previewWarning.numFound?(this.previewWarning.style.display="none",this.previewWarning.style.backgroundColor="red"):this.previewWarning.style.display="none",(1<a||0==a&&0==this.previewWarning.numFound)&&b==this.canvasDrawCurr.startTime&&
(this.canvasDrawCurr.warning[c]=a,this.canvasDrawCurr.isWarning=!0));this.previewWarning.numFound=a},initSoundMeter:function(){if(0==this._streamType||2==this._streamType)try{window.AudioContext=window.AudioContext||window.webkitAudioContext,null==this.audioContext&&(this.audioContext=new AudioContext),null!=this.soundMeter&&this.soundMeter.isConnected&&this.soundMeter.stop(),this.soundMeter=new SoundMeter(this.audioContext),this.soundMeter.isConnected=!1,this.soundMeter.connectToSource(this.stream,
a=>{a||(this.volumeMeter.avg=-1,this.volumeMeter.totalPlus=0,this.volumeMeter.count=0,this.volumeMeter.minVal=1,this.volumeMeter.arrVal=[],this.volumeMeter.lastVal=1,this.soundMeter.isConnected=!0,setInterval(()=>{this.ctxVolumeMeter.fillStyle="#333333";this.ctxVolumeMeter.fillRect(0,0,this.volumeMeter.width,this.volumeMeter.height);var b=Number(this.soundMeter.instant.toFixed(5));0>this.volumeMeter.avg?10>this.volumeMeter.count?(this.volumeMeter.count++,this.volumeMeter.totalPlus+=b):(this.volumeMeter.avg=
this.volumeMeter.totalPlus/this.volumeMeter.count,this.volumeMeter.avg=5E-4<this.volumeMeter.avg?.001:1E-4,cc.log("volume avg "+this.volumeMeter.avg),this.deviceInfo.VolumeAvg=this.volumeMeter.avg):(b=.4*.1*b/this.volumeMeter.avg,b=.2>b?.2:b,b=.8<b?.8:b,this.ctxVolumeMeter.fillStyle=.6<b?"#FF0000":"#0af50a",this.ctxVolumeMeter.fillRect(0,(1-b)*this.volumeMeter.height,this.volumeMeter.width,this.volumeMeter.height),this.canvasPreview.volumeMeterVal=b)},400))})}catch(a){}},update:function(a){a=(new Date).getTime();
cc.log("update ");this._lastTimeDraw?a>this._lastTimeDraw&&1E3<a-this._lastTimeDraw&&(this.processDraw(),this._lastTimeDraw=a):this._lastTimeDraw=a;this._running&&setTimeout(()=>{window.requestAnimationFrame(b=>{this.update(b)})},1200)},processUpload:function(a){setTimeout(()=>{if(0<this._queueUpload.length){var b=this._queueUpload.shift();this.uploadPublicContent(this._urlCurr,"curr.txt",b,c=>{cc.log("upload curr ok "+c);this._firstUpload&&(this.options.firebaseApp&&this.examLiveTeachers_student_subscribe(this.options.roomid,
d=>{cc.log("student get teacher control "+JSON.stringify(d));cc.log("myId "+this.options.user.userid);var e=!1;try{if(1==d.success){var f=d.data;for(d=0;d<f.length;d++){var h=f[d].arr.split(",");for(d=0;d<h.length;d++)h[d].toString()==this.options.user.userid.toString()&&(e=!0)}}}catch(m){cc.log("exception receive teacher control")}this.changeUpdateDraw(e)}),this._firstUpload=!1)})}},a)},changeUpdateDraw:function(a){cc.log("changeUpdateDraw "+a);var b=this.options.config;b.currentUpdateSize=a?2:5;
this.canvasDrawCurr.width=b.currentUpdateSize*this._imageCaptureWidth;this.canvasDrawCurr.height=b.currentUpdateSize*this._imageCaptureHeight;this.canvasDrawCurr.cols=b.currentUpdateSize;this.canvasDrawCurr.rows=b.currentUpdateSize;this.canvasDrawCurr.imageWidth=this._imageCaptureWidth;this.canvasDrawCurr.imageHeight=this._imageCaptureHeight;this.ctxDrawCurr.clearRect(0,0,this.canvasDrawCurr.width,this.canvasDrawCurr.height);this.canvasDrawCurr.numDraw=0;this.canvasDrawCurr.timestamp=[];this.canvasDrawCurr.warning=
{};this.canvasDrawCurr.isWarning=!1;this._uploadIntv=b.currentUpdateSize*b.currentUpdateSize*1E3+1E3},processDraw:function(){if(this._running){this.ctxPreview.fillStyle="black";this.ctxPreview.fillRect(0,0,this.canvasPreview.width,this.canvasPreview.height);var a=(new Date).getTime();if(this._hasVideoReviewPlaying&&this._hasExtentCamera)cc.log("has extent camera");else if(this._hasVideoReviewPlaying){var b=this._imageCaptureHeight/this.videoHeight*this.videoHeight;this.ctxPreview.drawImage(this.videoReview,
0,0,this.canvasPreview.width,this.canvasPreview.height);var c=(new Date(a)).toLocaleString();this.ctxPreview.fillStyle="red";this.ctxPreview.font="10px Arial";this.ctxPreview.fillText(c,0,b-10);this.canvasPreview.volumeMeterVal&&(this.ctxPreview.fillStyle="#333333",b=this.volumeMeter.width-3,this.ctxPreview.fillRect(this.canvasPreview.width-b,0,b,this.canvasPreview.height),c=this.canvasPreview.volumeMeterVal,this.ctxPreview.fillStyle=.6<c?"#e11d1d":"#41b545",this.ctxPreview.fillRect(this.canvasPreview.width-
b,(1-c)*this.canvasPreview.height,b,this.canvasPreview.height))}else this._hasExtentCamera&&cc.log("has extent camera");b=this.options.config;c=b.currentUpdateSize;this.ctxDrawCurr.drawImage(this.canvasPreview,0,0,this.canvasPreview.width,this.canvasPreview.height,Math.floor(this.canvasDrawCurr.numDraw%c)*this.canvasDrawCurr.imageWidth,Math.floor(this.canvasDrawCurr.numDraw/c)*this.canvasDrawCurr.imageHeight,this.canvasDrawCurr.imageWidth,this.canvasDrawCurr.imageHeight);0==this.canvasDrawCurr.numDraw&&
(this.canvasDrawCurr.startTime=a);this.canvasDrawCurr.numDraw++;this.canvasDrawCurr.timestamp.push(a);this.canvasDrawCurr.numDraw==c*c&&(cc.log("upload "+this.canvasDrawCurr.numDraw+":"+b.currentUpdateSize+":"+b.storeUpdateSize),this._queueUpload.push(this.toStrCanvasDraw(this.canvasDrawCurr)),this._firstUpload?this.processUpload(10):this.processUpload(1E3),this.ctxDrawCurr.clearRect(0,0,this.canvasDrawCurr.width,this.canvasDrawCurr.height),this.canvasDrawCurr.numDraw=0,this.canvasDrawCurr.timestamp=
[],this.canvasDrawCurr.warning={},this.canvasDrawCurr.isWarning=!1)}},toStrCanvasDraw:function(a){(new Date).getTime();var b=a.toDataURL("image/jpeg",15),c=(new Date).getTime();a={v:this.version(),c:a.cols,r:a.rows,numImage:a.numDraw,w:a.imageWidth,h:a.imageHeight,deviceInfo:this.deviceInfo,startTime:a.startTime,time:c,timeStr:(new Date).toUTCString(),timestamp:this.canvasDrawCurr.timestamp,warning:this.canvasDrawCurr.warning,isWarning:this.canvasDrawCurr.isWarning};a=JSON.stringify(a);c=a.length;
for(var d=c.toString(),e=10;e>c.toString().length;e--)d="0"+d;return b+a+d},initConn:function(){cc.log("initConn");null==this.conn&&this._running&&(this.conn=new aztExam.RTCConnection(this),this.conn.start(this.options.user.userid,"","offer"))},uploadCurr:function(){},initUrlUploadPublic:function(a){this.getPublicUpload(this.options.roomid,this.options.user.userid,"curr.txt",1,0,(b,c)=>{b&&""!=b?(this._urlCurr=b,b=c.indexOf(this.options.roomid),0<=b&&(this._urlDownload=c.substr(0,b)),this.getPublicUpload(this.options.roomid,
this.options.user.userid,"offer.txt",1,0,d=>{d&&""!=d?(this._urlOffer=d,a&&a()):setTimeout(()=>{this.initUrlUploadPublic(a)},8E3)})):setTimeout(()=>{this.initUrlUploadPublic(a)},8E3)})},startFirestoreEvent:function(){},checkUserLastLogin:function(a){this.getListFile(this.options.roomid,this.options.user.userid,b=>{cc.log("on getListFile "+JSON.stringify(b));if(b){for(var c=null,d=!0,e=0;e<b.length;e++)0<=b[e].path.indexOf("private")&&0<=b[e].path.indexOf(".lgin_")&&(c?(new Date(c.time)).getTime()<
(new Date(b[e].time)).getTime()&&(c=b[e]):c=b[e],d=!1);this.firstTimeLogin=d}a(!0)})},getHashCodeBrowser:function(a){a=a?cc.randomUUID():this.getLocalStorage("_bid");this.setLocalStorage("_bid",a);a=window.btoa(JSON.stringify({info:navigator.userAgent,uid:a}));return{hashCode:cc.md5(a),encoded:a}},role:function(){return"student"},version:function(){return"42.2"}});
aztExam.MonitorStudent=function(){var a;return{getInstance:function(b){null==a&&(a=new aztExam.monitorStudent(b));return a},releaseInst:function(){a=null},inst:function(){return this.getInstance()}}}();aztExam=aztExam||{};
aztExam.monitorTeacher=aztExam.monitor.extend({_imageCaptureWidth:200,_imageCaptureHeight:150,mainViewWidth:1280,mainViewHeight:720,historyWidth:440,userMediaWidth:840,userMediaHeight:472,arrImageIntv:null,isFirstLoad:!0,state:-1,arrUserConn:null,_mouseX:-1,_mouseY:-1,_mouseIntv:-1,_timeOnlineIntv:5E4,_maxUserUpdate:25,_indexStartUpdate:0,_indexEndUpdate:-1,_indexStartShow:0,_numShow:25,currIndexGet:-1,countLoop:0,_roomControlInfo:null,_objUserHasJoined:null,_objUserList:null,_arrUserUpdate:null,
ctor:function(){cc.log("init ver= "+this.version());this._super();window.addEventListener("resize",()=>{this.onresize()});cc.insertCss(".loader {border: 6px solid #f3f3f3; /* Light grey */border-top: 6px solid #3498db; /* Blue */border-radius: 50%;width: 50px;height: 50px;animation: spin 2s linear infinite;}@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}");document.addEventListener("fullscreenchange",()=>{this.onFullscreenChange()},!1);document.addEventListener("webkitfullscreenchange",
()=>{this.onFullscreenChange()},!1);document.addEventListener("mozfullscreenchange",()=>{this.onFullscreenChange()},!1);this.onresize()},start:function(a){this._super(a);this._objUserList={};for(a=0;a<this.options.userlistStart.length;a++){var b={};b.userid=this.options.userlistStart[a].userid;b.studentid=this.options.userlistStart[a].studentid;b.username=cc.isEmpty(this.options.userlistStart[a].studentname)?this.options.userlistStart[a].username:this.options.userlistStart[a].studentname;this.options.userlist[a]=
b;this._objUserList[this.options.userlist[a].userid]=this.options.userlist[a]}this._running=!0;this.collectInfo(()=>{0<=this.deviceInfo.osName.toLowerCase().indexOf("window")||0<=this.deviceInfo.osName.toLowerCase().indexOf("mac")?(this._imageCaptureWidth=360,this._imageCaptureHeight=202):(this._imageCaptureHeight=202,this._imageCaptureWidth=151);this.initUrlUploadPublic(()=>{this.initShowUser();this.loop()});setTimeout(()=>{this.mainHeader.style.display="none";this.onresize()},3E3)})},stop:function(){this._super()},
reset:function(){this._super();this.currIndexGet=-1;this.countLoop=this._indexEndUpdate=this._indexStartUpdate=this._indexStartShow=0;this.isFirstLoad=!0;this.setState(0);this.arrUserConn=[];this._objUserHasJoined={};this._objUserList={};this._arrUserUpdate=[];this._roomControlInfo=null},startFirestoreEvent:function(){this.firestoreReadDocument(this._keyDbRoomControlInfo)},initUrlUploadPublic:function(a){this.showLoading();this.getTokenForLive(this.options.roomid,b=>{b&&""!=b?(this.options.user.token=
b,this.getPublicUpload(this.options.roomid,this.options.user.userid,"offer.txt",1,0,(c,d)=>{if(c&&""!=c){var e=d.indexOf(this.options.roomid);0<=e?(this._urlDownload=d.substr(0,e),this.hideLoading(),a&&a()):alert("L\u1ed7i l\u1ea5y d\u1eef li\u1ec7u upload ! "+c+":"+this.options.roomid)}else setTimeout(()=>{this.initUrlUploadPublic(a)},8E3)})):setTimeout(()=>{this.initUrlUploadPublic(a)},8E3)})},onFullscreenChange:function(){this.btFullscreen.innerHTML=document.fullscreenElement||document.mozFullScreenElement||
document.webkitFullscreenElement?aztExam.svg.iconExitFullscreen:aztExam.svg.iconFullscreen},toggleFullScreen:function(){var a=this.app;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&
a.msRequestFullscreen()},initUI:function(){this.app=document.createElement("div");this.app.style.width="100%";this.app.style.height="100%";this.app.style.fontFamily="sans-serif";this.app.style.fontSize="20px";this.app.style.overflow="hidden";this.app.style.backgroundColor="#222222";this.mainView=this.findDom(document.createElement("div"));this.mainView.css("width","100%");this.mainView.css("height","100%");this.mainView.css("transform-origin","0% 0%");this.mainView.css("position","absolute");this.mainView.classList.add("azt_monitor_mainview");
this.mainView.css("background-color","#4c4b4b");this.mainView.css("overflow","hidden");this.mainView.css("display","none");this.app.appendChild(this.mainView);this.userView=this.findDom(document.createElement("div"));this.userView.css("width","100%");this.userView.css("height","100%");this.userView.css("transform-origin","0% 0%");this.userView.css("position","absolute");this.userView.css("overflow","hidden");this.userView.classList.add("azt_monitor_userview");this.userView.css("background-color",
"#4c4b4b");this.userView.css("display","none");this.app.appendChild(this.userView);this.divLog=document.createElement("div");this.divLog.style.position="fixed";this.divLog.style.width="100%";this.divLog.style.height="auto";this.divLog.style.bottom="0px";this.loadingDiv=document.createElement("div");this.loadingDiv.style.width="100%";this.loadingDiv.style.height="100%";this.loadingDiv.style.backgroundColor="gray";this.loadingDiv.style.opacity=.5;this.loadingDiv.style.display="none";this.loadingDiv.style.justifyContent=
"center";this.loadingDiv.style.alignItems="center";this.loadingDiv.style.position="absolute";this.loadingDiv.style.zIndex="9999999999";this.loadingDiv.innerHTML="<div class='loader'></div>";document.body.appendChild(this.loadingDiv);this.initMainView();this.initUserView();this.initUserHistory();this.setState(0)},onresize:function(){var a=window.innerHeight-52;var b=window.innerWidth-96;if(!(0>=a||0>=b)){var c=this.mainViewWidth/this.mainViewHeight<b/a?a/this.mainViewHeight:b/this.mainViewWidth;a=
(a-this.mainViewHeight*c)/2;b=48+(b-this.mainViewWidth*c)/2;this.classMedia.css("transform","scale("+c+")");this.classMedia.css("top",a+"px");this.classMedia.css("left",b+"px");this.btBack.style.top=(window.innerHeight-100)/2+"px";this.btNext.style.left=window.innerWidth-48+"px";this.btNext.style.top=(window.innerHeight-100)/2+"px";this.userHeader.css("width",window.innerWidth-this.historyWidth+"px");this.myMedia.css("width",window.innerWidth-this.historyWidth+"px");this.app.style.height=window.innerHeight+
"px";this.userMediaWidth=window.innerWidth-this.historyWidth-2;this.userMediaHeight=window.innerHeight-60;this.userMedia.css("width",this.userMediaWidth+"px");this.userMedia.css("height",this.userMediaHeight+"px");this.userMedia.css("top","65px");this.listUser.style.height=window.innerHeight-120+"px";this.resizeUserMedia()}},initMainView:function(){this.mainHeader=this.findDom(document.createElement("div"));this.mainHeader.css("width","100%");this.mainHeader.css("height","60px");this.mainHeader.css("border-bottom",
"1px solid black");this.mainHeader.css("position","fixed");this.mainHeader.css("display","none");this.mainHeader.css("top","0px");this.mainHeader.css("background-color","#333434");this.mainView.appendChild(this.mainHeader);this.btViewHistory=this.createButton(180,36,"TH\u00d4NG TIN C\u00c1 NH\u00c2N","#1A84E3",14);this.btViewHistory.css("position","absolute");this.btViewHistory.css("top","12px");this.btViewHistory.css("right","180px");this.btViewHistory.css("cursor","pointer");this.btViewHistory.addTouch(b=>
{this.removeAllUserMedia();this.showListUser();this.setState(1)});this.mainHeader.appendChild(this.btViewHistory);this.btExit=this.createButton(80,36,"\u0110\u00d3NG","#1A84E3",14);this.btExit.css("position","absolute");this.btExit.css("top","12px");this.btExit.css("left","12px");this.btExit.css("cursor","pointer");this.btExit.addTouch(b=>{window.parent.aztExam.removeMonitorTeacher&&window.parent.aztExam.removeMonitorTeacher()});this.mainHeader.appendChild(this.btExit);this.mainBottomMenu=this.findDom(document.createElement("div"));
this.mainBottomMenu.style.width="100%";this.mainBottomMenu.style.height="50px";this.mainBottomMenu.css("border-top","1px solid black");this.mainBottomMenu.css("position","fixed");this.mainBottomMenu.css("bottom","0px");this.mainBottomMenu.css("background-color","#222222");this.mainView.appendChild(this.mainBottomMenu);this.classMedia=this.findDom(document.createElement("div"));this.classMedia.css("width",this.mainViewWidth+"px");this.classMedia.css("height",this.mainViewHeight+"px");this.classMedia.css("overflow",
"hidden");this.classMedia.css("transform-origin","0% 0%");this.classMedia.css("position","absolute");this.classMedia.classList.add("azt_monitor_mainview");this.classMedia.css("background-color","#4c4b4b");this.mainView.appendChild(this.classMedia);this.btClose=this.findDom(document.createElement("div"));this.btClose.css("width","80px");this.btClose.css("height","36px");this.btClose.css("position","absolute");this.btClose.css("right","10px");this.btClose.css("bottom","7px");this.btClose.css("color",
"red");this.btClose.css("background","#333434");this.btClose.css("line-height","36px");this.btClose.css("cursor","pointer");this.btClose.css("text-align","center");this.btClose.innerHTML="\u0110\u00d3NG";this.btClose.css("font-size","14px");this.btClose.addTouch(b=>{window.parent.aztExam.removeMonitorTeacher&&window.parent.aztExam.removeMonitorTeacher()});this.mainView.appendChild(this.btClose);this.btClassInfo=this.findDom(document.createElement("div"));this.btClassInfo.css("width","190px");this.btClassInfo.css("height",
"36px");this.btClassInfo.css("position","absolute");this.btClassInfo.css("left","10px");this.btClassInfo.css("bottom","7px");this.btClassInfo.css("color","white");this.btClassInfo.css("background","#333434");this.btClassInfo.css("line-height","36px");this.btClassInfo.css("cursor","pointer");this.btClassInfo.css("font-size","12px");this.mainView.appendChild(this.btClassInfo);this.txtClassInfo=document.createElement("div");this.txtClassInfo.style.width="150px";this.txtClassInfo.style.lineHeight="36px";
this.txtClassInfo.style.marginLeft="40px";this.btClassInfo.appendChild(this.txtClassInfo);var a=document.createElement("div");a.innerHTML=aztExam.svg.iconGroup;a.style.position="absolute";a.style.top="4px";a.style.left="8px";this.btClassInfo.appendChild(a);this.btClassInfo.addTouch(b=>{this.removeAllUserMedia();this.showListUser();this.setState(1)});this.btBack=this.findDom(document.createElement("div"));this.btBack.style.width="48px";this.btBack.style.height="auto";this.btBack.style.textAlign="center";
this.btBack.style.position="absolute";this.btBack.style.left="0px";this.btBack.style.color="gray";this.btBack.style.fontSize="14px";this.btBack.style.top=(window.innerHeight-100)/2+"px";this.btBack.style.cursor="pointer";this.btBack.style.display="none";this.mainView.appendChild(this.btBack);a=document.createElement("div");a.innerHTML=aztExam.svg.iconLeft;a.style.fill="gray";this.btBack.appendChild(a);this.infoBack=document.createElement("div");this.infoBack.style.width="100%";this.infoBack.style.marginTop=
"-10px";this.btBack.appendChild(this.infoBack);this.btBack.addTouch(b=>{this.backShowUser()});this.btNext=this.findDom(document.createElement("div"));this.btNext.style.width="48px";this.btNext.style.height="auto";this.btNext.style.textAlign="center";this.btNext.style.position="absolute";this.btNext.style.left=window.innerWidth-58+"px";this.btNext.style.top=(window.innerHeight-100)/2+"px";this.btNext.style.color="gray";this.btNext.style.fontSize="14px";this.btNext.style.cursor="pointer";this.btNext.style.display=
"none";this.mainView.appendChild(this.btNext);a=document.createElement("div");a.innerHTML=aztExam.svg.iconLeft;a.style.fill="gray";a.style.transform="scale(-1,1)";this.btNext.appendChild(a);this.infoNext=document.createElement("div");this.infoNext.style.width="100%";this.infoNext.style.marginTop="-10px";this.btNext.appendChild(this.infoNext);this.btNext.addTouch(b=>{this.nextShowUser()});this.btFullscreen=this.findDom(document.createElement("div"));this.btFullscreen.css("cursor","pointer");this.btFullscreen.css("position",
"absolute");this.btFullscreen.css("top","5px");this.btFullscreen.css("right","5px");this.btFullscreen.css("transform","scale(0.6,0.6)");this.btFullscreen.innerHTML=aztExam.svg.iconFullscreen;this.btFullscreen.addTouch(b=>{this.toggleFullScreen()});this.mainView.appendChild(this.btFullscreen)},initUserView:function(){this.userMedia=this.findDom(document.createElement("div"));this.userMedia.css("width",this.userMediaWidth+"px");this.userMedia.css("height",this.userMediaHeight+"px");this.userMedia.css("transform-origin",
"0% 0%");this.userMedia.css("background-color","#222222");this.userMedia.css("position","absolute");this.userMedia.css("overflow","hidden");this.userView.appendChild(this.userMedia);this.history=this.findDom(document.createElement("div"));this.history.css("width",this.historyWidth+"px");this.history.css("height","100%");this.history.css("background-color","white");this.history.css("overflow-y","hidden");this.history.css("overflow-x","hidden");this.history.css("position","absolute");this.history.css("right",
"0px");this.history.css("display","block");this.userView.appendChild(this.history);this.listUserView=this.findDom(document.createElement("div"));this.listUserView.css("width",this.historyWidth+"px");this.listUserView.css("height","100%");this.listUserView.css("overflow","hidden");this.listUserView.css("background-color","white");this.listUserView.css("position","absolute");this.listUserView.css("right","0px");this.listUserView.css("display","none");this.userView.appendChild(this.listUserView);this.userHeader=
this.findDom(document.createElement("div"));this.userHeader.css("width",window.innerWidth-this.historyWidth+"px");this.userHeader.css("height","60px");this.userHeader.css("position","absolute");this.userHeader.css("top","0px");this.userHeader.css("left","0px");this.userHeader.css("background-color","#333434");this.userView.appendChild(this.userHeader);this.btUserViewDone=this.createButton(220,36,"M\u00c0N H\u00ccNH THEO D\u00d5I","#1A84E3",14);this.btUserViewDone.css("position","absolute");this.btUserViewDone.css("top",
"12px");this.btUserViewDone.css("left","12px");this.btUserViewDone.css("cursor","pointer");this.btUserViewDone.addTouch(d=>{this.removeAllUserMedia();this.setState(0)});this.userHeader.appendChild(this.btUserViewDone);this.myMedia=this.findDom(document.createElement("div"));this.myMedia.css("width",window.innerWidth-this.historyWidth+"px");this.myMedia.css("height","80px");this.myMedia.css("position","absolute");this.myMedia.css("bottom","0px");this.myMedia.css("left","0px");this.myMedia.css("display",
"flex");this.myMedia.css("flex-direction","row");this.myMedia.css("align-items","center");this.myMedia.css("justify-content","end");this.myMedia.css("background-color","#333434");this.myMedia.css("display","none");this.userView.appendChild(this.myMedia);this.videoReview=this.findDom(document.createElement("video"));this.videoReview.muted=!0;this.videoReview.playsInline=!0;this.videoReview.height=80;this.videoReview.onplay=()=>{this._hasVideoReviewPlaying=!0;this.videoReview.height=80};this.btMyMedia=
this.findDom(document.createElement("div"));this.btMyMedia.css("width","35px");this.btMyMedia.css("height",80);this.btMyMedia.css("margin-left","10px");this.btMyMedia.css("margin-right","6px");this.myMedia.appendChild(this.videoReview);this.myMedia.appendChild(this.btMyMedia);this.btMyCameraOff=this.findDom(document.createElement("div"));this.btMyCameraOff.innerHTML=aztExam.svg.iconCameraOff;this.btMyCameraOff.css("width","30px");this.btMyCameraOff.css("height","30px");this.btMyCameraOff.css("fill",
"#cd1f1f");this.btMyCameraOff.css("color","#cd1f1f");this.btMyCameraOff.css("display","none");this.btMyCameraOff.css("margin-top","5px");this.btMyCameraOff.css("cursor","pointer");this.btMyMedia.appendChild(this.btMyCameraOff);this.btMyCamera=this.findDom(document.createElement("div"));this.btMyCamera.innerHTML=aztExam.svg.iconCamera;this.btMyCamera.css("width","30px");this.btMyCamera.css("height","30px");this.btMyCamera.css("fill","#dfd9d9");this.btMyCamera.css("color","#dfd9d9");this.btMyCamera.css("display",
"block");this.btMyCamera.css("margin-top","5px");this.btMyCamera.css("cursor","pointer");this.btMyMedia.appendChild(this.btMyCamera);this.btMyMicOff=this.findDom(document.createElement("div"));this.btMyMicOff.innerHTML=aztExam.svg.iconMicOff;this.btMyMicOff.css("width","25px");this.btMyMicOff.css("height","25px");this.btMyMicOff.css("fill","#cd1f1f");this.btMyMicOff.css("display","none");this.btMyMicOff.css("margin-top","10px");this.btMyMicOff.css("cursor","pointer");this.btMyMedia.appendChild(this.btMyMicOff);
this.btMyMic=this.findDom(document.createElement("div"));this.btMyMic.innerHTML=aztExam.svg.iconMic;this.btMyMic.css("width","25px");this.btMyMic.css("height","25px");this.btMyMic.css("fill","#dfd9d9");this.btMyMic.css("display","block");this.btMyMic.css("cursor","pointer");this.btMyMic.css("margin-top","10px");this.btMyMedia.appendChild(this.btMyMic);var a=document.createElement("div");a.style.width="100%";a.style.height="40px";a.style.padding="10px";a.style.borderBottom="1px solid #CCCCCC";a.style.marginBottom=
"20px";this.listUserView.appendChild(a);var b=this.createButton(130,36,"TH\u00d4NG TIN","#1A84E3",14);b.style.float="left";b.style.marginTop="4px";b.addTouch(d=>{this.showUserHistory()});a.appendChild(b);var c=document.createElement("div");c.style.width="59%";c.style.height="21px";c.style.borderRadius="8px";c.style.borderColor="#CCCCCC";c.style.backgroundColor="#edeaea";c.style.color="#afaaaa";c.style.padding="10px";c.style.fontSize="17px";c.style.marginLeft="8px";c.style.float="left";c.innerHTML=
"T\u00ecm theo t\u00ean ";c.setAttribute("contenteditable",!0);c.setAttribute("contentsearch","");c.addEventListener("input",()=>{cc.log("on txt search change "+c.innerHTML);c.setAttribute("contentsearch",c.innerHTML);this.searchUserListItem(c.innerHTML)});c.addEventListener("focus",()=>{""==c.getAttribute("contentsearch")&&(c.innerHTML="",this.searchUserListItem(c.innerHTML))});c.addEventListener("blur",()=>{""==c.innerHTML&&(this.searchUserListItem(""),c.innerHTML="T\u00ecm theo t\u00ean ")});a.appendChild(c);
this.txtListUserInfo=document.createElement("div");this.txtListUserInfo.style.width="50%";this.txtListUserInfo.style.height="20px";this.txtListUserInfo.innerHTML="";this.txtListUserInfo.style.fontFamily="sans-serif";this.txtListUserInfo.style.fontSize="16px";this.txtListUserInfo.style.paddingLeft="15px";this.listUserView.appendChild(this.txtListUserInfo);this.listUser=document.createElement("div");this.listUser.style.width="100%";this.listUser.style.overflowX="hidden";this.listUser.style.overflowY=
"scroll";this.listUser.style.height=window.innerHeight-80+"px";this.listUserView.appendChild(this.listUser);a=document.createElement("div");a.style.width="100%";a.style.height="40px";a.style.padding="10px";a.style.borderBottom="1px solid #CCCCCC";a.style.marginBottom="10px";a.style.display="flex";a.style.flexDirection="row";a.style.justifyContent="start";a.style.alignItems="center";this.history.appendChild(a);b=this.createButton(130,36,"DANH S\u00c1CH","#1A84E3",14);b.style.marginTop="4px";b.addTouch(d=>
{this.showListUser()});a.appendChild(b);b=document.createElement("div");b.style.fontSize="16px";b.innerHTML=aztExam.lang.lbTitleHistory;b.style.fontWeight="bold";b.style.marginTop="4px";b.style.marginLeft="25px";a.appendChild(b)},setState(a){this.state!=a&&(this.state=a,this.mainView.css("display","none"),this.userView.css("display","none"),0==this.state&&this.mainView.css("display","block"),1==this.state&&this.userView.css("display","block"))},showLoading(){this.loadingDiv.style.display="flex";this.loadingDiv.style.justifyContent=
"center";this.loadingDiv.style.alignContent="center"},hideLoading(){this.loadingDiv.style.display="none"},update:function(a){a=(new Date).getTime();this._lastTimeIntv?a>this._lastTimeIntv&&1E3<a-this._lastTimeIntv&&(this.processImageIntv(),this._lastTimeIntv=a):this._lastTimeIntv=a;this._lastTimeGet?a>this._lastTimeGet&&450<a-this._lastTimeGet&&(this.getCurrNew(),this._lastTimeGet=a):this._lastTimeGet=a;this._lastTimeGetOffline?a>this._lastTimeGetOffline&&2E3<a-this._lastTimeGetOffline&&(this.getCurrOffline(),
this._lastTimeGetOffline=a):this._lastTimeGetOffline=a;this._running&&window.requestAnimationFrame(b=>{this.update(b)})},getCurrNew:function(){this.isFirstLoad&&(this.currIndexGet++,this.currIndexGet>=this._arrUserUpdate.length?(this.currIndexGet=-1,this.isFirstLoad=!1):(cc.log("load index "+this.currIndexGet),this.getCurrUser(this._arrUserUpdate[this.currIndexGet])));if(8>this.countLoop){for(var a=null,b=Number.MAX_VALUE,c=0;c<this._arrUserUpdate.length;c++){var d=(new Date).getTime(),e=Number(this._arrUserUpdate[c].lastimeUpdate);
if(this._arrUserUpdate[c].info){var f=this._arrUserUpdate[c].info.startTime;4E3<d-e&&e<b&&d-f<this.options.duration&&(b=e,a=this._arrUserUpdate[c])}}a?(this.countLoop++,cc.log("getUserOnline : "+a.userid),this.getCurrUser(a)):0<this.countLoop&&this.countLoop--}else 8<=this.countLoop&&17>this.countLoop?(this.countLoop++,cc.log("rest")):17<=this.countLoop&&(this.countLoop=0)},getCurrOffline:function(){var a=null,b=Number.MAX_VALUE;(new Date).getTime();for(var c=0;c<this._arrUserUpdate.length;c++){var d=
(new Date).getTime();if(this._arrUserUpdate[c].lastimeUpdate){var e=Number(this._arrUserUpdate[c].lastimeUpdate);(null==this._arrUserUpdate[c].info||d-this._arrUserUpdate[c].info.startTime>this.options.duration)&&4E3<d-e&&e<b&&(b=e,a=this._arrUserUpdate[c])}}a&&(cc.log("getUserOffline : "+a.userid),this.getCurrUser(a))},getCurr:function(){this.isFirstLoad?(this.currIndexGet++,this.currIndexGet>=this._indexEndUpdate?(this.isFirstLoad=!1,this.currIndexGet=-9):(cc.log("load index "+this.currIndexGet),
this.getCurrUser(this.options.userlist[this.currIndexGet]))):-1>this.currIndexGet?this.currIndexGet++:(this.countLoop++,9>this.countLoop?this.currIndexGet>=this._indexEndUpdate?this.currIndexGet=-1:(this.currIndexGet++,cc.log("load index "+this.currIndexGet),this.getCurrUser(this.options.userlist[this.currIndexGet])):16<=this.countLoop&&(this.countLoop=-1))},getCurrUser:function(a){if(a&&a.userid){var b=(new Date).getTime();a.lastimeUpdate=b;if(!(0>=a.userid)){var c=new XMLHttpRequest;c.user=a;c.onreadystatechange=
()=>{if(4==c.readyState)if(200==c.status)this.onGetCurrUser(!0,c.responseText,c.user);else this.onGetCurrUser(!1,null,c.user)};c.open("GET",this._urlDownload+this.options.roomid+"/"+a.userid+"/public/curr.txt?t="+(new Date).getTime());c.send()}}},onGetCurrUser:function(a,b,c){if(a){var d=parseInt(b.substr(b.length-10,10));a=b.substr(0,b.length-(10+d));b=b.substr(b.length-(10+d),d);b=JSON.parse(b);c.info=b;d=(new Date).getTime();c.info.status=d-b.startTime>this._timeOnlineIntv?"join":"online";c.imgstr=
a;c.mainViewItem&&this.bindMainviewItem(c);c.userListItem&&this.bindUserListItem(c);this.bindUserHistory(c)}},addUser:function(a){if(0<a.length){for(var b=-1,c=0;c<a.length;c++)if(a[c].userid&&a[c].username)if(null==this._objUserList[a[c].userid]){var d=JSON.parse(JSON.stringify(a[c]));this.options.userlist.push(d);-1==b&&(b=this.options.userlist.length-1);this._objUserList[a[c].userid]=d;this.getCurrUser(d)}else a[c].t&&(this._objUserList[a[c]].startTime=a[c].t),this.getCurrUser(this._objUserList[a[c]]);
-1<b&&this._indexStartShow+this._numShow>b&&this.showUser()}},backShowUser:function(){if(this._indexStartShow>=this._numShow){this._indexStartUpdate=this._indexStartShow-=this._numShow;this._indexEndUpdate=this._indexStartUpdate+this._maxUserUpdate<this.options.userlist.length?this._indexStartUpdate+this._maxUserUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;cc.log("backShowUser :"+this._indexStartShow+":"+this._indexStartUpdate+":"+this._indexEndUpdate);
this._arrUserUpdate=[];for(var a=this._indexStartUpdate;a<this._indexEndUpdate;a++)this._arrUserUpdate.push(this.options.userlist[a]);this.showUser();this.sendMessControlToStudent();this.showLoading();setTimeout(()=>{this.hideLoading()},1E3)}},nextShowUser:function(){this._indexStartUpdate=this._indexStartShow=this._indexStartShow+this._numShow<this.options.userlist.length?this._indexStartShow+this._numShow:0;this._indexEndUpdate=this._indexStartUpdate+this._maxUserUpdate<this.options.userlist.length?
this._indexStartUpdate+this._maxUserUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;this._arrUserUpdate=[];for(var a=this._indexStartUpdate;a<this._indexEndUpdate;a++)this._arrUserUpdate.push(this.options.userlist[a]);cc.log("nextShowUser :"+this._indexStartShow+":"+this._indexStartUpdate+":"+this._indexEndUpdate);this.showUser();this.sendMessControlToStudent();this.showLoading();setTimeout(()=>{this.hideLoading()},1E3)},initShowUser:function(){var a=
-1,b=this.getLocalStorage("aztTeacherControl");if(!cc.isEmpty(b))try{a=JSON.parse(b).idx}catch(c){}cc.log("localStartShow "+a);this._indexStartUpdate=this._indexStartShow=0<=a?a:0;this._indexEndUpdate=this.options.userlist.length>this._maxUserUpdate+this._indexStartUpdate?this._maxUserUpdate+this._indexStartUpdate:this.options.userlist.length;this.isFirstLoad=!0;this.currIndexGet=-1;this.countLoop=0;cc.log("list user : "+JSON.stringify(this.options.userlist));cc.log("initShowUser "+this._indexStartShow+
":"+this._indexStartUpdate+":"+this._indexEndUpdate);this._arrUserUpdate=[];for(b=this._indexStartUpdate;b<this._indexEndUpdate;b++)this._arrUserUpdate.push(this.options.userlist[b]);0>a&&this.sendMessControlToStudent();this.showUser()},sendMessControlToStudent:function(){for(var a=[],b=0;b<this._arrUserUpdate.length;b++)a.push(this._arrUserUpdate[b].userid);var c={idx:this._indexStartShow,cmd:"neba",arr:a.toString()};this.examLiveTeachers_teacher_saveChange(this.options.roomid,c,d=>{cc.log("write control response :"+
JSON.stringify(d));this.setLocalStorage("aztTeacherControl",JSON.stringify(c))})},showUser:function(){this.bindClassMedia();this.initListUser();this.txtClassInfo.innerHTML="Danh s\u00e1ch h\u1ecdc sinh ( "+this.options.userlist.length+" )";var a=Math.floor(this.options.userlist.length/this._numShow);a=a==this.options.userlist.length/this._numShow?a:a+1;var b=Math.floor(this._indexStartShow/this._numShow)+1;this.infoNext.innerHTML=b+" / "+a;this.infoBack.innerHTML=b+" / "+a;this.btBack.style.display=
"block";this.btNext.style.display="block"},refreshUserJoin:function(){for(var a=0,b=(new Date).getTime(),c=0;c<this.options.userlist.length;c++)this.options.userlist[c].info&&b-this.options.userlist[c].info.startTime<this.options.duration&&a++},bindClassMedia:function(){var a=this._arrUserUpdate;if(0!=a.length){cc.log("bindClassMedia "+a.length);for(var b=Math.sqrt(this._numShow),c=0,d=Math.floor(this.mainViewWidth/b)-1,e=Math.floor(this.mainViewHeight/Math.sqrt(this._numShow))-1,f=0;f<this.options.userlist.length;f++)this.options.userlist[f].mainViewItem=
null;cc.removeAllChildNodes(this.classMedia);for(f=0;f<this._arrUserUpdate.length;f++){var h=this.createMainviewItem(a[f],d,e);h.style.position="absolute";h.style.overflow="hidden";h.style.left=c%b*d+"px";h.style.top=Math.floor(c/b)*e+"px";h.style.cursor="pointer";h.addEventListener("mouseup",m=>{this.addUserMedia(m.currentTarget.user);this.showUserHistory();this.setState(1);m.stopPropagation()});this.classMedia.appendChild(h);c++}}},processImageIntv:function(){if(0==this.state)for(var a=document.getElementsByClassName("aztExam_image_intv"),
b=0;b<a.length;b++){var c=a[b];if(c.hasLoaded){var d=c.image,e=c.info.w,f=c.info.h,h=c.currIdx,m=c.info.numImage,k=c.info.c,u=c.info.r;0<=c.currIdx&&0<m&&(col=Math.floor(h%k),row=Math.floor(h/u),d.style.marginTop=-(row*f)+"px",d.style.marginLeft=-(col*e)+"px",null!=c.info.warning[h.toString()]?(d=parseInt(c.info.warning[h.toString()]),1<d&&(c.warning.style.backgroundColor="yellow",c.warning.style.display="block"),0==d&&(c.warning.style.backgroundColor="red",c.warning.style.display="block")):c.warning.style.display=
"none",h=h<m-1?h+1:-4,c.currIdx=h)}}},createMainviewItem:function(a,b,c){var d=document.createElement("div");d.style.border="1px solid black";d.style.backgroundColor="#2e2d2d";d.style.width=b+"px";d.style.height=c+"px";d.user=a;var e=this.findDom(document.createElement("div"));e.css("font-size","14px");e.css("color","white");e.css("width",b+"px");e.css("height","28px");e.css("display","flex");e.css("align-items","center");e.css("position","absolute");e.css("bottom","0px");e.css("background-color",
"#4c4949");var f=document.createElement("span");f.style.width=b-70+"px";f.style.paddingLeft="10px";f.style.whiteSpace="nowrap";f.style.overflow="hidden";f.style.color="gray";f.innerHTML=a.username;e.appendChild(f);d.spanName=f;f=this.findDom(document.createElement("div"));f.innerHTML=aztExam.svg.iconRefresh;f.css("position","absolute");f.css("width","15px");f.css("height","15px");f.css("bottom","8px");f.css("right","30px");f.css("display","block");f.css("cursor","pointer");f.setAttribute("icRefresh",
!0);f.addEventListener("mouseup",h=>{this.getCurrUser(h.currentTarget.it.user);h.stopPropagation()});f.it=d;d.icRefresh=f;f=this.findDom(document.createElement("div"));f.css("border-radius","50%");f.css("background-color","gray");f.css("width","6px");f.css("height","6px");f.css("position","absolute");f.css("bottom","11px");f.css("right","11px");e.appendChild(f);d.icStatus=f;f=this.findDom(document.createElement("div"));f.innerHTML=aztExam.svg.iconWarning;f.css("position","absolute");f.css("bottom",
"8px");f.css("right","60px");f.css("display","none");d.icWarning=f;f=document.createElement("span");f.style.position="absolute";f.style.width="60px";f.style.right="22px";f.style.bottom="8px";f.style.textAlign="right";f.style.color="gray";e.appendChild(f);d.txtTimeUpdate=f;c=22<=c-50?c-50:22;f=this.createCircleAva(a.username,c,"#222222","gray");d.appendChild(f);f.style.position="absolute";f.style.top="12px";f.style.left=(b-c)/2+"px";a.imageIntv||(a.imageIntv=this.createImageIntv());d.imageIntv=a.imageIntv;
d.imageIntv.style.display="none";d.appendChild(d.imageIntv);d.appendChild(e);a.mainViewItem=d;this.bindMainviewItem(a);return d},bindMainviewItem:function(a){if(a&&a.mainViewItem&&a.info&&a.imgstr){var b=a.mainViewItem,c=a.info,d=a.imgstr;a=this.isOnline(c);b.icStatus.style.backgroundColor=a?"#0af50a":"yellow";b.spanName.style.color=a?"white":"gray";b.icWarning.style.display=c.isWarning&&a?"block":"none";var e=(new Date).getTime();e=Math.floor((e-c.time)/1E3);e=3600<e?Math.floor(e/3600)+"h":60<e?
Math.floor(e/60)+"m":e+"s";b.txtTimeUpdate.innerHTML=e+" ago";b.imageIntv.style.display="block";e=b.imageIntv;if(e.imageTime!=c.time){e=b.imageIntv;var f=e.image;f.src=d;f.style.marginTop="0px";f.style.marginLeft="0px";e.currIdx=0;e.info=c;e.hasLoaded=!0;e.imageTime=c.time;d=c.w;var h=c.h;e.style.width=d+"px";e.style.height=h+"px";f=parseInt(b.style.width);h=(parseInt(b.style.height)-28)/h;e.style.transform="scale("+h+")";e.style.top="0px";e.style.left=(f-d*h)/2+"px"}b.lastimeUpdate=(new Date).getTime();
b.hasLoaded=!0;b.status="updated";b.info=c;b.user.isOnline=a;b.user.info=c}},createImageIntv:function(a){a=this.findDom(document.createElement("div"));a.style.overflow="hidden";a.style.width=this._imageCaptureWidth+"px";a.style.height=this._imageCaptureHeight+"px";a.classList.add("aztExam_image_intv");a.style.transformOrigin="0% 0%";a.style.position="absolute";a.style.backgroundColor="#2e2d2d";var b=new Image;b.style.position="absolute";a.appendChild(b);var c=document.createElement("div");c.style.position=
"absolute";c.style.width="100%";c.style.height="100%";c.style.backgroundColor="red";c.style.opacity="0.3";c.style.display="none";a.warning=c;a.appendChild(c);a.currIdx=-1;a.image=b;a.imageTime=-1;a.info=null;return a},initConn:function(){this.arrConn=[];for(var a=0;4>a;a++)this.arrConn[a]=new aztExam.RTCConnection(this),this.arrConn[a].initConn(this.options.user.userid,"user_"+a,"find_offer"),this.app.appendChild(this.arrConn[a].ui)},addUserMedia:function(a){if(cc.isArray(a)&&0<a.length){for(var b=
0;b<a.length>0;b++)this.initUserConn(a[b]);this.history.user=a[0];this.bindUserHistory(a[0]);this.bindUserMedia(this.arrUserConn);this.getListFile(this.options.roomid,a[0].userid)}else this.initUserConn(a),this.history.user=a,this.bindUserHistory(a),this.bindUserMedia(this.arrUserConn),this.getListFile(this.options.roomid,a.userid)},initUserConn:function(a){for(var b=-1,c=-1,d=0;d<this.arrUserConn.length;d++)this.arrUserConn[d].user==a&&(b=d),!this.arrUserConn[d].isUsed&&0>c&&(c=d);if(!(0<=b)){b=
null;if(0>c)if(4>this.arrUserConn.length)b=new aztExam.RTCConnection(this),this.arrUserConn.push(b);else{c=Number.MAX_VALUE;var e=null;for(d=0;d<this.arrUserConn.length;d++)0<=this.arrUserConn[d].timeUsed&&this.arrUserConn[d].timeUsed<c&&(c=this.arrUserConn[d].timeUsed,e=this.arrUserConn[d]);e&&(b=e,b.stop())}else b=this.arrUserConn[c];b.user=a;b.start(this.options.user.userid,a.userid)}},removeUserMedia:function(a){for(var b=-1,c=0;c<this.arrUserConn.length;c++)if(this.arrUserConn[c].user==a){b=
c;break}0<=b&&(this.arrUserConn[c].stop(),this.arrUserConn[c].user=null);this.bindUserMedia(this.arrUserConn)},removeAllUserMedia:function(a){for(a=0;a<this.arrUserConn.length;a++)this.arrUserConn[a].stop(),this.arrUserConn[a].user=null;this.bindUserMedia(this.arrUserConn)},resizeUserMedia:function(){var a=this.userMedia.childNodes;if(0<a.length){var b=Math.floor(Math.sqrt(a.length));b=b==Math.sqrt(a.length)?b:b+1;var c=this.userMediaHeight/b,d=Math.floor(a.length/b);d=d==a.length/b?d:d+1;b=Math.floor((this.userMediaWidth-
2)/d);2==a.length&&(b=this.userMediaWidth/2,c=this.userMediaHeight,d=2);for(var e=0;e<a.length;e++){var f=a[e];f.style.width=b+"px";f.style.height=c+"px";f.style.top=Math.floor(e/d)*c+"px";f.style.left=Math.floor(e%d)*b+"px";f.conn.resizeUI(b,c-50);f.ava.style.top=(c-50-parseInt(f.ava.style.height))/2+"px";f.ava.style.left=(b-parseInt(f.ava.style.width))/2+"px"}}},bindUserMedia:function(a){cc.removeAllChildNodes(this.userMedia);a=[];for(var b=0;b<this.arrUserConn.length;b++)this.arrUserConn[b].isUsed&&
a.push(this.arrUserConn[b]);if(0<a.length){b=Math.floor(Math.sqrt(a.length));b=b==Math.sqrt(a.length)?b:b+1;var c=this.userMediaHeight/b,d=Math.floor(a.length/b);d=d==a.length/b?d:d+1;var e=Math.floor((this.userMediaWidth-2)/d);2==a.length&&(e=this.userMediaWidth/2,c=this.userMediaHeight,d=2);for(b=0;b<a.length;b++){var f=this.createUserMediaItem(a[b],e,c);f.style.position="absolute";f.style.width=e+"px";f.style.height=c+"px";f.style.top=Math.floor(b/d)*c+"px";f.style.left=Math.floor(b%d)*e+"px";
f.conn=a[b];this.userMedia.appendChild(f)}}},createUserMediaItem:function(a,b,c){var d=document.createElement("div");d.style.border="1px solid black";d.style.backgroundColor="#2e2d2d";d.style.width=b+"px";d.style.height=c+"px";d.addEventListener("mouseup",m=>{this.history.user=m.currentTarget.conn.user;this.bindUserHistory(m.currentTarget.conn.user);this.showUserHistory();m.stopPropagation()});d.conn=a;var e=this.findDom(document.createElement("div"));e.css("font-size","16px");e.css("color","white");
e.css("width","100%");e.css("height","50px");e.css("display","flex");e.css("align-items","center");e.css("position","absolute");e.css("bottom","0px");e.css("background-color","#222222");var f=document.createElement("span");f.style.width=b-70+"px";f.style.paddingLeft="10px";f.style.whiteSpace="nowrap";f.style.overflow="hidden";f.style.color="gray";f.innerHTML=a.user.username;e.appendChild(f);d.spanName=f;f=this.findDom(document.createElement("div"));f.innerHTML=aztExam.svg.iconClose;f.css("position",
"absolute");f.css("width","30px");f.css("height","30px");f.css("bottom","18px");f.css("right","10px");f.css("display","block");f.css("cursor","pointer");f.conn=a;f.addEventListener("mouseup",m=>{this.removeUserMedia(m.currentTarget.conn.user);m.stopPropagation()});e.appendChild(f);f=22<=c-50?c-50:22;f=200<f?200:f;var h=this.createCircleAva(a.user.username,f,"#222222","gray");d.ava=h;d.appendChild(h);h.style.position="absolute";h.style.top=(c-50-f)/2+"px";h.style.left=(b-f)/2+"px";a.ui.style.position=
"absolute";a.resizeUI(b,c-50);d.appendChild(a.ui);d.appendChild(e);return d},showListUser:function(){this.listUserView.style.display="block";this.history.style.display="none";this.searchUserListItem("")},showUserHistory:function(){this.listUserView.style.display="none";this.history.style.display="block"},initListUser:function(){for(var a=0;a<this.options.userlist.length;a++)this.options.userlist[a].listUserItem=null;cc.removeAllChildNodes(this.listUser);for(a=0;a<this._arrUserUpdate.length;a++){var b=
this.createUserListItem(this._arrUserUpdate[a]);this._arrUserUpdate[a].listUserItem=b;this.listUser.appendChild(b)}},createUserListItem:function(a){if(a){var b=this.findDom(document.createElement("div"));b.style.width=this.historyWidth+"px";b.style.height="60px";b.style.display="flex";b.style.flexDirection="row";b.style.alignItems="center";b.style.paddingLeft="10px";b.style.cursor="pointer";a.userListItem=b;b.addTouch(f=>{this.addUserMedia(f.target.user)});b.addTouchMove(f=>{f.target.style.backgroundColor=
"#EEEEEE"});b.addTouchOut(f=>{f.target.style.backgroundColor="white"});var c="#F47373 #697689 #37D67A #2CCCE4 #555555 #dce775 #ff8a65 #ba68c8".split(" ");c=this.createCircleAva(a.username,50,c[Math.floor(Math.random()*(c.length-1))],"white");b.ava=c;c.style.pointerEvents="none";c.style.opacity=.5;b.appendChild(c);c=document.createElement("div");c.style.width=this.historyWidth-50+"px";c.style.height="100%";c.style.display="flex";c.style.justifyContent="center";c.style.paddingLeft="10px";c.style.flexDirection=
"column";c.style.pointerEvents="none";b.appendChild(c);var d=document.createElement("div");d.style.color="gray";d.style.fontSize="18px";d.style.fontFamily="sans-serif";d.style.display="flex";d.style.flexDirection="row";b.txtname=d;c.appendChild(d);var e=document.createElement("div");e.style.width="260px";e.innerHTML=a.username;d.appendChild(e);e=this.findDom(document.createElement("div"));e.style.width="20px";e.style.height="20px";e.style.fill="#979494";e.style.display="none";e.innerHTML=aztExam.svg.iconCamera;
b.icCam=e;d.appendChild(e);e=this.findDom(document.createElement("div"));e.style.width="20px";e.style.height="20px";e.style.marginLeft="10px";e.style.fill="#979494";e.style.display="none";e.innerHTML=aztExam.svg.iconMic;b.icMic=e;d.appendChild(e);e=this.findDom(document.createElement("div"));e.style.width="20px";e.style.height="20px";e.style.marginLeft="10px";e.style.display="none";e.innerHTML=aztExam.svg.iconWarning;b.icWarning=e;d.appendChild(e);d=document.createElement("div");d.style.width="1005";
d.style.display="flex";d.style.flexDirection="row";d.style.alignItems="center";d.style.justifyContent="start";c.appendChild(d);c=this.findDom(document.createElement("div"));c.css("border-radius","50%");c.css("background-color","gray");c.css("width","10px");c.css("height","10px");c.css("margin-right","4px");c.style.marginTop="5px";b.icStatus=c;d.appendChild(c);c=document.createElement("div");c.style.color="gray";c.style.fontSize="14px";c.style.fontFamily="sans-serif";c.style.marginTop="5px";c.innerHTML=
"Offline";b.txtinfo=c;d.appendChild(c);b.user=a;this.bindUserListItem(a);return b}},createCircleAva:function(a,b,c,d){null==a&&(a="");a=a.trim();var e=this.findDom(document.createElement("div"));e.css("border-radius","50%");e.css("background-color",c);e.css("width",b+"px");e.css("height",b+"px");e.css("display","flex");e.css("align-items","center");e.css("justify-content","center");e.css("color",d);e.css("font-size",(b-10)/2+"px");a=a.split(" ");e.innerHTML=a[a.length-1].substr(0,2).toUpperCase();
return e},bindUserListItem:function(a){if(a&&a.userListItem&&a.info){var b=a.userListItem;a=a.info;var c=(new Date).getTime(),d=Math.abs(c-a.time);c=(new Date(a.time)).toLocaleString();c=d<this._timeOnlineIntv?"Online":"Offline . "+c;d=this.isOnline(a);b.txtinfo.innerHTML=c;d?(b.ava.style.opacity=1,b.txtname.style.color="black",b.icStatus.style.backgroundColor="#0af50a",b.txtinfo.style.opacity=1,b.txtname.style.opacity=1,b.icStatus.style.opacity=1,b.icCam.style.display="block",b.icMic.style.display=
"block",b.icCam.innerHTML=a.deviceInfo.isWebsiteHasWebcamPermissions?aztExam.svg.iconCamera:aztExam.svg.iconCameraOff,b.icMic.innerHTML=a.deviceInfo.isWebsiteHasMicrophonePermissions?aztExam.svg.iconMic:aztExam.svg.iconMicOff,b.icWarning.style.display=a.isWarning?"block":"none"):(b.txtname.style.color="gray",b.icStatus.style.backgroundColor="gray",b.icCam.style.display="none",b.icMic.style.display="none",b.icWarning.style.display="none");this.txtListUserInfo.style.display="none"}},searchUserListItem:function(a){for(var b=
this.listUser.childNodes,c=0;c<b.length;c++)""==a.trim()?b[c].style.display="flex":0<=b[c].user.username.toLowerCase().indexOf(a.trim().toLowerCase())?b[c].style.display="flex":b[c].style.display="none"},initUserHistory:function(){this.userInfo=document.createElement("div");this.userInfo.style.width="100%";this.userInfo.style.height="auto";this.userInfo.style.marginTop="15px";this.userInfo.style.marginLeft="15px";this.userInfo.style.marginBottom="35px";this.userInfo.style.fontSize="16px";this.userInfo.style.lineHeight=
"25px";this.history.appendChild(this.userInfo);this.userHistory=document.createElement("div");this.userHistory.style.width="100%";this.userHistory.style.height=window.innerHeight-330+"px";this.userHistory.style.overflowY="scroll";this.userHistory.style.overflowX="hidden";this.userHistory.style.paddingTop="10px";this.history.appendChild(this.userHistory)},bindUserHistory:function(a){if(this.history.user==a)if(a&&a.info){var b="<b>T\u00ean : </b>"+a.username+"<br/>";b+="<b>H\u1ec7 \u0111i\u1ec1u h\u00e0nh : </b>"+
a.info.deviceInfo.osName+"_"+a.info.deviceInfo.osVersion+"<br/>";b+="<b>Tr\u00ecnh duy\u1ec7t :  </b>"+a.info.deviceInfo.browser.name+"_"+a.info.deviceInfo.browser.version+"<br/>";b+="<b>Tr\u1ea1ng th\u00e1i : </b>"+(this.isOnline(a.info)?"Online":"Offline")+"<br/>";b+="<b>Webcam : </b>"+(a.info.deviceInfo.hasWebcam?"C\u00f3":"Kh\u00f4ng")+"<br/>";b+="<b>C\u00f3 c\u1ea5p quy\u1ec1n webcam : </b>"+(a.info.deviceInfo.isWebsiteHasWebcamPermissions?"C\u00f3":"Kh\u00f4ng")+"<br/>";b+="<b>Microphone : </b>"+
(a.info.deviceInfo.hasMicrophone?"C\u00f3":"Kh\u00f4ng")+"<br/>";b+="<b>C\u00f3 c\u1ea5p quy\u1ec1n microphone : </b>"+(a.info.deviceInfo.isWebsiteHasMicrophonePermissions?"C\u00f3":"Kh\u00f4ng")+"<br/>";b+="<b>C\u1eadp nh\u1eadt : </b>"+(new Date(a.info.time)).toLocaleString()+"<br/>";this.userInfo.innerHTML=b}else this.userInfo.innerHTML="\u0110ang l\u1ea5y d\u1eef li\u1ec7u ...."},createUserHistoryItem:function(a){a=this.findDom(document.createElement("div"));a.style.width="100%";a.style.height=
"100px";a.style.marginLeft="20px";a.style.position="relative";a.style.cursor="pointer";a.style.borderLeft="2px solid green";a.addTouch(c=>{});a.addTouchMove(c=>{c.target.style.backgroundColor="#EEEEEE"});a.addTouchOut(c=>{c.target.style.backgroundColor="white"});var b=document.createElement("div");b.style.borderRadius="50%";b.style.width="10px";b.style.height="10px";b.style.backgroundColor="green";b.style.border="1px solid #888888";b.style.position="absolute";b.style.bottom="0px";b.style.left="-7px";
b.style.pointerEvents="none";a.appendChild(b);b=document.createElement("div");b.innerHTML="2021-11-11 09:11:11 AM";b.style.fontSize="14px";b.style.position="absolute";b.style.bottom="0px";b.style.left="15px";b.style.pointerEvents="none";a.appendChild(b);b=this.findDom(document.createElement("div"));b.style.width="100px";b.style.height="60px";b.style.display="flex";b.style.flexDirection="column";b.style.justifyContent="center";b.style.alignItems="center";b.style.position="absolute";b.style.left="35px";
b.style.top="25px";b.style.fontSize="12px";b.innerHTML=aztExam.svg.iconWarning+"6 C\u1ea3nh b\u00e1o";b.style.pointerEvents="none";a.appendChild(b);return a},isOnline:function(a){return a&&a.time&&(new Date).getTime()-a.time<this._timeOnlineIntv?!0:!1},role:function(){return"teacher"}});aztExam.MonitorTeacher=function(){var a;return{getInstance:function(b){null==a&&(a=new aztExam.monitorTeacher(b));return a},releaseInst:function(){a=null},inst:function(){return this.getInstance()}}}();
