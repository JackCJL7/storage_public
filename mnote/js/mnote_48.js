$("textarea").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto";this.style.height=this.scrollHeight+"px"});function getOs(){var a=navigator.userAgent.toLowerCase(),b=/iphone|ipod|ipad/.test(a),c=/android/.test(a);/safari/.test(a);return c?"android":b?"ios":"web"}
function replaceTV(a){return a.replace(/\u00e0|\u00e1|\u1ea1|\u1ea3|\u00e3|\u00e2|\u1ea7|\u1ea5|\u1ead|\u1ea9|\u1eab|\u0103|\u1eb1|\u1eaf|\u1eb7|\u1eb3|\u1eb5/g,"a").replace(/ /g,"-").replace(/\u0111/g,"d").replace(/\u0111/g,"d").replace(/\u1ef3|\u00fd|\u1ef5|\u1ef7|\u1ef9/g,"y").replace(/\u00f9|\u00fa|\u1ee5|\u1ee7|\u0169|\u01b0|\u1eeb|\u1ee9|\u1ef1|\u1eed|\u1eef/g,"u").replace(/\u00f2|\u00f3|\u1ecd|\u1ecf|\u00f5|\u00f4|\u1ed3|\u1ed1|\u1ed9|\u1ed5|\u1ed7|\u01a1|\u1edd|\u1edb|\u1ee3|\u1edf|\u1ee1.+/g,
"o").replace(/\u00e8|\u00e9|\u1eb9|\u1ebb|\u1ebd|\u00ea|\u1ec1|\u1ebf|\u1ec7|\u1ec3|\u1ec5.+/g,"e").replace(/\u00ec|\u00ed|\u1ecb|\u1ec9|\u0129/g,"i")}function showLoading(){$(".loading").css("display","block")}function hideLoading(){$(".loading").css("display","none")}
var roundedPoly=function(a,b,c){var e,d=function(u,v,n){n.x=v.x-u.x;n.y=v.y-u.y;n.len=Math.sqrt(n.x*n.x+n.y*n.y);n.nx=n.x/n.len;n.ny=n.y/n.len;n.ang=Math.atan2(n.ny,n.nx)};var f={};var g={};var h=b.length;var k=b[h-1];for(e=0;e<h;e++){var l=b[e%h];var m=b[(e+1)%h];d(l,k,f);d(l,m,g);k=f.nx*g.ny-f.ny*g.nx;var p=f.nx*g.nx-f.ny*-g.ny;var q=Math.asin(k);k=1;var t=!1;0>p?0>q?q=Math.PI+q:(q=Math.PI-q,k=-1,t=!0):0<q&&(k=-1,t=!0);p=q/2;var r=Math.abs(Math.cos(p)*c/Math.sin(p));r>Math.min(f.len/2,g.len/2)?
(r=Math.min(f.len/2,g.len/2),q=Math.abs(r*Math.sin(p)/Math.cos(p))):q=c;p=l.x+g.nx*r;r=l.y+g.ny*r;p+=-g.ny*q*k;r+=g.nx*q*k;a.arc(p,r,q,f.ang+Math.PI/2*k,g.ang-Math.PI/2*k,t);k=l;l=m}a.closePath()};
window.addEventListener("message",function(a){a.data&&(a.data.cmd&&"initMNote"==a.data.cmd&&a.data.pages&&(mnote=MNote.getInstance())&&null==mnote.mnotedata&&mnote.initNote(a.data),a.data.cmd&&"MNoteStaticText"==a.data.cmd&&(mnote=MNote.getInstance(),mnote.staticTextConfig=JSON.parse(a.data.data),localStorage&&localStorage.setItem("staticTextConfig",JSON.stringify(mnote.staticTextConfig))),a.data.cmd&&"getMNoteJson"==a.data.cmd&&parent.postMessage({cmd:"MNoteJson",data:mnote.exportJSON()},"*"))});
function drawArrowhead(a,b,c,e){var d=c.x,f=c.y;a.save();a.fillStyle=a.strokeStyle;a.beginPath();b=Math.atan2(c.y-b.y,c.x-b.x);c=e*Math.cos(b)+d;var g=e*Math.sin(b)+f;a.moveTo(c,g);b+=1/3*2*Math.PI;c=e*Math.cos(b)+d;g=e*Math.sin(b)+f;a.lineTo(c,g);b+=1/3*2*Math.PI;c=e*Math.cos(b)+d;g=e*Math.sin(b)+f;a.lineTo(c,g);a.closePath();a.fill();a.restore()}parent.postMessage("MNoteLoadComplete","*");function is_touch_device(){return"ontouchstart"in window||navigator.msMaxTouchPoints}
function isDomVisile(a){return"none"==$(a).css("display")?!1:!0}function dragMoveListener(a){var b=a.target,c=(parseFloat(b.getAttribute("data-x"))||0)+a.dx;a=(parseFloat(b.getAttribute("data-y"))||0)+a.dy;b.style.webkitTransform=b.style.transform="translate("+c+"px, "+a+"px)";b.setAttribute("data-x",c);b.setAttribute("data-y",a)}window.dragMoveListener=dragMoveListener;function initNote(a){mnote.addPages(a)}function exportJSON(){parent.postMessage({cmd:"MNoteJson",data:mnote.exportJSON()},"*")}
function exportPdf(){MNote.getInstance().exportPdf()}function exportPdf_(){MNote.getInstance().exportPdf_()}$(window).on("load",function(){});function initPanZoom(a){var b=document.querySelector("#mnote_pages");panzoom(b,{beforeWheel:function(c){return!c.altKey},bounds:!0,boundsPadding:.05,maxZoom:3,minZoom:1,pinchSpeed:3,initialX:0,initialY:0,initialZoom:a})}
var MNote_instance=cc.Class.extend({appWidth:900,appHeight:1120,pageWidth:750,pageHeight:1120,pages:[],pageCount:0,pageScale:1,maxLineWidth:25,minLineWidth:1,maxTextSize:60,minTextSize:20,isDrawingMode:!1,currDrawStyle:null,currTextStyle:null,currBrush:"pen",lastTouchX:-1,lastTouchY:-1,lastTouchDown:!1,BRUSH_MOVE:"move",BRUSH_PEN:"pen",BRUSH_ERASE:"erase",BRUSH_TEXT:"text",BRUSH_POLYGON:"polygon",BRUSH_LINE:"line",BRUSH_RECTANGLE:"rangle",BRUSH_CIRCLE:"circle",BRUSH_ARROW:"arrow",canvasTouchStartX:-1,
canvasTouchStartY:-1,canvasTouchStartTime:-1,canvasTapCount:0,aldreadyDelete:!1,mode:"mode_normal",MODE_NORMAL:"mode_normal",MODE_DRAWRING:"mode_drawing",MODE_ENTER_TEXT:"mode_enter_text",MODE_EDIT_TEXT:"mode_edit_text",countRight:0,countWrong:0,arrImg:[],mnotedata:null,staticTextConfig:null,desktopZoom:1,ctor:function(){var a=this,b=this;this.note_pages=document.getElementById("mnote_pages");this.note_content=document.getElementById("mnote_content");this.note_container=document.getElementById("mnote_container");
this.onresize(window.innerWidth,window.innerHeight);window.addEventListener("resize",function(){a.onresize(window.innerWidth,window.innerHeight)});is_touch_device()&&(this.panzoom=panzoom(this.note_container,{beforeWheel:function(d){return!d.altKey},onTouch:function(d){return"edit"==b.mnotedata.mode?!1:!0},smoothScroll:!0,bounds:!0,boundsPadding:.5,maxZoom:4,minZoom:1}),this.panzoom.on("transform",function(d){a.mode==a.MODE_NORMAL&&(d=document.getElementById("mnote_mark"),parseInt($(d).css("top"))>
b.appHeight&&!(d.getBoundingClientRect().top<b.appHeight)&&"edit"==b.mnotedata.mode&&$("#mnote_hold_bt").css("display","flex"))}));$("#mnote_help").css("display","block");$(".help_text").css("float","left");this.btnHoldDraw=document.getElementById("btn_hold_draw");$(this.btnHoldDraw).on("touchend mouseup",function(d){a.setMode(a.MODE_DRAWRING);d.preventDefault()});this.btnDrawFinish=document.getElementById("btn_draw_finish");this.btnDrawErase=document.getElementById("btn_draw_erase");this.btnDrawPen=
document.getElementById("btn_draw_pen");this.btnDrawColor=document.getElementById("btn_draw_color");this.btnDrawText=document.getElementById("btn_draw_text");this.btnDrawMove=document.getElementById("btn_draw_move");$(this.btnDrawFinish).on("touchend mouseup",function(d){a.setMode(a.MODE_NORMAL);d.preventDefault()});$(this.btnDrawErase).on("touchend mouseup",function(d){a.currBrush==a.BRUSH_ERASE?a.showMenuColor():a.setBrushDraw(a.BRUSH_ERASE)});$(this.btnDrawText).on("touchend mouseup",function(d){a.setBrushDraw(a.BRUSH_TEXT);
a.exportJSON()});$(this.btnDrawMove).on("touchend mouseup",function(d){a.setBrushDraw(a.BRUSH_MOVE)});$(this.btnDrawPen).on("touchend mouseup",function(d){a.currBrush==a.BRUSH_PEN||a.currBrush==a.BRUSH_LINE||a.currBrush==a.BRUSH_RECTANGLE||a.currBrush==a.BRUSH_CIRCLE||a.currBrush==a.BRUSH_ARROW?a.showMenuColor():a.setBrushDraw(a.BRUSH_PEN)});this.mnote_menu_color=document.getElementById("mnote_menu_color");this.menu_color_content=document.getElementById("menu_color_content");$(this.mnote_menu_color).on("touchend mouseup",
function(d){a.hideMenuColor();d.stopPropagation()});$(this.menu_color_content).on("touchend mouseup",function(d){d.stopPropagation()});this.currDrawStyle={alpha:1,lineWidth:6,strokeStyle:"red",fillStyle:"red"};this.currTextStyle={font:"font_chu_dep",size:20,align:"left",color:"red",fill:!1};is_touch_device()?($("#mnote_app").css("overflow","hidden"),$("#mnote_content").css("overflow","hidden"),$("#bt_trash").css("left",window.innerWidth/2-30+"px"),$("#bt_trash").css("top","0px"),this.currDrawStyle.lineWidth=
6):($("body").attr("spellcheck",!1),$("#mnote_content").css("overflow","scroll"),$("#menu_text_font").css("transform","scale(1)"),$("#bt_trash").css("left","0px"),$("#mnote_setting_zoom_out").css("display","block"),$("#mnote_setting_zoom_in").css("display","block"),$("#bt_trash").css("top",window.innerHeight/2+"px"),this.currDrawStyle.lineWidth=2,this.minTextSize=10);try{if(localStorage){var c=localStorage.getItem("textStyle"),e=localStorage.getItem("drawStyle");""!=e&&void 0!=e&&null!=e&&(this.currDrawStyle=
JSON.parse(e));""!=c&&void 0!=c&&null!=c&&(this.currTextStyle=JSON.parse(c))}}catch(d){console.log("exception "+d.toString())}this.initMenuBottom();this.initMenuText();this.initMarkUI();this.setBrushDraw(this.BRUSH_MOVE);this.contentBushPen=document.getElementById("content_brush_pen");this.contentBushLine=document.getElementById("content_brush_line");this.contentBushRect=document.getElementById("content_brush_rectangle");this.contentBushCircle=document.getElementById("content_brush_circle");this.contentBushArrow=
document.getElementById("content_brush_arrow");$(this.contentBushPen).on("touchend mouseup",function(d){a.setBrushDraw(a.BRUSH_PEN);d.preventDefault();d.stopPropagation()});$(this.contentBushLine).on("touchend mouseup",function(d){a.setBrushDraw(a.BRUSH_LINE);d.preventDefault();d.stopPropagation()});$(this.contentBushRect).on("touchend mouseup",function(d){a.setBrushDraw(a.BRUSH_RECTANGLE);d.preventDefault();d.stopPropagation()});$(this.contentBushCircle).on("touchend mouseup",function(d){a.setBrushDraw(a.BRUSH_CIRCLE);
d.preventDefault();d.stopPropagation()});$(this.contentBushArrow).on("touchend mouseup",function(d){a.setBrushDraw(a.BRUSH_ARROW);d.preventDefault();d.stopPropagation()});this.thickSliderInput=document.getElementById("thick_slider_input");$(this.thickSliderInput).on("input",function(d){a.setDrawStyle({lineWidth:parseInt($(a.thickSliderInput).val())})});$(".btn-content-color").on("mouseup",function(d){b.setDrawStyle({strokeStyle:$(this).attr("data")});d.preventDefault();d.stopPropagation()});b=this;
$("#thick_slider").on("touchstart",function(d){b.sliderThickTouch(d);d.preventDefault();d.stopPropagation()});$("#thick_slider").on("touchmove",function(d){b.sliderThickTouch(d);d.preventDefault();d.stopPropagation()});this.setDrawStyle(this.currDrawStyle);this.setTextStyle(this.currTextStyle);$("#color_content_close").on("touchend mouseup",function(){a.hideMenuColor()});$(".help_text").on("touchend mouseup",function(){$(this).css("display","none")});window.addEventListener("mouseup",function(d){a.lastTouchDown=
!1;var f=$(".obj_down");0<f.length&&a._endObj(f[0],d);$(".obj_down").removeClass("obj_down");a.inactiveAllObj();if(!is_touch_device())for(d=0;d<a.pages.length;d++)a.onCanvasEnd(document.getElementById("canvas_"+d));document.getElementById("slider_text_size").isMouseDown=!1;$("#mnote_menu_edit_bg").css("display","none")});window.addEventListener("mousemove",function(d){var f=$(".obj_down");0<f.length&&a._moveObj($(f[0]).get(0),d)});window.addEventListener("mousedown",function(d){});document.getElementById("capture").addEventListener("change",
function(d){if(d=document.getElementById("capture").files[0]){var f=new FileReader;f.onload=function(g){a.addPage({backgroundImage:g.target.result})};f.readAsDataURL(d)}});$("#btn_save_data").on("touchstart mousedown",function(d){d.preventDefault()});$("#btn_save_data").on("touchend mouseup",function(d){parent.postMessage({cmd:"MNoteJson",data:a.exportJSON()},"*");d.preventDefault()});$("#mnote_mark_result").on("touchstart mousedown",function(d){d.preventDefault()});c=document.createElement("style");
c.type="text/css";c.innerHTML="@font-face {font-family: handwriting_font_z;src: url(css/HP0015HB.ttf);}";document.getElementsByTagName("head")[0].appendChild(c);$("#mark_comment_txt").css("font-family","handwriting_font_z");this.initStaticTextSetting();$("#setting_menu_static_text").click(function(){"none"==$("#setting_static_text").css("display")?a.showStaticTextSetting():a.hideStaticTextSetting()});$("#setting_menu_mathtype").click(function(){a.showMathEditor()});c=document.querySelectorAll(".dropdown-trigger");
M.Dropdown.init(c,{alignment:"bottom",hover:!1});this.initMathEditor();$("#btn_resubmit").click(function(){parent.postMessage({cmd:"MNoteReSubmit",data:{}},"*")});$("#mnote_setting_zoom_out").click(function(){a.setDesktopZoom(a.desktopZoom-.4)});$("#mnote_setting_zoom_in").click(function(){a.setDesktopZoom(a.desktopZoom+.4)});$("#mnote_menu_edit_bg_rotate").click(function(d){$("#mnote_menu_edit_bg").css("display","none");var f=$("#mnote_menu_edit_bg").attr("data");a.rotateBgPage(f);d.preventDefault();
d.stopPropagation()});$("#mnote_menu_edit_bg_moveup").click(function(d){$("#mnote_menu_edit_bg").css("display","none");var f=$("#mnote_menu_edit_bg").attr("data");a.moveUpPage(f);d.preventDefault();d.stopPropagation()});$("#mnote_menu_edit_bg_movedown").click(function(d){$("#mnote_menu_edit_bg").css("display","none");var f=$("#mnote_menu_edit_bg").attr("data");a.moveDownPage(f);d.preventDefault();d.stopPropagation()});$("#btn_comment_font").click(function(){"block"==$("#txtCommnetFont").css("display")?
$("#txtCommnetFont").css("display","none"):$("#txtCommnetFont").css("display","block")});b=this;$(".txtCommnetFont").click(function(d){$("#mark_comment_txt").css("font-family",$(this).attr("value"));$("#txtCommnetFont").css("display","none");if(b.staticTextConfig&&(b.staticTextConfig.txtCommentFont=$(this).attr("value"),localStorage))try{localStorage.setItem("staticTextConfig",JSON.stringify(b.staticTextConfig))}catch(f){}});this.recognizing=!1;this.final_transcript=""},setButtonVoiceToText:function(a){a?
($("#bt_voice_text").removeClass("green"),$("#bt_voice_text").addClass("red pulse")):($("#bt_voice_text").removeClass("red pulse"),$("#bt_voice_text").addClass("green"))},linebreak:function(a){return a.replace(/\n\n/g,"<p></p>").replace(/\n/g,"<br>")},capitalize:function(a){return a.replace(/\S/,function(b){return b.toUpperCase()})},setupVoiceToText:function(){this.recognition=new webkitSpeechRecognition;this.recognition.lang="vi-VN";this.recognition.continuous=!0;this.recognition.interimResults=
!0;var a=this;this.recognition.onstart=function(){a.recognizing=!0;a.setButtonVoiceToText(!0)};this.recognition.onerror=function(b){"no-speech"==b.error&&console.log("voice to text error no-speech");"audio-capture"==b.error&&console.log("voice to text error audio-capture");"not-allowed"==b.error&&console.log("voice to text error not-allowed");a.recognizing=!1;a.setButtonVoiceToText(!1)};this.recognition.onend=function(){a.recognizing=!1;a.setButtonVoiceToText(!1)};this.recognition.onresult=function(b){for(var c=
"",e=b.resultIndex;e<b.results.length;++e)b.results[e].isFinal?a.final_transcript+=b.results[e][0].transcript:c+=b.results[e][0].transcript;console.log("transcript "+a.final_transcript+":"+c);$("#mark_comment_txt").val(a.final_transcript+":"+c);a.resizeTxtComment()}},sliderThickTouch:function(a){if(!(1>a.touches.length)){var b=a.touches[a.touches.length-1],c=document.getElementById("thick_slider"),e=c.getBoundingClientRect();b=(b.clientX-e.left)/e.width;b=0>b?0:b;b=1<b?1:b;$(this.thickSliderInput).val(Math.floor(2+
33*b));c=$(c).find(".thumb")[0];$(c).css("left",Math.floor(b*e.width-5)+"px");this.setDrawStyle({lineWidth:parseInt($(this.thickSliderInput).val())});a.preventDefault();a.stopPropagation()}},setDesktopZoom:function(a){.6<=a&&8>=a&&(this.desktopZoom=a,$("#mnote_container").css("transform","scale("+this.desktopZoom+")"))},initNote:function(a){var b=this;this.mnotedata=a;this.mnotedata.fullname="hoten";this.mnotedata.classname="lop";this.mnotedata.homework="baitap";this.mnotedata.homeworkTime="0000_00_00";
a.staticTextConfig&&(this.staticTextConfig=JSON.parse(a.staticTextConfig));a.student_obj&&a.student_obj.fullName&&($("#mnote_user_name").html("H\u1ecd v\u00e0 t\u00ean : "+a.student_obj.fullName),this.mnotedata.fullname=replaceTV(a.student_obj.fullName));a.classroom_obj&&a.classroom_obj.name&&($("#mnote_user_class").html("L\u1edbp : "+a.classroom_obj.name),this.mnotedata.classname=replaceTV(a.classroom_obj.name));if(a.homework_obj&&a.homework_obj.deadline){var c=a.homework_obj.deadline.split("T")[0];
c=c.split("-");$("#mnote_user_time").html("Ng\u00e0y "+c[2]+" th\u00e1ng "+c[1]+" n\u0103m "+c[0]);this.mnotedata.homeworkTime=c[2]+"_"+c[1]+"_"+c[0]}a.homework_obj&&a.homework_obj.content&&($("#mnote_user_homework").html(a.homework_obj.content),this.mnotedata.homework=replaceTV(a.homework_obj.name.substr(0,50)));for(c=0;c<a.pages.length;c++)void 0==a.pages[c].id&&(a.pages[c].id=c);this.addPages(a.pages);a.comment&&$("#mark_comment_txt").val(a.comment);a.point&&$("#mark_number_txt").val(a.point);
this.resizeTxtComment();a.commentEmoji&&this.addCommentEmoji(a.commentEmoji);if("edit"==this.mnotedata.mode){a=!1;if(void 0!=this.mnotedata.hideMark&&null!=this.mnotedata.hideMark)a=this.mnotedata.hideMark;else try{localStorage&&(a="true"==localStorage.getItem("hideMark")?!0:!1)}catch(d){}a?this.hideMark(!0):this.showMark(!0);try{"exam"==this.mnotedata.context&&$("#mnote_mark").css("display","none")}catch(d){}}else is_touch_device()||($("#mark_comment_txt").attr("disabled",""),$("#mark_number_txt").attr("disabled",
"")),$("#mnote_mark_chose").css("display","none"),$("#btn_save_data").css("display","none"),$("#mnote_hold_bt").css("display","none"),$("#mnote_mark").css("top","0px"),$("#hide_mark").css("display","none"),$("#mnote_mark_hide").css("display","none"),a=$("#mnote_mark_point").height()-10,$("#mnote_pages").css("padding-top",a+"px"),$("#mnote_user_info").css("display","none"),$("#mnote_mark").on("touchend mousedown",function(d){}),$("#mnote_mark_result").css("display","none"),$("#mnote_setting_bt").css("display",
"none"),$("#mnote_setting_zoom_in").css("display","none"),$("#mnote_setting_zoom_out").css("display","none"),$("#mnote_mark_emoji_bt").css("display","none"),$("#mnote_help").css("display","none"),$("#mnote_mark_emoji_bt").css("display","none"),$(".bt-edit-bg").css("display","none"),1==this.mnotedata.hideMark&&this.hideMark();if(this.staticTextConfig&&this.staticTextConfig.txtCommentFont)$("#mark_comment_txt").css("font-family",this.staticTextConfig.txtCommentFont);else try{if(localStorage){var e=
localStorage.getItem("staticTextConfig");e&&(this.staticTextConfig=JSON.parse(e),this.staticTextConfig.txtCommentFont&&$("#mark_comment_txt").css("font-family",this.staticTextConfig.txtCommentFont))}}catch(d){}setTimeout(function(){"edit"==b.mnotedata.mode&&$("#mnote_hold_bt").css("display","flex")},500)},resetNote:function(){this.removeAllPage()},addPages:function(a){for(var b=0;b<a.length;b++)this.addPage(a[b])},addPage:function(a){var b=this,c=$('<div data="'+a.id+'" id="page_'+a.id+'" class="page"></div>');
$(c).css("margin-top","5px");$(this.note_pages).append($(c));$(c).width(this.pageWidth-200);var e=$('<div class="page_bg"></div>');$(c).append($(e));var d=$('<div class="page_canvas_draw"></div>');$(c).append($(d));var f=$('<div class="page_objs_layer"></div>');$(c).append($(f));$(f).css("pointer-events","none");f=$('<i data="rotate" class="material-icons bt-edit-bg waves-effect waves-light" style="font-size:35px">crop_rotate</i>');var g=$('<i data="moveup" class="material-icons bt-edit-bg waves-effect waves-light" style="right:50px;font-size:35px">arrow_upward</i>');
$(c).append($(f));$(c).append($(g));c=document.createElement("canvas");c.id="canvas_"+a.id;c.index=a.id;c.pageid=a.id;c.style="position:absolute";$(c).addClass("canvas_draw");this.addCanvasEventListener(c);f=document.createElement("canvas");f.id="canvasDraw_"+a.id;f.pageid=a.id;f.style="position:absolute";$(d).append(f);$(d).append(c);d=!1;g=a.backgroundImage.length;var h=a.backgroundImage.toLowerCase();h.indexOf(".mp4")>=g-5||h.indexOf(".mov")>=g-5||h.indexOf(".wmv")>=g-5||h.indexOf(".webm")>=g-
5||h.indexOf(".mp3")>=g-5||h.indexOf(".m4a")>=g-5||0<=h.indexOf("player.vimeo")||0<=h.indexOf("mega.nz")?(d=!0,c.pagetype=1):c.pagetype=0;isNaN(a.width)||isNaN(a.height)||b.resizePage(a.id,a.width,a.height);if(a.backgroundImage)if(d)0<=a.backgroundImage.indexOf("player.vimeo")||0<=a.backgroundImage.indexOf("mega.nz")?$(e).html('<iframe src="'+a.backgroundImage+'" width="100%" height=450 style="border:none"></iframe>'):0>a.backgroundImage.indexOf("wewiin.nyc3.cdn")?($(e).html('<video id="video_'+a.id+
'" class="video-js vjs-big-play-centered" controls preload="auto" width="100%" height="450" style="width:100%;height:450px"><source src="'+a.backgroundImage+'" type="video/mp4" /></video>'),videojs("video_"+a.id,{controls:!0,autoplay:!1,preload:"auto"})):$(e).html(" Ch\u1ee9c n\u0103ng video \u0111ang t\u1ea1m kho\u00e1 , vui l\u00f2ng th\u1eed l\u1ea1i sau ! "),b.resizePage(a.id,b.pageWidth,450,null),f.style.pointerEvents="none",c.style.pointerEvents="none",$(c.parentNode).css("pointer-events","none");
else{var k=new Image;$(e).append(k);this.arrImg.push(k);$(k).attr("pageid",a.id);$(k).attr("id","image_bg_"+a.id);$(k).attr("nl","1");k.crossOrigin="anonymous";k.onload=function(){if($(this).parent()){id=parseInt($(this).attr("pageid"));var m=b.pageWidth<k.width?b.pageWidth:k.width,p=Math.floor(k.height*m/k.width);k.width=m;k.height=p;b.resizePage(id,b.pageWidth,p,k)}};k.onerror=function(){if("1"==$(this).attr("nl")){var m=$(this).attr("src");0<=m.indexOf("https://azotacdn.studybymusic.com")&&m.replace("https://azotacdn.studybymusic.com",
"https://wewiin.nyc3.cdn.digitaloceanspaces.com");$(this).attr("src",m+"?time="+(new Date).getTime())}$(this).attr("nl","2")};k.src=a.backgroundImage}else e=b.pageWidth,b.resizePage(a.id,e,4*e/3,null);if(a.draw){a.draw=a.draw.replaceAll("https://cdn.azota.vn/api/download_public","https://wewiin.nyc3.cdn.digitaloceanspaces.com");var l=new Image;$(k).attr("pageid",a.id);l.onload=function(m){if(m=document.getElementById("canvas_"+parseInt($(k).attr("pageid"))))m.setAttribute("hasDraw",!0),m.getContext("2d").drawImage(l,
0,0)};l.crossOrigin="anonymous";l.src=a.draw}else(c=document.getElementById("canvas_"+parseInt($(k).attr("pageid"))))&&c.setAttribute("hasDraw",!1);if(a.staticText&&0<a.staticText.length)for(e=0;e<a.staticText.length;e++)this.addStaticText(a.id,a.staticText[e].value,a.staticText[e].x,a.staticText[e].y);if(a.objText&&0<a.objText.length)for(e=0;e<a.objText.length;e++)this._addText(a.id,a.objText[e].value,a.objText[e].x,a.objText[e].y,a.objText[e].textStyle);this.pageCount++;this.pages.push(a)},exportJSON:function(){var a=
{},b=[];a.pages=b;var c=$(".page"),e=this;$(c).each(function(f){f={};var g=$(this).find(".canvas_draw")[0];f.width=g.width;f.height=g.height;f.id=Number($(this).attr("data"));if(0==g.pagetype){var h=$(this).find("img")[0];f.backgroundImage=$(h).attr("src");f.rotation=parseInt($(h).attr("rotation"))}else f.backgroundImage=e.mnotedata.pages[g.pageid].backgroundImage;var k=$(this).find(".page_objs_layer")[0],l=$(k).find(".obj_static_text");f.staticText=[];for(h=0;h<l.length;h++){var m={};m.x=parseInt($(l[h]).css("left"));
m.y=parseInt($(l[h]).css("top"));$(l[h]).hasClass("wrong")?m.value="wrong":m.value="correct";f.staticText.push(m)}k=$(k).find(".obj_text");f.objText=[];for(h=0;h<k.length;h++)l={},l.x=parseInt($(k[h]).css("left")),l.y=parseInt($(k[h]).css("top")),l.value=$(k[h]).html(),l.textStyle=JSON.parse($(k[h]).attr("styleText").replaceAll("'",'"')),f.objText.push(l);if(0==g.pagetype)try{"true"==g.getAttribute("hasDraw").toString()&&(f.draw=g.toDataURL("image/png"))}catch(p){}b.push(f)});a.staticTextConfig=JSON.stringify(this.staticTextConfig);
try{localStorage.setItem("staticTextConfig",JSON.stringify(this.staticTextConfig))}catch(f){}a.comment=$("#mark_comment_txt").val();a.commentEmoji=[];c=$(".comment_emoji");for(var d=0;d<c.length;d++)a.commentEmoji.push($(c[d]).attr("src"));a.point=$("#mark_number_txt").val();a.point=a.point.replaceAll(",",".");if(void 0==a.point||null==a.point||""==a.point||isNaN(Number(a.point)))a.point=0;a.hideMark=this.mnotedata.hideMark;cc.log("EXPORT JSON "+JSON.stringify(a));return a},updateSaveImageSuccess:function(a,
b){},updateSaveImage:function(a){},updateAllImage:function(){},removeAllPage:function(a){this.pageCount=0;this.pages=[];$("mnote_pages").empty()},removePage:function(a){},moveUpPage:function(a){for(var b=document.getElementById("mnote_pages"),c=b.childNodes,e=-1,d=0;d<c.length;d++)c[d].id=="page_"+a&&(e=d);1<e&&(a=c[e-1],c=c[e],$(a).hasClass("page")&&b.insertBefore(c,a))},moveDownPage:function(a){for(var b=document.getElementById("mnote_pages"),c=b.childNodes,e=-1,d=0;d<c.length;d++)c[d].id=="page_"+
a&&(e=d);e<c.length-1&&(a=c[e+1],c=c[e],$(a).hasClass("page")&&b.insertBefore(a,c))},resizePage:function(a,b,c,e){var d=$("#page_"+a);$("#page_"+a).css("width",b+"px");$("#page_"+a).css("height",c+"px");var f=document.getElementById("canvas_"+a),g=document.getElementById("canvasDraw_"+a);1!=f.isUpdateSize&&(f.width=b,f.height=c,g.width=b,g.height=c,f.isUpdateSize=!0);if(Math.floor(f.height)!=Math.floor(c)&&(f.width=b,f.height=c,g.width=b,g.height=c,this.mnotedata.pages[a].draw)){f=this.mnotedata.pages[a].draw;
f=f.replaceAll("https://cdn.azota.vn/api/download_public","https://wewiin.nyc3.cdn.digitaloceanspaces.com");var h=new Image;h.onload=function(l){(l=document.getElementById("canvas_"+a))&&l.getContext("2d").drawImage(h,0,0)};h.crossOrigin="anonymous";h.src=f}"edit"==this.mnotedata.mode&&$("#mnote_mark").css("top",$(this.note_pages).height()+40+"px");$(this.note_container).height($(this.note_pages).height()*this.pageScale+1.5*window.innerHeight);"edit"==this.mnotedata.mode&&"web"==getOs()&&$(this.note_container).height($(this.note_container).height()+
300);f=null;for(g=0;g<this.mnotedata.pages.length;g++)this.mnotedata.pages[g].id==a&&(f=this.mnotedata.pages[g]);g=0;f&&(g=isNaN(Number(f.rotation))?0:Number(f.rotation));d=$(d).find(".bt-edit-bg");$(d).css("display","none");if(null!=e){$(e).attr("imgwidth",b);$(e).attr("imgheight",c);$(e).attr("rotation",g);this.rotateBgImage(e,g);"edit"==this.mnotedata.mode&&$(d).css("display","block");var k=this;$(d).on("touchend mouseup",function(l){"rotate"==$(this).attr("data")?k.rotateBgPage(Number($(this).parent().attr("data"))):
k.moveUpPage(Number($(this).parent().attr("data")));l.preventDefault();l.stopPropagation()})}},rotateBgPage:function(a){a=document.getElementById("image_bg_"+a);var b=parseInt($(a).attr("rotation"));b-=90;-360>=b&&(b=0);this.rotateBgImage(a,b)},rotateBgImage:function(a,b){var c=parseInt($(a).attr("imgwidth")),e=parseInt($(a).attr("imgheight"));$(a).css("transform","rotate("+b+"deg)");$(a).attr("rotation",b);-90==b||-270==b?e>c?(a.height=c,a.width=Math.floor(c/(e/c))):(a.width=e,a.height=Math.floor(e/
(c/e))):(a.width=c,a.height=e)},addCanvasEventListener:function(a){var b=this;"edit"==this.mnotedata.mode&&(is_touch_device()?(a.addEventListener("touchstart",function(c){b.onCanvasTouchStart(c)}),a.addEventListener("touchmove",function(c){b.onCanvasTouchMove(c)},!1),a.addEventListener("touchend",function(c){b.onCanvasTouchEnd(c)})):(a.addEventListener("mousedown",function(c){b.onCanvasTouchStart(c)}),a.addEventListener("mousemove",function(c){b.onCanvasTouchMove(c)},!1)))},onCanvasTouchStart:function(a){cc.log("touch start");
var b=a.currentTarget,c=this.getCoorTouchEvent(b,a);b.downing=!0;b.downx=c.x;b.downy=c.y;b.downclientx=c.clientX;b.downclienty=c.clientY;b.lastmoveclientx=c.clientX;b.lastmoveclienty=c.clientY;b.lastmovex=c.x;b.lastmovey=c.y;b.lastmovex1=c.x;b.lastmovey1=c.y;b.downtime=(new Date).getTime();b.movefar=!1;this.mode==this.MODE_NORMAL?a.preventDefault():this.mode==this.MODE_DRAWRING?(c=b.getContext("2d"),c.moveTo(b.lastmovex,b.lastmovey),c.beginPath(),this.currBrush!=this.BRUSH_MOVE&&this.currBrush!=this.BRUSH_TEXT&&
($(".obj_text").css("pointer-events","none"),$(".obj_static_text").css("pointer-events","none")),a.preventDefault()):this.mode==this.MODE_ENTER_TEXT?a.preventDefault():this.mode==this.MODE_EDIT_TEXT&&a.preventDefault()},onCanvasTouchMove:function(a){var b=a.currentTarget,c=document.getElementById("canvasDraw_"+b.pageid),e=this.getCoorTouchEvent(b,a);b.downing&&(30<Math.abs(e.x-b.downx)||30<Math.abs(e.y-b.downy))&&(b.movefar=!0);if(this.mode==this.MODE_NORMAL)b.lastmovex=e.x,b.lastmovey=e.y,b.lastmoveclientx=
e.clientX,b.lastmoveclienty=e.clientY;else if(this.mode==this.MODE_DRAWRING){var d=!1;a.touches&&1<a.touches.length&&(d=!0);this.currBrush!=this.BRUSH_MOVE&&this.currBrush!=this.BRUSH_TEXT&&b.downing&&!d&&(1<Math.abs(e.x-b.lastmovex)||1<Math.abs(e.y-b.lastmovey))&&(ctx=this.currBrush==this.BRUSH_PEN||this.currBrush==this.BRUSH_ERASE?b.getContext("2d"):c.getContext("2d"),ctx.lineCap="round",ctx.lineJoin="round",ctx.strokeMiterLimit=1,ctx.globalAlpha=this.currDrawStyle.alpha,ctx.strokeStyle=this.currDrawStyle.strokeStyle,
ctx.lineWidth=this.currDrawStyle.lineWidth,this.currBrush==this.BRUSH_PEN&&(ctx.globalCompositeOperation="source-over"),this.currBrush==this.BRUSH_ERASE&&(ctx.globalCompositeOperation="destination-out",ctx.lineWidth=10*this.currDrawStyle.lineWidth,ctx.lineWidth=30>ctx.lineWidth?30:ctx.lineWidth),this.currBrush==this.BRUSH_PEN||this.currBrush==this.BRUSH_ERASE?(ctx.beginPath(),is_touch_device()?(ctx.moveTo(b.lastmovex1,b.lastmovey1),ctx.lineTo(e.x,e.y)):(ctx.moveTo(b.lastmovex,b.lastmovey),ctx.quadraticCurveTo(b.lastmovex1,
b.lastmovey1,(b.lastmovex1+e.x)/2,(b.lastmovey1+e.y)/2)),ctx.stroke()):(ctx.clearRect(0,0,b.width,b.height),this.currBrush==this.BRUSH_LINE&&(ctx.beginPath(),ctx.moveTo(b.downx,b.downy),ctx.lineTo(e.x,e.y),ctx.stroke()),this.currBrush==this.BRUSH_RECTANGLE&&(ctx.beginPath(),a=Math.min(b.downx,e.x),c=Math.min(b.downy,e.y),ctx.rect(a,c,Math.max(b.downx,e.x)-a,Math.max(b.downy,e.y)-c),ctx.stroke()),this.currBrush==this.BRUSH_CIRCLE&&(ctx.beginPath(),ctx.arc(b.downx,b.downy,Math.floor(Math.sqrt((b.downx-
e.x)*(b.downx-e.x)+(b.downy-e.y)*(b.downy-e.y))),0,2*Math.PI),ctx.stroke()),this.currBrush==this.BRUSH_ARROW&&(ctx.beginPath(),ctx.moveTo(b.downx,b.downy),ctx.lineTo(e.x,e.y),ctx.stroke(),drawArrowhead(ctx,{x:b.downx,y:b.downy},{x:e.x,y:e.y},3*ctx.lineWidth))),b.lastmovex=b.lastmovex1,b.lastmovey=b.lastmovey1,b.lastmovex1=e.x,b.lastmovey1=e.y,b.lastmoveclientx=e.clientX,b.lastmoveclienty=e.clientY)}else this.mode==this.MODE_ENTER_TEXT?(b.lastmovex=e.x,b.lastmovey=e.y,b.lastmoveclientx=e.clientX,b.lastmoveclienty=
e.clientY,a.preventDefault()):this.mode==this.MODE_EDIT_TEXT&&a.preventDefault()},onCanvasTouchEnd:function(a){cc.log("touch end");var b=a.currentTarget;this.mode==this.MODE_NORMAL?(this.onCanvasEnd(b),a.preventDefault()):this.mode==this.MODE_DRAWRING?(this.onCanvasEnd(b),a.preventDefault()):this.mode==this.MODE_ENTER_TEXT?(this.onCanvasEnd(b),a.preventDefault(),a.stopPropagation()):this.mode==this.MODE_EDIT_TEXT&&(this.onCanvasEnd(b),a.preventDefault())},onCanvasEnd:function(a){var b=this,c=(new Date).getTime();
if(a.downing){cc.log("onCanvasEnd "+a.lastmovex+":"+a.downx+":"+a.lastmovey+":"+a.downy+":"+this.mode+":"+this.currBrush);cc.log("onCanvasEnd "+a.lastmoveclientx+":"+a.downclientx+":"+a.lastmoveclienty+":"+a.downclienty+":"+this.mode+":"+this.currBrush);var e=!0,d=this.mode;d==this.MODE_ENTER_TEXT&&(is_touch_device()?this.checkIsTouchTapCanvas(a)&&(this.blurText(),this.setMode(this.MODE_DRAWRING),this.setBrushDraw(this.BRUSH_MOVE)):(this.blurText(),this.setMode(this.MODE_DRAWRING)),e=!1);if(d==this.MODE_DRAWRING){this.currBrush==
this.BRUSH_TEXT&&(is_touch_device()?this.checkIsTouchTapCanvas(a)&&this.addText(a.index,a.lastmovex,a.lastmovey):this.addText(a.index,a.lastmovex,a.lastmovey),e=!1);this.currBrush==this.BRUSH_ERASE&&(e=!1);this.currBrush==this.BRUSH_PEN&&(e=!1,a.setAttribute("hasDraw",!0));var f=document.getElementById("canvasDraw_"+a.pageid);d=a.getContext("2d");f.getContext("2d").clearRect(0,0,a.width,a.height);d.lineCap="round";d.lineJoin="round";d.strokeMiterLimit=10;d.shadowColor="rgba(0,0,0,.5)";d.globalAlpha=
this.currDrawStyle.alpha;d.strokeStyle=this.currDrawStyle.strokeStyle;d.lineWidth=this.currDrawStyle.lineWidth;d.globalCompositeOperation="source-over";this.currBrush==this.BRUSH_LINE&&(d.beginPath(),d.moveTo(a.downx,a.downy),d.lineTo(a.lastmovex1,a.lastmovey1),d.stroke(),a.setAttribute("hasDraw",!0),e=!1);this.currBrush==this.BRUSH_RECTANGLE&&(d.beginPath(),e=Math.min(a.downx,a.lastmovex1),f=Math.min(a.downy,a.lastmovey1),d.rect(e,f,Math.max(a.downx,a.lastmovex1)-e,Math.max(a.downy,a.lastmovey1)-
f),d.stroke(),a.setAttribute("hasDraw",!0),e=!1);this.currBrush==this.BRUSH_CIRCLE&&(d.beginPath(),d.arc(a.downx,a.downy,Math.floor(Math.sqrt((a.downx-a.lastmovex1)*(a.downx-a.lastmovex1)+(a.downy-a.lastmovey1)*(a.downy-a.lastmovey1))),0,2*Math.PI),d.stroke(),a.setAttribute("hasDraw",!0));this.currBrush==this.BRUSH_ARROW&&(d.beginPath(),d.moveTo(a.downx,a.downy),d.lineTo(a.lastmovex1,a.lastmovey1),d.stroke(),drawArrowhead(d,{x:a.downx,y:a.downy},{x:a.lastmovex1,y:a.lastmovey1},3*d.lineWidth),a.setAttribute("hasDraw",
!0));$(".obj_text").css("pointer-events","all");$(".obj_static_text").css("pointer-events","all")}e&&(d=!1,is_touch_device()?150>c-a.downtime&&0<a.downy&&0<a.downx&&0<a.lastmovex&&0<a.lastmovey&&13>Math.abs(a.lastmoveclientx-a.downclientx)&&13>Math.abs(a.lastmoveclienty-a.downclienty)&&(d=!0):d=!0,d?void 0!=a.endtime?200>c-a.endtime?(a.tapCount++,cc.log(a.tapCount+" multi click canvas "+a.index+":"+a.endx+":"+a.endy),2==a.tapCount&&this.doubleClickCanvas(a)):a.tapCount=1:a.tapCount=1:a.tapCount=0,
1==a.tapCount&&setTimeout(function(){1==a.tapCount&&b.clickCanvas(a)},200));a.endtime=c;a.endx=a.lastmovex;a.endy=a.lastmovey;a.endmovefar=a.movefar;a.downing=!1;a.downx=-1;a.downy=-1;a.lastmovex=-1;a.lastmovey=-1;a.downtime=0;a.movefar=!1}},checkIsTouchTapCanvas:function(a){return 150>(new Date).getTime()-a.downtime&&0<a.downy&&0<a.downx&&0<a.lastmovex&&0<a.lastmovey&&13>Math.abs(a.lastmoveclientx-a.downclientx)&&13>Math.abs(a.lastmoveclienty-a.downclienty)?!0:!1},clickCanvas:function(a){cc.log("click canvas "+
a.index+":"+a.endx+":"+a.endy+":"+this.staticTextConfig.correctWidth/2);this.mode==this.MODE_NORMAL&&this.addStaticText(a.index,"correct",a.endx-30,a.endy-this.staticTextConfig.correctHeight/2);this.mode==this.MODE_DRAWRING&&(this.currBrush==this.BRUSH_TEXT||a.endmovefar||this.addStaticText(a.index,"correct",a.endx-30,a.endy-this.staticTextConfig.correctHeight/2))},doubleClickCanvas:function(a){cc.log("double click canvas "+a.index+":"+a.endx+":"+a.endy);this.mode==this.MODE_NORMAL&&this.addStaticText(a.index,
"wrong",a.endx-30,a.endy-this.staticTextConfig.wrongHeight/2);this.mode==this.MODE_DRAWRING&&(this.currBrush==this.BRUSH_TEXT||a.endmovefar||this.addStaticText(a.index,"wrong",a.endx-30,a.endy-this.staticTextConfig.wrongHeight/2))},getCoorTouchCanvas:function(a,b){var c=b.clientX,e=b.clientY,d=a.getBoundingClientRect();c=Math.floor((c-d.left)*($(a).width()/d.width));e=Math.floor((e-d.top)*($(a).height()/d.height));return{x:c,y:e}},getCoorTouchEvent:function(a,b){if(b.touches){if(1>b.touches.length)return{x:0,
y:0};var c=b.touches[b.touches.length-1],e=c.clientX;c=c.clientY;var d=a.getBoundingClientRect(),f=Math.floor((e-d.left)*($(a).width()/d.width));d=Math.floor((c-d.top)*($(a).height()/d.height))}else e=b.clientX,c=b.clientY,d=a.getBoundingClientRect(),f=Math.floor((e-d.left)*($(a).width()/d.width)),d=Math.floor((c-d.top)*($(a).height()/d.height));return{clientX:e,clientY:c,x:f,y:d}},getCoorTouch:function(a){if(a.touches&&1==a.touches.length){var b=a.touches[a.touches.length-1].clientX;a=a.touches[a.touches.length-
1].clientY}else b=a.clientX,a=a.clientY;return{clientX:b,clientY:a,x:b,y:a}},showMenuNormal:function(){$("#mnote_hold_bt").css("display","flex");$("#mnote_setting_bt").css("display","block");$("#mnote_help").css("display","block");$(".help_text").css("display","block")},hideMenuNormal:function(){$("#mnote_hold_bt").css("display","none");$("#mnote_setting_bt").css("display","none");$(".help_text").css("display","none")},setMode:function(a){a!=this.mode&&(this.hideMenuDraw(),this.hideMenuText(),this.hideMenuNormal(),
a==this.MODE_NORMAL&&(this.showMenuNormal(),this.blurText(),is_touch_device()||$("#mnote_pages").css("cursor","default")),a==this.MODE_ENTER_TEXT&&this.showMenuText(),a==this.MODE_DRAWRING&&this.showMenuDraw(),this.mode=a)},enterDrawingMode:function(){this.isDrawingMode=!0;this.mode=this.MODE_DRAWRING;this.showMenuDraw()},exitDrawingMode:function(){this.isDrawingMode=!1;this.mode=this.MODE_NORMAL;$(".help_text").css("display","block");this.hideMenuDraw();$("#mnote_hold_bt").css("display","flex")},
showMenuDraw:function(){is_touch_device()?$("#mnote_menu_bottom").css("display","block"):($("#mnote_menu_draw").find("span").first(),$("#mnote_menu_draw").css("display","flex"),gsap.fromTo(".btn-menu-draw",{scale:1},{scale:1,duration:.1,ease:"expo.out"}));this.currBrush==this.BRUSH_TEXT&&this.setBrushDraw(this.BRUSH_MOVE)},hideMenuDraw:function(){is_touch_device()?$("#mnote_menu_bottom").css("display","none"):(clearInterval(this.ivtInvisibleSpanMenuDraw),$("#mnote_menu_draw").css("display","none"))},
setBrushDraw:function(a){this.currBrush=a;is_touch_device()||(a==this.BRUSH_PEN||a==this.BRUSH_LINE||a==this.BRUSH_RECTANGLE||a==this.BRUSH_CIRCLE||a==this.BRUSH_ARROW?$("#mnote_pages").css("cursor","url('images/pen.png') 0 20, auto"):a==this.BRUSH_ERASE?$("#mnote_pages").css("cursor","url('images/erase.png') 0 20, auto"):a==this.BRUSH_TEXT?$("#mnote_pages").css("cursor","url('images/text.png') 0 20, auto"):$("#mnote_pages").css("cursor","default"));this.setDrawStyle(this.currDrawStyle)},showMenuColor:function(){$(this.mnote_menu_color).css("display",
"block");gsap.fromTo(this.menu_color_content,{scale:.1},{scale:1,duration:.15,ease:"expo.out"})},hideMenuColor:function(){$(this.mnote_menu_color).css("display","none")},setDrawStyle:function(a){cc.log("setDrawStyle "+JSON.stringify(a));a.lineWidth&&(this.currDrawStyle.lineWidth=a.lineWidth);a.strokeStyle&&(this.currDrawStyle.strokeStyle=a.strokeStyle);a.alpha&&(this.currDrawStyle.alpha=a.alpha);cc.log("setDrawStyle "+JSON.stringify(this.currDrawStyle)+":"+this.currBrush);$("#btn_thick_preview").css("opacity",
this.currDrawStyle.alpha);var b=this;$(".btn-content-color").each(function(c){$(this).empty();$(this).attr("data")==b.currDrawStyle.strokeStyle&&$(this).append($('<i class="material-icons">check</i>'))});$("#btn_draw_color").find("svg").css("fill",this.currDrawStyle.strokeStyle);$("#btn_thick_preview").css("background-color",this.currDrawStyle.strokeStyle);$(this.thickSliderInput).val(this.currDrawStyle.lineWidth);$("#btn_thick_preview").css("width",this.currDrawStyle.lineWidth+5+"px");$("#btn_thick_preview").css("height",
this.currDrawStyle.lineWidth+5+"px");this.setActiveButton(this.btnDrawPen,!1);this.setActiveButton(this.btnDrawErase,!1);this.setActiveButton(this.btnDrawText,!1);this.setActiveButton(this.btnDrawMove,!1);this.setActiveButton(this.contentBushPen,!1);this.setActiveButton(this.contentBushLine,!1);this.setActiveButton(this.contentBushRect,!1);this.setActiveButton(this.contentBushCircle,!1);this.setActiveButton(this.contentBushArrow,!1);$(".btn-option-draw").css("background-color","black");$(".btn-option-draw").find("svg").css("fill",
"#888888");$(".btn-option-draw").find("svg").css("color","#888888");$(".btn-option-draw").find("i").css("color","#888888");$("#option_brush").css("display","none");this.currBrush==this.BRUSH_PEN&&(this.setActiveButton(this.btnDrawPen,!0,this.currDrawStyle.strokeStyle),this.setActiveButton(this.contentBushPen,!0,this.currDrawStyle.strokeStyle),$("#btn_option_pen").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_pen").find("svg").css("fill","white"),$("#btn_option_pen").find("i").css("color",
"white"),$("#option_brush").css("display","block"),$("#btn_option_brush_pen").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_brush_pen").find("svg").css("fill","white"),$("#btn_option_brush_pen").find("svg").css("color","white"),$("#btn_option_brush_pen").find("i").css("color","white"));this.currBrush==this.BRUSH_LINE&&(this.setActiveButton(this.btnDrawPen,!0,this.currDrawStyle.strokeStyle),this.setActiveButton(this.contentBushLine,!0,this.currDrawStyle.strokeStyle),$("#btn_option_pen").css("background-color",
this.currDrawStyle.strokeStyle),$("#btn_option_pen").find("svg").css("fill","white"),$("#btn_option_pen").find("i").css("color","white"),$("#option_brush").css("display","block"),$("#btn_option_brush_line").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_brush_line").find("svg").css("fill","white"),$("#btn_option_brush_line").find("svg").css("color","white"),$("#btn_option_brush_line").find("i").css("color","white"));this.currBrush==this.BRUSH_RECTANGLE&&(this.setActiveButton(this.btnDrawPen,
!0,this.currDrawStyle.strokeStyle),this.setActiveButton(this.contentBushRect,!0,this.currDrawStyle.strokeStyle),$("#btn_option_pen").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_pen").find("svg").css("fill","white"),$("#btn_option_pen").find("i").css("color","white"),$("#option_brush").css("display","block"),$("#btn_option_brush_rect").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_brush_rect").find("svg").css("fill","white"),$("#btn_option_brush_rect").find("svg").css("color",
"white"),$("#btn_option_brush_rect").find("i").css("color","white"));this.currBrush==this.BRUSH_CIRCLE&&(this.setActiveButton(this.btnDrawPen,!0,this.currDrawStyle.strokeStyle),this.setActiveButton(this.contentBushCircle,!0,this.currDrawStyle.strokeStyle),$("#btn_option_pen").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_pen").find("svg").css("fill","white"),$("#btn_option_pen").find("i").css("color","white"),$("#option_brush").css("display","block"),$("#btn_option_brush_circle").css("background-color",
this.currDrawStyle.strokeStyle),$("#btn_option_brush_circle").find("svg").css("fill","white"),$("#btn_option_brush_circle").find("svg").css("color","white"),$("#btn_option_brush_circle").find("i").css("color","white"));this.currBrush==this.BRUSH_ARROW&&(this.setActiveButton(this.btnDrawPen,!0,this.currDrawStyle.strokeStyle),this.setActiveButton(this.contentBushArrow,!0,this.currDrawStyle.strokeStyle),$("#btn_option_pen").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_pen").find("svg").css("fill",
"white"),$("#btn_option_pen").find("i").css("color","white"),$("#option_brush").css("display","block"),$("#btn_option_brush_arrow").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_brush_arrow").find("svg").css("fill","white"),$("#btn_option_brush_arrow").find("svg").css("color","white"),$("#btn_option_brush_arrow").find("i").css("color","white"));this.currBrush==this.BRUSH_ERASE&&(this.setActiveButton(this.btnDrawErase,!0,this.currDrawStyle.strokeStyle),$("#btn_option_erase").css("background-color",
this.currDrawStyle.strokeStyle),$("#btn_option_erase").find("svg").css("fill","white"),$("#btn_option_erase").find("i").css("color","white"));this.currBrush==this.BRUSH_TEXT&&(this.setActiveButton(this.btnDrawText,!0,this.currDrawStyle.strokeStyle),$("#btn_option_text").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_text").find("svg").css("fill","white"),$("#btn_option_text").find("i").css("color","white"));this.currBrush==this.BRUSH_MOVE&&(this.setActiveButton(this.btnDrawMove,
!0,this.currDrawStyle.strokeStyle),$("#btn_option_move").css("background-color",this.currDrawStyle.strokeStyle),$("#btn_option_move").find("svg").css("fill","white"),$("#btn_option_move").find("i").css("color","white"));$("#thick_slider").find(".thumb").css("display","block");$("#thick_slider").find(".thumb").css("opacity",.7);$("#thick_slider").find(".thumb").css("background-color",this.currDrawStyle.strokeStyle);$("#color_preview").css("background-color",this.currDrawStyle.strokeStyle);$("#color_preview").css("opacity",
this.currDrawStyle.alpha);$("#color_preview").css("width",this.currDrawStyle.lineWidth+5+"px");$("#color_preview").css("height",this.currDrawStyle.lineWidth+5+"px");$("#btn_hold_draw").css("background-color",this.currDrawStyle.strokeStyle);$("#mnote_hold_bt").find("span").css("color",this.currDrawStyle.strokeStyle);$(this.btnDrawFinish).css("color",this.currDrawStyle.strokeStyle);a=this.currDrawStyle.lineWidth;$("#preview_draw_bt").css("width",3+a+"px");$("#preview_draw_bt").css("height",3+a+"px");
$("#preview_draw_bt").css("background-color",this.currDrawStyle.strokeStyle);b=this;$(".btn-color-bottom-small").each(function(c){$(this).empty();$(this).parent().css("border","none");$(this).attr("data")==b.currDrawStyle.strokeStyle&&($(this).append($('<i class="material-icons">check</i>')),$(this).parent().css("border","solid 1px #CCCCCC"))});try{localStorage&&localStorage.setItem("drawStyle",JSON.stringify(this.currDrawStyle))}catch(c){}},setActiveButton:function(a,b,c){b?($(a).removeClass($(a).attr("activeColor")),
$(a).addClass(c),$(a).find("svg").css("fill","white"),$(a).find("svg").css("color","white"),$(a).find("i").css("color","white"),$(a).attr("activeColor",c)):($(a).removeClass($(a).attr("activeColor")),$(a).addClass("white"),$(a).find("svg").css("fill","#666666"),$(a).find("svg").css("color","#666666"),$(a).find("i").css("color","#666666"),$(a).attr("activeColor","white"))},lastXStaticTextAdded:-1,lastYStaticTextAdded:-1,addStaticText:function(a,b,c,e){var d=document.getElementById("canvas_"+a).height,
f=document.getElementById("canvas_"+a).width;c=Math.abs(c);e=Math.abs(e);0>c||0>e||c>f-40||e>d-40||2>Math.abs(c-this.lastXStaticTextAdded)&&2>Math.abs(e-this.lastYStaticTextAdded)||(d="","wrong"==b.toLowerCase()?this.staticTextConfig.useWrongText&&(d=this.staticTextConfig.textWrong):this.staticTextConfig.useCorrectText&&(d=this.staticTextConfig.textCorrect),d=$("<span pageid="+a+' class="obj_static_text"><span>'+d+"</span></span>"),f=$("#page_"+a).find(".page_objs_layer")[0],$(f).append(d),$(d).css("position",
"absolute"),$(d).attr("pageid",a),$(d).css("font-family",this.staticTextConfig.fontText),$(d).css("font-size",this.staticTextConfig.fontSize+"px"),$(d).css("text-align","center"),$(d).css("font-weight","bold"),$(d).css("min-width","50px"),$(d).css("min-height","50px"),$(d).css("text-shadow","1px 1px 1px #827e7e"),$(d).css("left",Math.floor(c)+"px"),$(d).css("top",Math.floor(e)+"px"),this.lastXStaticTextAdded=c,this.lastYStaticTextAdded=e,"wrong"==b.toLowerCase()?(this.countWrong++,$(d).addClass("wrong"),
a=this.staticTextConfig.fontColor,b=$('<img class="wrong_img" src="'+this.staticTextConfig.urlImgWrong+'" width="30" height="30"/>'),$(d).append($(b)),this.staticTextConfig.useWrongText?($(b).css("display","none"),$(d).find("span").css("display","block")):($(b).css("display","block"),$(d).find("span").css("display","none"))):(this.countRight++,$(d).addClass("correct"),a=this.staticTextConfig.fontColor,b=$('<img class="correct_img" src="'+this.staticTextConfig.urlImgCorrect+'" width="30" height="30" />'),
$(d).append($(b)),this.staticTextConfig.useCorrectText?($(b).css("display","none"),$(d).find("span").css("display","block")):($(b).css("display","block"),$(d).find("span").css("display","none"))),this.updateMark(),$(d).css("color",a),"edit"==this.mnotedata.mode&&$(d).css("pointer-events","all"),this.moveable(d))},moveable:function(a){if("edit"==this.mnotedata.mode){var b=this;$(a).on("touchstart mousedown",function(c){if(!(c.touches&&1<c.touches.length)){var e=b.getCoorTouch(c);$(this).attr("downx",
Math.floor(e.x));$(this).attr("downy",Math.floor(e.y));$(this).attr("clientx",Math.floor(e.clientX));$(this).attr("clienty",Math.floor(e.clientY));$(this).attr("lastx",Math.floor(e.x));$(this).attr("lasty",Math.floor(e.y));$(this).attr("downtime",(new Date).getTime());$(".obj_down").removeClass("obj_down");$(this).addClass("obj_down");b.mode!=b.MODE_ENTER_TEXT&&($("#bt_trash").css("display","block"),$("#bt_trash").css("opacity",.7));$(a).hasClass("obj_static_text")&&(c.preventDefault(),c.stopPropagation(),
b.setObjsActive(this))}});$(a).on("touchmove",function(c){c.touches&&1<c.touches.length||(b.getCoorTouch(c),b._moveObj(c.currentTarget,c),c.preventDefault(),c.stopPropagation())});$(a).on("touchend mouseup",function(c){b._endObj(this,c);c.preventDefault();c.stopPropagation()})}},_moveObj:function(a,b){if("true"==$(a).hasClass("obj_down").toString()){var c=this.getCoorTouch(b),e=parseInt($(a).attr("downx")),d=parseInt($(a).attr("downy"));if(5<Math.abs(c.x-e)||5<Math.abs(c.y-d)){var f=this.getCoorTouchEvent(a.parentNode,
b);$(a).css("left",Math.floor(f.x-$(a).width()/2)+"px");$(a).css("top",Math.floor(f.y-$(a).height()/2)+"px")}$(a).attr("lastx",c.x);$(a).attr("lasty",c.y);(10<Math.abs(c.clientX-e)||10<Math.abs(c.clientY-d))&&$(a).attr("movefar",!0);$(a).attr("clientx",Math.floor(c.clientX));$(a).attr("clienty",Math.floor(c.clientY));c=parseInt($(a).attr("clientx"));e=parseInt($(a).attr("clienty"));c>self.appWidth/2-30&&c<self.appWidth/2+30&&70>e?$("#bt_trash").css("opacity",1):$("#bt_trash").css("opacity",.7)}},
_endObj:function(a,b){if("true"==$(a).hasClass("obj_down").toString()){parseInt($(a).attr("downx"));parseInt($(a).attr("downy"));parseInt($(a).attr("lastx"));var c=parseInt($(a).attr("lasty")),e=parseInt($(a).attr("clientx")),d=parseInt($(a).attr("clienty"));if("true"!=$(a).attr("movefar")&&($(a).hasClass("obj_text")&&!$(a).hasClass("focusing")&&(this.focusText(a),b.preventDefault(),b.stopPropagation()),$(a).hasClass("obj_static_text")&&$(a).hasClass("correct"))){$(a).removeClass("correct");$(a).addClass("wrong");
$(a).find("span").html(this.staticTextConfig.textWrong);var f=$(a).find("img");0<f.length&&($(f[0]).attr("src",this.staticTextConfig.urlImgWrong),$(f[0]).removeClass("correct_img"),$(f[0]).addClass("wrong_img"));this.staticTextConfig.useWrongText?($(a).find("span").css("display","block"),$(a).find("img").css("display","none")):($(a).find("span").css("display","none"),$(a).find("img").css("display","block"));this.countRight--;this.countWrong++;this.updateMark()}$(a).attr("movefar",!1);$("#bt_trash").css("display",
"none");cc.log("pos up "+e+":"+d+":"+this.appWidth+":"+this.appHeight/2+":"+c);if(is_touch_device()){if(e>this.appWidth/2-30&&e<this.appWidth/2+30&&70>d){$(a).remove();this.updateMark();b.preventDefault();b.stopPropagation();return}}else if(0<e&&80>e&&d<this.appHeight/2+30&&d>this.appHeight/2-30){$(a).remove();this.updateMark();b.preventDefault();b.stopPropagation();return}c=parseInt($(a).css("left"));e=parseInt($(a).css("top"));d=document.getElementById("canvas_"+parseInt($(a).attr("pageid"))).height;
if(0>c||0>e||c>this.pageWidth-40||e>d-40)$(a).remove(),this.updateMark(),b.preventDefault(),b.stopPropagation();c=parseInt($(a).attr("lastTouchTime"));if($(a).hasClass("obj_static_text")){var g=(new Date).getTime();if(!isNaN(c)&&(e=is_touch_device()?300:700,g-c<e)){$(a).hasClass("wrong")?this.countWrong--:this.countRight--;$(a).remove();this.updateMark();b.preventDefault();b.stopPropagation();return}this.inactiveAllObj()}$(a).attr("lastTouchTime",g);$(".obj_down").removeClass("obj_down")}},setObjsActive:function(a){this.inactiveAllObj();
$(a).addClass("obj_active");$(a).css("border","2px dashed")},inactiveAllObj:function(){$(".obj_active").css("border","none");$(".obj_active").removeClass("obj_active")},initMenuBottom:function(){var a="green red purple #3f51b5 teal #03a9f4 yellow #cddc39 cyan #ffc107 #795548 #424242".split(" ");$("#menu_bottom_2_content").empty();for(var b=0;b<a.length;b++){var c=$('<div class="btn-color-bottom"><div data="'+a[b]+'" class="btn-color-bottom-small  btn-small btn-floating btn-flat waves-effect waves-light" style="background-color:'+
a[b]+'"></div></div>');$("#menu_bottom_2_content").append($(c))}var e=this;$(".btn-color-bottom-small").click(function(d){e.setDrawStyle({strokeStyle:$(this).attr("data")})});this.canvas_slider=document.getElementById("canvas_slider");this.createCanvasSlider($("#menu_bottom_slider"),"#888888",this.minLineWidth,this.maxLineWidth,this.currDrawStyle.lineWidth);$(".btn-option-draw").click(function(d){d=$(this).attr("data");"pen"==d&&e.setBrushDraw(e.BRUSH_PEN);"erase"==d&&e.setBrushDraw(e.BRUSH_ERASE);
"move"==d&&e.setBrushDraw(e.BRUSH_MOVE);"text"==d&&e.setBrushDraw(e.BRUSH_TEXT);"line"==d&&e.setBrushDraw(e.BRUSH_LINE);"rect"==d&&e.setBrushDraw(e.BRUSH_RECTANGLE);"circle"==d&&e.setBrushDraw(e.BRUSH_CIRCLE);"arrow"==d&&e.setBrushDraw(e.BRUSH_ARROW)});$("#menu_bottom_close").on("touchstart mouseup",function(d){e.setMode(e.MODE_NORMAL);d.stopPropagation();d.preventDefault()});$("#mnote_menu_bottom").on("touchstart",function(d){})},createCanvasSlider:function(a,b,c,e,d){var f=this,g=$(a).find("canvas");
if(!(1>g.length)){var h=g[0];g=$(a).find(".thumb");if(!(1>g.length)){var k=g[0];g=h.getContext("2d");g.strokeStyle=b;g.lineWidth=4;h.min=c;h.max=e;g.fillStyle=b;g.moveTo(4,canvas_slider.height/2);g.beginPath();g.lineCap="round";g.strokeMiterLimit=2;g.lineTo(h.width,Math.floor(h.height/2-5));g.lineTo(h.width,Math.floor(h.height/2+5));g.lineTo(4,h.height/2);g.closePath();g.fill();g.stroke();this.setCanvasSliderValue(a,d);is_touch_device()?(h.addEventListener("touchstart",function(l){f._updateThumbSlider(a,
l);l.stopPropagation();l.preventDefault()}),h.addEventListener("touchmove",function(l){f._updateThumbSlider(a,l)}),$(k).on("touchstart",function(l){f._updateThumbSlider(a,l);l.stopPropagation();l.preventDefault()}),$(k).on("touchmove",function(l){f._updateThumbSlider(a,l);l.stopPropagation();l.preventDefault()})):(h.addEventListener("mousedown",function(l){h.isMouseDown=!0;f._updateThumbSlider(a,l);l.stopPropagation();l.preventDefault()}),h.addEventListener("mousemove",function(l){1==h.isMouseDown&&
f._updateThumbSlider(a,l)}),h.addEventListener("mouseup",function(l){h.isMouseDown=!1;$(k).attr("mousedown","false")}),$(k).css("pointer-events","none"))}}},setCanvasSliderValue:function(a,b){var c=$(a).find("canvas");if(!(1>c.length)){c=c[0];var e=$(a).find(".thumb");if(!(1>e.length)){e=e[0];b>c.max&&(b=max);b<c.min&&(b=min);var d=(b-c.min)/(c.max-c.min),f=3+20*d;$(e).css("width",f+"px");$(e).css("height",f+"px");$(e).css("top",Math.floor(c.height-f)/2+"px");$(e).css("left",Math.floor(c.width*d)-
f/2+"px");c.value=b;c==this.canvas_slider&&this.setDrawStyle({lineWidth:b});c==this.slider_text_size&&this.setTextStyle({size:b})}}},_updateThumbSlider:function(a,b){var c=$(a).find("canvas");if(!(1>c.length)){c=c[0];var e;if(e=is_touch_device()?b.touches[0]:{clientX:b.clientX}){var d=c.getBoundingClientRect();e=e.clientX-d.left;0>e&&(e=0);e>c.width&&(e=c.width);this.setCanvasSliderValue(a,Math.floor(c.min+(c.max-c.min)*e/c.width))}}},initMenuText:function(){var a="green red purple #3f51b5 teal #03a9f4 yellow #cddc39 cyan #ffc107 #795548 #424242".split(" ");
$("#menu_text_color_content").empty();for(var b=0;b<a.length;b++){var c=$('<div class="btn-color-text"><div data="'+a[b]+'" class="btn-color-text-small  btn-small btn-floating btn-flat waves-effect waves-light" style="background-color:'+a[b]+'"></div></div>');$("#menu_text_color_content").append($(c))}this.slider_text_size=document.getElementById("slider_text_size");this.createCanvasSlider("#menu_text_slider","black",this.minTextSize,this.maxTextSize,this.currTextStyle.size);var e=this;is_touch_device()?
($(".btn-color-text-small").on("touchstart",function(d){1<d.touches.length||($(this).attr("downx",d.touches[0].clientX),$(this).attr("downy",d.touches[0].clientY),$(this).attr("movex",d.touches[0].clientX),$(this).attr("movey",d.touches[0].clientY))}),$(".btn-color-text-small").on("touchmove",function(d){1<d.touches.length||($(this).attr("movex",d.touches[0].clientX),$(this).attr("movey",d.touches[0].clientY))}),$(".btn-color-text-small").on("touchend",function(d){var f=parseInt($(this).attr("downx")),
g=parseInt($(this).attr("downy")),h=parseInt($(this).attr("movex")),k=parseInt($(this).attr("movey"));13>Math.abs(f-h)&&13>Math.abs(g-k)&&e.setTextStyle({color:$(this).attr("data")});d.stopPropagation();d.preventDefault()}),$("#btn_option_align").on("touchend",function(d){"left"==e.currTextStyle.align?e.setTextStyle({align:"center"}):"center"==e.currTextStyle.align?e.setTextStyle({align:"right"}):"right"==e.currTextStyle.align?e.setTextStyle({align:"left"}):(d.stopPropagation(),d.preventDefault())}),
$("#btn_option_fill").on("touchend",function(d){e.currTextStyle.fill?e.setTextStyle({fill:!1}):e.setTextStyle({fill:!0});d.stopPropagation();d.preventDefault()}),$("#btn_option_font").on("touchend",function(d){isDomVisile(document.getElementById("menu_text_font"))?$("#menu_text_font").css("display","none"):$("#menu_text_font").css("display","block");d.stopPropagation();d.preventDefault()}),$(".font_chu").on("touchstart",function(d){e.setTextStyle({font:$(this).attr("data")});d.stopPropagation();d.preventDefault()}),
$("#menu_text_option").on("touchstart mousedown",function(d){d.preventDefault()}),$("#mnote_menu_text").on("touchend mouseup",function(d){d.stopPropagation();d.preventDefault()}),$("#menu_text_close").on("touchend",function(d){e.blurText();e.setMode(e.MODE_DRAWRING);d.stopPropagation();d.preventDefault()}),$("#btn_text_size").on("touchend",function(d){isDomVisile(document.getElementById("menu_text_slider"))?$("#menu_text_slider").css("display","none"):$("#menu_text_slider").css("display","flex");
d.stopPropagation();d.preventDefault()}),$("#menu_text_color").on("touchstart",function(d){d.stopPropagation()})):($(".btn-color-text-small").on("mousedown",function(d){e.setTextStyle({color:$(this).attr("data")});d.stopPropagation();d.preventDefault()}),$("#btn_option_align").on("mousedown",function(d){d.stopPropagation();d.preventDefault();"left"==e.currTextStyle.align?e.setTextStyle({align:"center"}):"center"==e.currTextStyle.align?e.setTextStyle({align:"right"}):"right"==e.currTextStyle.align&&
e.setTextStyle({align:"left"})}),$("#btn_option_fill").on("mousedown",function(d){e.currTextStyle.fill?e.setTextStyle({fill:!1}):e.setTextStyle({fill:!0});d.stopPropagation();d.preventDefault()}),$("#btn_text_size").on("mousedown",function(d){isDomVisile(document.getElementById("menu_text_slider"))?$("#menu_text_slider").css("display","none"):$("#menu_text_slider").css("display","flex");d.stopPropagation();d.preventDefault()}),$("#btn_option_font").on("mousedown",function(d){isDomVisile(document.getElementById("menu_text_font"))?
$("#menu_text_font").css("display","none"):$("#menu_text_font").css("display","block");d.stopPropagation();d.preventDefault()}),$(".font_chu").on("mousedown",function(d){e.setTextStyle({font:$(this).attr("data")});d.stopPropagation();d.preventDefault()}),$("#menu_text_color").on("mousedown",function(d){d.stopPropagation()}),$("#menu_text_color").css("overflow-x","hidden"))},showMenuText:function(){$("#mnote_menu_text").css("display","block");$("#mnote_setting_zoom_out").css("display","none");$("#mnote_setting_zoom_in").css("display",
"none")},hideMenuText:function(){$("#mnote_menu_text").css("display","none");$("#menu_text_slider").css("display","none");$("#menu_text_font").css("display","none");is_touch_device()||($("#mnote_setting_zoom_out").css("display","block"),$("#mnote_setting_zoom_in").css("display","block"))},_addText:function(a,b,c,e,d){var f=is_touch_device()?200:80;c=c+f>this.pageWidth?this.pageWidth-f:c;b=$('<div pageid="'+a+'" class="obj_text" style="padding:10px" contenteditable="true">'+b+"</div>");a=$("#page_"+
a).find(".page_objs_layer")[0];$(a).append(b);$(b).css("position","absolute");$(b).css("font-family",d.font);$(b).css("text-align",d.align);$(b).css("left",c+"px");$(b).css("top",e+"px");$(b).css("min-width",f+"px");$(b).css("letter-spacing","3px");$(b).css("font-size",d.size+"px");$(b).css("font-weight","bold");d.fill?($(b).css("color","white"),$(b).css("background-color",d.color)):($(b).css("color",d.color),$(b).css("background-color","tranparent"));"edit"==this.mnotedata.mode&&$(b).css("pointer-events",
"all");$(b).css("border-radius","8px");$(b).attr("styleText",JSON.stringify(d).replaceAll('"',"'"));var g=this;$(b).blur(function(){cc.log("on text lost focus");$(this).removeClass("focusing");$(this).css("border","none");""==$(this).html().trim()&&$(this).remove();g.setMode(g.MODE_DRAWRING)});$(b).focus(function(h){cc.log("on text focus");$(this).addClass("focusing");$(this).css("border","dashed 2px");g.setTextStyle(JSON.parse($(this).attr("styleText").replaceAll("'",'"')));g.setMode(g.MODE_ENTER_TEXT)});
$(b).on("input",function(h){h=parseInt($(this).css("left"));h+$(this).width()>g.pageWidth-15&&(h=g.pageWidth-$(this).width()-15,$(this).css("left",h+"px"))});this.moveable(b);return $(b)},addText:function(a,b,c){a=this._addText(a,"",b,c,this.currTextStyle);this.focusText($(a));this.setMode(this.MODE_ENTER_TEXT)},focusText:function(a){this.blurText();$(".focusing").removeClass("focusing");$(a).focus();var b=$(a).get(0).getBoundingClientRect(),c=0;b.top>this.appHeight/4-50&&(c=b.top-(this.appHeight/
4-50));this.panzoom&&"android"==getOs()&&this.panzoom.moveBy(0,-c);c=$(a).get(0);if(""!=$(a).html()){a=document.createRange();b=window.getSelection();if(void 0!=c.childNodes){c=c.childNodes[c.childNodes.length-1];if(3==c.nodeType){var e=c.length;a.setStart(c,e)}1==c.nodeType&&(e=c.firstChild.length,a.setStart(c.firstChild,e))}else c=c.firstChild,a.setStart(c,c.length);a.collapse(!0);b.removeAllRanges();b.addRange(a)}},blurText:function(){$(".focusing").blur();$(".focusing").each(function(a){$(this).removeClass("focusing");
$(this).css("border","none");""==$(this).html().trim()&&$(this).remove()})},setTextStyle:function(a){a.font&&(this.currTextStyle.font=a.font);a.color&&(this.currTextStyle.color=a.color);a.size&&(this.currTextStyle.size=a.size);void 0!=a.fill&&(this.currTextStyle.fill=a.fill);a.align&&(this.currTextStyle.align=a.align);a=this.currTextStyle.size;$("#btn_text_size").find("span").html(a);$("#slider_text_thumb").css("background-color",this.currTextStyle.color);var b=this;$(".btn-color-text-small").each(function(c){$(this).empty();
$(this).parent().css("border","none");$(this).attr("data")==b.currTextStyle.color&&($(this).append($('<i class="material-icons">check</i>')),$(this).parent().css("border","solid 1px #CCCCCC"))});"left"==this.currTextStyle.align&&$("#btn_option_align").find("i").html("format_align_left");"right"==this.currTextStyle.align&&$("#btn_option_align").find("i").html("format_align_right");"center"==this.currTextStyle.align&&$("#btn_option_align").find("i").html("format_align_center");this.currTextStyle.fill?
$("#btn_option_fill").find("i").html("font_download"):$("#btn_option_fill").find("i").html("format_color_text");$(".focusing").css("font-family",this.currTextStyle.font);$(".focusing").css("font-size",this.currTextStyle.size);$(".focusing").css("text-align",this.currTextStyle.align);this.currTextStyle.fill?($(".focusing").css("color","white"),$(".focusing").css("background-color",this.currTextStyle.color)):($(".focusing").css("color",this.currTextStyle.color),$(".focusing").css("background-color",
"transparent"));$(".focusing").attr("styleText",JSON.stringify(this.currTextStyle).replaceAll('"',"'"));try{localStorage&&localStorage.setItem("textStyle",JSON.stringify(this.currTextStyle))}catch(c){}},addTouchTap:function(a,b){$(a).on("touchstart",function(c){1<c.touches.length||($(this).attr("downx",c.touches[0].clientX),$(this).attr("downy",c.touches[0].clientY),$(this).attr("movex",c.touches[0].clientX),$(this).attr("movey",c.touches[0].clientY),c.preventDefault())});$(a).on("touchmove",function(c){1<
c.touches.length||($(this).attr("movex",c.touches[0].clientX),$(this).attr("movey",c.touches[0].clientY))});$(a).on("touchend",function(c){var e=parseInt($(this).attr("downx")),d=parseInt($(this).attr("downy")),f=parseInt($(this).attr("movex")),g=parseInt($(this).attr("movey"));13>Math.abs(e-f)&&13>Math.abs(d-g)&&b&&b();c.preventDefault()});$(a).on("mouseup",function(c){b&&b()})},updateMark:function(a){this.countWrong=$(".wrong").length;this.countRight=$(".correct").length;this.countWrong=0>this.countWrong?
0:this.countWrong;this.countRight=0>this.countRight?0:this.countRight;var b=this.countRight+this.countWrong;this.point=0;if(0<b){var c=(10*this.countRight/b).toFixed(1),e=1==this.mnotedata.hideMark?"":" = "+c+" \u0110i\u1ec3m ";$("#mnote_mark_result").html("Tr\u1ea3 l\u1eddi \u0111\u00fang "+this.countRight+" / "+b+e+'.    <span style="color: green;margin-left: 20px;">\u0111 : '+this.countRight+' </span> <span style="color: red;margin-left:20px ;">s : '+this.countWrong+"</span>");this.point=void 0!=
a&&null!=a?a:c}else $("#mnote_mark_result").html("Ch\u01b0a c\u00f3 s\u1ed1 c\u00e2u \u0111\u00fang , c\u00e2u sai "),this.point=a;isNaN(this.point)&&(this.point=0);$("#mark_number_txt").val(this.point);var d=this;$(".btn-mark-chose-bt").each(function(){$(this).css("background-color","#e0e0e0");$(this).find("span").css("color","#444444");parseInt($(this).attr("data"))==Math.round(d.point)&&($(this).css("background-color","red"),$(this).find("span").css("color","white"))})},initMarkUI:function(){var a=
this;$(".mnote_mark_point_txt").focus(function(){var d=$("#mnote_mark").get(0).getBoundingClientRect(),f=0;100<d.top&&(f=d.top-100);a.panzoom&&a.panzoom.moveBy(0,-f);a.markTxtFocus=!0;a.setMode(a.MODE_NORMAL)});$(".mnote_mark_point_txt").blur(function(){a.markTxtFocus=!1});var b=this;$("#mark_comment_txt").on("input",function(d){b.resizeTxtComment()});for(var c=10;0<=c;c--){var e=$('<div class="btn-mark-chose"><div data="'+c+'" class="btn-mark-chose-bt  btn-floating waves-effect waves-light" style="background-color:#e0e0e0"><span style="color:#444444">'+
c+"</span></div></div>");$("#mnote_mark_chose").append($(e));10==c&&$(e).find("span").css("left","30px")}$("#mnote_mark_chose").on("touchstart",function(d){d.preventDefault()});$(".btn-mark-chose-bt").each(function(){var d=this;b.addTouchTap($(this),function(){b.updateMark(parseInt($(d).attr("data")))})});$("#mnote_mark_hide").on("mouseup touchend",function(d){1==b.mnotedata.hideMark?b.showMark():b.hideMark();b.updateMark();d.preventDefault()});c=$("#switch_hide_mark").find("input")[0];$(c).on("change",
function(d){this.checked?b.showMark():b.hideMark();d.stopPropagation();d.preventDefault()});$("#mark_number_txt").on("input",function(){var d=Math.floor($("#mark_number_txt").val());isNaN(d)||$(".btn-mark-chose-bt").each(function(){$(this).css("background-color","#e0e0e0");$(this).find("span").css("color","#444444");parseInt($(this).attr("data"))==d&&($(this).css("background-color","red"),$(this).find("span").css("color","white"))})});$("#mark_comment_txt").on("touchstart",function(d){});$("#mnote_mark_emoji_bt").click(function(){if("block"==
$("#emoji_chosen").css("display"))$("#emoji_chosen").css("display","none");else if($("#emoji_chosen").css("display","block"),0==$(".emoji_chosen").length){for(var d=1;20>d;d++){var f=$("<img class='emoji_chosen' src='images/emoji/emoji"+d+".gif' width='80' height='80'/>");$("#emoji_chosen_container").append($(f));$(f).css("cursor","pointer")}$("#emoji_chosen_container").width(80*(d+1)+"px");$(".emoji_chosen").click(function(){a.addCommentEmoji([$(this).attr("src")])})}})},hideMark:function(a){this.mnotedata.hideMark=
!0;$("#switch_hide_mark").find("input")[0].checked=!1;$("#mnote_mark_number").css("display","none");$("#mnote_mark_comment").css("width","100%");$("#mnote_mark_chose").css("display","none");this.mnotedata.point=0;if(!a)try{localStorage.setItem("hideMark","true")}catch(b){}},showMark:function(a){this.mnotedata.hideMark=!1;$("#switch_hide_mark").find("input")[0].checked=!0;$("#mnote_mark_number").css("display","block");$("#mnote_mark_comment").css("width","65%");$("#mnote_mark_chose").css("display",
"block");if(!a)try{localStorage.setItem("hideMark","false")}catch(b){}},resizeTxtComment:function(){var a=document.getElementById("mark_comment_txt");a=$(a).height();a=(200>a?200:a)+130+$("#mnote_mark_emoji").height();this.mnotedata&&"view"==this.mnotedata.mode&&(a+=80);$("#mnote_mark_point").css("height",a+"px");$("#mark_number_txt").css("margin-top",(a-68-150)/2+"px");a=$("#mnote_mark_emoji_container").height()-50;a=0>a?0:a;$("#mnote_mark_emoji_bt").css("margin-top",a+"px")},addCommentEmoji:function(a){for(var b=
0;b<a.length;b++){var c=$('<img class="comment_emoji" src="'+a[b]+'" width="120" height="120"/>');$("#mnote_mark_emoji_container").append($(c));var e=this;$(c).css("cursor","pointer");$(c).click(function(d){"edit"==e.mnotedata.mode&&($(this).remove(),e.resizeTxtComment())})}this.resizeTxtComment()},initStaticTextSetting:function(){var a=this;this.staticTextConfig={urlImgCorrect:"images/rightwrong/right1.png",urlImgWrong:"images/rightwrong/wrong1.png",textCorrect:"\u0111",textWrong:"s",useCorrectText:!0,
useWrongText:!0,correctWidth:50,correctHeight:50,wrongWidth:50,wrongHeight:50,fontText:"font_chu_dep",fontSize:30,fontColor:"red"};try{var b=localStorage.getItem("staticTextConfig");b?this.staticTextConfig=JSON.parse(b):document.getElementById("ifclasslive").src="https://classlive.stume.net/localstorage.html"}catch(c){}$("#setting_static_text_size").on("input",function(){$(".setting_text").css("font-size",$("#setting_static_text_size").val()+"px")});$("#setting_static_text_font").on("change",function(){$(".setting_text").css("font-family",
$("#setting_static_text_font").val())});$("#setting_static_text_close").click(function(){a.hideStaticTextSetting()});$("#static_text_txt_menu").click(function(){$("#mnote_static_text_txt").css("display","block");$("#mnote_static_text_img").css("display","none")});$("#static_text_img_menu").click(function(){$("#mnote_static_text_txt").css("display","none");$("#mnote_static_text_img").css("display","block");a.initStaticTextImageChosen()});this.resizeTxtComment();$("select").formSelect();$("#setting_static_text_submit").click(function(){var c=
$("#setting_text_correct").html().trim();""==c&&(c="\u0111");a.staticTextConfig.textCorrect=c;a.staticTextConfig.useCorrectText=!0;c=$("#setting_text_wrong").html().trim();""==c&&(c="s");a.staticTextConfig.textWrong=c;a.staticTextConfig.useWrongText=!0;a.staticTextConfig.fontText=$("#setting_static_text_font").val();a.staticTextConfig.fontSize=$("#setting_static_text_size").val();a.staticTextConfig.correctWidth=$("#setting_text_correct").width();a.staticTextConfig.correctHeight=$("#setting_text_correct").height();
a.staticTextConfig.wrongWidth=$("#setting_text_wrong").width();a.staticTextConfig.wrongHeight=$("#setting_text_wrong").height();$(".wrong").css("font-family",a.staticTextConfig.fontText);$(".wrong").css("font-size",a.staticTextConfig.fontSize);$(".wrong").find("span").html(a.staticTextConfig.textWrong);$(".correct").css("font-family",a.staticTextConfig.fontText);$(".correct").css("font-size",a.staticTextConfig.fontSize);$(".correct").find("span").html(a.staticTextConfig.textCorrect);$(".wrong").find("span").css("display",
"block");$(".wrong").find("img").css("display","none");$(".correct").find("span").css("display","block");$(".correct").find("img").css("display","none");try{localStorage.setItem("staticTextConfig",JSON.stringify(a.staticTextConfig))}catch(e){}a.hideStaticTextSetting()});$("#setting_static_img_submit").click(function(){a.staticTextConfig.useCorrectText=!1;a.staticTextConfig.useWrongText=!1;a.staticTextConfig.correctWidth=50;a.staticTextConfig.correctHeight=50;a.staticTextConfig.wrongWidth=50;a.staticTextConfig.wrongHeight=
50;a.staticTextConfig.urlImgCorrect=$("#static_img_corect").attr("src");a.staticTextConfig.urlImgWrong=$("#static_img_wrong").attr("src");$(".correct_img").attr("src",a.staticTextConfig.urlImgCorrect);$(".wrong_img").attr("src",a.staticTextConfig.urlImgWrong);$(".wrong").find("span").css("display","none");$(".wrong").find("img").css("display","block");$(".correct").find("span").css("display","none");$(".correct").find("img").css("display","block");try{localStorage.setItem("staticTextConfig",JSON.stringify(a.staticTextConfig))}catch(c){}a.hideStaticTextSetting()})},
showStaticTextSetting:function(){$("#setting_static_text").css("display","block");$("#setting_text_correct").html(this.staticTextConfig.textCorrect);$("#setting_text_wrong").html(this.staticTextConfig.textWrong);$(".setting_text").css("font-size",this.staticTextConfig.fontSize+"px");$(".setting_text").css("font-family",this.staticTextConfig.fontText);$("#setting_static_text_size").val(this.staticTextConfig.fontSize);$("#setting_static_text_font").val(this.staticTextConfig.fontText);$("select").formSelect();
""==this.staticTextConfig.urlImgCorrect&&(this.staticTextConfig.urlImgCorrect="images/rightwrong/right1.png");""==this.staticTextConfig.urlImgWrong&&(this.staticTextConfig.urlImgWrong="images/rightwrong/wrong1.png");$("#static_img_corect").attr("src",this.staticTextConfig.urlImgCorrect);$("#static_img_wrong").attr("src",this.staticTextConfig.urlImgWrong);this.staticTextConfig.useCorrectText?($("#mnote_static_text_txt").css("display","block"),$("#mnote_static_text_img").css("display","none")):($("#mnote_static_text_txt").css("display",
"none"),$("#mnote_static_text_img").css("display","block"),this.initStaticTextImageChosen())},hideStaticTextSetting:function(){$("#setting_static_text").css("display","none")},initStaticTextImageChosen:function(){if(0==$(".static_img_correct").length){for(var a=1;6>a;a++){var b=$("<img class='static_img_correct' src='images/rightwrong/right"+a+".png' width='30' height='30'/>");$("#static_img_corect_container").append($(b));b=$("<img class='static_img_wrong' src='images/rightwrong/wrong"+a+".png' width='30' height='30'/>");
$("#static_img_wrong_container").append($(b))}$(".static_img_correct").click(function(){$("#static_img_corect").attr("src",$(this).attr("src"))});$(".static_img_wrong").click(function(){$("#static_img_wrong").attr("src",$(this).attr("src"))})}},initMathEditor:function(){var a=this;is_touch_device()&&($("#math_editor").css("height",window.innerHeight-60),$("#math_editor").css("top","60"));$("#math_editor_close").click(function(){a.hideMathEditor()});$("#math_editor_submit").click(function(){});this.myEditor=
new MathEditor("mathquill_editor");this.myEditor.styleMe({textarea_background:"#FFFFFF",textarea_foreground:"#FF0000",textarea_border:"#000000",toolbar_background:"#FFFFFF",toolbar_foreground:"#000000",toolbar_border:"#000000",button_background:"#FFFFFF",button_border:"#000000"})},showMathEditor:function(){$("#math_editor").css("display","block");this.myEditor.setLatex("")},hideMathEditor:function(){$("#math_editor").css("display","none")},convertCoordGlobalToLocal:function(a,b){var c={x:a,y:b};c.x=
a*this.pageScale;c.y=b*this.pageScale;var e=0;is_touch_device()||(e=document.getElementById("mnote_content").scrollTop);c.y+=e;return c},exportPdf:function(){var a=this;showLoading();this.zipExport=new JSZip;$(".bt-edit-bg").css("display","none");setTimeout(function(){a.exportPdfPage(0)},300)},exportPdfPage:function(a){var b=this;0>a&&(a=0);a>=this.pageCount?html2canvas(document.querySelector("#mnote_mark_point"),{useCORS:!0}).then(function(c){c=c.toDataURL("image/jpeg",70);c=c.substr(23);b.zipExport.file("diem_loiphe.jpg",
c,{base64:!0});var e=b.mnotedata.classname+"_"+b.mnotedata.fullname+"_"+b.mnotedata.homeworkTime+"_"+b.mnotedata.homework;b.zipExport.generateAsync({type:"blob"}).then(function(d){hideLoading();$(".bt-edit-bg").css("display","block");saveAs(d,e+".zip")})}):html2canvas(document.querySelector("#page_"+a),{useCORS:!0}).then(function(c){c=c.toDataURL("image/jpeg",70);c=c.substr(23);b.zipExport.file("trang_"+a+".jpg",c,{base64:!0});b.exportPdfPage(a+1)})},exportPdf_:function(){showLoading();$("#mnote_mark_chose").css("display",
"none");$("#btn_save_data").css("display","none");$("#mnote_hold_bt").css("display","none");$("#mnote_setting_bt").css("display","none");$("#hide_mark").css("display","none");var a=$("#mnote_mark").css("top");$("#mnote_mark").css("top","36px");$("#mnote_mark_hide").css("display","none");var b=$("#mnote_mark_point").height()+20;$("#mnote_pages").css("padding-top",b+"px");b=$("#mnote_user_info").height()-10;$("#mnote_pages").css("margin-top",b+"px");$("#mnote_mark_result").css("display","none");$("#mnote_mark_emoji_bt").css("display",
"none");$("#mnote_help").css("display","none");$("#mnote_mark_emoji_bt").css("display","none");$("#mnote_user_info").css("display","block");$(".bt-edit-bg").css("display","none");$("#emoji_chosen").css("display","none");var c=this.mnotedata.classname+"_"+this.mnotedata.fullname+"_"+this.mnotedata.homeworkTime+"_"+this.mnotedata.homework;setTimeout(function(){html2canvas(document.querySelector("#mnote_container"),{useCORS:!0}).then(function(e){var d=document.createElement("a");d.download=c+".jpg";
d.href=e.toDataURL("image/jpeg",.9);d.click();$("#mnote_mark_chose").css("display","block");$("#btn_save_data").css("display","block");$("#mnote_hold_bt").css("display","block");$("#mnote_setting_bt").css("display","block");$("#hide_mark").css("display","flex");$("#mnote_mark").css("top",a);$("#mnote_mark_hide").css("display","block");$("#mnote_pages").css("padding-top","0px");$("#mnote_pages").css("margin-top","0px");$("#mnote_mark_result").css("display","flex");$("#mnote_mark_emoji_bt").css("display",
"block");$("#mnote_help").css("display","block");$("#mnote_mark_emoji_bt").css("display","block");$("#mnote_user_info").css("display","none");$(".bt-edit-bg").css("display","block");hideLoading()})},1E3)},isPanzoomEnable:function(){return this.mode==this.MODE_DRAWRING&&(this.currBrush==this.BRUSH_PEN||this.currBrush==this.BRUSH_ERASE||this.currBrush==this.BRUSH_LINE||this.currBrush==this.BRUSH_RECTANGLE||this.currBrush==this.BRUSH_CIRCLE||this.currBrush==this.BRUSH_ARROW)||this.mode==this.MODE_ENTER_TEXT||
1==this.markTxtFocus?!1:!0},onresize:function(a,b){is_touch_device()&&this.appWidth==a&&this.appHeight<b&&(this.blurText(),$(".mnote_mark_point_txt").blur());this.appWidth=a;this.appHeight=b;$("#mnote_app").css("height",b+"px");$(this.note_content).css("height",b+"px");$(this.note_pages).width(this.pageWidth);this.pageScale=$(this.note_content).width()/this.pageWidth;$(this.note_pages).css("transform","scale("+this.pageScale+")")}}),MNote=function(){var a;return{getInstance:function(){a||(a=new MNote_instance);
return a},releaseInst:function(){a=null},inst:function(){return this.getInstance()}}}();function loadCss(){var a=document.getElementsByTagName("head")[0],b=document.createElement("link");document.createElement("img");var c="css/mnote_u.css?t="+(new Date).getTime();b.href=c;b.rel="stylesheet";a.appendChild(b);startApp()}function startApp(){$("#root").css("display","block");mnote=MNote.getInstance()}loadCss();